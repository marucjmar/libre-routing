(self.webpackChunklibre_routing_playground=self.webpackChunklibre_routing_playground||[]).push([[179],{69:Ro=>{const Lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",sn=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],ue="undefined"!=typeof BigInt?BigInt:Number;function on(nn){let ot=nn;return ot&ue(1)&&(ot=~ot),ot>>=ue(1),+ot.toString()}function vn(nn){let ot="",kt=ue(nn);for(;kt>31;){const qn=kt&ue(31)|ue(32);ot+=Lr[qn],kt>>=ue(5)}return ot+Lr[kt]}function kn(nn){let ot=ue(nn);const kt=ot<0;return ot<<=ue(1),kt&&(ot=~ot),vn(ot)}Ro.exports={encode:function ar({precision:nn=5,thirdDim:ot=0,thirdDimPrecision:kt=0,polyline:qn}){const Gn=10**nn,vr=10**kt,Fr=function rr(nn,ot,kt){if(nn<0||nn>15)throw new Error("precision out of range. Should be between 0 and 15");if(kt<0||kt>15)throw new Error("thirdDimPrecision out of range. Should be between 0 and 15");if(ot<0||ot>7||4===ot||5===ot)throw new Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");const qn=kt<<7|ot<<4|nn;return vn(1)+vn(qn)}(nn,ot,kt),Or=[];let lr=ue(0),zr=ue(0),Kn=ue(0);return qn.forEach(Zt=>{const Vi=ue(Math.round(Zt[0]*Gn));Or.push(kn(Vi-lr)),lr=Vi;const ri=ue(Math.round(Zt[1]*Gn));if(Or.push(kn(ri-zr)),zr=ri,ot){const wi=ue(Math.round(Zt[2]*vr));Or.push(kn(wi-Kn)),Kn=wi}}),[...Fr,...Or].join("")},decode:function jt(nn){const ot=function pn(nn){let ot=ue(0),kt=ue(0);const qn=[];if(nn.split("").forEach(Gn=>{const vr=ue(function Pt(nn){const ot=nn.charCodeAt(0);return sn[ot-45]}(Gn));ot|=(vr&ue(31))<<kt,(vr&ue(32))===ue(0)?(qn.push(ot),ot=ue(0),kt=ue(0)):kt+=ue(5)}),kt>0)throw new Error("Invalid encoding");return qn}(nn),kt=function _n(nn,ot){if(1!=+nn.toString())throw new Error("Invalid format version");const kt=+ot.toString();return{precision:15&kt,thirdDim:kt>>4&7,thirdDimPrecision:kt>>7&15}}(ot[0],ot[1]),qn=10**kt.precision,Gn=10**kt.thirdDimPrecision,{thirdDim:vr}=kt;let Fr=0,Or=0,lr=0;const zr=[];let Kn=2;for(;Kn<ot.length;)Fr+=on(ot[Kn])/qn,Or+=on(ot[Kn+1])/qn,vr?(lr+=on(ot[Kn+2])/Gn,zr.push([Fr,Or,lr]),Kn+=3):(zr.push([Fr,Or]),Kn+=2);if(Kn!==ot.length)throw new Error("Invalid encoding. Premature ending reached");return{...kt,polyline:zr}},ABSENT:0,LEVEL:1,ALTITUDE:2,ELEVATION:3}},705:(Ro,ws,Lr)=>{"use strict";function sn(e){return"function"==typeof e}function Us(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Lo=Us(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,a)=>`${a+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function y(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class hn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const u of n)u.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(sn(i))try{i()}catch(u){t=u instanceof Lo?u.errors:[u]}const{_teardowns:a}=this;if(a){this._teardowns=null;for(const u of a)try{Ze(u)}catch(f){t=t??[],f instanceof Lo?t=[...t,...f.errors]:t.push(f)}}if(t)throw new Lo(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Ze(t);else{if(t instanceof hn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&y(n,t)}remove(t){const{_teardowns:n}=this;n&&y(n,t),t instanceof hn&&t._removeParent(this)}}hn.EMPTY=(()=>{const e=new hn;return e.closed=!0,e})();const ci=hn.EMPTY;function hi(e){return e instanceof hn||e&&"closed"in e&&sn(e.remove)&&sn(e.add)&&sn(e.unsubscribe)}function Ze(e){sn(e)?e():e.unsubscribe()}const ue={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},jt={setTimeout(...e){const{delegate:t}=jt;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=jt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Pt(e){jt.setTimeout(()=>{const{onUnhandledError:t}=ue;if(!t)throw e;t(e)})}function pn(){}const _n=rr("C",void 0,void 0);function rr(e,t,n){return{kind:e,value:t,error:n}}let vn=null;function kn(e){if(ue.useDeprecatedSynchronousErrorHandling){const t=!vn;if(t&&(vn={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=vn;if(vn=null,n)throw i}}else e()}class ot extends hn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,hi(t)&&t.add(this)):this.destination=Fr}static create(t,n,i){return new kt(t,n,i)}next(t){this.isStopped?vr(function ar(e){return rr("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?vr(function on(e){return rr("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?vr(_n,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class kt extends ot{constructor(t,n,i){let a;if(super(),sn(t))a=t;else if(t){let u;({next:a,error:n,complete:i}=t),this&&ue.useDeprecatedNextContext?(u=Object.create(t),u.unsubscribe=()=>this.unsubscribe()):u=t,a=null==a?void 0:a.bind(u),n=null==n?void 0:n.bind(u),i=null==i?void 0:i.bind(u)}this.destination={next:a?qn(a):pn,error:qn(n??Gn),complete:i?qn(i):pn}}}function qn(e,t){return(...n)=>{try{e(...n)}catch(i){ue.useDeprecatedSynchronousErrorHandling?function nn(e){ue.useDeprecatedSynchronousErrorHandling&&vn&&(vn.errorThrown=!0,vn.error=e)}(i):Pt(i)}}}function Gn(e){throw e}function vr(e,t){const{onStoppedNotification:n}=ue;n&&jt.setTimeout(()=>n(e,t))}const Fr={closed:!0,next:pn,error:Gn,complete:pn},Or="function"==typeof Symbol&&Symbol.observable||"@@observable";function lr(e){return e}let Zt=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,a){const u=function wi(e){return e&&e instanceof ot||function ri(e){return e&&sn(e.next)&&sn(e.error)&&sn(e.complete)}(e)&&hi(e)}(n)?n:new kt(n,i,a);return kn(()=>{const{operator:f,source:v}=this;u.add(f?f.call(u,v):v?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=Vi(i))((a,u)=>{let f;f=this.subscribe(v=>{try{n(v)}catch(w){u(w),null==f||f.unsubscribe()}},u,a)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[Or](){return this}pipe(...n){return function Kn(e){return 0===e.length?lr:1===e.length?e[0]:function(n){return e.reduce((i,a)=>a(i),n)}}(n)(this)}toPromise(n){return new(n=Vi(n))((i,a)=>{let u;this.subscribe(f=>u=f,f=>a(f),()=>i(u))})}}return e.create=t=>new e(t),e})();function Vi(e){var t;return null!==(t=e??ue.Promise)&&void 0!==t?t:Promise}const ls=Us(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Nr=(()=>{class e extends Zt{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new Wt(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new ls}next(n){kn(()=>{if(this._throwIfClosed(),!this.isStopped){const i=this.observers.slice();for(const a of i)a.next(n)}})}error(n){kn(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){kn(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:a,observers:u}=this;return i||a?ci:(u.push(n),new hn(()=>y(u,n)))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:a,isStopped:u}=this;i?n.error(a):u&&n.complete()}asObservable(){const n=new Zt;return n.source=this,n}}return e.create=(t,n)=>new Wt(t,n),e})();class Wt extends Nr{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:ci}}function Ui(e){return sn(null==e?void 0:e.lift)}function an(e){return t=>{if(Ui(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}class Cn extends ot{constructor(t,n,i,a,u){super(t),this.onFinalize=u,this._next=n?function(f){try{n(f)}catch(v){t.error(v)}}:super._next,this._error=a?function(f){try{a(f)}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(f){t.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function Xt(e,t){return an((n,i)=>{let a=0;n.subscribe(new Cn(i,u=>{i.next(e.call(t,u,a++))}))})}function Vr(e){return this instanceof Vr?(this.v=e,this):new Vr(e)}function ur(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,i=n.apply(e,t||[]),u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(G){i[G]&&(a[G]=function(K){return new Promise(function(ce,De){u.push([G,K,ce,De])>1||v(G,K)})})}function v(G,K){try{!function w(G){G.value instanceof Vr?Promise.resolve(G.value.v).then(I,M):z(u[0][2],G)}(i[G](K))}catch(ce){z(u[0][3],ce)}}function I(G){v("next",G)}function M(G){v("throw",G)}function z(G,K){G(K),u.shift(),u.length&&v(u[0][0],u[0][1])}}function Ya(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function $t(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(u){n[u]=e[u]&&function(f){return new Promise(function(v,w){!function a(u,f,v,w){Promise.resolve(w).then(function(I){u({value:I,done:v})},f)}(v,w,(f=e[u](f)).done,f.value)})}}}const Ur=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function cs(e){return sn(null==e?void 0:e.then)}function Ir(e){return sn(e[Or])}function ha(e){return Symbol.asyncIterator&&sn(null==e?void 0:e[Symbol.asyncIterator])}function fi(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const fo=function ho(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ln(e){return sn(null==e?void 0:e[fo])}function Hs(e){return ur(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:a}=yield Vr(n.read());if(a)return yield Vr(void 0);yield yield Vr(i)}}finally{n.releaseLock()}})}function Jn(e){return sn(null==e?void 0:e.getReader)}function ii(e){if(e instanceof Zt)return e;if(null!=e){if(Ir(e))return function Qn(e){return new Zt(t=>{const n=e[Or]();if(sn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ur(e))return function da(e){return new Zt(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(cs(e))return function qs(e){return new Zt(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Pt)})}(e);if(ha(e))return Ja(e);if(Ln(e))return function zo(e){return new Zt(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Jn(e))return function No(e){return Ja(Hs(e))}(e)}throw fi(e)}function Ja(e){return new Zt(t=>{(function Bo(e,t){var n,i,a,u;return function ji(e,t,n,i){return new(n||(n=Promise))(function(u,f){function v(M){try{I(i.next(M))}catch(z){f(z)}}function w(M){try{I(i.throw(M))}catch(z){f(z)}}function I(M){M.done?u(M.value):function a(u){return u instanceof n?u:new n(function(f){f(u)})}(M.value).then(v,w)}I((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ya(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(f){a={error:f}}finally{try{i&&!i.done&&(u=n.return)&&(yield u.call(n))}finally{if(a)throw a.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function jr(e,t,n,i=0,a=!1){const u=t.schedule(function(){n(),a?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(u),!a)return u}function Fn(e,t,n=1/0){return sn(t)?Fn((i,a)=>Xt((u,f)=>t(i,u,a,f))(ii(e(i,a))),n):("number"==typeof t&&(n=t),an((i,a)=>function fa(e,t,n,i,a,u,f,v){const w=[];let I=0,M=0,z=!1;const G=()=>{z&&!w.length&&!I&&t.complete()},K=De=>I<i?ce(De):w.push(De),ce=De=>{u&&t.next(De),I++;let Ie=!1;ii(n(De,M++)).subscribe(new Cn(t,Me=>{null==a||a(Me),u?K(Me):t.next(Me)},()=>{Ie=!0},void 0,()=>{if(Ie)try{for(I--;w.length&&I<i;){const Me=w.shift();f?jr(t,f,()=>ce(Me)):ce(Me)}G()}catch(Me){t.error(Me)}}))};return e.subscribe(new Cn(t,K,()=>{z=!0,G()})),()=>{null==v||v()}}(i,a,e,n)))}function Di(e=1/0){return Fn(lr,e)}const q=new Zt(e=>e.complete());function W(e){return e[e.length-1]}function re(e){return function j(e){return e&&sn(e.schedule)}(W(e))?e.pop():void 0}function ne(e,t=0){return an((n,i)=>{n.subscribe(new Cn(i,a=>jr(i,e,()=>i.next(a),t),()=>jr(i,e,()=>i.complete(),t),a=>jr(i,e,()=>i.error(a),t)))})}function ae(e,t=0){return an((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function He(e,t){if(!e)throw new Error("Iterable cannot be null");return new Zt(n=>{jr(n,t,()=>{const i=e[Symbol.asyncIterator]();jr(n,t,()=>{i.next().then(a=>{a.done?n.complete():n.next(a.value)})},0,!0)})})}function at(e,t){return t?function nt(e,t){if(null!=e){if(Ir(e))return function ge(e,t){return ii(e).pipe(ae(t),ne(t))}(e,t);if(Ur(e))return function me(e,t){return new Zt(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(cs(e))return function Ee(e,t){return ii(e).pipe(ae(t),ne(t))}(e,t);if(ha(e))return He(e,t);if(Ln(e))return function We(e,t){return new Zt(n=>{let i;return jr(n,t,()=>{i=e[fo](),jr(n,t,()=>{let a,u;try{({value:a,done:u}=i.next())}catch(f){return void n.error(f)}u?n.complete():n.next(a)},0,!0)}),()=>sn(null==i?void 0:i.return)&&i.return()})}(e,t);if(Jn(e))return function Ye(e,t){return He(Hs(e),t)}(e,t)}throw fi(e)}(e,t):ii(e)}function bt(e){return e<=0?()=>q:an((t,n)=>{let i=0;t.subscribe(new Cn(n,a=>{++i<=e&&(n.next(a),e<=i&&n.complete())}))})}function Ft(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(bt(1)).subscribe(()=>e())}function dt(e){for(let t in e)if(e[t]===dt)return t;throw Error("Could not find renamed property on target object.")}function yt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(yt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Cs(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const ju=dt({__forward_ref__:dt});function Qa(e){return e.__forward_ref__=Qa,e.toString=function(){return yt(this())},e}function _t(e){return function Vo(e){return"function"==typeof e&&e.hasOwnProperty(ju)&&e.__forward_ref__===Qa}(e)?e():e}class Dt extends Error{constructor(t,n){super(function pa(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function cr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():function ft(e){return"string"==typeof e?e:null==e?"":String(e)}(e)}function Uo(e,t){const n=t?` in ${t}`:"";throw new Dt(-201,`No provider for ${cr(e)} found${n}`)}function hr(e,t){null==e&&function bn(e,t,n,i){throw new Error(`ASSERTION ERROR: ${e}`+(null==i?"":` [Expected=> ${n} ${i} ${t} <=Actual]`))}(t,e,null,"!=")}function Ke(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ei(e){return{providers:e.providers||[],imports:e.imports||[]}}function tl(e){return nl(e,ya)||nl(e,Xu)}function nl(e,t){return e.hasOwnProperty(t)?e[t]:null}function Wu(e){return e&&(e.hasOwnProperty(po)||e.hasOwnProperty(Th))?e[po]:null}const ya=dt({\u0275prov:dt}),po=dt({\u0275inj:dt}),Xu=dt({ngInjectableDef:dt}),Th=dt({ngInjectorDef:dt});var Et=(()=>((Et=Et||{})[Et.Default=0]="Default",Et[Et.Host=1]="Host",Et[Et.Self=2]="Self",Et[Et.SkipSelf=4]="SkipSelf",Et[Et.Optional=8]="Optional",Et))();let jl;function Hi(e){const t=jl;return jl=e,t}function _a(e,t,n){const i=tl(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&Et.Optional?null:void 0!==t?t:void Uo(yt(e),"Injector")}function hs(e){return{toString:e}.toString()}var Ci=(()=>((Ci=Ci||{})[Ci.OnPush=0]="OnPush",Ci[Ci.Default=1]="Default",Ci))(),Hr=(()=>{return(e=Hr||(Hr={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",Hr;var e})();const $e="undefined"!=typeof globalThis&&globalThis,Yu="undefined"!=typeof window&&window,va="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Be=$e||"undefined"!=typeof global&&global||Yu||va,Si={},ln=[],$o=dt({\u0275cmp:dt}),sl=dt({\u0275dir:dt}),xa=dt({\u0275pipe:dt}),ol=dt({\u0275mod:dt}),cn=dt({\u0275fac:dt}),Ss=dt({__NG_ELEMENT_ID__:dt});let Vt=0;function Gs(e){return hs(()=>{const n={},i={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Ci.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||ln,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Hr.Emulated,id:"c",styles:e.styles||ln,_:null,setInput:null,schemas:e.schemas||null,tView:null},a=e.directives,u=e.features,f=e.pipes;return i.id+=Vt++,i.inputs=ll(e.inputs,n),i.outputs=ll(e.outputs),u&&u.forEach(v=>v(i)),i.directiveDefs=a?()=>("function"==typeof a?a():a).map(An):null,i.pipeDefs=f?()=>("function"==typeof f?f():f).map(Ho):null,i})}function An(e){return fr(e)||function Ii(e){return e[sl]||null}(e)}function Ho(e){return function pi(e){return e[xa]||null}(e)}const al={};function Zs(e){return hs(()=>{const t={type:e.type,bootstrap:e.bootstrap||ln,declarations:e.declarations||ln,imports:e.imports||ln,exports:e.exports||ln,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(al[e.id]=e.type),t})}function ll(e,t){if(null==e)return Si;const n={};for(const i in e)if(e.hasOwnProperty(i)){let a=e[i],u=a;Array.isArray(a)&&(u=a[1],a=a[0]),n[a]=i,t&&(t[a]=u)}return n}const dr=Gs;function fr(e){return e[$o]||null}function mi(e,t){const n=e[ol]||null;if(!n&&!0===t)throw new Error(`Type ${yt(e)} does not have '\u0275mod' property.`);return n}function Ki(e){return Array.isArray(e)&&"object"==typeof e[1]}function Ti(e){return Array.isArray(e)&&!0===e[1]}function fs(e){return 0!=(8&e.flags)}function Ea(e){return 2==(2&e.flags)}function Ai(e){return null!==e.template}function ec(e){return 0!=(512&e[2])}function As(e,t){return e.hasOwnProperty(cn)?e[cn]:null}class Yl{constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function Ms(e){return e.type.prototype.ngOnChanges&&(e.setInput=Jl),cl}function cl(){const e=Sa(this),t=e?.current;if(t){const n=e.previous;if(n===Si)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function Jl(e,t,n,i){const a=Sa(e)||function lc(e,t){return e[hl]=t}(e,{previous:Si,current:null}),u=a.current||(a.current={}),f=a.previous,v=this.declaredInputs[n],w=f[v];u[v]=new Yl(w&&w.currentValue,t,f===Si),e[i]=t}const hl="__ngSimpleChanges__";function Sa(e){return e[hl]||null}let Ia;function In(e){return!!e.listen}const qe={createRenderer:(e,t)=>function pl(){return void 0!==Ia?Ia:"undefined"!=typeof document?document:void 0}()};function yn(e){for(;Array.isArray(e);)e=e[0];return e}function Wr(e,t){return yn(t[e.index])}function d(e,t){const n=t[e];return Ki(n)?n:n[0]}function s(e){return 4==(4&e[2])}function c(e){return 128==(128&e[2])}function g(e,t){return null==t?null:e[t]}function b(e){e[18]=0}function E(e,t){e[5]+=t;let n=e,i=e[3];for(;null!==i&&(1===t&&1===n[5]||-1===t&&0===n[5]);)i[5]+=t,n=i,i=i[3]}const S={lFrame:gr(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function H(){return S.bindingsEnabled}function V(){return S.lFrame.lView}function ee(){return S.lFrame.tView}function le(){let e=oe();for(;null!==e&&64===e.type;)e=e.parent;return e}function oe(){return S.lFrame.currentTNode}function de(e,t){const n=S.lFrame;n.currentTNode=e,n.isParent=t}function ye(){return S.lFrame.isParent}function Re(){return S.isInCheckNoChangesMode}function et(e){S.isInCheckNoChangesMode=e}function zn(e,t){const n=S.lFrame;n.bindingIndex=n.bindingRootIndex=e,Ji(t)}function Ji(e){S.lFrame.currentDirectiveIndex=e}function ki(){return S.lFrame.currentQueryIndex}function Xr(e){S.lFrame.currentQueryIndex=e}function Xs(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function mr(e,t,n){if(n&Et.SkipSelf){let a=t,u=e;for(;!(a=a.parent,null!==a||n&Et.Host||(a=Xs(u),null===a||(u=u[15],10&a.type))););if(null===a)return!1;t=a,e=u}const i=S.lFrame=rn();return i.currentTNode=t,i.lView=e,!0}function Nn(e){const t=rn(),n=e[1];S.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function rn(){const e=S.lFrame,t=null===e?null:e.child;return null===t?gr(e):t}function gr(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function er(){const e=S.lFrame;return S.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const dn=er;function Ks(){const e=er();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function li(e){S.lFrame.selectedIndex=e}function ru(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const u=e.data[n].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:v,ngAfterViewInit:w,ngAfterViewChecked:I,ngOnDestroy:M}=u;f&&(e.contentHooks||(e.contentHooks=[])).push(-n,f),v&&((e.contentHooks||(e.contentHooks=[])).push(n,v),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,v)),w&&(e.viewHooks||(e.viewHooks=[])).push(-n,w),I&&((e.viewHooks||(e.viewHooks=[])).push(n,I),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,I)),null!=M&&(e.destroyHooks||(e.destroyHooks=[])).push(n,M)}}function yl(e,t,n){iu(e,t,3,n)}function Aa(e,t,n,i){(3&e[2])===n&&iu(e,t,n,i)}function yo(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function iu(e,t,n,i){const u=i??-1,f=t.length-1;let v=0;for(let w=void 0!==i?65535&e[18]:0;w<f;w++)if("number"==typeof t[w+1]){if(v=t[w],null!=i&&v>=i)break}else t[w]<0&&(e[18]+=65536),(v<u||-1==u)&&(pf(e,n,t,w),e[18]=(4294901760&e[18])+w+2),w++}function pf(e,t,n,i){const a=n[i]<0,u=n[i+1],v=e[a?-n[i]:n[i]];if(a){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{u.call(v)}finally{}}}else try{u.call(v)}finally{}}class su{constructor(t,n,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function hc(e,t,n){const i=In(e);let a=0;for(;a<n.length;){const u=n[a];if("number"==typeof u){if(0!==u)break;a++;const f=n[a++],v=n[a++],w=n[a++];i?e.setAttribute(t,v,w,f):t.setAttributeNS(f,v,w)}else{const f=u,v=n[++a];Wn(f)?i&&e.setProperty(t,f,v):i?e.setAttribute(t,f,v):t.setAttribute(f,v),a++}}return a}function Fh(e){return 3===e||4===e||6===e}function Wn(e){return 64===e.charCodeAt(0)}function vl(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const a=t[i];"number"==typeof a?n=a:0===n||Oh(e,n,a,null,-1===n||2===n?t[++i]:null)}}return e}function Oh(e,t,n,i,a){let u=0,f=e.length;if(-1===t)f=-1;else for(;u<e.length;){const v=e[u++];if("number"==typeof v){if(v===t){f=-1;break}if(v>t){f=u-1;break}}}for(;u<e.length;){const v=e[u];if("number"==typeof v)break;if(v===n){if(null===i)return void(null!==a&&(e[u+1]=a));if(i===e[u+1])return void(e[u+2]=a)}u++,null!==i&&u++,null!==a&&u++}-1!==f&&(e.splice(f,0,t),u=f+1),e.splice(u++,0,n),null!==i&&e.splice(u++,0,i),null!==a&&e.splice(u++,0,a)}function Wo(e){return-1!==e}function ys(e){return 32767&e}function Xo(e,t){let n=function dc(e){return e>>16}(e),i=t;for(;n>0;)i=i[15],n--;return i}let fc=!0;function pc(e){const t=fc;return fc=e,t}let gm=0;function xl(e,t){const n=Ko(e,t);if(-1!==n)return n;const i=t[1];i.firstCreatePass&&(e.injectorIndex=t.length,gc(i.data,e),gc(t,null),gc(i.blueprint,null));const a=yc(e,t),u=e.injectorIndex;if(Wo(a)){const f=ys(a),v=Xo(a,t),w=v[1].data;for(let I=0;I<8;I++)t[u+I]=v[f+I]|w[f+I]}return t[u+8]=a,u}function gc(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Ko(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function yc(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,a=t;for(;null!==a;){const u=a[1],f=u.type;if(i=2===f?u.declTNode:1===f?a[6]:null,null===i)return-1;if(n++,a=a[15],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function Yo(e,t,n){!function zh(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(Ss)&&(i=n[Ss]),null==i&&(i=n[Ss]=gm++);const a=255&i;t.data[e+(a>>5)]|=1<<a}(e,t,n)}function au(e,t,n){if(n&Et.Optional)return e;Uo(t,"NodeInjector")}function gf(e,t,n,i){if(n&Et.Optional&&void 0===i&&(i=null),0==(n&(Et.Self|Et.Host))){const a=e[9],u=Hi(void 0);try{return a?a.get(t,i,n&Et.Optional):_a(t,i,n&Et.Optional)}finally{Hi(u)}}return au(i,t,n)}function yf(e,t,n,i=Et.Default,a){if(null!==e){const u=function xc(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Ss)?e[Ss]:void 0;return"number"==typeof t?t>=0?255&t:Nh:t}(n);if("function"==typeof u){if(!mr(t,e,i))return i&Et.Host?au(a,n,i):gf(t,n,i,a);try{const f=u(i);if(null!=f||i&Et.Optional)return f;Uo(n)}finally{dn()}}else if("number"==typeof u){let f=null,v=Ko(e,t),w=-1,I=i&Et.Host?t[16][6]:null;for((-1===v||i&Et.SkipSelf)&&(w=-1===v?yc(e,t):t[v+8],-1!==w&&Bh(i,!1)?(f=t[1],v=ys(w),t=Xo(w,t)):v=-1);-1!==v;){const M=t[1];if(lu(u,v,M.data)){const z=_f(v,t,n,f,i,I);if(z!==Jo)return z}w=t[v+8],-1!==w&&Bh(i,t[1].data[v+8]===I)&&lu(u,v,t)?(f=M,v=ys(w),t=Xo(w,t)):v=-1}}}return gf(t,n,i,a)}const Jo={};function Nh(){return new Pa(le(),V())}function _f(e,t,n,i,a,u){const f=t[1],v=f.data[e+8],M=vc(v,f,n,null==i?Ea(v)&&fc:i!=f&&0!=(3&v.type),a&Et.Host&&u===v);return null!==M?Ma(t,f,M,v):Jo}function vc(e,t,n,i,a){const u=e.providerIndexes,f=t.data,v=1048575&u,w=e.directiveStart,M=u>>20,G=a?v+M:e.directiveEnd;for(let K=i?v:v+M;K<G;K++){const ce=f[K];if(K<w&&n===ce||K>=w&&ce.type===n)return K}if(a){const K=f[w];if(K&&Ai(K)&&K.type===n)return w}return null}function Ma(e,t,n,i){let a=e[n];const u=t.data;if(function Lh(e){return e instanceof su}(a)){const f=a;f.resolving&&function Bl(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Dt(-200,`Circular dependency in DI detected for ${e}${n}`)}(cr(u[n]));const v=pc(f.canSeeViewProviders);f.resolving=!0;const w=f.injectImpl?Hi(f.injectImpl):null;mr(e,i,Et.Default);try{a=e[n]=f.factory(void 0,u,e,i),t.firstCreatePass&&n>=i.directiveStart&&function cc(e,t,n){const{ngOnChanges:i,ngOnInit:a,ngDoCheck:u}=t.type.prototype;if(i){const f=Ms(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,f),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,f)}a&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,a),u&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,u),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,u))}(n,u[n],t)}finally{null!==w&&Hi(w),pc(v),f.resolving=!1,dn()}}return a}function lu(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Bh(e,t){return!(e&Et.Self||e&Et.Host&&t)}class Pa{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return yf(this._tNode,this._lView,t,i,n)}}const Js="__parameters__";function wl(e,t,n){return hs(()=>{const i=function Uh(e){return function(...n){if(e){const i=e(...n);for(const a in i)this[a]=i[a]}}}(t);function a(...u){if(this instanceof a)return i.apply(this,u),this;const f=new a(...u);return v.annotation=f,v;function v(w,I,M){const z=w.hasOwnProperty(Js)?w[Js]:Object.defineProperty(w,Js,{value:[]})[Js];for(;z.length<=M;)z.push(null);return(z[M]=z[M]||[]).push(f),w}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a})}class qt{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Ke({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const vf=new qt("AnalyzeForEntryComponents");function Qt(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?(t===e&&(t=e.slice(0,n)),Qt(i,t)):t!==e&&t.push(i)}return t}function Qi(e,t){e.forEach(n=>Array.isArray(n)?Qi(n,t):t(n))}function $h(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Ra(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const _s={},Sc="__NG_DI_FLAG__",vo="ngTempTokenPath",Cf=/\n/gm,Sf="__source",bm=dt({provide:String,useValue:dt});let pu;function Kh(e){const t=pu;return pu=e,t}function If(e,t=Et.Default){if(void 0===pu)throw new Dt(203,"");return null===pu?_a(e,void 0,t):pu.get(e,t&Et.Optional?null:void 0,t)}function vt(e,t=Et.Default){return(function $l(){return jl}()||If)(_t(e),t)}function Yh(e){const t=[];for(let n=0;n<e.length;n++){const i=_t(e[n]);if(Array.isArray(i)){if(0===i.length)throw new Dt(900,"");let a,u=Et.Default;for(let f=0;f<i.length;f++){const v=i[f],w=mu(v);"number"==typeof w?-1===w?a=v.token:u|=w:a=v}t.push(vt(a,u))}else t.push(vt(i))}return t}function Fa(e,t){return e[Sc]=t,e.prototype[Sc]=t,e}function mu(e){return e[Sc]}const gu=Fa(wl("Inject",e=>({token:e})),-1),Qs=Fa(wl("Optional"),8),Oa=Fa(wl("SkipSelf"),4),Oc="__ngContext__";function Kr(e,t){e[Oc]=t}function dd(e){const t=function Va(e){return e[Oc]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function gd(e){return e.ngOriginalError}function Xf(e,...t){e.error(...t)}class xo{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t),i=function yd(e){return e&&e.ngErrorLogger||Xf}(t);i(this._console,"ERROR",t),n&&i(this._console,"ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&gd(t);for(;n&&gd(n);)n=gd(n);return n||null}}const vd=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Be))();function Ls(e){return e instanceof Function?e():e}var Li=(()=>((Li=Li||{})[Li.Important=1]="Important",Li[Li.DashCase=2]="DashCase",Li))();function Bc(e,t){return undefined(e,t)}function Al(e){const t=e[3];return Ti(t)?t[3]:t}function o(e){return l(e[13])}function r(e){return l(e[4])}function l(e){for(;null!==e&&!Ti(e);)e=e[4];return e}function m(e,t,n,i,a){if(null!=i){let u,f=!1;Ti(i)?u=i:Ki(i)&&(f=!0,i=i[0]);const v=yn(i);0===e&&null!==n?null==a?Je(t,n,v):Oe(t,n,v,a||null,!0):1===e&&null!==n?Oe(t,n,v,a||null,!0):2===e?function Xn(e,t,n){const i=ke(e,t);i&&function Ve(e,t,n,i){In(e)?e.removeChild(t,n,i):t.removeChild(n)}(e,i,t,n)}(t,v,f):3===e&&t.destroyNode(v),null!=u&&function vi(e,t,n,i,a){const u=n[7];u!==yn(n)&&m(t,e,i,u,a);for(let v=10;v<n.length;v++){const w=n[v];$n(w[1],w,e,t,i,u)}}(t,e,u,n,a)}}function C(e,t,n){return In(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Y(e,t){const n=e[9],i=n.indexOf(t),a=t[3];1024&t[2]&&(t[2]&=-1025,E(a,-1)),n.splice(i,1)}function Q(e,t){if(e.length<=10)return;const n=10+t,i=e[n];if(i){const a=i[17];null!==a&&a!==e&&Y(a,i),t>0&&(e[n-1][4]=i[4]);const u=Ra(e,10+t);!function A(e,t){$n(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const f=u[19];null!==f&&f.detachView(u[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function se(e,t){if(!(256&t[2])){const n=t[11];In(n)&&n.destroyNode&&$n(e,t,n,3,null,null),function N(e){let t=e[13];if(!t)return pe(e[1],e);for(;t;){let n=null;if(Ki(t))n=t[13];else{const i=t[10];i&&(n=i)}if(!n){for(;t&&!t[4]&&t!==e;)Ki(t)&&pe(t[1],t),t=t[3];null===t&&(t=e),Ki(t)&&pe(t[1],t),n=t&&t[4]}t=n}}(t)}}function pe(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function _e(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const a=t[n[i]];if(!(a instanceof su)){const u=n[i+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const v=a[u[f]],w=u[f+1];try{w.call(v)}finally{}}else try{u.call(a)}finally{}}}}(e,t),function he(e,t){const n=e.cleanup,i=t[7];let a=-1;if(null!==n)for(let u=0;u<n.length-1;u+=2)if("string"==typeof n[u]){const f=n[u+1],v="function"==typeof f?f(t):yn(t[f]),w=i[a=n[u+2]],I=n[u+3];"boolean"==typeof I?v.removeEventListener(n[u],w,I):I>=0?i[a=I]():i[a=-I].unsubscribe(),u+=2}else{const f=i[a=n[u+1]];n[u].call(f)}if(null!==i){for(let u=a+1;u<i.length;u++)i[u]();t[7]=null}}(e,t),1===t[1].type&&In(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&Ti(t[3])){n!==t[3]&&Y(n,t);const i=t[19];null!==i&&i.detachView(e)}}}function Ce(e,t,n){return function we(e,t,n){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return n[0];if(2&i.flags){const a=e.data[i.directiveStart].encapsulation;if(a===Hr.None||a===Hr.Emulated)return null}return Wr(i,n)}(e,t.parent,n)}function Oe(e,t,n,i,a){In(e)?e.insertBefore(t,n,i,a):t.insertBefore(n,i,a)}function Je(e,t,n){In(e)?e.appendChild(t,n):t.appendChild(n)}function ze(e,t,n,i,a){null!==i?Oe(e,t,n,i,a):Je(e,t,n)}function ke(e,t){return In(e)?e.parentNode(t):t.parentNode}let it=function Te(e,t,n){return 40&e.type?Wr(e,n):null};function Ut(e,t,n,i){const a=Ce(e,i,t),u=t[11],v=function Ne(e,t,n){return it(e,t,n)}(i.parent||t[6],i,t);if(null!=a)if(Array.isArray(n))for(let w=0;w<n.length;w++)ze(u,a,n[w],v,!1);else ze(u,a,n,v,!1)}function fn(e,t){if(null!==t){const n=t.type;if(3&n)return Wr(t,e);if(4&n)return yr(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return fn(e,i);{const a=e[t.index];return Ti(a)?yr(-1,a):yn(a)}}if(32&n)return Bc(t,e)()||yn(e[t.index]);{const i=Dn(e,t);return null!==i?Array.isArray(i)?i[0]:fn(Al(e[16]),i):fn(e,t.next)}}return null}function Dn(e,t){return null!==t?e[16][6].projection[t.projection]:null}function yr(e,t){const n=10+e+1;if(n<t.length){const i=t[n],a=i[1].firstChild;if(null!==a)return fn(i,a)}return t[7]}function jn(e,t,n,i,a,u,f){for(;null!=n;){const v=i[n.index],w=n.type;if(f&&0===t&&(v&&Kr(yn(v),i),n.flags|=4),64!=(64&n.flags))if(8&w)jn(e,t,n.child,i,a,u,!1),m(t,e,a,v,u);else if(32&w){const I=Bc(n,i);let M;for(;M=I();)m(t,e,a,M,u);m(t,e,a,v,u)}else 16&w?Pr(e,t,i,n,a,u):m(t,e,a,v,u);n=f?n.projectionNext:n.next}}function $n(e,t,n,i,a,u){jn(n,i,e.firstChild,t,a,u,!1)}function Pr(e,t,n,i,a,u){const f=n[16],w=f[6].projection[i.projection];if(Array.isArray(w))for(let I=0;I<w.length;I++)m(t,e,a,w[I],u);else jn(e,t,w,f[3],a,u,!0)}function Dr(e,t,n){In(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Er(e,t,n){In(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function Yr(e,t,n){let i=e.length;for(;;){const a=e.indexOf(t,n);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const u=t.length;if(a+u===i||e.charCodeAt(a+u)<=32)return a}n=a+1}}const ui="ng-template";function Mn(e,t,n){let i=0;for(;i<e.length;){let a=e[i++];if(n&&"class"===a){if(a=e[i],-1!==Yr(a.toLowerCase(),t,0))return!0}else if(1===a){for(;i<e.length&&"string"==typeof(a=e[i++]);)if(a.toLowerCase()===t)return!0;return!1}}return!1}function sr(e){return 4===e.type&&e.value!==ui}function Mt(e,t,n){return t===(4!==e.type||n?e.value:ui)}function Oi(e,t,n){let i=4;const a=e.attrs||[],u=function Os(e){for(let t=0;t<e.length;t++)if(Fh(e[t]))return t;return e.length}(a);let f=!1;for(let v=0;v<t.length;v++){const w=t[v];if("number"!=typeof w){if(!f)if(4&i){if(i=2|1&i,""!==w&&!Mt(e,w,n)||""===w&&1===t.length){if(En(i))return!1;f=!0}}else{const I=8&i?w:t[++v];if(8&i&&null!==e.attrs){if(!Mn(e.attrs,I,n)){if(En(i))return!1;f=!0}continue}const z=Jr(8&i?"class":w,a,sr(e),n);if(-1===z){if(En(i))return!1;f=!0;continue}if(""!==I){let G;G=z>u?"":a[z+1].toLowerCase();const K=8&i?G:null;if(K&&-1!==Yr(K,I,0)||2&i&&I!==G){if(En(i))return!1;f=!0}}}}else{if(!f&&!En(i)&&!En(w))return!1;if(f&&En(w))continue;f=!1,i=w|1&i}}return En(i)||f}function En(e){return 0==(1&e)}function Jr(e,t,n,i){if(null===t)return-1;let a=0;if(i||!n){let u=!1;for(;a<t.length;){const f=t[a];if(f===e)return a;if(3===f||6===f)u=!0;else{if(1===f||2===f){let v=t[++a];for(;"string"==typeof v;)v=t[++a];continue}if(4===f)break;if(0===f){a+=4;continue}}a+=u?1:2}return-1}return function wo(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function ts(e,t,n=!1){for(let i=0;i<t.length;i++)if(Oi(e,t[i],n))return!0;return!1}function zi(e,t){return e?":not("+t.trim()+")":t}function xi(e){let t=e[0],n=1,i=2,a="",u=!1;for(;n<e.length;){let f=e[n];if("string"==typeof f)if(2&i){const v=e[++n];a+="["+f+(v.length>0?'="'+v+'"':"")+"]"}else 8&i?a+="."+f:4&i&&(a+=" "+f);else""!==a&&!En(f)&&(t+=zi(u,a),a=""),i=f,u=u||!En(i);n++}return""!==a&&(t+=zi(u,a)),t}const St={};function q_(e,t){const n=e.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const a=n[i],u=n[i+1];if(-1!==u){const f=e.data[u];Xr(a),f.contentQueries(2,t[u],u)}}}function Id(e,t,n,i,a,u,f,v,w,I){const M=t.blueprint.slice();return M[0]=a,M[2]=140|i,b(M),M[3]=M[15]=e,M[8]=n,M[10]=f||e&&e[10],M[11]=v||e&&e[11],M[12]=w||e&&e[12]||null,M[9]=I||e&&e[9]||null,M[6]=u,M[16]=2==t.type?e[16]:M,M}function Hc(e,t,n,i,a){let u=e.data[t];if(null===u)u=function tg(e,t,n,i,a){const u=oe(),f=ye(),w=e.data[t]=function Z1(e,t,n,i,a,u){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:a,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,n,t,i,a);return null===e.firstChild&&(e.firstChild=w),null!==u&&(f?null==u.child&&null!==w.parent&&(u.child=w):null===u.next&&(u.next=w)),w}(e,t,n,i,a),function Rt(){return S.lFrame.inI18n}()&&(u.flags|=64);else if(64&u.type){u.type=n,u.value=i,u.attrs=a;const f=function be(){const e=S.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return de(u,!0),u}function qc(e,t,n,i){if(0===n)return-1;const a=t.length;for(let u=0;u<n;u++)t.push(i),e.blueprint.push(i),e.data.push(null);return a}function Td(e,t,n){Nn(t);try{const i=e.viewQuery;null!==i&&cg(1,i,n);const a=e.template;null!==a&&G_(e,t,a,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&q_(e,t),e.staticViewQueries&&cg(2,e.viewQuery,n);const u=e.components;null!==u&&function H1(e,t){for(let n=0;n<t.length;n++)hD(e,t[n])}(t,u)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[2]&=-5,Ks()}}function Gc(e,t,n,i){const a=t[2];if(256==(256&a))return;Nn(t);const u=Re();try{b(t),function Ot(e){return S.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&G_(e,t,n,2,i);const f=3==(3&a);if(!u)if(f){const I=e.preOrderCheckHooks;null!==I&&yl(t,I,null)}else{const I=e.preOrderHooks;null!==I&&Aa(t,I,0,null),yo(t,0)}if(function uD(e){for(let t=o(e);null!==t;t=r(t)){if(!t[2])continue;const n=t[9];for(let i=0;i<n.length;i++){const a=n[i],u=a[3];0==(1024&a[2])&&E(u,1),a[2]|=1024}}}(t),function lD(e){for(let t=o(e);null!==t;t=r(t))for(let n=10;n<t.length;n++){const i=t[n],a=i[1];c(i)&&Gc(a,i,a.template,i[8])}}(t),null!==e.contentQueries&&q_(e,t),!u)if(f){const I=e.contentCheckHooks;null!==I&&yl(t,I)}else{const I=e.contentHooks;null!==I&&Aa(t,I,1),yo(t,1)}!function j1(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const a=n[i];if(a<0)li(~a);else{const u=a,f=n[++i],v=n[++i];zn(f,u),v(2,t[u])}}}finally{li(-1)}}(e,t);const v=e.components;null!==v&&function $1(e,t){for(let n=0;n<t.length;n++)cD(e,t[n])}(t,v);const w=e.viewQuery;if(null!==w&&cg(2,w,i),!u)if(f){const I=e.viewCheckHooks;null!==I&&yl(t,I)}else{const I=e.viewHooks;null!==I&&Aa(t,I,2),yo(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),u||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,E(t[3],-1))}finally{Ks()}}function q1(e,t,n,i){const a=t[10],u=!Re(),f=s(t);try{u&&!f&&a.begin&&a.begin(),f&&Td(e,t,i),Gc(e,t,n,i)}finally{u&&!f&&a.end&&a.end()}}function G_(e,t,n,i,a){const u=function Bn(){return S.lFrame.selectedIndex}(),f=2&i;try{li(-1),f&&t.length>20&&function Vc(e,t,n,i){if(!i)if(3==(3&t[2])){const u=e.preOrderCheckHooks;null!==u&&yl(t,u,n)}else{const u=e.preOrderHooks;null!==u&&Aa(t,u,0,n)}li(n)}(e,t,20,Re()),n(i,a)}finally{li(u)}}function W_(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=ap(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function ap(e,t,n,i,a,u,f,v,w,I){const M=20+i,z=M+a,G=function G1(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:St);return n}(M,z),K="function"==typeof I?I():I;return G[1]={type:e,blueprint:G,template:n,queries:null,viewQuery:v,declTNode:t,data:G.slice().fill(null,M),bindingStartIndex:M,expandoStartIndex:z,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:w,consts:K,incompleteFirstPass:!1}}function Y_(e,t,n,i){const a=function av(e){return e[7]||(e[7]=[])}(t);null===n?a.push(i):(a.push(n),e.firstCreatePass&&function lv(e){return e.cleanup||(e.cleanup=[])}(e).push(i,a.length-1))}function J_(e,t,n){for(let i in e)if(e.hasOwnProperty(i)){const a=e[i];(n=null===n?{}:n).hasOwnProperty(i)?n[i].push(t,a):n[i]=[t,a]}return n}function ev(e,t,n,i,a,u){const f=u.hostBindings;if(f){let v=e.hostBindingOpCodes;null===v&&(v=e.hostBindingOpCodes=[]);const w=~t.index;(function Q1(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(v)!=w&&v.push(w),v.push(i,a,f)}}function tv(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function nv(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function iD(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;Ai(t)&&(n[""]=e)}}function rv(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function iv(e,t,n,i,a){e.data[i]=a;const u=a.factory||(a.factory=As(a.type)),f=new su(u,Ai(a),null);e.blueprint[i]=f,n[i]=f,ev(e,t,0,i,qc(e,n,a.hostVars,St),a)}function sD(e,t,n){const i=Wr(t,e),a=W_(n),u=e[10],f=lp(e,Id(e,a,null,n.onPush?64:16,i,t,u,u.createRenderer(i,n),null,null));e[t.index]=f}function oD(e,t,n,i,a,u){const f=u[t];if(null!==f){const v=i.setInput;for(let w=0;w<f.length;){const I=f[w++],M=f[w++],z=f[w++];null!==v?i.setInput(n,z,I,M):n[M]=z}}}function aD(e,t){let n=null,i=0;for(;i<t.length;){const a=t[i];if(0!==a)if(5!==a){if("number"==typeof a)break;e.hasOwnProperty(a)&&(null===n&&(n=[]),n.push(a,e[a],t[i+1])),i+=2}else i+=2;else i+=4}return n}function cD(e,t){const n=d(t,e);if(c(n)){const i=n[1];80&n[2]?Gc(i,n,i.template,n[8]):n[5]>0&&og(n)}}function og(e){for(let i=o(e);null!==i;i=r(i))for(let a=10;a<i.length;a++){const u=i[a];if(1024&u[2]){const f=u[1];Gc(f,u,f.template,u[8])}else u[5]>0&&og(u)}const n=e[1].components;if(null!==n)for(let i=0;i<n.length;i++){const a=d(n[i],e);c(a)&&a[5]>0&&og(a)}}function hD(e,t){const n=d(t,e),i=n[1];(function dD(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(i,n),Td(i,n,n[8])}function lp(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function ug(e,t,n){const i=t[10];i.begin&&i.begin();try{Gc(e,t,e.template,n)}catch(a){throw function cv(e,t){const n=e[9],i=n?n.get(xo,null):null;i&&i.handleError(t)}(t,a),a}finally{i.end&&i.end()}}function ov(e){!function lg(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],i=dd(n),a=i[1];q1(a,i,a.template,n)}}(e[8])}function cg(e,t,n){Xr(0),t(e,n)}const gD=(()=>Promise.resolve(null))();function up(e,t,n){let i=n?e.styles:null,a=n?e.classes:null,u=0;if(null!==t)for(let f=0;f<t.length;f++){const v=t[f];"number"==typeof v?u=v:1==u?a=Cs(a,v):2==u&&(i=Cs(i,v+": "+t[++f]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=a:e.classesWithoutHost=a}const hg=new qt("INJECTOR",-1);class dv{get(t,n=_s){if(n===_s){const i=new Error(`NullInjectorError: No provider for ${yt(t)}!`);throw i.name="NullInjectorError",i}return n}}const dg=new qt("Set Injector scope."),Ad={},vD={};let fg;function fv(){return void 0===fg&&(fg=new dv),fg}function pv(e,t=null,n=null,i){const a=mv(e,t,n,i);return a._resolveInjectorDefTypes(),a}function mv(e,t=null,n=null,i){return new xD(e,n,t||fv(),i)}class xD{constructor(t,n,i,a=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const u=[];n&&Qi(n,v=>this.processProvider(v,t,n)),Qi([t],v=>this.processInjectorType(v,[],u)),this.records.set(hg,Zc(void 0,this));const f=this.records.get(dg);this.scope=null!=f?f.value:null,this.source=a||("object"==typeof t?null:yt(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,n=_s,i=Et.Default){this.assertNotDestroyed();const a=Kh(this),u=Hi(void 0);try{if(!(i&Et.SkipSelf)){let v=this.records.get(t);if(void 0===v){const w=function TD(e){return"function"==typeof e||"object"==typeof e&&e instanceof qt}(t)&&tl(t);v=w&&this.injectableDefInScope(w)?Zc(pg(t),Ad):null,this.records.set(t,v)}if(null!=v)return this.hydrate(t,v)}return(i&Et.Self?fv():this.parent).get(t,n=i&Et.Optional&&n===_s?null:n)}catch(f){if("NullInjectorError"===f.name){if((f[vo]=f[vo]||[]).unshift(yt(t)),a)throw f;return function Jh(e,t,n,i){const a=e[vo];throw t[Sf]&&a.unshift(t[Sf]),e.message=function wm(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let a=yt(t);if(Array.isArray(t))a=t.map(yt).join(" -> ");else if("object"==typeof t){let u=[];for(let f in t)if(t.hasOwnProperty(f)){let v=t[f];u.push(f+":"+("string"==typeof v?JSON.stringify(v):yt(v)))}a=`{${u.join(", ")}}`}return`${n}${i?"("+i+")":""}[${a}]: ${e.replace(Cf,"\n  ")}`}("\n"+e.message,a,n,i),e.ngTokenPath=a,e[vo]=null,e}(f,t,"R3InjectorError",this.source)}throw f}finally{Hi(u),Kh(a)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((i,a)=>t.push(yt(a))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Dt(205,"")}processInjectorType(t,n,i){if(!(t=_t(t)))return!1;let a=Wu(t);const u=null==a&&t.ngModule||void 0,f=void 0===u?t:u,v=-1!==i.indexOf(f);if(void 0!==u&&(a=Wu(u)),null==a)return!1;if(null!=a.imports&&!v){let M;i.push(f);try{Qi(a.imports,z=>{this.processInjectorType(z,n,i)&&(void 0===M&&(M=[]),M.push(z))})}finally{}if(void 0!==M)for(let z=0;z<M.length;z++){const{ngModule:G,providers:K}=M[z];Qi(K,ce=>this.processProvider(ce,G,K||ln))}}this.injectorDefTypes.add(f);const w=As(f)||(()=>new f);this.records.set(f,Zc(w,Ad));const I=a.providers;if(null!=I&&!v){const M=t;Qi(I,z=>this.processProvider(z,M,I))}return void 0!==u&&void 0!==t.providers}processProvider(t,n,i){let a=Wc(t=_t(t))?t:_t(t&&t.provide);const u=function wD(e,t,n){return yv(e)?Zc(void 0,e.useValue):Zc(function gv(e,t,n){let i;if(Wc(e)){const a=_t(e);return As(a)||pg(a)}if(yv(e))i=()=>_t(e.useValue);else if(function ED(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...Yh(e.deps||[]));else if(function DD(e){return!(!e||!e.useExisting)}(e))i=()=>vt(_t(e.useExisting));else{const a=_t(e&&(e.useClass||e.provide));if(!function SD(e){return!!e.deps}(e))return As(a)||pg(a);i=()=>new a(...Yh(e.deps))}return i}(e),Ad)}(t);if(Wc(t)||!0!==t.multi)this.records.get(a);else{let f=this.records.get(a);f||(f=Zc(void 0,Ad,!0),f.factory=()=>Yh(f.multi),this.records.set(a,f)),a=t,f.multi.push(t)}this.records.set(a,u)}hydrate(t,n){return n.value===Ad&&(n.value=vD,n.value=n.factory()),"object"==typeof n.value&&n.value&&function ID(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=_t(t.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function pg(e){const t=tl(e),n=null!==t?t.factory:As(e);if(null!==n)return n;if(e instanceof qt)throw new Dt(204,"");if(e instanceof Function)return function bD(e){const t=e.length;if(t>0)throw function ea(e,t){const n=[];for(let i=0;i<e;i++)n.push(t);return n}(t,"?"),new Dt(204,"");const n=function un(e){const t=e&&(e[ya]||e[Xu]);if(t){const n=function rl(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Dt(204,"")}function Zc(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function yv(e){return null!==e&&"object"==typeof e&&bm in e}function Wc(e){return"function"==typeof e}let rs=(()=>{class e{static create(n,i){if(Array.isArray(n))return pv({name:""},i,n,"");{const a=n.name??"";return pv({name:a},n.parent,n.providers,a)}}}return e.THROW_IF_NOT_FOUND=_s,e.NULL=new dv,e.\u0275prov=Ke({token:e,providedIn:"any",factory:()=>vt(hg)}),e.__NG_ELEMENT_ID__=-1,e})();function OD(e,t){ru(dd(e)[1],le())}let cp=null;function Xc(){if(!cp){const e=Be.Symbol;if(e&&e.iterator)cp=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const i=t[n];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(cp=i)}}}return cp}function Md(e){return!!_g(e)&&(Array.isArray(e)||!(e instanceof Map)&&Xc()in e)}function _g(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ct(e,t=Et.Default){const n=V();return null===n?vt(e,t):yf(le(),n,_t(e),t)}function Eg(){throw new Error("invalid")}function Cg(e,t,n,i,a){const f=a?"class":"style";!function hv(e,t,n,i,a){for(let u=0;u<n.length;){const f=n[u++],v=n[u++],w=t[f],I=e.data[f];null!==I.setInput?I.setInput(w,a,i,v):w[v]=a}}(e,n,t.inputs[f],f,i)}function Yv(e,t,n,i){const a=V(),u=ee(),f=20+e,v=a[11],w=a[f]=C(v,t,function Rh(){return S.lFrame.currentNamespace}()),I=u.firstCreatePass?function gE(e,t,n,i,a,u,f){const v=t.consts,I=Hc(t,e,2,a,g(v,u));return function ig(e,t,n,i){let a=!1;if(H()){const u=function nD(e,t,n){const i=e.directiveRegistry;let a=null;if(i)for(let u=0;u<i.length;u++){const f=i[u];ts(n,f.selectors,!1)&&(a||(a=[]),Yo(xl(n,t),e,f.type),Ai(f)?(nv(e,n),a.unshift(f)):a.push(f))}return a}(e,t,n),f=null===i?null:{"":-1};if(null!==u){a=!0,rv(n,e.data.length,u.length);for(let M=0;M<u.length;M++){const z=u[M];z.providersResolver&&z.providersResolver(z)}let v=!1,w=!1,I=qc(e,t,u.length,null);for(let M=0;M<u.length;M++){const z=u[M];n.mergedAttrs=vl(n.mergedAttrs,z.hostAttrs),iv(e,n,t,I,z),iD(I,z,f),null!==z.contentQueries&&(n.flags|=8),(null!==z.hostBindings||null!==z.hostAttrs||0!==z.hostVars)&&(n.flags|=128);const G=z.type.prototype;!v&&(G.ngOnChanges||G.ngOnInit||G.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),v=!0),!w&&(G.ngOnChanges||G.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),w=!0),I++}!function W1(e,t){const i=t.directiveEnd,a=e.data,u=t.attrs,f=[];let v=null,w=null;for(let I=t.directiveStart;I<i;I++){const M=a[I],z=M.inputs,G=null===u||sr(t)?null:aD(z,u);f.push(G),v=J_(z,I,v),w=J_(M.outputs,I,w)}null!==v&&(v.hasOwnProperty("class")&&(t.flags|=16),v.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=f,t.inputs=v,t.outputs=w}(e,n)}f&&function rD(e,t,n){if(t){const i=e.localNames=[];for(let a=0;a<t.length;a+=2){const u=n[t[a+1]];if(null==u)throw new Dt(-301,`Export of name '${t[a+1]}' not found!`);i.push(t[a],u)}}}(n,i,f)}return n.mergedAttrs=vl(n.mergedAttrs,n.attrs),a}(t,n,I,g(v,f)),null!==I.attrs&&up(I,I.attrs,!1),null!==I.mergedAttrs&&up(I,I.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,I),I}(f,u,a,0,t,n,i):u.data[f];de(I,!0);const M=I.mergedAttrs;null!==M&&hc(v,w,M);const z=I.classes;null!==z&&Er(v,w,z);const G=I.styles;null!==G&&Dr(v,w,G),64!=(64&I.flags)&&Ut(u,a,w,I),0===function k(){return S.lFrame.elementDepthCount}()&&Kr(w,a),function F(){S.lFrame.elementDepthCount++}(),function go(e){return 1==(1&e.flags)}(I)&&(function ng(e,t,n){!H()||(function eD(e,t,n,i){const a=n.directiveStart,u=n.directiveEnd;e.firstCreatePass||xl(n,t),Kr(i,t);const f=n.initialInputs;for(let v=a;v<u;v++){const w=e.data[v],I=Ai(w);I&&sD(t,n,w);const M=Ma(t,e,v,n);Kr(M,t),null!==f&&oD(0,v-a,M,w,0,f),I&&(d(n.index,t)[8]=M)}}(e,t,n,Wr(n,t)),128==(128&n.flags)&&function tD(e,t,n){const i=n.directiveStart,a=n.directiveEnd,f=n.index,v=function gs(){return S.lFrame.currentDirectiveIndex}();try{li(f);for(let w=i;w<a;w++){const I=e.data[w],M=t[w];Ji(w),(null!==I.hostBindings||0!==I.hostVars||null!==I.hostAttrs)&&tv(I,M)}}finally{li(-1),Ji(v)}}(e,t,n))}(u,a,I),function Z_(e,t,n){if(fs(t)){const a=t.directiveEnd;for(let u=t.directiveStart;u<a;u++){const f=e.data[u];f.contentQueries&&f.contentQueries(1,n[u],u)}}}(u,I,a)),null!==i&&function rg(e,t,n=Wr){const i=t.localNames;if(null!==i){let a=t.index+1;for(let u=0;u<i.length;u+=2){const f=i[u+1],v=-1===f?n(t,e):e[f];e[a++]=v}}}(a,I)}function Jv(){let e=le();ye()?function Se(){S.lFrame.isParent=!1}():(e=e.parent,de(e,!1));const t=e;!function B(){S.lFrame.elementDepthCount--}();const n=ee();n.firstCreatePass&&(ru(n,e),fs(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function ks(e){return 0!=(16&e.flags)}(t)&&Cg(n,t,V(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Zo(e){return 0!=(32&e.flags)}(t)&&Cg(n,t,V(),t.stylesWithoutHost,!1)}function Sg(e,t,n,i){Yv(e,t,n,i),Jv()}function fp(e){return!!e&&"function"==typeof e.then}const nx=function tx(e){return!!e&&"function"==typeof e.subscribe},Mu=void 0;var uC=["en",[["a","p"],["AM","PM"],Mu],[["AM","PM"],Mu,Mu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Mu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Mu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Mu,"{1} 'at' {0}",Mu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function lC(e){const n=Math.floor(Math.abs(e)),i=e.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===i?1:5}];let ah={};function Yx(e){return e in ah||(ah[e]=Be.ng&&Be.ng.common&&Be.ng.common.locales&&Be.ng.common.locales[e]),ah[e]}var Xe=(()=>((Xe=Xe||{})[Xe.LocaleId=0]="LocaleId",Xe[Xe.DayPeriodsFormat=1]="DayPeriodsFormat",Xe[Xe.DayPeriodsStandalone=2]="DayPeriodsStandalone",Xe[Xe.DaysFormat=3]="DaysFormat",Xe[Xe.DaysStandalone=4]="DaysStandalone",Xe[Xe.MonthsFormat=5]="MonthsFormat",Xe[Xe.MonthsStandalone=6]="MonthsStandalone",Xe[Xe.Eras=7]="Eras",Xe[Xe.FirstDayOfWeek=8]="FirstDayOfWeek",Xe[Xe.WeekendRange=9]="WeekendRange",Xe[Xe.DateFormat=10]="DateFormat",Xe[Xe.TimeFormat=11]="TimeFormat",Xe[Xe.DateTimeFormat=12]="DateTimeFormat",Xe[Xe.NumberSymbols=13]="NumberSymbols",Xe[Xe.NumberFormats=14]="NumberFormats",Xe[Xe.CurrencyCode=15]="CurrencyCode",Xe[Xe.CurrencySymbol=16]="CurrencySymbol",Xe[Xe.CurrencyName=17]="CurrencyName",Xe[Xe.Currencies=18]="Currencies",Xe[Xe.Directionality=19]="Directionality",Xe[Xe.PluralCase=20]="PluralCase",Xe[Xe.ExtraData=21]="ExtraData",Xe))();const gp="en-US";let Jx=gp;class E0{}class dS{resolveComponentFactory(t){throw function hS(e){const t=Error(`No component factory found for ${yt(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let uh=(()=>{class e{}return e.NULL=new dS,e})();function fS(){return ch(le(),V())}function ch(e,t){return new kl(Wr(e,t))}let kl=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=fS,e})();function pS(e){return e instanceof kl?e.nativeElement:e}class S0{}let yS=(()=>{class e{}return e.\u0275prov=Ke({token:e,providedIn:"root",factory:()=>null}),e})();class wp{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const _S=new wp("13.1.3"),zg={};function Dp(e,t,n,i,a=!1){for(;null!==n;){const u=t[n.index];if(null!==u&&i.push(yn(u)),Ti(u))for(let v=10;v<u.length;v++){const w=u[v],I=w[1].firstChild;null!==I&&Dp(w[1],w,I,i)}const f=n.type;if(8&f)Dp(e,t,n.child,i);else if(32&f){const v=Bc(n,t);let w;for(;w=v();)i.push(w)}else if(16&f){const v=Dn(t,n);if(Array.isArray(v))i.push(...v);else{const w=Al(t[16]);Dp(w[1],w,v,i,!0)}}n=a?n.projectionNext:n.next}return i}class zd{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return Dp(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Ti(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&(Q(t,i),Ra(n,i))}this._attachedToViewContainer=!1}se(this._lView[1],this._lView)}onDestroy(t){Y_(this._lView[1],this._lView,null,t)}markForCheck(){!function ag(e){for(;e;){e[2]|=64;const t=Al(e);if(ec(e)&&!t)return e;e=t}return null}(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){ug(this._lView[1],this._lView,this.context)}checkNoChanges(){!function pD(e,t,n){et(!0);try{ug(e,t,n)}finally{et(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Dt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function L(e,t){$n(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Dt(902,"");this._appRef=t}}class vS extends zd{constructor(t){super(t),this._view=t}detectChanges(){ov(this._view)}checkNoChanges(){!function mD(e){et(!0);try{ov(e)}finally{et(!1)}}(this._view)}get context(){return null}}class I0 extends uh{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=fr(t);return new Ng(n,this.ngModule)}}function T0(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const bS=new qt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>vd});class Ng extends E0{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Do(e){return e.map(xi).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return T0(this.componentDef.inputs)}get outputs(){return T0(this.componentDef.outputs)}create(t,n,i,a){const u=(a=a||this.ngModule)?function wS(e,t){return{get:(n,i,a)=>{const u=e.get(n,zg,a);return u!==zg||i===zg?u:t.get(n,i,a)}}}(t,a.injector):t,f=u.get(S0,qe),v=u.get(yS,null),w=f.createRenderer(null,this.componentDef),I=this.componentDef.selectors[0][0]||"div",M=i?function K_(e,t,n){if(In(e))return e.selectRootElement(t,n===Hr.ShadowDom);let i="string"==typeof t?e.querySelector(t):t;return i.textContent="",i}(w,i,this.componentDef.encapsulation):C(f.createRenderer(null,this.componentDef),I,function xS(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(I)),z=this.componentDef.onPush?576:528,G=function Tv(e,t){return{components:[],scheduler:e||vd,clean:gD,playerHandler:t||null,flags:0}}(),K=ap(0,null,null,1,0,null,null,null,null,null),ce=Id(null,K,G,z,null,null,f,w,v,u);let De,Ie;Nn(ce);try{const Me=function Sv(e,t,n,i,a,u){const f=n[1];n[20]=e;const w=Hc(f,20,2,"#host",null),I=w.mergedAttrs=t.hostAttrs;null!==I&&(up(w,I,!0),null!==e&&(hc(a,e,I),null!==w.classes&&Er(a,e,w.classes),null!==w.styles&&Dr(a,e,w.styles)));const M=i.createRenderer(e,t),z=Id(n,W_(t),null,t.onPush?64:16,n[20],w,i,M,u||null,null);return f.firstCreatePass&&(Yo(xl(w,n),f,t.type),nv(f,w),rv(w,n.length,1)),lp(n,z),n[20]=z}(M,this.componentDef,ce,f,w);if(M)if(i)hc(w,M,["ng-version",_S.full]);else{const{attrs:xe,classes:Ge}=function Su(e){const t=[],n=[];let i=1,a=2;for(;i<e.length;){let u=e[i];if("string"==typeof u)2===a?""!==u&&t.push(u,e[++i]):8===a&&n.push(u);else{if(!En(a))break;a=u}i++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);xe&&hc(w,M,xe),Ge&&Ge.length>0&&Er(w,M,Ge.join(" "))}if(Ie=function ml(e,t){return e.data[t]}(K,20),void 0!==n){const xe=Ie.projection=[];for(let Ge=0;Ge<this.ngContentSelectors.length;Ge++){const mt=n[Ge];xe.push(null!=mt?Array.from(mt):null)}}De=function Iv(e,t,n,i,a){const u=n[1],f=function J1(e,t,n){const i=le();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),iv(e,i,t,qc(e,t,1,null),n));const a=Ma(t,e,i.directiveStart,i);Kr(a,t);const u=Wr(i,t);return u&&Kr(u,t),a}(u,n,t);if(i.components.push(f),e[8]=f,a&&a.forEach(w=>w(f,t)),t.contentQueries){const w=le();t.contentQueries(1,f,w.directiveStart)}const v=le();return!u.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(li(v.index),ev(n[1],v,0,v.directiveStart,v.directiveEnd,t),tv(t,f)),f}(Me,this.componentDef,ce,G,[OD]),Td(K,ce,null)}finally{Ks()}return new ES(this.componentType,De,ch(Ie,ce),ce,Ie)}}class ES extends class cS{}{constructor(t,n,i,a,u){super(),this.location=i,this._rootLView=a,this._tNode=u,this.instance=n,this.hostView=this.changeDetectorRef=new vS(a),this.componentType=t}get injector(){return new Pa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class qa{}class A0{}const hh=new Map;class k0 extends qa{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new I0(this);const i=mi(t);this._bootstrapComponents=Ls(i.bootstrap),this._r3Injector=mv(t,n,[{provide:qa,useValue:this},{provide:uh,useValue:this.componentFactoryResolver}],yt(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,n=rs.THROW_IF_NOT_FOUND,i=Et.Default){return t===rs||t===qa||t===hg?this:this._r3Injector.get(t,n,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Bg extends A0{constructor(t){super(),this.moduleType=t,null!==mi(t)&&function SS(e){const t=new Set;!function n(i){const a=mi(i,!0),u=a.id;null!==u&&(function M0(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${yt(t)} vs ${yt(t.name)}`)}(u,hh.get(u),i),hh.set(u,i));const f=Ls(a.imports);for(const v of f)t.has(v)||(t.add(v),n(v))}(e)}(t)}create(t){return new k0(this.moduleType,t)}}function Vg(e){return t=>{setTimeout(e,void 0,t)}}const ss=class HS extends Nr{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,i){let a=t,u=n||(()=>null),f=i;if(t&&"object"==typeof t){const w=t;a=w.next?.bind(w),u=w.error?.bind(w),f=w.complete?.bind(w)}this.__isAsync&&(u=Vg(u),a&&(a=Vg(a)),f&&(f=Vg(f)));const v=super.subscribe({next:a,error:u,complete:f});return t instanceof hn&&t.add(v),v}};function qS(){return this._results[Xc()]()}class Ug{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=Xc(),i=Ug.prototype;i[n]||(i[n]=qS)}get changes(){return this._changes||(this._changes=new ss)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const i=this;i.dirty=!1;const a=Qt(t);(this._changesDetected=!function _m(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let a=e[i],u=t[i];if(n&&(a=n(a),u=n(u)),u!==a)return!1}return!0}(i._results,a,n))&&(i._results=a,i.length=a.length,i.last=a[this.length-1],i.first=a[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Ga=(()=>{class e{}return e.__NG_ELEMENT_ID__=WS,e})();const GS=Ga,ZS=class extends GS{constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(t){const n=this._declarationTContainer.tViews,i=Id(this._declarationLView,n,t,16,null,n.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[19];return null!==u&&(i[19]=u.createEmbeddedView(n)),Td(n,i,t),new zd(i)}};function WS(){return Ep(le(),V())}function Ep(e,t){return 4&e.type?new ZS(t,e,ch(e,t)):null}let To=(()=>{class e{}return e.__NG_ELEMENT_ID__=XS,e})();function XS(){return V0(le(),V())}const KS=To,N0=class extends KS{constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return ch(this._hostTNode,this._hostLView)}get injector(){return new Pa(this._hostTNode,this._hostLView)}get parentInjector(){const t=yc(this._hostTNode,this._hostLView);if(Wo(t)){const n=Xo(t,this._hostLView),i=ys(t);return new Pa(n[1].data[i+8],n)}return new Pa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=B0(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,i){const a=t.createEmbeddedView(n||{});return this.insert(a,i),a}createComponent(t,n,i,a,u){const f=t&&!function du(e){return"function"==typeof e}(t);let v;if(f)v=n;else{const z=n||{};v=z.index,i=z.injector,a=z.projectableNodes,u=z.ngModuleRef}const w=f?t:new Ng(fr(t)),I=i||this.parentInjector;if(!u&&null==w.ngModule&&I){const z=I.get(qa,null);z&&(u=z)}const M=w.create(I,a,void 0,u);return this.insert(M.hostView,v),M}insert(t,n){const i=t._lView,a=i[1];if(function p(e){return Ti(e[3])}(i)){const M=this.indexOf(t);if(-1!==M)this.detach(M);else{const z=i[3],G=new N0(z,z[6],z[3]);G.detach(G.indexOf(t))}}const u=this._adjustIndex(n),f=this._lContainer;!function U(e,t,n,i){const a=10+i,u=n.length;i>0&&(n[a-1][4]=t),i<u-10?(t[4]=n[a],$h(n,10+i,t)):(n.push(t),t[4]=null),t[3]=n;const f=t[17];null!==f&&n!==f&&function $(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(f,t);const v=t[19];null!==v&&v.insertView(e),t[2]|=128}(a,i,f,u);const v=yr(u,f),w=i[11],I=ke(w,f[7]);return null!==I&&function R(e,t,n,i,a,u){i[0]=a,i[6]=t,$n(e,i,n,1,a,u)}(a,f[6],w,i,I,v),t.attachToViewContainerRef(),$h(jg(f),u,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=B0(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=Q(this._lContainer,n);i&&(Ra(jg(this._lContainer),n),se(i[1],i))}detach(t){const n=this._adjustIndex(t,-1),i=Q(this._lContainer,n);return i&&null!=Ra(jg(this._lContainer),n)?new zd(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function B0(e){return e[8]}function jg(e){return e[8]||(e[8]=[])}function V0(e,t){let n;const i=t[e.index];if(Ti(i))n=i;else{let a;if(8&e.type)a=yn(i);else{const u=t[11];a=u.createComment("");const f=Wr(e,t);Oe(u,ke(u,f),a,function je(e,t){return In(e)?e.nextSibling(t):t.nextSibling}(u,f),!1)}t[e.index]=n=function sv(e,t,n,i){return new Array(e,!0,!1,t,null,0,i,n,null,null)}(i,t,a,e),lp(t,n)}return new N0(n,e,t)}class $g{constructor(t){this.queryList=t,this.matches=null}clone(){return new $g(this.queryList)}setDirty(){this.queryList.setDirty()}}class Hg{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,a=[];for(let u=0;u<i;u++){const f=n.getByIndex(u);a.push(this.queries[f.indexInDeclarationView].clone())}return new Hg(a)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==G0(t,n).matches&&this.queries[n].setDirty()}}class U0{constructor(t,n,i=null){this.predicate=t,this.flags=n,this.read=i}}class qg{constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const a=null!==n?n.length:0,u=this.getByIndex(i).embeddedTView(t,a);u&&(u.indexInDeclarationView=i,null!==n?n.push(u):n=[u])}return null!==n?new qg(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Gg{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new Gg(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let a=0;a<i.length;a++){const u=i[a];this.matchTNodeWithReadOption(t,n,QS(n,u)),this.matchTNodeWithReadOption(t,n,vc(n,t,u,!1,!1))}else i===Ga?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,vc(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const a=this.metadata.read;if(null!==a)if(a===kl||a===To||a===Ga&&4&n.type)this.addMatch(n.index,-2);else{const u=vc(n,t,a,!1,!1);null!==u&&this.addMatch(n.index,u)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function QS(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function tI(e,t,n,i){return-1===n?function eI(e,t){return 11&e.type?ch(e,t):4&e.type?Ep(e,t):null}(t,e):-2===n?function nI(e,t,n){return n===kl?ch(t,e):n===Ga?Ep(t,e):n===To?V0(t,e):void 0}(e,t,i):Ma(e,e[1],n,t)}function j0(e,t,n,i){const a=t[19].queries[i];if(null===a.matches){const u=e.data,f=n.matches,v=[];for(let w=0;w<f.length;w+=2){const I=f[w];v.push(I<0?null:tI(t,u[I],f[w+1],n.metadata.read))}a.matches=v}return a.matches}function Zg(e,t,n,i){const a=e.queries.getByIndex(n),u=a.matches;if(null!==u){const f=j0(e,t,a,n);for(let v=0;v<u.length;v+=2){const w=u[v];if(w>0)i.push(f[v/2]);else{const I=u[v+1],M=t[-w];for(let z=10;z<M.length;z++){const G=M[z];G[17]===G[3]&&Zg(G[1],G,I,i)}if(null!==M[9]){const z=M[9];for(let G=0;G<z.length;G++){const K=z[G];Zg(K[1],K,I,i)}}}}}return i}function Cp(e){const t=V(),n=ee(),i=ki();Xr(i+1);const a=G0(n,i);if(e.dirty&&s(t)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{const u=a.crossesNgTemplate?Zg(n,t,i,[]):j0(n,t,a,i);e.reset(u,pS),e.notifyOnChanges()}return!0}return!1}function $0(e,t,n){const i=ee();i.firstCreatePass&&(function q0(e,t,n){null===e.queries&&(e.queries=new qg),e.queries.track(new Gg(t,n))}(i,new U0(e,t,n),-1),2==(2&t)&&(i.staticViewQueries=!0)),function H0(e,t,n){const i=new Ug(4==(4&n));Y_(e,t,i,i.destroy),null===t[19]&&(t[19]=new Hg),t[19].queries.push(new $g(i))}(i,V(),t)}function G0(e,t){return e.queries.getByIndex(t)}function Ap(...e){}const Mp=new qt("Application Initializer");let fh=(()=>{class e{constructor(n){this.appInits=n,this.resolve=Ap,this.reject=Ap,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,a)=>{this.resolve=i,this.reject=a})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let a=0;a<this.appInits.length;a++){const u=this.appInits[a]();if(fp(u))n.push(u);else if(nx(u)){const f=new Promise((v,w)=>{u.subscribe({complete:v,error:w})});n.push(f)}}Promise.all(n).then(()=>{i()}).catch(a=>{this.reject(a)}),0===n.length&&i(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(vt(Mp,8))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const Ud=new qt("AppId"),DI={provide:Ud,useFactory:function wI(){return`${ey()}${ey()}${ey()}`},deps:[]};function ey(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const ub=new qt("Platform Initializer"),ty=new qt("Platform ID"),cb=new qt("appBootstrapListener");let hb=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const Rl=new qt("LocaleId"),db=new qt("DefaultCurrencyCode");class EI{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Pp=(()=>{class e{compileModuleSync(n){return new Bg(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),u=Ls(mi(n).declarations).reduce((f,v)=>{const w=fr(v);return w&&f.push(new Ng(w)),f},[]);return new EI(i,u)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const SI=(()=>Promise.resolve(0))();function ny(e){"undefined"==typeof Zone?SI.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ti{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ss(!1),this.onMicrotaskEmpty=new ss(!1),this.onStable=new ss(!1),this.onError=new ss(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!i&&n,a.shouldCoalesceRunChangeDetection=i,a.lastRequestAnimationFrameId=-1,a.nativeRequestAnimationFrame=function II(){let e=Be.requestAnimationFrame,t=Be.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function MI(e){const t=()=>{!function AI(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Be,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,iy(e),e.isCheckStableRunning=!0,ry(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),iy(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,a,u,f,v)=>{try{return fb(e),n.invokeTask(a,u,f,v)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&t(),pb(e)}},onInvoke:(n,i,a,u,f,v,w)=>{try{return fb(e),n.invoke(a,u,f,v,w)}finally{e.shouldCoalesceRunChangeDetection&&t(),pb(e)}},onHasTask:(n,i,a,u)=>{n.hasTask(a,u),i===a&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,iy(e),ry(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(n,i,a,u)=>(n.handleError(a,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(a)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ti.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ti.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,a){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+a,t,TI,Ap,Ap);try{return u.runTask(f,n,i)}finally{u.cancelTask(f)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const TI={};function ry(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function iy(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function fb(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function pb(e){e._nesting--,ry(e)}class PI{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ss,this.onMicrotaskEmpty=new ss,this.onStable=new ss,this.onError=new ss}run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,a){return t.apply(n,i)}}let sy=(()=>{class e{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ti.assertNotInAngularZone(),ny(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ny(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,a){let u=-1;i&&i>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:u,updateCb:a})}whenStable(n,i,a){if(a&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,a),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,i,a){return[]}}return e.\u0275fac=function(n){return new(n||e)(vt(ti))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})(),mb=(()=>{class e{constructor(){this._applications=new Map,oy.addToWindow(this)}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return oy.findTestabilityInTree(this,n,i)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();class kI{addToWindow(t){}findTestabilityInTree(t,n,i){return null}}let Ao,oy=new kI;const gb=new qt("AllowMultipleToken");class yb{constructor(t,n){this.name=t,this.token=n}}function _b(e,t,n=[]){const i=`Platform: ${t}`,a=new qt(i);return(u=[])=>{let f=vb();if(!f||f.injector.get(gb,!1))if(e)e(n.concat(u).concat({provide:a,useValue:!0}));else{const v=n.concat(u).concat({provide:a,useValue:!0},{provide:dg,useValue:"platform"});!function OI(e){if(Ao&&!Ao.destroyed&&!Ao.injector.get(gb,!1))throw new Dt(400,"");Ao=e.get(xb);const t=e.get(ub,null);t&&t.forEach(n=>n())}(rs.create({providers:v,name:i}))}return function zI(e){const t=vb();if(!t)throw new Dt(401,"");return t}()}}function vb(){return Ao&&!Ao.destroyed?Ao:null}let xb=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const v=function NI(e,t){let n;return n="noop"===e?new PI:("zone.js"===e?void 0:e)||new ti({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!t?.ngZoneEventCoalescing,shouldCoalesceRunChangeDetection:!!t?.ngZoneRunCoalescing}),n}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),w=[{provide:ti,useValue:v}];return v.run(()=>{const I=rs.create({providers:w,parent:this.injector,name:n.moduleType.name}),M=n.create(I),z=M.injector.get(xo,null);if(!z)throw new Dt(402,"");return v.runOutsideAngular(()=>{const G=v.onError.subscribe({next:K=>{z.handleError(K)}});M.onDestroy(()=>{ay(this._modules,M),G.unsubscribe()})}),function BI(e,t,n){try{const i=n();return fp(i)?i.catch(a=>{throw t.runOutsideAngular(()=>e.handleError(a)),a}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(z,v,()=>{const G=M.injector.get(fh);return G.runInitializers(),G.donePromise.then(()=>(function pC(e){hr(e,"Expected localeId to be defined"),"string"==typeof e&&(Jx=e.toLowerCase().replace(/_/g,"-"))}(M.injector.get(Rl,gp)||gp),this._moduleDoBootstrap(M),M))})})}bootstrapModule(n,i=[]){const a=bb({},i);return function LI(e,t,n){const i=new Bg(n);return Promise.resolve(i)}(0,0,n).then(u=>this.bootstrapModuleFactory(u,a))}_moduleDoBootstrap(n){const i=n.injector.get(jd);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(a=>i.bootstrap(a));else{if(!n.instance.ngDoBootstrap)throw new Dt(403,"");n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Dt(404,"");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(vt(rs))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();function bb(e,t){return Array.isArray(t)?t.reduce(bb,e):{...e,...t}}let jd=(()=>{class e{constructor(n,i,a,u,f){this._zone=n,this._injector=i,this._exceptionHandler=a,this._componentFactoryResolver=u,this._initStatus=f,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new Zt(I=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{I.next(this._stable),I.complete()})}),w=new Zt(I=>{let M;this._zone.runOutsideAngular(()=>{M=this._zone.onStable.subscribe(()=>{ti.assertNotInAngularZone(),ny(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,I.next(!0))})})});const z=this._zone.onUnstable.subscribe(()=>{ti.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{I.next(!1)}))});return()=>{M.unsubscribe(),z.unsubscribe()}});this.isStable=function Kt(...e){const t=re(e),n=function te(e,t){return"number"==typeof W(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?ii(i[0]):Di(n)(at(i,t)):q}(v,w.pipe(function lt(e={}){const{connector:t=(()=>new Nr),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:a=!0}=e;return u=>{let f=null,v=null,w=null,I=0,M=!1,z=!1;const G=()=>{null==v||v.unsubscribe(),v=null},K=()=>{G(),f=w=null,M=z=!1},ce=()=>{const De=f;K(),null==De||De.unsubscribe()};return an((De,Ie)=>{I++,!z&&!M&&G();const Me=w=w??t();Ie.add(()=>{I--,0===I&&!z&&!M&&(v=Ft(ce,a))}),Me.subscribe(Ie),f||(f=new kt({next:xe=>Me.next(xe),error:xe=>{z=!0,G(),v=Ft(K,n,xe),Me.error(xe)},complete:()=>{M=!0,G(),v=Ft(K,i),Me.complete()}}),at(De).subscribe(f))})(u)}}()))}bootstrap(n,i){if(!this._initStatus.done)throw new Dt(405,"");let a;a=n instanceof E0?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(a.componentType);const u=function FI(e){return e.isBoundToModule}(a)?void 0:this._injector.get(qa),v=a.create(rs.NULL,[],i||a.selector,u),w=v.location.nativeElement,I=v.injector.get(sy,null),M=I&&v.injector.get(mb);return I&&M&&M.registerApplication(w,I),v.onDestroy(()=>{this.detachView(v.hostView),ay(this.components,v),M&&M.unregisterApplication(w)}),this._loadComponent(v),v}tick(){if(this._runningTick)throw new Dt(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;ay(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(cb,[]).concat(this._bootstrapListeners).forEach(a=>a(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(n){return new(n||e)(vt(ti),vt(rs),vt(xo),vt(uh),vt(fh))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();function ay(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let Db=!0,ly=(()=>{class e{}return e.__NG_ELEMENT_ID__=jI,e})();function jI(e){return function $I(e,t,n){if(Ea(e)&&!n){const i=d(e.index,t);return new zd(i,i)}return 47&e.type?new zd(t[16],t):null}(le(),V(),16==(16&e))}class Mb{constructor(){}supports(t){return Md(t)}create(t){return new XI(t)}}const WI=(e,t)=>t;class XI{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||WI}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,a=0,u=null;for(;n||i;){const f=!i||n&&n.currentIndex<kb(i,a,u)?n:i,v=kb(f,a,u),w=f.currentIndex;if(f===i)a--,i=i._nextRemoved;else if(n=n._next,null==f.previousIndex)a++;else{u||(u=[]);const I=v-a,M=w-a;if(I!=M){for(let G=0;G<I;G++){const K=G<u.length?u[G]:u[G]=0,ce=K+G;M<=ce&&ce<I&&(u[G]=K+1)}u[f.previousIndex]=M-I}}v!==w&&t(f,v,w)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!Md(t))throw new Dt(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let a,u,f,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let v=0;v<this.length;v++)u=t[v],f=this._trackByFn(v,u),null!==n&&Object.is(n.trackById,f)?(i&&(n=this._verifyReinsertion(n,u,f,v)),Object.is(n.item,u)||this._addIdentityChange(n,u)):(n=this._mismatch(n,u,f,v),i=!0),n=n._next}else a=0,function GD(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Xc()]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,v=>{f=this._trackByFn(a,v),null!==n&&Object.is(n.trackById,f)?(i&&(n=this._verifyReinsertion(n,v,f,a)),Object.is(n.item,v)||this._addIdentityChange(n,v)):(n=this._mismatch(n,v,f,a),i=!0),n=n._next,a++}),this.length=a;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,a){let u;return null===t?u=this._itTail:(u=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,u,a)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,a))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,u,a)):t=this._addAfter(new KI(n,i),u,a),t}_verifyReinsertion(t,n,i,a){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==u?t=this._reinsertAfter(u,t._prev,a):t.currentIndex!=a&&(t.currentIndex=a,this._addToMoves(t,a)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const a=t._prevRemoved,u=t._nextRemoved;return null===a?this._removalsHead=u:a._nextRemoved=u,null===u?this._removalsTail=a:u._prevRemoved=a,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const a=null===n?this._itHead:n._next;return t._next=a,t._prev=n,null===a?this._itTail=t:a._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new Pb),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Pb),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class KI{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class YI{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class Pb{constructor(){this.map=new Map}put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new YI,this.map.set(n,i)),i.add(t)}get(t,n){const a=this.map.get(t);return a?a.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function kb(e,t,n){const i=e.previousIndex;if(null===i)return i;let a=0;return n&&i<n.length&&(a=n[i]),i+t+a}class Rb{constructor(){}supports(t){return t instanceof Map||_g(t)}create(){return new JI}}class JI{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||_g(t)))throw new Dt(900,"")}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,a)=>{if(n&&n.key===a)this._maybeAddToChanges(n,i),this._appendAfter=n,n=n._next;else{const u=this._getOrCreateRecordForKey(a,i);n=this._insertBeforeOrAppend(n,u)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let i=n;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const i=t._prev;return n._next=t,n._prev=i,t._prev=n,i&&(i._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const a=this._records.get(t);this._maybeAddToChanges(a,n);const u=a._prev,f=a._next;return u&&(u._next=f),f&&(f._prev=u),a._next=null,a._prev=null,a}const i=new QI(t);return this._records.set(t,i),i.currentValue=n,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(i=>n(t[i],i))}}class QI{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Lb(){return new $d([new Mb])}let $d=(()=>{class e{constructor(n){this.factories=n}static create(n,i){if(null!=i){const a=i.factories.slice();n=n.concat(a)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||Lb()),deps:[[e,new Oa,new Qs]]}}find(n){const i=this.factories.find(a=>a.supports(n));if(null!=i)return i;throw new Dt(901,"")}}return e.\u0275prov=Ke({token:e,providedIn:"root",factory:Lb}),e})();function Fb(){return new ph([new Rb])}let ph=(()=>{class e{constructor(n){this.factories=n}static create(n,i){if(i){const a=i.factories.slice();n=n.concat(a)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||Fb()),deps:[[e,new Oa,new Qs]]}}find(n){const i=this.factories.find(u=>u.supports(n));if(i)return i;throw new Dt(901,"")}}return e.\u0275prov=Ke({token:e,providedIn:"root",factory:Fb}),e})();const eT=[new Rb],nT=new $d([new Mb]),rT=new ph(eT),iT=_b(null,"core",[{provide:ty,useValue:"unknown"},{provide:xb,deps:[rs]},{provide:mb,deps:[]},{provide:hb,deps:[]}]),uT=[{provide:jd,useClass:jd,deps:[ti,rs,xo,uh,fh]},{provide:bS,deps:[ti],useFactory:function cT(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(n){t.push(n)}}},{provide:fh,useClass:fh,deps:[[new Qs,Mp]]},{provide:Pp,useClass:Pp,deps:[]},DI,{provide:$d,useFactory:function sT(){return nT},deps:[]},{provide:ph,useFactory:function oT(){return rT},deps:[]},{provide:Rl,useFactory:function aT(e){return e||function lT(){return"undefined"!=typeof $localize&&$localize.locale||gp}()},deps:[[new gu(Rl),new Qs,new Oa]]},{provide:db,useValue:"USD"}];let hT=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(vt(jd))},e.\u0275mod=Zs({type:e}),e.\u0275inj=Ei({providers:uT}),e})(),Rp=null;function Ll(){return Rp}const so=new qt("DocumentToken");let ku=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:function(){return function mT(){return vt(Ob)}()},providedIn:"platform"}),e})();const gT=new qt("Location Initialized");let Ob=(()=>{class e extends ku{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ll().getBaseHref(this._doc)}onPopState(n){const i=Ll().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Ll().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,i,a){zb()?this._history.pushState(n,i,a):this.location.hash=a}replaceState(n,i,a){zb()?this._history.replaceState(n,i,a):this.location.hash=a}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(vt(so))},e.\u0275prov=Ke({token:e,factory:function(){return function yT(){return new Ob(vt(so))}()},providedIn:"platform"}),e})();function zb(){return!!window.history.pushState}function fy(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Nb(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Za(e){return e&&"?"!==e[0]?"?"+e:e}let mh=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:function(){return function _T(e){const t=vt(so).location;return new Bb(vt(ku),t&&t.origin||"")}()},providedIn:"root"}),e})();const py=new qt("appBaseHref");let Bb=(()=>{class e extends mh{constructor(n,i){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return fy(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Za(this._platformLocation.search),a=this._platformLocation.hash;return a&&n?`${i}${a}`:i}pushState(n,i,a,u){const f=this.prepareExternalUrl(a+Za(u));this._platformLocation.pushState(n,i,f)}replaceState(n,i,a,u){const f=this.prepareExternalUrl(a+Za(u));this._platformLocation.replaceState(n,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(vt(ku),vt(py,8))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})(),vT=(()=>{class e extends mh{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=fy(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,a,u){let f=this.prepareExternalUrl(a+Za(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(n,i,f)}replaceState(n,i,a,u){let f=this.prepareExternalUrl(a+Za(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(vt(ku),vt(py,8))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})(),my=(()=>{class e{constructor(n,i){this._subject=new ss,this._urlChangeListeners=[],this._platformStrategy=n;const a=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=Nb(Vb(a)),this._platformStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Za(i))}normalize(n){return e.stripTrailingSlash(function bT(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Vb(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,i="",a=null){this._platformStrategy.pushState(a,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Za(i)),a)}replaceState(n,i="",a=null){this._platformStrategy.replaceState(a,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Za(i)),a)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){this._platformStrategy.historyGo?.(n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(a=>a(n,i))}subscribe(n,i,a){return this._subject.subscribe({next:n,error:i,complete:a})}}return e.normalizeQueryParams=Za,e.joinWithSlash=fy,e.stripTrailingSlash=Nb,e.\u0275fac=function(n){return new(n||e)(vt(mh),vt(ku))},e.\u0275prov=Ke({token:e,factory:function(){return function xT(){return new my(vt(mh),vt(ku))}()},providedIn:"root"}),e})();function Vb(e){return e.replace(/\/index.html$/,"")}var kr=(()=>((kr=kr||{})[kr.Zero=0]="Zero",kr[kr.One=1]="One",kr[kr.Two=2]="Two",kr[kr.Few=3]="Few",kr[kr.Many=4]="Many",kr[kr.Other=5]="Other",kr))();const TT=function Kx(e){return function is(e){const t=function cC(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=Yx(t);if(n)return n;const i=t.split("-")[0];if(n=Yx(i),n)return n;if("en"===i)return uC;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[Xe.PluralCase]};class $p{}let rA=(()=>{class e extends $p{constructor(n){super(),this.locale=n}getPluralCategory(n,i){switch(TT(i||this.locale)(n)){case kr.Zero:return"zero";case kr.One:return"one";case kr.Two:return"two";case kr.Few:return"few";case kr.Many:return"many";default:return"other"}}}return e.\u0275fac=function(n){return new(n||e)(vt(Rl))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})(),zA=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Zs({type:e}),e.\u0275inj=Ei({providers:[{provide:$p,useClass:rA}]}),e})();let UA=(()=>{class e{}return e.\u0275prov=Ke({token:e,providedIn:"root",factory:()=>new jA(vt(so),window)}),e})();class jA{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function $A(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let a=i.currentNode;for(;a;){const u=a.shadowRoot;if(u){const f=u.getElementById(t)||u.querySelector(`[name="${t}"]`);if(f)return f}a=i.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),this.attemptFocus(n))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),i=n.left+this.window.pageXOffset,a=n.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(i-u[0],a-u[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=ew(this.window.history)||ew(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function ew(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Ty extends class qA extends class pT{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function fT(e){Rp||(Rp=e)}(new Ty)}onAndCancel(t,n,i){return t.addEventListener(n,i,!1),()=>{t.removeEventListener(n,i,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function GA(){return Gd=Gd||document.querySelector("base"),Gd?Gd.getAttribute("href"):null}();return null==n?null:function ZA(e){Hp=Hp||document.createElement("a"),Hp.setAttribute("href",e);const t=Hp.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Gd=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function iA(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[a,u]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(a.trim()===t)return decodeURIComponent(u)}return null}(document.cookie,t)}}let Hp,Gd=null;const tw=new qt("TRANSITION_ID"),XA=[{provide:Mp,useFactory:function WA(e,t,n){return()=>{n.get(fh).donePromise.then(()=>{const i=Ll(),a=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let u=0;u<a.length;u++)i.remove(a[u])})}},deps:[tw,so,rs],multi:!0}];class Ay{static init(){!function RI(e){oy=e}(new Ay)}addToWindow(t){Be.getAngularTestability=(i,a=!0)=>{const u=t.findTestabilityInTree(i,a);if(null==u)throw new Error("Could not find testability for element.");return u},Be.getAllAngularTestabilities=()=>t.getAllTestabilities(),Be.getAllAngularRootElements=()=>t.getAllRootElements(),Be.frameworkStabilizers||(Be.frameworkStabilizers=[]),Be.frameworkStabilizers.push(i=>{const a=Be.getAllAngularTestabilities();let u=a.length,f=!1;const v=function(w){f=f||w,u--,0==u&&i(f)};a.forEach(function(w){w.whenStable(v)})})}findTestabilityInTree(t,n,i){return null==n?null:t.getTestability(n)??(i?Ll().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}}let KA=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const qp=new qt("EventManagerPlugins");let Gp=(()=>{class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(a=>a.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,i,a){return this._findPluginFor(i).addEventListener(n,i,a)}addGlobalEventListener(n,i,a){return this._findPluginFor(i).addGlobalEventListener(n,i,a)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const a=this._plugins;for(let u=0;u<a.length;u++){const f=a[u];if(f.supports(n))return this._eventNameToPlugin.set(n,f),f}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(vt(qp),vt(ti))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();class nw{constructor(t){this._doc=t}addGlobalEventListener(t,n,i){const a=Ll().getGlobalEventTarget(this._doc,t);if(!a)throw new Error(`Unsupported event target ${a} for event ${n}`);return this.addEventListener(a,n,i)}}let rw=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const i=new Set;n.forEach(a=>{this._stylesSet.has(a)||(this._stylesSet.add(a),i.add(a))}),this.onStylesAdded(i)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})(),Zd=(()=>{class e extends rw{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,i,a){n.forEach(u=>{const f=this._doc.createElement("style");f.textContent=u,a.push(i.appendChild(f))})}addHost(n){const i=[];this._addStylesToHost(this._stylesSet,n,i),this._hostNodes.set(n,i)}removeHost(n){const i=this._hostNodes.get(n);i&&i.forEach(iw),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((i,a)=>{this._addStylesToHost(n,a,i)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(iw))}}return e.\u0275fac=function(n){return new(n||e)(vt(so))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();function iw(e){Ll().remove(e)}const My={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Py=/%COMP%/g;function Zp(e,t,n){for(let i=0;i<t.length;i++){let a=t[i];Array.isArray(a)?Zp(e,a,n):(a=a.replace(Py,e),n.push(a))}return n}function aw(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let ky=(()=>{class e{constructor(n,i,a){this.eventManager=n,this.sharedStylesHost=i,this.appId=a,this.rendererByCompId=new Map,this.defaultRenderer=new Ry(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;switch(i.encapsulation){case Hr.Emulated:{let a=this.rendererByCompId.get(i.id);return a||(a=new nM(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,a)),a.applyToHost(n),a}case 1:case Hr.ShadowDom:return new rM(this.eventManager,this.sharedStylesHost,n,i);default:if(!this.rendererByCompId.has(i.id)){const a=Zp(i.id,i.styles,[]);this.sharedStylesHost.addStyles(a),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(vt(Gp),vt(Zd),vt(Ud))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();class Ry{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(My[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){t.appendChild(n)}insertBefore(t,n,i){t&&t.insertBefore(n,i)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,a){if(a){n=a+":"+n;const u=My[a];u?t.setAttributeNS(u,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const a=My[i];a?t.removeAttributeNS(a,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,a){a&(Li.DashCase|Li.Important)?t.style.setProperty(n,i,a&Li.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&Li.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){t[n]=i}setValue(t,n){t.nodeValue=n}listen(t,n,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,aw(i)):this.eventManager.addEventListener(t,n,aw(i))}}class nM extends Ry{constructor(t,n,i,a){super(t),this.component=i;const u=Zp(a+"-"+i.id,i.styles,[]);n.addStyles(u),this.contentAttr=function QA(e){return"_ngcontent-%COMP%".replace(Py,e)}(a+"-"+i.id),this.hostAttr=function eM(e){return"_nghost-%COMP%".replace(Py,e)}(a+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}class rM extends Ry{constructor(t,n,i,a){super(t),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=Zp(a.id,a.styles,[]);for(let f=0;f<u.length;f++){const v=document.createElement("style");v.textContent=u[f],this.shadowRoot.appendChild(v)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let iM=(()=>{class e extends nw{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,a){return n.addEventListener(i,a,!1),()=>this.removeEventListener(n,i,a)}removeEventListener(n,i,a){return n.removeEventListener(i,a)}}return e.\u0275fac=function(n){return new(n||e)(vt(so))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const uw=["alt","control","meta","shift"],oM={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},cw={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},aM={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let lM=(()=>{class e extends nw{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,a){const u=e.parseEventName(i),f=e.eventCallback(u.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ll().onAndCancel(n,u.domEventName,f))}static parseEventName(n){const i=n.toLowerCase().split("."),a=i.shift();if(0===i.length||"keydown"!==a&&"keyup"!==a)return null;const u=e._normalizeKey(i.pop());let f="";if(uw.forEach(w=>{const I=i.indexOf(w);I>-1&&(i.splice(I,1),f+=w+".")}),f+=u,0!=i.length||0===u.length)return null;const v={};return v.domEventName=a,v.fullKey=f,v}static getEventFullKey(n){let i="",a=function uM(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&cw.hasOwnProperty(t)&&(t=cw[t]))}return oM[t]||t}(n);return a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),uw.forEach(u=>{u!=a&&aM[u](n)&&(i+=u+".")}),i+=a,i}static eventCallback(n,i,a){return u=>{e.getEventFullKey(u)===n&&a.runGuarded(()=>i(u))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(vt(so))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const fM=_b(iT,"browser",[{provide:ty,useValue:"browser"},{provide:ub,useValue:function cM(){Ty.makeCurrent(),Ay.init()},multi:!0},{provide:so,useFactory:function dM(){return function fl(e){Ia=e}(document),document},deps:[]}]),pM=[{provide:dg,useValue:"root"},{provide:xo,useFactory:function hM(){return new xo},deps:[]},{provide:qp,useClass:iM,multi:!0,deps:[so,ti,ty]},{provide:qp,useClass:lM,multi:!0,deps:[so]},{provide:ky,useClass:ky,deps:[Gp,Zd,Ud]},{provide:S0,useExisting:ky},{provide:rw,useExisting:Zd},{provide:Zd,useClass:Zd,deps:[so]},{provide:sy,useClass:sy,deps:[ti]},{provide:Gp,useClass:Gp,deps:[qp,ti]},{provide:class HA{},useClass:KA,deps:[]}];let mM=(()=>{class e{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:e,providers:[{provide:Ud,useValue:n.appId},{provide:tw,useExisting:Ud},XA]}}}return e.\u0275fac=function(n){return new(n||e)(vt(e,12))},e.\u0275mod=Zs({type:e}),e.\u0275inj=Ei({providers:pM,imports:[zA,hT]}),e})();"undefined"!=typeof window&&window;var SM=Lr(943);function fw(e,t,n,i,a,u,f){try{var v=e[u](f),w=v.value}catch(I){return void n(I)}v.done?t(w):Promise.resolve(w).then(i,a)}function Fy(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var u=e.apply(t,n);function f(w){fw(u,i,a,f,v,"next",w)}function v(w){fw(u,i,a,f,v,"throw",w)}f(void 0)})}}function Ru(e,t,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function Wp(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zy(e[0])||!zy(e[1]))throw new Error("coordinates must contain numbers");return Ru({type:"Point",coordinates:e},t,n)}function Ol(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function zy(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}class _w{callbacks={};fire(t,n){(this.callbacks[t]||[]).forEach(i=>i(n))}on(t,n){this.callbacks[t]=[...this.callbacks[t]||[],n]}off(t,n){this.callbacks[t]=(this.callbacks[t]||[]).filter(i=>i!==n)}}const kM={alternatives:1,skipAlternativesOnMultipleWaypoint:!0,firstRouteCenter:!0,plugins:[],routeSourceId:"libre-routing-route-source",waypointsSourceId:"libre-routing-waypoints-source"};class RM{_map;_options;get map(){return this._map}get options(){return this._options}dispatcher=new _w;data;_waypoints=[];set waypoints(t){this._waypoints=t,this.dispatcher.fire("waypoints",this._waypoints)}get waypoints(){return this._waypoints}constructor(t){this._options={...kM,...t}}onAdd(t){return this._map=t,this.enable(),document.createElement("div")}onRemove(){this.disable()}addWaypoint(t,n,i){const a=[...this.waypoints];a.splice(n,0,{originalPos:t,mappedPos:i}),this.waypoints=a,this.updateWaypointsSource()}updateWaypoint(t,n,i){this.waypoints[n]={originalPos:t,mappedPos:i},this.updateWaypointsSource()}removeWaypoint(t){const n=[...this.waypoints];n.splice(t,1),this.waypoints=n,this.updateWaypointsSource()}recalculateRoute(t=!1){var n=this;return Fy(function*(){if(!n.map||n.waypoints.length<2)return;if(!n.options.dataProvider)throw new Error("No data provider");const i=n.options.skipAlternativesOnMultipleWaypoint&&2!==n.waypoints.length?0:n.options.alternatives,a=yield n.options.dataProvider.request(n.waypoints,{alternatives:i});if(!a)return;const u=!n.data;return n.data=a,n.setSource(n.options.routeSourceId,a.geojson.data),n.dispatcher.fire("routeCalculated",n.data),2===n.waypoints.length&&!t&&u&&n.zoomToData(),a})()}zoomToData(t){this.data.bounds&&this.map.fitBounds(this.data.bounds,{padding:40,...t})}on(...t){this.dispatcher.on(...t)}off(...t){this.dispatcher.off(...t)}enable(){this.setupMapSources(),this.initPlugins()}disable(){this.detachPlugins(),this.options.dataProvider?.destroy(),this.map.removeSource(this.options.routeSourceId),this.map.removeSource(this.options.waypointsSourceId)}selectRoute(t){const n=this.data.geojson.data.features.filter(a=>a.properties?.routeIndex===t).map(a=>({...a,properties:{...a.properties,routeIndex:0}})),i={...this.data.geojson.data,features:n};this.setSource(this.options.routeSourceId,i),this.dispatcher.fire("routeSelected",{event:"routeSelected",data:i})}updateWaypointsSource(){const n=Ol(this.waypoints.map((i,a)=>Wp(i.originalPos,{id:a})));this.setSource(this.options.waypointsSourceId,n)}initPlugins(){this.options.plugins.forEach(t=>this.resolvePlugin(t).onAdd(this))}detachPlugins(){this.options.plugins.forEach(t=>this.resolvePlugin(t).onRemove(this))}setupMapSources(){this.map.addSource(this.options.routeSourceId,{type:"geojson",data:Ol([])}),this.map.addSource(this.options.waypointsSourceId,{type:"geojson",data:Ol([])})}resolvePlugin(t){return"function"==typeof t?new t({}):t}setSource(t,n){this.map.getSource(t).setData(n)}}var Lu=(()=>{return(e=Lu||(Lu={})).RouteLayerId="libre-routing-route-layer",e.WaypointsLayerId="libre-routing-waypoints-layer",Lu;var e})();function vw(e,t,n){var i,a,u,f=null,v=0;n||(n={});var w=function(){v=!1===n.leading?0:Date.now(),f=null,u=e.apply(i,a),f||(i=a=null)};return function(){var I=Date.now();!v&&!1===n.leading&&(v=I);var M=t-(I-v);return i=this,a=arguments,M<=0||M>t?(f&&(clearTimeout(f),f=null),v=I,u=e.apply(i,a),f||(i=a=null)):!f&&!1!==n.trailing&&(f=setTimeout(w,M)),u}}const LM={calculateOnFly:!0,routeLayerId:Lu.RouteLayerId,waypointsLayerId:Lu.WaypointsLayerId};class FM{mapMoveHandler=vw(this.onMapMove.bind(this),50,{leading:!0,trailing:!0});mapClickHandler=this.onMapClick.bind(this);mousedownHandler=this.onMousedown.bind(this);mouseupHandler=this.onMouseup.bind(this);point=Ol([Wp([0,0])]);waypoints=[];_waypointOrigin;options;ctx;map;dispatcher;recalculateHandler=vw(()=>{this.ctx.recalculateRoute()},100,{leading:!0,trailing:!0});_dirty=!1;set waypointOrigin(t){this._waypointOrigin=t,this._dirty=!t,this.fire("dirty",this._dirty)}get waypointOrigin(){return this._waypointOrigin}get dirty(){return this._dirty}constructor(t){this.dispatcher=new _w,this.options={...LM,...t}}onAdd(t){this.ctx=t,this.map=t.map,t.on("waypoints",n=>this.waypoints=n),this.map.addSource("point",{type:"geojson",data:this.point}),this.map.addLayer({id:"point",type:"circle",source:"point",layout:{visibility:"visible"},paint:{"circle-radius":3.4,"circle-color":"#fff","circle-stroke-width":4,"circle-stroke-color":"#e207ff"}}),this.map.on("mousedown",this.mousedownHandler),this.map.on("mouseup",this.mouseupHandler),this.map.on("click",this.mapClickHandler),this.map.on("mousemove",this.mapMoveHandler)}onRemove(){}onMapClick(t){const i=this.map.queryRenderedFeatures(t.point,{layers:[this.options.routeLayerId]}).find(a=>a.source===this.ctx.options.routeSourceId);i&&0!==i.properties.routeIndex?this.ctx.selectRoute(i.properties.routeIndex):this.waypoints.length>=2||this.addWaypoint(t.lngLat.toArray(),this.waypoints.length-1)}onMapMove(t){if(null!=this.waypointOrigin)return void this.updateWaypoint(t.lngLat.toArray(),this.waypointOrigin);const n=this.map.queryRenderedFeatures(t.point,{layers:[this.options.routeLayerId,this.options.waypointsLayerId]}),i=n.find(({source:u})=>u===this.ctx.options.waypointsSourceId),a=n.find(({source:u})=>u===this.ctx.options.routeSourceId);return i?(this.map.getCanvas().style.cursor="pointer",void this.map.setLayoutProperty("point","visibility","none")):n.length&&!i&&a?0===a.properties.routeIndex?("visible"!==this.map.getLayoutProperty("point","visibility")&&(this.map.getCanvas().style.cursor="pointer",this.map.setLayoutProperty("point","visibility","visible")),this.point.features[0].geometry.coordinates=t.lngLat.toArray(),void this.map.getSource("point").setData(this.point)):(this.map.getCanvas().style.cursor="pointer",void this.map.setLayoutProperty("point","visibility","none")):void("visible"===this.map.getLayoutProperty("point","visibility")&&(this.map.setLayoutProperty("point","visibility","none"),this.map.getCanvas().style.cursor=""))}onMousedown(t){const n=this.map.queryRenderedFeatures(t.point,{layers:[this.options.routeLayerId,this.options.waypointsLayerId]});if(!n.length)return;const i=n.find(u=>u.source===this.ctx.options.waypointsSourceId);if(i)return this.map.dragPan.disable(),void(this.waypointOrigin=i.properties.id);const a=n.find(u=>u.source===this.ctx.options.routeSourceId);a&&0===a.properties.routeIndex&&(this.map.dragPan.disable(),this.waypointOrigin=a.properties.waypoint+1,this.map.setLayoutProperty("point","visibility","none"),this.addWaypoint(t.lngLat.toArray(),a.properties.waypoint+1))}onMouseup(){this.map.dragPan.enable(),this.map.setLayoutProperty("point","visibility","none"),this.waypointOrigin=null}fire(t,n){this.dispatcher.fire(t,n)}on(t,n){this.dispatcher.on(t,n)}off(t,n){this.dispatcher.off(t,n)}addWaypoint(t,n){this.ctx.addWaypoint(t,n),(!this.dirty||this.options.calculateOnFly)&&this.recalculateHandler()}updateWaypoint(t,n){this.ctx.updateWaypoint(t,n),(!this.dirty||this.options.calculateOnFly)&&this.recalculateHandler()}}function xw(e,t){return Object.entries(t).reduce((n,[i,a])=>(n[i]=a&&"object"==typeof a?xw(n[i]=n[i]||(Array.isArray(a)?[]:{}),a):a,n),e)}const zM=(e,t)=>({id:e,source:t,type:"circle",layout:{visibility:"visible"},paint:{"circle-radius":3.4,"circle-color":"#fff","circle-stroke-width":4,"circle-stroke-color":"#e207ff"}});class NM{_options;ctx;options;get map(){return this.ctx.map}constructor(t={}){this._options=t}onAdd(t){this.ctx=t,this.options=xw(this.defaultConfig(),this._options),this.options.layers.forEach(n=>{this.map.addLayer(n.style,n.before)})}onRemove(){this.map.removeLayer("route"),this.map.removeLayer("waypoints")}defaultConfig(){return{layers:[{style:(e=Lu.RouteLayerId,t=this.ctx.options.routeSourceId,{id:e,type:"line",source:t,minzoom:1,maxzoom:17,layout:{"line-join":"round","line-cap":"round","line-sort-key":["case",["==",["get","routeIndex"],0],1,0]},paint:{"line-color":["case",["==",["get","routeIndex"],0],"#e207ff","#33C9EB"],"line-width":4}})},{style:zM(Lu.WaypointsLayerId,this.ctx.options.waypointsSourceId)}]};var e,t}}const bw=Symbol("Comlink.proxy"),BM=Symbol("Comlink.endpoint"),VM=Symbol("Comlink.releaseProxy"),Ny=Symbol("Comlink.thrown"),ww=e=>"object"==typeof e&&null!==e||"function"==typeof e,Dw=new Map([["proxy",{canHandle:e=>ww(e)&&e[bw],serialize(e){const{port1:t,port2:n}=new MessageChannel;return Ew(e,t),[n,[n]]},deserialize:e=>(e.start(),Sw(e))}],["throw",{canHandle:e=>ww(e)&&Ny in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}}]]);function Ew(e,t=self){t.addEventListener("message",function n(i){if(!i||!i.data)return;const{id:a,type:u,path:f}=Object.assign({path:[]},i.data),v=(i.data.argumentList||[]).map(Fu);let w;try{const I=f.slice(0,-1).reduce((z,G)=>z[G],e),M=f.reduce((z,G)=>z[G],e);switch(u){case"GET":w=M;break;case"SET":I[f.slice(-1)[0]]=Fu(i.data.value),w=!0;break;case"APPLY":w=M.apply(I,v);break;case"CONSTRUCT":w=function GM(e){return Object.assign(e,{[bw]:!0})}(new M(...v));break;case"ENDPOINT":{const{port1:z,port2:G}=new MessageChannel;Ew(e,G),w=function qM(e,t){return Tw.set(e,t),e}(z,[z])}break;case"RELEASE":w=void 0;break;default:return}}catch(I){w={value:I,[Ny]:0}}Promise.resolve(w).catch(I=>({value:I,[Ny]:0})).then(I=>{const[M,z]=Vy(I);t.postMessage(Object.assign(Object.assign({},M),{id:a}),z),"RELEASE"===u&&(t.removeEventListener("message",n),Cw(t))})}),t.start&&t.start()}function Cw(e){(function $M(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function Sw(e,t){return By(e,[],t)}function Xp(e){if(e)throw new Error("Proxy has been released and is not useable")}function By(e,t=[],n=function(){}){let i=!1;const a=new Proxy(n,{get(u,f){if(Xp(i),f===VM)return()=>gh(e,{type:"RELEASE",path:t.map(v=>v.toString())}).then(()=>{Cw(e),i=!0});if("then"===f){if(0===t.length)return{then:()=>a};const v=gh(e,{type:"GET",path:t.map(w=>w.toString())}).then(Fu);return v.then.bind(v)}return By(e,[...t,f])},set(u,f,v){Xp(i);const[w,I]=Vy(v);return gh(e,{type:"SET",path:[...t,f].map(M=>M.toString()),value:w},I).then(Fu)},apply(u,f,v){Xp(i);const w=t[t.length-1];if(w===BM)return gh(e,{type:"ENDPOINT"}).then(Fu);if("bind"===w)return By(e,t.slice(0,-1));const[I,M]=Iw(v);return gh(e,{type:"APPLY",path:t.map(z=>z.toString()),argumentList:I},M).then(Fu)},construct(u,f){Xp(i);const[v,w]=Iw(f);return gh(e,{type:"CONSTRUCT",path:t.map(I=>I.toString()),argumentList:v},w).then(Fu)}});return a}function HM(e){return Array.prototype.concat.apply([],e)}function Iw(e){const t=e.map(Vy);return[t.map(n=>n[0]),HM(t.map(n=>n[1]))]}const Tw=new WeakMap;function Vy(e){for(const[t,n]of Dw)if(n.canHandle(e)){const[i,a]=n.serialize(e);return[{type:"HANDLER",name:t,value:i},a]}return[{type:"RAW",value:e},Tw.get(e)||[]]}function Fu(e){switch(e.type){case"HANDLER":return Dw.get(e.name).deserialize(e.value);case"RAW":return e.value}}function gh(e,t,n){return new Promise(i=>{const a=function ZM(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}();e.addEventListener("message",function u(f){!f.data||!f.data.id||f.data.id!==a||(e.removeEventListener("message",u),i(f.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),n)})}var WM=Lr(69),XM=Lr(572);function Wd(e,t,n){if(null!==e)for(var i,a,u,f,v,w,I,G,M=0,z=0,K=e.type,ce="FeatureCollection"===K,De="Feature"===K,Ie=ce?e.features.length:1,Me=0;Me<Ie;Me++){v=(G=!!(I=ce?e.features[Me].geometry:De?e.geometry:e)&&"GeometryCollection"===I.type)?I.geometries.length:1;for(var xe=0;xe<v;xe++){var Ge=0,mt=0;if(null!==(f=G?I.geometries[xe]:I)){w=f.coordinates;var zt=f.type;switch(M=!n||"Polygon"!==zt&&"MultiPolygon"!==zt?0:1,zt){case null:break;case"Point":if(!1===t(w,z,Me,Ge,mt))return!1;z++,Ge++;break;case"LineString":case"MultiPoint":for(i=0;i<w.length;i++){if(!1===t(w[i],z,Me,Ge,mt))return!1;z++,"MultiPoint"===zt&&Ge++}"LineString"===zt&&Ge++;break;case"Polygon":case"MultiLineString":for(i=0;i<w.length;i++){for(a=0;a<w[i].length-M;a++){if(!1===t(w[i][a],z,Me,Ge,mt))return!1;z++}"MultiLineString"===zt&&Ge++,"Polygon"===zt&&mt++}"Polygon"===zt&&Ge++;break;case"MultiPolygon":for(i=0;i<w.length;i++){for(mt=0,a=0;a<w[i].length;a++){for(u=0;u<w[i][a].length-M;u++){if(!1===t(w[i][a][u],z,Me,Ge,mt))return!1;z++}mt++}Ge++}break;case"GeometryCollection":for(i=0;i<f.geometries.length;i++)if(!1===Wd(f.geometries[i],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function jy(e){var t=[1/0,1/0,-1/0,-1/0];return Wd(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}jy.default=jy;const e2=jy;class n2{response;code=401;message="Unauthorized";constructor(t){this.response=t}}const r2=new class t2{latestResponseExecutionTime=0;buffer=[];maxBuffer=4;request(t,n){var i=this;return Fy(function*(){const a=new AbortController,u=Date.now();i.buffer.length>i.maxBuffer&&(i.buffer[0].abort(),i.buffer.splice(0,1)),i.buffer.push(a);const f=yield fetch(t,{...n,signal:a.signal});if(200!==f.status)throw f;if(i.buffer=i.buffer.filter(v=>v!==a),i.latestResponseExecutionTime>u)throw new Error("Prev response");return i.latestResponseExecutionTime=u,yield f.json()})()}},i2={request:e=>Fy(function*(){try{const t=yield r2.request(e.url),i=Ol(t.routes.map((a,u)=>s2(a,u)).reduce((a,u)=>[...a,...u],[]));return{bounds:e2(i),rawData:t,geojson:{type:"geojson",data:i}}}catch(t){if(t instanceof Response){const n=t,i=yield n.json();if(401===n.status)throw new n2(i)}throw t}})()},s2=(e,t)=>e.sections.map((n,i)=>{const u=(0,WM.decode)(n.polyline).polyline.map(([w,I])=>({x:w,y:I}));return function Oy(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Ru({type:"LineString",coordinates:e},t,n)}(XM(u,1e-4,!0).map(w=>[+w.y.toFixed(6),+w.x.toFixed(6)]),{waypoint:i,routeIndex:t})}),o2={baseUrl:"https://router.hereapi.com/v8/routes",transportMode:"car",worker:!0};class a2{worker;executorAPI;options;constructor(t){this.options={...o2,...t},!0===this.options.worker?(this.worker=new Worker(Lr.tu(new URL(Lr.p+Lr.u(419),Lr.b)),{type:void 0}),this.executorAPI=Sw(this.worker)):this.executorAPI=i2}destroy(){this.worker&&this.worker.terminate()}request(t,n){const i=this.buildUrl(t,n);return this.executorAPI.request({url:i})}setOption(t,n){this.options[t]=n}buildUrl(t,n){const i=[...t[0].originalPos].reverse(),a=[...t[t.length-1].originalPos].reverse(),u={origin:i.toString(),destination:a.toString(),spans:[...this.options.spans||[],"names"].toString(),transportMode:this.options.transportMode||"",return:[...this.options.return||[],"polyline"].toString(),alternatives:n?.alternatives,apiKey:this.options.apiKey};let f=new URLSearchParams(u).toString();return t.length>2&&(f+=`&${this.serializeWaypoints(t)}`),`${this.options.baseUrl}?${f}`}serializeWaypoints(t){return t.slice(1,t.length-1).map(n=>`via=${[...n.originalPos].reverse()}`).join("&")}}const $y_production=!1,$y_hereApiKey="WMRvf7QXKJQhmlw1nEdkL2UjXKSdNY4NryQ5_6tGudc",l2=["mapContainer"];class Kp{mapContainer;ngAfterViewInit(){const t=new SM.Map({container:this.mapContainer.nativeElement,center:[13,51],zoom:4,style:`https://assets.vector.hereapi.com/styles/berlin/base/mapbox/tilezen?apikey=${$y_hereApiKey}`}),n=new a2({apiKey:$y_hereApiKey}),i=new RM({dataProvider:n,plugins:[new NM,new FM]});i.on("routeCalculated",console.log),i.on("routeSelected",console.log),i.on("waypoints",console.log),t.on("load",()=>{t.addControl(i),i.addWaypoint([13,51],0),i.addWaypoint([14,51],0),i.recalculateRoute()})}static \u0275fac=function(n){return new(n||Kp)};static \u0275cmp=Gs({type:Kp,selectors:[["libre-routing-root"]],viewQuery:function(n,i){if(1&n&&$0(l2,5),2&n){let a;Cp(a=function Sp(){return function rI(e,t){return e[19].queries[t].queryList}(V(),ki())}())&&(i.mapContainer=a.first)}},decls:2,vars:0,consts:[["id","map"],["mapContainer",""]],template:function(n,i){1&n&&Sg(0,"div",0,1)},styles:["#map[_ngcontent-%COMP%]{display:block;width:100vw;height:100vh}"]})}function Bt(...e){return at(e,re(e))}class ko extends Nr{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const{isArray:u2}=Array,{getPrototypeOf:c2,prototype:h2,keys:d2}=Object;const{isArray:m2}=Array;function v2(...e){const t=re(e),n=function J(e){return sn(W(e))?e.pop():void 0}(e),{args:i,keys:a}=function f2(e){if(1===e.length){const t=e[0];if(u2(t))return{args:t,keys:null};if(function p2(e){return e&&"object"==typeof e&&c2(e)===h2}(t)){const n=d2(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}(e);if(0===i.length)return at([],t);const u=new Zt(function x2(e,t,n=lr){return i=>{Mw(t,()=>{const{length:a}=e,u=new Array(a);let f=a,v=a;for(let w=0;w<a;w++)Mw(t,()=>{const I=at(e[w],t);let M=!1;I.subscribe(new Cn(i,z=>{u[w]=z,M||(M=!0,v--),v||i.next(n(u.slice()))},()=>{--f||i.complete()}))},i)},i)}}(i,t,a?f=>function _2(e,t){return e.reduce((n,i,a)=>(n[i]=t[a],n),{})}(a,f):lr));return n?u.pipe(function y2(e){return Xt(t=>function g2(e,t){return m2(t)?e(...t):e(t)}(e,t))}(n)):u}function Mw(e,t,n){e?jr(n,e,t):t()}const Yp=Us(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Hy(...e){return function b2(){return Di(1)}()(at(e,re(e)))}function Pw(e){return new Zt(t=>{ii(e()).subscribe(t)})}function kw(){return an((e,t)=>{let n=null;e._refCount++;const i=new Cn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const a=e._connection,u=n;n=null,a&&(!u||a===u)&&a.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class w2 extends Zt{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Ui(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new hn;const n=this.getSubject();t.add(this.source.subscribe(new Cn(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=hn.EMPTY)}return t}refCount(){return kw()(this)}}function Ou(e,t){return an((n,i)=>{let a=null,u=0,f=!1;const v=()=>f&&!a&&i.complete();n.subscribe(new Cn(i,w=>{null==a||a.unsubscribe();let I=0;const M=u++;ii(e(w,M)).subscribe(a=new Cn(i,z=>i.next(t?t(w,z,M,I++):z),()=>{a=null,v()}))},()=>{f=!0,v()}))})}function E2(e,t,n,i,a){return(u,f)=>{let v=n,w=t,I=0;u.subscribe(new Cn(f,M=>{const z=I++;w=v?e(w,M,z):(v=!0,M),i&&f.next(w)},a&&(()=>{v&&f.next(w),f.complete()})))}}function Rw(e,t){return an(E2(e,t,arguments.length>=2,!0))}function yh(e,t){return an((n,i)=>{let a=0;n.subscribe(new Cn(i,u=>e.call(t,u,a++)&&i.next(u)))})}function zl(e){return an((t,n)=>{let u,i=null,a=!1;i=t.subscribe(new Cn(n,void 0,void 0,f=>{u=ii(e(f,zl(e)(t))),i?(i.unsubscribe(),i=null,u.subscribe(n)):a=!0})),a&&(i.unsubscribe(),i=null,u.subscribe(n))})}function Xd(e,t){return sn(t)?Fn(e,t,1):Fn(e,1)}function qy(e){return e<=0?()=>q:an((t,n)=>{let i=[];t.subscribe(new Cn(n,a=>{i.push(a),e<i.length&&i.shift()},()=>{for(const a of i)n.next(a);n.complete()},void 0,()=>{i=null}))})}function Lw(e=C2){return an((t,n)=>{let i=!1;t.subscribe(new Cn(n,a=>{i=!0,n.next(a)},()=>i?n.complete():n.error(e())))})}function C2(){return new Yp}function Fw(e){return an((t,n)=>{let i=!1;t.subscribe(new Cn(n,a=>{i=!0,n.next(a)},()=>{i||n.next(e),n.complete()}))})}function _h(e,t){const n=arguments.length>=2;return i=>i.pipe(e?yh((a,u)=>e(a,u,i)):lr,bt(1),n?Fw(t):Lw(()=>new Yp))}function Ns(e,t,n){const i=sn(e)||t||n?{next:e,error:t,complete:n}:e;return i?an((a,u)=>{var f;null===(f=i.subscribe)||void 0===f||f.call(i);let v=!0;a.subscribe(new Cn(u,w=>{var I;null===(I=i.next)||void 0===I||I.call(i,w),u.next(w)},()=>{var w;v=!1,null===(w=i.complete)||void 0===w||w.call(i),u.complete()},w=>{var I;v=!1,null===(I=i.error)||void 0===I||I.call(i,w),u.error(w)},()=>{var w,I;v&&(null===(w=i.unsubscribe)||void 0===w||w.call(i)),null===(I=i.finalize)||void 0===I||I.call(i)}))}):lr}class Xa{constructor(t,n){this.id=t,this.url=n}}class Gy extends Xa{constructor(t,n,i="imperative",a=null){super(t,n),this.navigationTrigger=i,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Kd extends Xa{constructor(t,n,i){super(t,n),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ow extends Xa{constructor(t,n,i){super(t,n),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class T2 extends Xa{constructor(t,n,i){super(t,n),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class A2 extends Xa{constructor(t,n,i,a){super(t,n),this.urlAfterRedirects=i,this.state=a}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class M2 extends Xa{constructor(t,n,i,a){super(t,n),this.urlAfterRedirects=i,this.state=a}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class P2 extends Xa{constructor(t,n,i,a,u){super(t,n),this.urlAfterRedirects=i,this.state=a,this.shouldActivate=u}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class k2 extends Xa{constructor(t,n,i,a){super(t,n),this.urlAfterRedirects=i,this.state=a}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class R2 extends Xa{constructor(t,n,i,a){super(t,n),this.urlAfterRedirects=i,this.state=a}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zw{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Nw{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class L2{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class F2{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class O2{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class z2{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bw{constructor(t,n,i){this.routerEvent=t,this.position=n,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Gt="primary";class N2{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function vh(e){return new N2(e)}const Vw="ngNavigationCancelingError";function Zy(e){const t=Error("NavigationCancelingError: "+e);return t[Vw]=!0,t}function V2(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const a={};for(let u=0;u<i.length;u++){const f=i[u],v=e[u];if(f.startsWith(":"))a[f.substring(1)]=v;else if(f!==v.path)return null}return{consumed:e.slice(0,i.length),posParams:a}}function ua(e,t){const n=e?Object.keys(e):void 0,i=t?Object.keys(t):void 0;if(!n||!i||n.length!=i.length)return!1;let a;for(let u=0;u<n.length;u++)if(a=n[u],!Uw(e[a],t[a]))return!1;return!0}function Uw(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((a,u)=>i[u]===a)}return e===t}function jw(e){return Array.prototype.concat.apply([],e)}function $w(e){return e.length>0?e[e.length-1]:null}function bi(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function ca(e){return nx(e)?e:fp(e)?at(Promise.resolve(e)):Bt(e)}const $2={exact:function Gw(e,t,n){if(!Nu(e.segments,t.segments)||!Jp(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!Gw(e.children[i],t.children[i],n))return!1;return!0},subset:Zw},Hw={exact:function H2(e,t){return ua(e,t)},subset:function q2(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Uw(e[n],t[n]))},ignored:()=>!0};function qw(e,t,n){return $2[n.paths](e.root,t.root,n.matrixParams)&&Hw[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function Zw(e,t,n){return Ww(e,t,t.segments,n)}function Ww(e,t,n,i){if(e.segments.length>n.length){const a=e.segments.slice(0,n.length);return!(!Nu(a,n)||t.hasChildren()||!Jp(a,n,i))}if(e.segments.length===n.length){if(!Nu(e.segments,n)||!Jp(e.segments,n,i))return!1;for(const a in t.children)if(!e.children[a]||!Zw(e.children[a],t.children[a],i))return!1;return!0}{const a=n.slice(0,e.segments.length),u=n.slice(e.segments.length);return!!(Nu(e.segments,a)&&Jp(e.segments,a,i)&&e.children[Gt])&&Ww(e.children[Gt],t,u,i)}}function Jp(e,t,n){return t.every((i,a)=>Hw[n](e[a].parameters,i.parameters))}class zu{constructor(t,n,i){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vh(this.queryParams)),this._queryParamMap}toString(){return W2.serialize(this)}}class tn{constructor(t,n){this.segments=t,this.children=n,this.parent=null,bi(n,(i,a)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Qp(this)}}class Yd{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=vh(this.parameters)),this._parameterMap}toString(){return Qw(this)}}function Nu(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}class Xw{}class Kw{parse(t){const n=new rP(t);return new zu(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${Jd(t.root,!0)}`,i=function Y2(e){const t=Object.keys(e).map(n=>{const i=e[n];return Array.isArray(i)?i.map(a=>`${em(n)}=${em(a)}`).join("&"):`${em(n)}=${em(i)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function X2(e){return encodeURI(e)}(t.fragment)}`:""}`}}const W2=new Kw;function Qp(e){return e.segments.map(t=>Qw(t)).join("/")}function Jd(e,t){if(!e.hasChildren())return Qp(e);if(t){const n=e.children[Gt]?Jd(e.children[Gt],!1):"",i=[];return bi(e.children,(a,u)=>{u!==Gt&&i.push(`${u}:${Jd(a,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function Z2(e,t){let n=[];return bi(e.children,(i,a)=>{a===Gt&&(n=n.concat(t(i,a)))}),bi(e.children,(i,a)=>{a!==Gt&&(n=n.concat(t(i,a)))}),n}(e,(i,a)=>a===Gt?[Jd(e.children[Gt],!1)]:[`${a}:${Jd(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Gt]?`${Qp(e)}/${n[0]}`:`${Qp(e)}/(${n.join("//")})`}}function Yw(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function em(e){return Yw(e).replace(/%3B/gi,";")}function Wy(e){return Yw(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function tm(e){return decodeURIComponent(e)}function Jw(e){return tm(e.replace(/\+/g,"%20"))}function Qw(e){return`${Wy(e.path)}${function K2(e){return Object.keys(e).map(t=>`;${Wy(t)}=${Wy(e[t])}`).join("")}(e.parameters)}`}const J2=/^[^\/()?;=#]+/;function nm(e){const t=e.match(J2);return t?t[0]:""}const Q2=/^[^=?&#]+/,tP=/^[^&#]+/;class rP{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new tn([],{}):new tn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[Gt]=new tn(t,n)),i}parseSegment(){const t=nm(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new Yd(tm(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=nm(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const a=nm(this.remaining);a&&(i=a,this.capture(i))}t[tm(n)]=tm(i)}parseQueryParam(t){const n=function eP(e){const t=e.match(Q2);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const f=function nP(e){const t=e.match(tP);return t?t[0]:""}(this.remaining);f&&(i=f,this.capture(i))}const a=Jw(n),u=Jw(i);if(t.hasOwnProperty(a)){let f=t[a];Array.isArray(f)||(f=[f],t[a]=f),f.push(u)}else t[a]=u}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=nm(this.remaining),a=this.remaining[i.length];if("/"!==a&&")"!==a&&";"!==a)throw new Error(`Cannot parse url '${this.url}'`);let u;i.indexOf(":")>-1?(u=i.substr(0,i.indexOf(":")),this.capture(u),this.capture(":")):t&&(u=Gt);const f=this.parseChildren();n[u]=1===Object.keys(f).length?f[Gt]:new tn([],f),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class e1{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Xy(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=Xy(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=Ky(t,this._root);return n.length<2?[]:n[n.length-2].children.map(a=>a.value).filter(a=>a!==t)}pathFromRoot(t){return Ky(t,this._root).map(n=>n.value)}}function Xy(e,t){if(e===t.value)return t;for(const n of t.children){const i=Xy(e,n);if(i)return i}return null}function Ky(e,t){if(e===t.value)return[t];for(const n of t.children){const i=Ky(e,n);if(i.length)return i.unshift(t),i}return[]}class Ka{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function xh(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class t1 extends e1{constructor(t,n){super(t),this.snapshot=n,Yy(this,t)}toString(){return this.snapshot.toString()}}function n1(e,t){const n=function iP(e,t){const f=new rm([],{},{},"",{},Gt,t,null,e.root,-1,{});return new i1("",new Ka(f,[]))}(e,t),i=new ko([new Yd("",{})]),a=new ko({}),u=new ko({}),f=new ko({}),v=new ko(""),w=new bh(i,a,f,v,u,Gt,t,n.root);return w.snapshot=n.root,new t1(new Ka(w,[]),n)}class bh{constructor(t,n,i,a,u,f,v,w){this.url=t,this.params=n,this.queryParams=i,this.fragment=a,this.data=u,this.outlet=f,this.component=v,this._futureSnapshot=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Xt(t=>vh(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Xt(t=>vh(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function r1(e,t="emptyOnly"){const n=e.pathFromRoot;let i=0;if("always"!==t)for(i=n.length-1;i>=1;){const a=n[i],u=n[i-1];if(a.routeConfig&&""===a.routeConfig.path)i--;else{if(u.component)break;i--}}return function sP(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...t.resolve,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(i))}class rm{constructor(t,n,i,a,u,f,v,w,I,M,z){this.url=t,this.params=n,this.queryParams=i,this.fragment=a,this.data=u,this.outlet=f,this.component=v,this.routeConfig=w,this._urlSegment=I,this._lastPathIndex=M,this._resolve=z}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=vh(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vh(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class i1 extends e1{constructor(t,n){super(n),this.url=t,Yy(this,n)}toString(){return s1(this._root)}}function Yy(e,t){t.value._routerState=e,t.children.forEach(n=>Yy(e,n))}function s1(e){const t=e.children.length>0?` { ${e.children.map(s1).join(", ")} } `:"";return`${e.value}${t}`}function Jy(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,ua(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),ua(t.params,n.params)||e.params.next(n.params),function U2(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!ua(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),ua(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Qy(e,t){const n=ua(e.params,t.params)&&function G2(e,t){return Nu(e,t)&&e.every((n,i)=>ua(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||Qy(e.parent,t.parent))}function Qd(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const a=function aP(e,t,n){return t.children.map(i=>{for(const a of n.children)if(e.shouldReuseRoute(i.value,a.value.snapshot))return Qd(e,i,a);return Qd(e,i)})}(e,t,n);return new Ka(i,a)}{if(e.shouldAttach(t.value)){const u=e.retrieve(t.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=t.value,f.children=t.children.map(v=>Qd(e,v)),f}}const i=function lP(e){return new bh(new ko(e.url),new ko(e.params),new ko(e.queryParams),new ko(e.fragment),new ko(e.data),e.outlet,e.component,e)}(t.value),a=t.children.map(u=>Qd(e,u));return new Ka(i,a)}}function im(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function ef(e){return"object"==typeof e&&null!=e&&e.outlets}function e_(e,t,n,i,a){let u={};return i&&bi(i,(f,v)=>{u[v]=Array.isArray(f)?f.map(w=>`${w}`):`${f}`}),new zu(n.root===e?t:o1(n.root,e,t),u,a)}function o1(e,t,n){const i={};return bi(e.children,(a,u)=>{i[u]=a===t?n:o1(a,t,n)}),new tn(e.segments,i)}class a1{constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&im(i[0]))throw new Error("Root segment cannot have matrix parameters");const a=i.find(ef);if(a&&a!==$w(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class t_{constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function l1(e,t,n){if(e||(e=new tn([],{})),0===e.segments.length&&e.hasChildren())return sm(e,t,n);const i=function pP(e,t,n){let i=0,a=t;const u={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(i>=n.length)return u;const f=e.segments[a],v=n[i];if(ef(v))break;const w=`${v}`,I=i<n.length-1?n[i+1]:null;if(a>0&&void 0===w)break;if(w&&I&&"object"==typeof I&&void 0===I.outlets){if(!c1(w,I,f))return u;i+=2}else{if(!c1(w,{},f))return u;i++}a++}return{match:!0,pathIndex:a,commandIndex:i}}(e,t,n),a=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const u=new tn(e.segments.slice(0,i.pathIndex),{});return u.children[Gt]=new tn(e.segments.slice(i.pathIndex),e.children),sm(u,0,a)}return i.match&&0===a.length?new tn(e.segments,{}):i.match&&!e.hasChildren()?n_(e,t,n):i.match?sm(e,0,a):n_(e,t,n)}function sm(e,t,n){if(0===n.length)return new tn(e.segments,{});{const i=function fP(e){return ef(e[0])?e[0].outlets:{[Gt]:e}}(n),a={};return bi(i,(u,f)=>{"string"==typeof u&&(u=[u]),null!==u&&(a[f]=l1(e.children[f],t,u))}),bi(e.children,(u,f)=>{void 0===i[f]&&(a[f]=u)}),new tn(e.segments,a)}}function n_(e,t,n){const i=e.segments.slice(0,t);let a=0;for(;a<n.length;){const u=n[a];if(ef(u)){const w=mP(u.outlets);return new tn(i,w)}if(0===a&&im(n[0])){i.push(new Yd(e.segments[t].path,u1(n[0]))),a++;continue}const f=ef(u)?u.outlets[Gt]:`${u}`,v=a<n.length-1?n[a+1]:null;f&&v&&im(v)?(i.push(new Yd(f,u1(v))),a+=2):(i.push(new Yd(f,{})),a++)}return new tn(i,{})}function mP(e){const t={};return bi(e,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=n_(new tn([],{}),0,n))}),t}function u1(e){const t={};return bi(e,(n,i)=>t[i]=`${n}`),t}function c1(e,t,n){return e==n.path&&ua(t,n.parameters)}class yP{constructor(t,n,i,a){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=a}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),Jy(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const a=xh(n);t.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,a[f],i),delete a[f]}),bi(a,(u,f)=>{this.deactivateRouteAndItsChildren(u,i)})}deactivateRoutes(t,n,i){const a=t.value,u=n?n.value:null;if(a===u)if(a.component){const f=i.getContext(a.outlet);f&&this.deactivateChildRoutes(t,n,f.children)}else this.deactivateChildRoutes(t,n,i);else u&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),a=i&&t.value.component?i.children:n,u=xh(t);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],a);if(i&&i.outlet){const f=i.outlet.detach(),v=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:f,route:t,contexts:v})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),a=i&&t.value.component?i.children:n,u=xh(t);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],a);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,n,i){const a=xh(n);t.children.forEach(u=>{this.activateRoutes(u,a[u.value.outlet],i),this.forwardEvent(new z2(u.value.snapshot))}),t.children.length&&this.forwardEvent(new F2(t.value.snapshot))}activateRoutes(t,n,i){const a=t.value,u=n?n.value:null;if(Jy(a),a===u)if(a.component){const f=i.getOrCreateContext(a.outlet);this.activateChildRoutes(t,n,f.children)}else this.activateChildRoutes(t,n,i);else if(a.component){const f=i.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const v=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),f.children.onOutletReAttached(v.contexts),f.attachRef=v.componentRef,f.route=v.route.value,f.outlet&&f.outlet.attach(v.componentRef,v.route.value),Jy(v.route.value),this.activateChildRoutes(t,null,f.children)}else{const v=function _P(e){for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(a.snapshot),w=v?v.module.componentFactoryResolver:null;f.attachRef=null,f.route=a,f.resolver=w,f.outlet&&f.outlet.activateWith(a,w),this.activateChildRoutes(t,null,f.children)}}else this.activateChildRoutes(t,null,i)}}class r_{constructor(t,n){this.routes=t,this.module=n}}function Nl(e){return"function"==typeof e}function Bu(e){return e instanceof zu}const tf=Symbol("INITIAL_VALUE");function nf(){return Ou(e=>v2(e.map(t=>t.pipe(bt(1),function D2(...e){const t=re(e);return an((n,i)=>{(t?Hy(e,n,t):Hy(e,n)).subscribe(i)})}(tf)))).pipe(Rw((t,n)=>{let i=!1;return n.reduce((a,u,f)=>a!==tf?a:(u===tf&&(i=!0),i||!1!==u&&f!==n.length-1&&!Bu(u)?a:u),t)},tf),yh(t=>t!==tf),Xt(t=>Bu(t)?t:!0===t),bt(1)))}class EP{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new rf,this.attachRef=null}}class rf{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const i=this.getOrCreateContext(t);i.outlet=n,this.contexts.set(t,i)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new EP,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let h1=(()=>{class e{constructor(n,i,a,u,f){this.parentContexts=n,this.location=i,this.resolver=a,this.changeDetector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new ss,this.deactivateEvents=new ss,this.attachEvents=new ss,this.detachEvents=new ss,this.name=u||Gt,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const f=(i=i||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),v=this.parentContexts.getOrCreateContext(this.name).children,w=new CP(n,v,this.location.injector);this.activated=this.location.createComponent(f,this.location.length,w),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(ct(rf),ct(To),ct(uh),function bl(e){return function _c(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let a=0;for(;a<i;){const u=n[a];if(Fh(u))break;if(0===u)a+=2;else if("number"==typeof u)for(a++;a<i&&"string"==typeof n[a];)a++;else{if(u===t)return n[a+1];a+=2}}}return null}(le(),e)}("name"),ct(ly))},e.\u0275dir=dr({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class CP{constructor(t,n,i){this.route=t,this.childContexts=n,this.parent=i}get(t,n){return t===bh?this.route:t===rf?this.childContexts:this.parent.get(t,n)}}let d1=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gs({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,i){1&n&&Sg(0,"router-outlet")},directives:[h1],encapsulation:2}),e})();function f1(e,t=""){for(let n=0;n<e.length;n++){const i=e[n];SP(i,IP(t,i))}}function SP(e,t){e.children&&f1(e.children,t)}function IP(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function i_(e){const t=e.children&&e.children.map(i_),n=t?{...e,children:t}:{...e};return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Gt&&(n.component=d1),n}function lo(e){return e.outlet||Gt}function p1(e,t){const n=e.filter(i=>lo(i)===t);return n.push(...e.filter(i=>lo(i)!==t)),n}const m1={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function om(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...m1}:{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const a=(t.matcher||V2)(n,e,t);if(!a)return{...m1};const u={};bi(a.posParams,(v,w)=>{u[w]=v.path});const f=a.consumed.length>0?{...u,...a.consumed[a.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:a.consumed,lastChild:a.consumed.length,parameters:f,positionalParamSegments:a.posParams??{}}}function am(e,t,n,i,a="corrected"){if(n.length>0&&function MP(e,t,n){return n.some(i=>lm(e,t,i)&&lo(i)!==Gt)}(e,n,i)){const f=new tn(t,function AP(e,t,n,i){const a={};a[Gt]=i,i._sourceSegment=e,i._segmentIndexShift=t.length;for(const u of n)if(""===u.path&&lo(u)!==Gt){const f=new tn([],{});f._sourceSegment=e,f._segmentIndexShift=t.length,a[lo(u)]=f}return a}(e,t,i,new tn(n,e.children)));return f._sourceSegment=e,f._segmentIndexShift=t.length,{segmentGroup:f,slicedSegments:[]}}if(0===n.length&&function PP(e,t,n){return n.some(i=>lm(e,t,i))}(e,n,i)){const f=new tn(e.segments,function TP(e,t,n,i,a,u){const f={};for(const v of i)if(lm(e,n,v)&&!a[lo(v)]){const w=new tn([],{});w._sourceSegment=e,w._segmentIndexShift="legacy"===u?e.segments.length:t.length,f[lo(v)]=w}return{...a,...f}}(e,t,n,i,e.children,a));return f._sourceSegment=e,f._segmentIndexShift=t.length,{segmentGroup:f,slicedSegments:n}}const u=new tn(e.segments,e.children);return u._sourceSegment=e,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:n}}function lm(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function g1(e,t,n,i){return!!(lo(e)===i||i!==Gt&&lm(t,n,e))&&("**"===e.path||om(t,e,n).matched)}function y1(e,t,n){return 0===t.length&&!e.children[n]}class sf{constructor(t){this.segmentGroup=t||null}}class _1{constructor(t){this.urlTree=t}}function um(e){return new Zt(t=>t.error(new sf(e)))}function v1(e){return new Zt(t=>t.error(new _1(e)))}function kP(e){return new Zt(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class FP{constructor(t,n,i,a,u){this.configLoader=n,this.urlSerializer=i,this.urlTree=a,this.config=u,this.allowRedirects=!0,this.ngModule=t.get(qa)}apply(){const t=am(this.urlTree.root,[],[],this.config).segmentGroup,n=new tn(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,Gt).pipe(Xt(u=>this.createUrlTree(s_(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(zl(u=>{if(u instanceof _1)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof sf?this.noMatchError(u):u}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,Gt).pipe(Xt(a=>this.createUrlTree(s_(a),t.queryParams,t.fragment))).pipe(zl(a=>{throw a instanceof sf?this.noMatchError(a):a}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,i){const a=t.segments.length>0?new tn([],{[Gt]:t}):t;return new zu(a,n,i)}expandSegmentGroup(t,n,i,a){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,n,i).pipe(Xt(u=>new tn([],u))):this.expandSegment(t,i,n,i.segments,a,!0)}expandChildren(t,n,i){const a=[];for(const u of Object.keys(i.children))"primary"===u?a.unshift(u):a.push(u);return at(a).pipe(Xd(u=>{const f=i.children[u],v=p1(n,u);return this.expandSegmentGroup(t,v,f,u).pipe(Xt(w=>({segment:w,outlet:u})))}),Rw((u,f)=>(u[f.outlet]=f.segment,u),{}),function S2(e,t){const n=arguments.length>=2;return i=>i.pipe(e?yh((a,u)=>e(a,u,i)):lr,qy(1),n?Fw(t):Lw(()=>new Yp))}())}expandSegment(t,n,i,a,u,f){return at(i).pipe(Xd(v=>this.expandSegmentAgainstRoute(t,n,i,v,a,u,f).pipe(zl(I=>{if(I instanceof sf)return Bt(null);throw I}))),_h(v=>!!v),zl((v,w)=>{if(v instanceof Yp||"EmptyError"===v.name){if(y1(n,a,u))return Bt(new tn([],{}));throw new sf(n)}throw v}))}expandSegmentAgainstRoute(t,n,i,a,u,f,v){return g1(a,n,u,f)?void 0===a.redirectTo?this.matchSegmentAgainstRoute(t,n,a,u,f):v&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,i,a,u,f):um(n):um(n)}expandSegmentAgainstRouteUsingRedirect(t,n,i,a,u,f){return"**"===a.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,a,f):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,a,u,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,i,a){const u=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?v1(u):this.lineralizeSegments(i,u).pipe(Fn(f=>{const v=new tn(f,{});return this.expandSegment(t,v,n,f,a,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,i,a,u,f){const{matched:v,consumedSegments:w,lastChild:I,positionalParamSegments:M}=om(n,a,u);if(!v)return um(n);const z=this.applyRedirectCommands(w,a.redirectTo,M);return a.redirectTo.startsWith("/")?v1(z):this.lineralizeSegments(a,z).pipe(Fn(G=>this.expandSegment(t,n,i,G.concat(u.slice(I)),f,!1)))}matchSegmentAgainstRoute(t,n,i,a,u){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Bt(i._loadedConfig):this.configLoader.load(t.injector,i)).pipe(Xt(G=>(i._loadedConfig=G,new tn(a,{})))):Bt(new tn(a,{}));const{matched:f,consumedSegments:v,lastChild:w}=om(n,i,a);if(!f)return um(n);const I=a.slice(w);return this.getChildConfig(t,i,a).pipe(Fn(z=>{const G=z.module,K=z.routes,{segmentGroup:ce,slicedSegments:De}=am(n,v,I,K),Ie=new tn(ce.segments,ce.children);if(0===De.length&&Ie.hasChildren())return this.expandChildren(G,K,Ie).pipe(Xt(mt=>new tn(v,mt)));if(0===K.length&&0===De.length)return Bt(new tn(v,{}));const Me=lo(i)===u;return this.expandSegment(G,Ie,K,De,Me?Gt:u,!0).pipe(Xt(Ge=>new tn(v.concat(Ge.segments),Ge.children)))}))}getChildConfig(t,n,i){return n.children?Bt(new r_(n.children,t)):n.loadChildren?void 0!==n._loadedConfig?Bt(n._loadedConfig):this.runCanLoadGuards(t.injector,n,i).pipe(Fn(a=>a?this.configLoader.load(t.injector,n).pipe(Xt(u=>(n._loadedConfig=u,u))):function RP(e){return new Zt(t=>t.error(Zy(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(n))):Bt(new r_([],t))}runCanLoadGuards(t,n,i){const a=n.canLoad;return a&&0!==a.length?Bt(a.map(f=>{const v=t.get(f);let w;if(function xP(e){return e&&Nl(e.canLoad)}(v))w=v.canLoad(n,i);else{if(!Nl(v))throw new Error("Invalid CanLoad guard");w=v(n,i)}return ca(w)})).pipe(nf(),Ns(f=>{if(!Bu(f))return;const v=Zy(`Redirecting to "${this.urlSerializer.serialize(f)}"`);throw v.url=f,v}),Xt(f=>!0===f)):Bt(!0)}lineralizeSegments(t,n){let i=[],a=n.root;for(;;){if(i=i.concat(a.segments),0===a.numberOfChildren)return Bt(i);if(a.numberOfChildren>1||!a.children[Gt])return kP(t.redirectTo);a=a.children[Gt]}}applyRedirectCommands(t,n,i){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,i)}applyRedirectCreatreUrlTree(t,n,i,a){const u=this.createSegmentGroup(t,n.root,i,a);return new zu(u,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return bi(t,(a,u)=>{if("string"==typeof a&&a.startsWith(":")){const v=a.substring(1);i[u]=n[v]}else i[u]=a}),i}createSegmentGroup(t,n,i,a){const u=this.createSegments(t,n.segments,i,a);let f={};return bi(n.children,(v,w)=>{f[w]=this.createSegmentGroup(t,v,i,a)}),new tn(u,f)}createSegments(t,n,i,a){return n.map(u=>u.path.startsWith(":")?this.findPosParam(t,u,a):this.findOrReturn(u,i))}findPosParam(t,n,i){const a=i[n.path.substring(1)];if(!a)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return a}findOrReturn(t,n){let i=0;for(const a of n){if(a.path===t.path)return n.splice(i),a;i++}return t}}function s_(e){const t={};for(const i of Object.keys(e.children)){const u=s_(e.children[i]);(u.segments.length>0||u.hasChildren())&&(t[i]=u)}return function OP(e){if(1===e.numberOfChildren&&e.children[Gt]){const t=e.children[Gt];return new tn(e.segments.concat(t.segments),t.children)}return e}(new tn(e.segments,t))}class x1{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class cm{constructor(t,n){this.component=t,this.route=n}}function NP(e,t,n){const i=e._root;return of(i,t?t._root:null,n,[i.value])}function hm(e,t,n){const i=function VP(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(i?i.module.injector:n).get(e)}function of(e,t,n,i,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=xh(t);return e.children.forEach(f=>{(function UP(e,t,n,i,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,f=t?t.value:null,v=n?n.getContext(e.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const w=function jP(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Nu(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Nu(e.url,t.url)||!ua(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Qy(e,t)||!ua(e.queryParams,t.queryParams);default:return!Qy(e,t)}}(f,u,u.routeConfig.runGuardsAndResolvers);w?a.canActivateChecks.push(new x1(i)):(u.data=f.data,u._resolvedData=f._resolvedData),of(e,t,u.component?v?v.children:null:n,i,a),w&&v&&v.outlet&&v.outlet.isActivated&&a.canDeactivateChecks.push(new cm(v.outlet.component,f))}else f&&af(t,v,a),a.canActivateChecks.push(new x1(i)),of(e,null,u.component?v?v.children:null:n,i,a)})(f,u[f.value.outlet],n,i.concat([f.value]),a),delete u[f.value.outlet]}),bi(u,(f,v)=>af(f,n.getContext(v),a)),a}function af(e,t,n){const i=xh(e),a=e.value;bi(i,(u,f)=>{af(u,a.component?t?t.children.getContext(f):null:t,n)}),n.canDeactivateChecks.push(new cm(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}class YP{}function b1(e){return new Zt(t=>t.error(e))}class QP{constructor(t,n,i,a,u,f){this.rootComponentType=t,this.config=n,this.urlTree=i,this.url=a,this.paramsInheritanceStrategy=u,this.relativeLinkResolution=f}recognize(){const t=am(this.urlTree.root,[],[],this.config.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,Gt);if(null===n)return null;const i=new rm([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Gt,this.rootComponentType,null,this.urlTree.root,-1,{}),a=new Ka(i,n),u=new i1(this.url,a);return this.inheritParamsAndData(u._root),u}inheritParamsAndData(t){const n=t.value,i=r1(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),t.children.forEach(a=>this.inheritParamsAndData(a))}processSegmentGroup(t,n,i){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,i)}processChildren(t,n){const i=[];for(const u of Object.keys(n.children)){const f=n.children[u],v=p1(t,u),w=this.processSegmentGroup(v,f,u);if(null===w)return null;i.push(...w)}const a=w1(i);return function ek(e){e.sort((t,n)=>t.value.outlet===Gt?-1:n.value.outlet===Gt?1:t.value.outlet.localeCompare(n.value.outlet))}(a),a}processSegment(t,n,i,a){for(const u of t){const f=this.processSegmentAgainstRoute(u,n,i,a);if(null!==f)return f}return y1(n,i,a)?[]:null}processSegmentAgainstRoute(t,n,i,a){if(t.redirectTo||!g1(t,n,i,a))return null;let u,f=[],v=[];if("**"===t.path){const K=i.length>0?$w(i).parameters:{};u=new rm(i,K,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,C1(t),lo(t),t.component,t,D1(n),E1(n)+i.length,S1(t))}else{const K=om(n,t,i);if(!K.matched)return null;f=K.consumedSegments,v=i.slice(K.lastChild),u=new rm(f,K.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,C1(t),lo(t),t.component,t,D1(n),E1(n)+f.length,S1(t))}const w=function tk(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(t),{segmentGroup:I,slicedSegments:M}=am(n,f,v,w.filter(K=>void 0===K.redirectTo),this.relativeLinkResolution);if(0===M.length&&I.hasChildren()){const K=this.processChildren(w,I);return null===K?null:[new Ka(u,K)]}if(0===w.length&&0===M.length)return[new Ka(u,[])];const z=lo(t)===a,G=this.processSegment(w,I,M,z?Gt:a);return null===G?null:[new Ka(u,G)]}}function nk(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function w1(e){const t=[],n=new Set;for(const i of e){if(!nk(i)){t.push(i);continue}const a=t.find(u=>i.value.routeConfig===u.value.routeConfig);void 0!==a?(a.children.push(...i.children),n.add(a)):t.push(i)}for(const i of n){const a=w1(i.children);t.push(new Ka(i.value,a))}return t.filter(i=>!n.has(i))}function D1(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function E1(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function C1(e){return e.data||{}}function S1(e){return e.resolve||{}}function o_(e){return Ou(t=>{const n=e(t);return n?at(n).pipe(Xt(()=>t)):Bt(t)})}class ck extends class uk{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const a_=new qt("ROUTES");class I1{constructor(t,n,i,a){this.injector=t,this.compiler=n,this.onLoadStartListener=i,this.onLoadEndListener=a}load(t,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const a=this.loadModuleFactory(n.loadChildren).pipe(Xt(u=>{this.onLoadEndListener&&this.onLoadEndListener(n);const f=u.create(t);return new r_(jw(f.injector.get(a_,void 0,Et.Self|Et.Optional)).map(i_),f)}),zl(u=>{throw n._loader$=void 0,u}));return n._loader$=new w2(a,()=>new Nr).pipe(kw()),n._loader$}loadModuleFactory(t){return ca(t()).pipe(Fn(n=>n instanceof A0?Bt(n):at(this.compiler.compileModuleAsync(n))))}}class dk{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function fk(e){throw e}function pk(e,t,n){return t.parse("/")}function T1(e,t){return Bt(null)}const mk={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},gk={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Bs=(()=>{class e{constructor(n,i,a,u,f,v,w){this.rootComponentType=n,this.urlSerializer=i,this.rootContexts=a,this.location=u,this.config=w,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Nr,this.errorHandler=fk,this.malformedUriErrorHandler=pk,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:T1,afterPreactivation:T1},this.urlHandlingStrategy=new dk,this.routeReuseStrategy=new ck,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=f.get(qa),this.console=f.get(hb);const z=f.get(ti);this.isNgZoneEnabled=z instanceof ti&&ti.isInAngularZone(),this.resetConfig(w),this.currentUrlTree=function j2(){return new zu(new tn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new I1(f,v,G=>this.triggerEvent(new zw(G)),G=>this.triggerEvent(new Nw(G))),this.routerState=n1(this.currentUrlTree,this.rootComponentType),this.transitions=new ko({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(n){const i=this.events;return n.pipe(yh(a=>0!==a.id),Xt(a=>({...a,extractedUrl:this.urlHandlingStrategy.extract(a.rawUrl)})),Ou(a=>{let u=!1,f=!1;return Bt(a).pipe(Ns(v=>{this.currentNavigation={id:v.id,initialUrl:v.currentRawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ou(v=>{const w=this.browserUrlTree.toString(),I=!this.navigated||v.extractedUrl.toString()!==w||w!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||I)&&this.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return dm(v.source)&&(this.browserUrlTree=v.extractedUrl),Bt(v).pipe(Ou(z=>{const G=this.transitions.getValue();return i.next(new Gy(z.id,this.serializeUrl(z.extractedUrl),z.source,z.restoredState)),G!==this.transitions.getValue()?q:Promise.resolve(z)}),function zP(e,t,n,i){return Ou(a=>function LP(e,t,n,i,a){return new FP(e,t,n,i,a).apply()}(e,t,n,a.extractedUrl,i).pipe(Xt(u=>({...a,urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Ns(z=>{this.currentNavigation={...this.currentNavigation,finalUrl:z.urlAfterRedirects}}),function rk(e,t,n,i,a){return Fn(u=>function JP(e,t,n,i,a="emptyOnly",u="legacy"){try{const f=new QP(e,t,n,i,a,u).recognize();return null===f?b1(new YP):Bt(f)}catch(f){return b1(f)}}(e,t,u.urlAfterRedirects,n(u.urlAfterRedirects),i,a).pipe(Xt(f=>({...u,targetSnapshot:f}))))}(this.rootComponentType,this.config,z=>this.serializeUrl(z),this.paramsInheritanceStrategy,this.relativeLinkResolution),Ns(z=>{if("eager"===this.urlUpdateStrategy){if(!z.extras.skipLocationChange){const K=this.urlHandlingStrategy.merge(z.urlAfterRedirects,z.rawUrl);this.setBrowserUrl(K,z)}this.browserUrlTree=z.urlAfterRedirects}const G=new A2(z.id,this.serializeUrl(z.extractedUrl),this.serializeUrl(z.urlAfterRedirects),z.targetSnapshot);i.next(G)}));if(I&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:G,extractedUrl:K,source:ce,restoredState:De,extras:Ie}=v,Me=new Gy(G,this.serializeUrl(K),ce,De);i.next(Me);const xe=n1(K,this.rootComponentType).snapshot;return Bt({...v,targetSnapshot:xe,urlAfterRedirects:K,extras:{...Ie,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=v.rawUrl,v.resolve(null),q}),o_(v=>{const{targetSnapshot:w,id:I,extractedUrl:M,rawUrl:z,extras:{skipLocationChange:G,replaceUrl:K}}=v;return this.hooks.beforePreactivation(w,{navigationId:I,appliedUrlTree:M,rawUrlTree:z,skipLocationChange:!!G,replaceUrl:!!K})}),Ns(v=>{const w=new M2(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(w)}),Xt(v=>({...v,guards:NP(v.targetSnapshot,v.currentSnapshot,this.rootContexts)})),function $P(e,t){return Fn(n=>{const{targetSnapshot:i,currentSnapshot:a,guards:{canActivateChecks:u,canDeactivateChecks:f}}=n;return 0===f.length&&0===u.length?Bt({...n,guardsResult:!0}):function HP(e,t,n,i){return at(e).pipe(Fn(a=>function KP(e,t,n,i,a){const u=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return u&&0!==u.length?Bt(u.map(v=>{const w=hm(v,t,a);let I;if(function DP(e){return e&&Nl(e.canDeactivate)}(w))I=ca(w.canDeactivate(e,t,n,i));else{if(!Nl(w))throw new Error("Invalid CanDeactivate guard");I=ca(w(e,t,n,i))}return I.pipe(_h())})).pipe(nf()):Bt(!0)}(a.component,a.route,n,t,i)),_h(a=>!0!==a,!0))}(f,i,a,e).pipe(Fn(v=>v&&function vP(e){return"boolean"==typeof e}(v)?function qP(e,t,n,i){return at(t).pipe(Xd(a=>Hy(function ZP(e,t){return null!==e&&t&&t(new L2(e)),Bt(!0)}(a.route.parent,i),function GP(e,t){return null!==e&&t&&t(new O2(e)),Bt(!0)}(a.route,i),function XP(e,t,n){const i=t[t.length-1],u=t.slice(0,t.length-1).reverse().map(f=>function BP(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(f)).filter(f=>null!==f).map(f=>Pw(()=>Bt(f.guards.map(w=>{const I=hm(w,f.node,n);let M;if(function wP(e){return e&&Nl(e.canActivateChild)}(I))M=ca(I.canActivateChild(i,e));else{if(!Nl(I))throw new Error("Invalid CanActivateChild guard");M=ca(I(i,e))}return M.pipe(_h())})).pipe(nf())));return Bt(u).pipe(nf())}(e,a.path,n),function WP(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Bt(!0);const a=i.map(u=>Pw(()=>{const f=hm(u,t,n);let v;if(function bP(e){return e&&Nl(e.canActivate)}(f))v=ca(f.canActivate(t,e));else{if(!Nl(f))throw new Error("Invalid CanActivate guard");v=ca(f(t,e))}return v.pipe(_h())}));return Bt(a).pipe(nf())}(e,a.route,n))),_h(a=>!0!==a,!0))}(i,u,e,t):Bt(v)),Xt(v=>({...n,guardsResult:v})))})}(this.ngModule.injector,v=>this.triggerEvent(v)),Ns(v=>{if(Bu(v.guardsResult)){const I=Zy(`Redirecting to "${this.serializeUrl(v.guardsResult)}"`);throw I.url=v.guardsResult,I}const w=new P2(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.triggerEvent(w)}),yh(v=>!!v.guardsResult||(this.restoreHistory(v),this.cancelNavigationTransition(v,""),!1)),o_(v=>{if(v.guards.canActivateChecks.length)return Bt(v).pipe(Ns(w=>{const I=new k2(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}),Ou(w=>{let I=!1;return Bt(w).pipe(function ik(e,t){return Fn(n=>{const{targetSnapshot:i,guards:{canActivateChecks:a}}=n;if(!a.length)return Bt(n);let u=0;return at(a).pipe(Xd(f=>function sk(e,t,n,i){return function ok(e,t,n,i){const a=Object.keys(e);if(0===a.length)return Bt({});const u={};return at(a).pipe(Fn(f=>function ak(e,t,n,i){const a=hm(e,t,i);return ca(a.resolve?a.resolve(t,n):a(t,n))}(e[f],t,n,i).pipe(Ns(v=>{u[f]=v}))),qy(1),Fn(()=>Object.keys(u).length===a.length?Bt(u):q))}(e._resolve,e,t,i).pipe(Xt(u=>(e._resolvedData=u,e.data={...e.data,...r1(e,n).resolve},null)))}(f.route,i,e,t)),Ns(()=>u++),qy(1),Fn(f=>u===a.length?Bt(n):q))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Ns({next:()=>I=!0,complete:()=>{I||(this.restoreHistory(w),this.cancelNavigationTransition(w,"At least one route resolver didn't emit any value."))}}))}),Ns(w=>{const I=new R2(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}))}),o_(v=>{const{targetSnapshot:w,id:I,extractedUrl:M,rawUrl:z,extras:{skipLocationChange:G,replaceUrl:K}}=v;return this.hooks.afterPreactivation(w,{navigationId:I,appliedUrlTree:M,rawUrlTree:z,skipLocationChange:!!G,replaceUrl:!!K})}),Xt(v=>{const w=function oP(e,t,n){const i=Qd(e,t._root,n?n._root:void 0);return new t1(i,t)}(this.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return{...v,targetRouterState:w}}),Ns(v=>{this.currentUrlTree=v.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(v.urlAfterRedirects,v.rawUrl),this.routerState=v.targetRouterState,"deferred"===this.urlUpdateStrategy&&(v.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,v),this.browserUrlTree=v.urlAfterRedirects)}),((e,t,n)=>Xt(i=>(new yP(t,i.targetRouterState,i.currentRouterState,n).activate(e),i)))(this.rootContexts,this.routeReuseStrategy,v=>this.triggerEvent(v)),Ns({next(){u=!0},complete(){u=!0}}),function I2(e){return an((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{u||f||this.cancelNavigationTransition(a,`Navigation ID ${a.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===a.id&&(this.currentNavigation=null)}),zl(v=>{if(f=!0,function B2(e){return e&&e[Vw]}(v)){const w=Bu(v.url);w||(this.navigated=!0,this.restoreHistory(a,!0));const I=new Ow(a.id,this.serializeUrl(a.extractedUrl),v.message);i.next(I),w?setTimeout(()=>{const M=this.urlHandlingStrategy.merge(v.url,this.rawUrlTree),z={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||dm(a.source)};this.scheduleNavigation(M,"imperative",null,z,{resolve:a.resolve,reject:a.reject,promise:a.promise})},0):a.resolve(!1)}else{this.restoreHistory(a,!0);const w=new T2(a.id,this.serializeUrl(a.extractedUrl),v);i.next(w);try{a.resolve(this.errorHandler(v))}catch(I){a.reject(I)}}return q}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next({...this.transitions.value,...n})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{const a={replaceUrl:!0},u=n.state?.navigationId?n.state:null;if(u){const v={...u};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(a.state=v)}const f=this.parseUrl(n.url);this.scheduleNavigation(f,i,u,a)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){f1(n),this.config=n.map(i_),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:a,queryParams:u,fragment:f,queryParamsHandling:v,preserveFragment:w}=i,I=a||this.routerState.root,M=w?this.currentUrlTree.fragment:f;let z=null;switch(v){case"merge":z={...this.currentUrlTree.queryParams,...u};break;case"preserve":z=this.currentUrlTree.queryParams;break;default:z=u||null}return null!==z&&(z=this.removeEmptyProps(z)),function uP(e,t,n,i,a){if(0===n.length)return e_(t.root,t.root,t,i,a);const u=function cP(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new a1(!0,0,e);let t=0,n=!1;const i=e.reduce((a,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const v={};return bi(u.outlets,(w,I)=>{v[I]="string"==typeof w?w.split("/"):w}),[...a,{outlets:v}]}if(u.segmentPath)return[...a,u.segmentPath]}return"string"!=typeof u?[...a,u]:0===f?(u.split("/").forEach((v,w)=>{0==w&&"."===v||(0==w&&""===v?n=!0:".."===v?t++:""!=v&&a.push(v))}),a):[...a,u]},[]);return new a1(n,t,i)}(n);if(u.toRoot())return e_(t.root,new tn([],{}),t,i,a);const f=function hP(e,t,n){if(e.isAbsolute)return new t_(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const u=n.snapshot._urlSegment;return new t_(u,u===t.root,0)}const i=im(e.commands[0])?0:1;return function dP(e,t,n){let i=e,a=t,u=n;for(;u>a;){if(u-=a,i=i.parent,!i)throw new Error("Invalid number of '../'");a=i.segments.length}return new t_(i,!1,a-u)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+i,e.numberOfDoubleDots)}(u,t,e),v=f.processChildren?sm(f.segmentGroup,f.index,u.commands):l1(f.segmentGroup,f.index,u.commands);return e_(f.segmentGroup,v,t,i,a)}(I,this.currentUrlTree,n,z,M??null)}navigateByUrl(n,i={skipLocationChange:!1}){const a=Bu(n)?n:this.parseUrl(n),u=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,i)}navigate(n,i={skipLocationChange:!1}){return function yk(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(a){i=this.malformedUriErrorHandler(a,this.urlSerializer,n)}return i}isActive(n,i){let a;if(a=!0===i?{...mk}:!1===i?{...gk}:i,Bu(n))return qw(this.currentUrlTree,n,a);const u=this.parseUrl(n);return qw(this.currentUrlTree,u,a)}removeEmptyProps(n){return Object.keys(n).reduce((i,a)=>{const u=n[a];return null!=u&&(i[a]=u),i},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new Kd(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,i,a,u,f){if(this.disposed)return Promise.resolve(!1);const v=this.transitions.value,w=dm(i)&&v&&!dm(v.source),I=v.rawUrl.toString()===n.toString();if(w&&I&&v.id===this.currentNavigation?.id)return Promise.resolve(!0);let G,K,ce;f?(G=f.resolve,K=f.reject,ce=f.promise):ce=new Promise((Me,xe)=>{G=Me,K=xe});const De=++this.navigationId;let Ie;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(a=this.location.getState()),Ie=a&&a.\u0275routerPageId?a.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):Ie=0,this.setTransition({id:De,targetPageId:Ie,source:i,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:u,resolve:G,reject:K,promise:ce,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ce.catch(Me=>Promise.reject(Me))}setBrowserUrl(n,i){const a=this.urlSerializer.serialize(n),u={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.isCurrentPathEqualTo(a)||i.extras.replaceUrl?this.location.replaceState(a,"",u):this.location.go(a,"",u)}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const a=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===a?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===a&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(a)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,i){const a=new Ow(n.id,this.serializeUrl(n.extractedUrl),i);this.triggerEvent(a),n.resolve(!1)}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return e.\u0275fac=function(n){Eg()},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();function dm(e){return"imperative"!==e}class A1{}class M1{preload(t,n){return Bt(null)}}let P1=(()=>{class e{constructor(n,i,a,u){this.router=n,this.injector=a,this.preloadingStrategy=u,this.loader=new I1(a,i,w=>n.triggerEvent(new zw(w)),w=>n.triggerEvent(new Nw(w)))}setUpPreloading(){this.subscription=this.router.events.pipe(yh(n=>n instanceof Kd),Xd(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(qa);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const a=[];for(const u of i)if(u.loadChildren&&!u.canLoad&&u._loadedConfig){const f=u._loadedConfig;a.push(this.processRoutes(f.module,f.routes))}else u.loadChildren&&!u.canLoad?a.push(this.preloadConfig(n,u)):u.children&&a.push(this.processRoutes(n,u.children));return at(a).pipe(Di(),Xt(u=>{}))}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Bt(i._loadedConfig):this.loader.load(n.injector,i)).pipe(Fn(u=>(i._loadedConfig=u,this.processRoutes(u.module,u.routes)))))}}return e.\u0275fac=function(n){return new(n||e)(vt(Bs),vt(Pp),vt(rs),vt(A1))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})(),c_=(()=>{class e{constructor(n,i,a={}){this.router=n,this.viewportScroller=i,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Gy?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Kd&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Bw&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.router.triggerEvent(new Bw(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){Eg()},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();const Vu=new qt("ROUTER_CONFIGURATION"),k1=new qt("ROUTER_FORROOT_GUARD"),bk=[my,{provide:Xw,useClass:Kw},{provide:Bs,useFactory:function Ik(e,t,n,i,a,u,f={},v,w){const I=new Bs(null,e,t,n,i,a,jw(u));return v&&(I.urlHandlingStrategy=v),w&&(I.routeReuseStrategy=w),function Tk(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(f,I),f.enableTracing&&I.events.subscribe(M=>{console.group?.(`Router Event: ${M.constructor.name}`),console.log(M.toString()),console.log(M),console.groupEnd?.()}),I},deps:[Xw,rf,my,rs,Pp,a_,Vu,[class hk{},new Qs],[class lk{},new Qs]]},rf,{provide:bh,useFactory:function Ak(e){return e.routerState.root},deps:[Bs]},P1,M1,class xk{preload(t,n){return n().pipe(zl(()=>Bt(null)))}},{provide:Vu,useValue:{enableTracing:!1}}];function wk(){return new yb("Router",Bs)}let Dk=(()=>{class e{constructor(n,i){}static forRoot(n,i){return{ngModule:e,providers:[bk,R1(n),{provide:k1,useFactory:Sk,deps:[[Bs,new Qs,new Oa]]},{provide:Vu,useValue:i||{}},{provide:mh,useFactory:Ck,deps:[ku,[new gu(py),new Qs],Vu]},{provide:c_,useFactory:Ek,deps:[Bs,UA,Vu]},{provide:A1,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:M1},{provide:yb,multi:!0,useFactory:wk},[h_,{provide:Mp,multi:!0,useFactory:Mk,deps:[h_]},{provide:L1,useFactory:Pk,deps:[h_]},{provide:cb,multi:!0,useExisting:L1}]]}}static forChild(n){return{ngModule:e,providers:[R1(n)]}}}return e.\u0275fac=function(n){return new(n||e)(vt(k1,8),vt(Bs,8))},e.\u0275mod=Zs({type:e}),e.\u0275inj=Ei({}),e})();function Ek(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new c_(e,t,n)}function Ck(e,t,n={}){return n.useHash?new vT(e,t):new Bb(e,t)}function Sk(e){return"guarded"}function R1(e){return[{provide:vf,multi:!0,useValue:e},{provide:a_,multi:!0,useValue:e}]}let h_=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Nr}appInitializer(){return this.injector.get(gT,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const a=new Promise(v=>i=v),u=this.injector.get(Bs),f=this.injector.get(Vu);return"disabled"===f.initialNavigation?(u.setUpLocationChangeListener(),i(!0)):"enabled"===f.initialNavigation||"enabledBlocking"===f.initialNavigation?(u.hooks.afterPreactivation=()=>this.initNavigation?Bt(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),u.initialNavigation()):i(!0),a})}bootstrapListener(n){const i=this.injector.get(Vu),a=this.injector.get(P1),u=this.injector.get(c_),f=this.injector.get(Bs),v=this.injector.get(jd);n===v.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&f.initialNavigation(),a.setUpPreloading(),u.init(),f.resetRootComponentType(v.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(vt(rs))},e.\u0275prov=Ke({token:e,factory:e.\u0275fac}),e})();function Mk(e){return e.appInitializer.bind(e)}function Pk(e){return e.bootstrapListener.bind(e)}const L1=new qt("Router Initializer");class fm{static \u0275fac=function(n){return new(n||fm)};static \u0275mod=Zs({type:fm,bootstrap:[Kp]});static \u0275inj=Ei({providers:[],imports:[[mM,Dk.forRoot([],{initialNavigation:"enabledBlocking"})]]})}$y_production&&function UI(){Db=!1}(),fM().bootstrapModule(fm).catch(e=>console.error(e))},572:(Ro,ws,Lr)=>{var sn;!function(){"use strict";function Us(Ze,ue){var jt=Ze.x-ue.x,Pt=Ze.y-ue.y;return jt*jt+Pt*Pt}function Lo(Ze,ue,jt){var Pt=ue.x,pn=ue.y,_n=jt.x-Pt,on=jt.y-pn;if(0!==_n||0!==on){var ar=((Ze.x-Pt)*_n+(Ze.y-pn)*on)/(_n*_n+on*on);ar>1?(Pt=jt.x,pn=jt.y):ar>0&&(Pt+=_n*ar,pn+=on*ar)}return(_n=Ze.x-Pt)*_n+(on=Ze.y-pn)*on}function hn(Ze,ue,jt,Pt,pn){for(var on,_n=Pt,ar=ue+1;ar<jt;ar++){var rr=Lo(Ze[ar],Ze[ue],Ze[jt]);rr>_n&&(on=ar,_n=rr)}_n>Pt&&(on-ue>1&&hn(Ze,ue,on,Pt,pn),pn.push(Ze[on]),jt-on>1&&hn(Ze,on,jt,Pt,pn))}function ci(Ze,ue){var jt=Ze.length-1,Pt=[Ze[0]];return hn(Ze,0,jt,ue,Pt),Pt.push(Ze[jt]),Pt}function hi(Ze,ue,jt){if(Ze.length<=2)return Ze;var Pt=void 0!==ue?ue*ue:1;return Ze=jt?Ze:function y(Ze,ue){for(var pn,jt=Ze[0],Pt=[jt],_n=1,on=Ze.length;_n<on;_n++)Us(pn=Ze[_n],jt)>ue&&(Pt.push(pn),jt=pn);return jt!==pn&&Pt.push(pn),Pt}(Ze,Pt),ci(Ze,Pt)}void 0!==(sn=function(){return hi}.call(ws,Lr,ws,Ro))&&(Ro.exports=sn)}()},943:function(Ro){Ro.exports=function(){"use strict";var ws,Lr,sn;function Us(y,hn){if(ws)if(Lr){var ci="var sharedChunk = {}; ("+ws+")(sharedChunk); ("+Lr+")(sharedChunk);",hi={};ws(hi),sn=hn(hi),"undefined"!=typeof window&&(sn.workerUrl=window.URL.createObjectURL(new Blob([ci],{type:"text/javascript"})))}else Lr=hn;else ws=hn}return Us(0,function(y){var hn=ci;function ci(o,r,l,h){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=r,this.p2x=l,this.p2y=h}function hi(o,r,l,h){const m=new hn(o,r,l,h);return function(_){return m.solve(_)}}ci.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,r){if(void 0===r&&(r=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,h=0;h<8;h++){var m=this.sampleCurveX(l)-o;if(Math.abs(m)<r)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=m/_}var x=0,D=1;for(l=o,h=0;h<20&&(m=this.sampleCurveX(l),!(Math.abs(m-o)<r));h++)o>m?x=l:D=l,l=.5*(D-x)+x;return l},solve:function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))}};const Ze=hi(.25,.1,.25,1);function ue(o,r,l){return Math.min(l,Math.max(r,o))}function jt(o,r,l){const h=l-r,m=((o-r)%h+h)%h+r;return m===r?l:m}function Pt(o,...r){for(const l of r)for(const h in l)o[h]=l[h];return o}let pn=1;function _n(o,r){o.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function on(o,r,l){const h={};for(const m in o)h[m]=r.call(l||this,o[m],m,o);return h}function ar(o,r,l){const h={};for(const m in o)r.call(l||this,o[m],m,o)&&(h[m]=o[m]);return h}function rr(o){return Array.isArray(o)?o.map(rr):"object"==typeof o&&o?on(o,rr):o}const vn={};function kn(o){vn[o]||("undefined"!=typeof console&&console.warn(o),vn[o]=!0)}function nn(o,r,l){return(l.y-o.y)*(r.x-o.x)>(r.y-o.y)*(l.x-o.x)}function ot(o){let r=0;for(let l,h,m=0,_=o.length,x=_-1;m<_;x=m++)l=o[m],h=o[x],r+=(h.x-l.x)*(l.y+h.y);return r}function kt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function qn(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,m,_)=>{const x=m||_;return r[h]=!x||x.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let Gn,vr,Fr=null;function Or(o){if(null==Fr){const r=o.navigator?o.navigator.userAgent:null;Fr=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Fr}function lr(o){return"undefined"!=typeof ImageBitmap&&o instanceof ImageBitmap}const zr={now:performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(o){const r=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(o,r=0){const l=window.document.createElement("canvas"),h=l.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return l.width=o.width,l.height=o.height,h.drawImage(o,0,0,o.width,o.height),h.getImageData(-r,-r,o.width+2*r,o.height+2*r)},resolveURL:o=>(Gn||(Gn=document.createElement("a")),Gn.href=o,Gn.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==vr&&(vr=matchMedia("(prefers-reduced-motion: reduce)")),vr.matches)}};class Kn{constructor(r,l,h){const m=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(l=x[1])+2*(h=x[2]);for(let C=0;C<this.d*this.d;C++){const A=x[3+C],R=x[3+C+1];m.push(A===R?null:x.subarray(A,R))}const D=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],D),this.bboxes=x.subarray(D),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=h,this.scale=l/r,this.uid=0;const _=h/l*r;this.min=-_,this.max=r+_}insert(r,l,h,m,_){this._forEachCell(l,h,m,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,l,h,m,_,x){this.cells[_].push(x)}query(r,l,h,m,_){const x=this.min,D=this.max;if(r<=x&&l<=x&&D<=h&&D<=m&&!_)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(r,l,h,m,this._queryCell,C,{},_),C}}_queryCell(r,l,h,m,_,x,D,C){const A=this.cells[_];if(null!==A){const R=this.keys,L=this.bboxes;for(let N=0;N<A.length;N++){const U=A[N];if(void 0===D[U]){const $=4*U;(C?C(L[$+0],L[$+1],L[$+2],L[$+3]):r<=L[$+2]&&l<=L[$+3]&&h>=L[$+0]&&m>=L[$+1])?(D[U]=!0,x.push(R[U])):D[U]=!1}}}}_forEachCell(r,l,h,m,_,x,D,C){const A=this._convertToCellCoord(r),R=this._convertToCellCoord(l),L=this._convertToCellCoord(h),N=this._convertToCellCoord(m);for(let U=A;U<=L;U++)for(let $=R;$<=N;$++){const Y=this.d*$+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord($),this._convertFromCellCoord(U+1),this._convertFromCellCoord($+1)))&&_.call(this,r,l,h,m,Y,x,D,C))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,l=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const m=new Int32Array(l+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let _=l;for(let x=0;x<r.length;x++){const D=r[x];m[3+x]=_,m.set(D,_),_+=D.length}return m[3+r.length]=_,m.set(this.keys,_),_+=this.keys.length,m[3+r.length+1]=_,m.set(this.bboxes,_),_+=this.bboxes.length,m.buffer}static serialize(r,l){const h=r.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(r){return new Kn(r.buffer)}}var Zt,Vi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ri(o){return(o=Math.round(o))<0?0:o>255?255:o}function wi(o){return ri("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function ls(o){return(r="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:r>1?1:r;var r}function Nr(o,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?o+(r-o)*l*6:2*l<1?r:3*l<2?o+(r-o)*(2/3-l)*6:o}try{Zt={}.parseCSSColor=function(o){var r,l=o.replace(/ /g,"").toLowerCase();if(l in Vi)return Vi[l].slice();if("#"===l[0])return 4===l.length?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:7===l.length&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),m=l.indexOf(")");if(-1!==h&&m+1===l.length){var _=l.substr(0,h),x=l.substr(h+1,m-(h+1)).split(","),D=1;switch(_){case"rgba":if(4!==x.length)return null;D=ls(x.pop());case"rgb":return 3!==x.length?null:[wi(x[0]),wi(x[1]),wi(x[2]),D];case"hsla":if(4!==x.length)return null;D=ls(x.pop());case"hsl":if(3!==x.length)return null;var C=(parseFloat(x[0])%360+360)%360/360,A=ls(x[1]),R=ls(x[2]),L=R<=.5?R*(A+1):R+A-R*A,N=2*R-L;return[ri(255*Nr(N,L,C+1/3)),ri(255*Nr(N,L,C)),ri(255*Nr(N,L,C-1/3)),D];default:return null}}return null}}catch{}class Wt{constructor(r,l,h,m=1){this.r=r,this.g=l,this.b=h,this.a=m}static parse(r){if(!r)return;if(r instanceof Wt)return r;if("string"!=typeof r)return;const l=Zt(r);return l?new Wt(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,m]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${m})`}toArray(){const{r,g:l,b:h,a:m}=this;return 0===m?[0,0,0,0]:[255*r/m,255*l/m,255*h/m,m]}}function Ui(o,...r){for(const l of r)for(const h in l)o[h]=l[h];return o}Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1);class an extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class Cn{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,m]of l)this.bindings[h]=m}concat(r){return new Cn(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Xt={kind:"null"},Le={kind:"number"},ht={kind:"string"},gt={kind:"boolean"},di={kind:"color"},Ds={kind:"object"},ut={kind:"value"},uo={kind:"collator"},ji={kind:"formatted"},co={kind:"resolvedImage"};function Br(o,r){return{kind:"array",itemType:o,N:r}}function mn(o){if("array"===o.kind){const r=mn(o.itemType);return"number"==typeof o.N?`array<${r}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${r}>`}return o.kind}const $t=[Xt,Le,ht,gt,di,ji,Ds,Br(ut),co];function $i(o,r){if("error"===r.kind)return null;if("array"===o.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!$i(o.itemType,r.itemType))&&("number"!=typeof o.N||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if("value"===o.kind)for(const l of $t)if(!$i(l,r))return null}return`Expected ${mn(o)} but found ${mn(r)} instead.`}function js(o,r){return r.some(l=>l.kind===o.kind)}function Fo(o,r){return r.some(l=>"null"===l?null===o:"array"===l?Array.isArray(o):"object"===l?o&&!Array.isArray(o)&&"object"==typeof o:l===typeof o)}class $s{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vr{constructor(r,l,h,m,_){this.text=r,this.image=l,this.scale=h,this.fontStack=m,this.textColor=_}}class ur{constructor(r){this.sections=r}static fromString(r){return new ur([new Vr(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof ur?r:ur.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class Sr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Sr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Ya(o,r,l,h){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[o,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[o,r,l,h]:[o,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function us(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Wt||o instanceof $s||o instanceof ur||o instanceof Sr)return!0;if(Array.isArray(o)){for(const r of o)if(!us(r))return!1;return!0}if("object"==typeof o){for(const r in o)if(!us(o[r]))return!1;return!0}return!1}function xn(o){if(null===o)return Xt;if("string"==typeof o)return ht;if("boolean"==typeof o)return gt;if("number"==typeof o)return Le;if(o instanceof Wt)return di;if(o instanceof $s)return uo;if(o instanceof ur)return ji;if(o instanceof Sr)return co;if(Array.isArray(o)){const r=o.length;let l;for(const h of o){const m=xn(h);if(l){if(l===m)continue;l=ut;break}l=m}return Br(l||ut,r)}return Ds}function Es(o){const r=typeof o;return null===o?"":"string"===r||"number"===r||"boolean"===r?String(o):o instanceof Wt||o instanceof ur||o instanceof Sr?o.toString():JSON.stringify(o)}class Yn{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(2!==r.length)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!us(r[1]))return l.error("invalid value");const h=r[1];let m=xn(h);const _=l.expectedType;return"array"!==m.kind||0!==m.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(m=_),new Yn(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wt?["rgba"].concat(this.value.toArray()):this.value instanceof ur?this.value.serialize():this.value}}class Rn{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Oo={string:ht,number:Le,boolean:gt,object:Ds};class Ur{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,m=1;const _=r[0];if("array"===_){let D,C;if(r.length>2){const A=r[1];if("string"!=typeof A||!(A in Oo)||"object"===A)return l.error('The item type argument of "array" must be one of string, number, boolean',1);D=Oo[A],m++}else D=ut;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=r[2],m++}h=Br(D,C)}else h=Oo[_];const x=[];for(;m<r.length;m++){const D=l.parse(r[m],m,ut);if(!D)return null;x.push(D)}return new Ur(h,x)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!$i(this.type,xn(h)))return h;if(l===this.args.length-1)throw new Rn(`Expected value to be of type ${mn(this.type)}, but found ${mn(xn(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if("array"===r.kind){const h=r.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){l.push(h.kind);const m=r.N;("number"==typeof m||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(h=>h.serialize()))}}class cs{constructor(r){this.type=ji,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const m=[];let _=!1;for(let x=1;x<=r.length-1;++x){const D=r[x];if(_&&"object"==typeof D&&!Array.isArray(D)){_=!1;let C=null;if(D["font-scale"]&&(C=l.parse(D["font-scale"],1,Le),!C))return null;let A=null;if(D["text-font"]&&(A=l.parse(D["text-font"],1,Br(ht)),!A))return null;let R=null;if(D["text-color"]&&(R=l.parse(D["text-color"],1,di),!R))return null;const L=m[m.length-1];L.scale=C,L.font=A,L.textColor=R}else{const C=l.parse(r[x],1,ut);if(!C)return null;const A=C.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:C,scale:null,font:null,textColor:null})}}return new cs(m)}evaluate(r){return new ur(this.sections.map(l=>{const h=l.content.evaluate(r);return xn(h)===co?new Vr("",h,null,null,null):new Vr(Es(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class Ir{constructor(r){this.type=co,this.input=r}static parse(r,l){if(2!==r.length)return l.error("Expected two arguments.");const h=l.parse(r[1],1,ht);return h?new Ir(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=Sr.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ha={"to-boolean":gt,"to-color":di,"to-number":Le,"to-string":ht};class fi{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if(("to-boolean"===h||"to-string"===h)&&2!==r.length)return l.error("Expected one argument.");const m=ha[h],_=[];for(let x=1;x<r.length;x++){const D=l.parse(r[x],x,ut);if(!D)return null;_.push(D)}return new fi(m,_)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let l,h;for(const m of this.args){if(l=m.evaluate(r),h=null,l instanceof Wt)return l;if("string"==typeof l){const _=r.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ya(l[0],l[1],l[2],l[3]),!h))return new Wt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Rn(h||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(r),null===l)return 0;const m=Number(l);if(!isNaN(m))return m}throw new Rn(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?ur.fromString(Es(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Sr.fromString(Es(this.args[0].evaluate(r))):Es(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new cs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ir(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}const ho=["Unknown","Point","LineString","Polygon"];class fo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ho[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=Wt.parse(r)),l}}class Ln{constructor(r,l,h,m){this.name=r,this.type=l,this._evaluate=h,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const h=r[0],m=Ln.definitions[h];if(!m)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,D=x.filter(([A])=>!Array.isArray(A)||A.length===r.length-1);let C=null;for(const[A,R]of D){C=new ne(l.registry,l.path,null,l.scope);const L=[];let N=!1;for(let U=1;U<r.length;U++){const $=r[U],Y=Array.isArray(A)?A[U-1]:A.type,Q=C.parse($,1+L.length,Y);if(!Q){N=!0;break}L.push(Q)}if(!N)if(Array.isArray(A)&&A.length!==L.length)C.error(`Expected ${A.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const $=Array.isArray(A)?A[U]:A.type,Y=L[U];C.concat(U+1).checkSubtype($,Y.type)}if(0===C.errors.length)return new Ln(h,_,R,L)}}if(1===D.length)l.errors.push(...C.errors);else{const A=(D.length?D:x).map(([L])=>{return N=L,Array.isArray(N)?`(${N.map(mn).join(", ")})`:`(${mn(N.type)}...)`;var N}).join(" | "),R=[];for(let L=1;L<r.length;L++){const N=l.parse(r[L],1+R.length);if(!N)return null;R.push(mn(N.type))}l.error(`Expected arguments of type ${A}, but found (${R.join(", ")}) instead.`)}return null}static register(r,l){Ln.definitions=l;for(const h in l)r[h]=Ln}}class Hs{constructor(r,l,h){this.type=uo,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(2!==r.length)return l.error("Expected one argument.");const h=r[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const m=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,gt);if(!m)return null;const _=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,gt);if(!_)return null;let x=null;return h.locale&&(x=l.parse(h.locale,1,ht),!x)?null:new Hs(m,_,x)}evaluate(r){return new $s(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Jn=8192;function ii(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Qn(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function da(o,r){const l=(180+o[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(l*m*Jn),Math.round(h*m*Jn)]}function qs(o,r,l){const h=o[0]-r[0],m=o[1]-r[1],_=o[0]-l[0],x=o[1]-l[1];return h*x-_*m==0&&h*_<=0&&m*x<=0}function zo(o,r){let l=!1;for(let x=0,D=r.length;x<D;x++){const C=r[x];for(let A=0,R=C.length;A<R-1;A++){if(qs(o,C[A],C[A+1]))return!1;(m=C[A])[1]>(h=o)[1]!=(_=C[A+1])[1]>h[1]&&h[0]<(_[0]-m[0])*(h[1]-m[1])/(_[1]-m[1])+m[0]&&(l=!l)}}var h,m,_;return l}function Ja(o,r){for(let l=0;l<r.length;l++)if(zo(o,r[l]))return!0;return!1}function No(o,r,l,h){const m=h[0]-l[0],_=h[1]-l[1],x=(o[0]-l[0])*_-m*(o[1]-l[1]),D=(r[0]-l[0])*_-m*(r[1]-l[1]);return x>0&&D<0||x<0&&D>0}function Bo(o,r,l){for(const A of l)for(let R=0;R<A.length-1;++R)if((D=[(x=A[R+1])[0]-(_=A[R])[0],x[1]-_[1]])[0]*(C=[(m=r)[0]-(h=o)[0],m[1]-h[1]])[1]-D[1]*C[0]!=0&&No(h,m,_,x)&&No(_,x,h,m))return!0;var h,m,_,x,D,C;return!1}function jr(o,r){for(let l=0;l<o.length;++l)if(!zo(o[l],r))return!1;for(let l=0;l<o.length-1;++l)if(Bo(o[l],o[l+1],r))return!1;return!0}function fa(o,r){for(let l=0;l<r.length;l++)if(jr(o,r[l]))return!0;return!1}function Fn(o,r,l){const h=[];for(let m=0;m<o.length;m++){const _=[];for(let x=0;x<o[m].length;x++){const D=da(o[m][x],l);ii(r,D),_.push(D)}h.push(_)}return h}function Di(o,r,l){const h=[];for(let m=0;m<o.length;m++){const _=Fn(o[m],r,l);h.push(_)}return h}function q(o,r,l,h){if(o[0]<l[0]||o[0]>l[2]){const m=.5*h;let _=o[0]-l[0]>m?-h:l[0]-o[0]>m?h:0;0===_&&(_=o[0]-l[2]>m?-h:l[2]-o[0]>m?h:0),o[0]+=_}ii(r,o)}function P(o,r,l,h){const m=Math.pow(2,h.z)*Jn,_=[h.x*Jn,h.y*Jn],x=[];for(const D of o)for(const C of D){const A=[C.x+_[0],C.y+_[1]];q(A,r,l,m),x.push(A)}return x}function O(o,r,l,h){const m=Math.pow(2,h.z)*Jn,_=[h.x*Jn,h.y*Jn],x=[];for(const C of o){const A=[];for(const R of C){const L=[R.x+_[0],R.y+_[1]];ii(r,L),A.push(L)}x.push(A)}if(r[2]-r[0]<=m/2){(D=r)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const C of x)for(const A of C)q(A,r,l,m)}var D;return x}class j{constructor(r,l){this.type=gt,this.geojson=r,this.geometries=l}static parse(r,l){if(2!==r.length)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(us(r[1])){const h=r[1];if("FeatureCollection"===h.type)for(let m=0;m<h.features.length;++m){const _=h.features[m].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new j(h,h.features[m].geometry)}else if("Feature"===h.type){const m=h.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new j(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new j(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(l,h){const m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===h.type){const D=Fn(h.coordinates,_,x),C=P(l.geometry(),m,_,x);if(!Qn(m,_))return!1;for(const A of C)if(!zo(A,D))return!1}if("MultiPolygon"===h.type){const D=Di(h.coordinates,_,x),C=P(l.geometry(),m,_,x);if(!Qn(m,_))return!1;for(const A of C)if(!Ja(A,D))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(l,h){const m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===h.type){const D=Fn(h.coordinates,_,x),C=O(l.geometry(),m,_,x);if(!Qn(m,_))return!1;for(const A of C)if(!jr(A,D))return!1}if("MultiPolygon"===h.type){const D=Di(h.coordinates,_,x),C=O(l.geometry(),m,_,x);if(!Qn(m,_))return!1;for(const A of C)if(!fa(A,D))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function W(o){if(o instanceof Ln&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof j)return!1;let r=!0;return o.eachChild(l=>{r&&!W(l)&&(r=!1)}),r}function J(o){if(o instanceof Ln&&"feature-state"===o.name)return!1;let r=!0;return o.eachChild(l=>{r&&!J(l)&&(r=!1)}),r}function re(o,r){if(o instanceof Ln&&r.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(h=>{l&&!re(h,r)&&(l=!1)}),l}class te{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(2!==r.length||"string"!=typeof r[1])return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new te(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ne{constructor(r,l=[],h,m=new Cn,_=[]){this.registry=r,this.path=l,this.key=l.map(x=>`[${x}]`).join(""),this.scope=m,this.errors=_,this.expectedType=h}parse(r,l,h,m,_={}){return l?this.concat(l,h,m)._parse(r,_):this._parse(r,_)}_parse(r,l){function h(m,_,x){return"assert"===x?new Ur(_,[m]):"coerce"===x?new fi(_,[m]):m}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[m];if(_){let x=_.parse(r,this);if(!x)return null;if(this.expectedType){const D=this.expectedType,C=x.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==C.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(D,C))return null}else x=h(x,D,l.typeAnnotation||"coerce");else x=h(x,D,l.typeAnnotation||"assert")}if(!(x instanceof Yn)&&"resolvedImage"!==x.type.kind&&ae(x)){const D=new fo;try{x=new Yn(x.type,x.evaluate(D))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const m="number"==typeof r?this.path.concat(r):this.path,_=h?this.scope.concat(h):this.scope;return new ne(this.registry,m,l||null,_,this.errors)}error(r,...l){const h=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new an(h,r))}checkSubtype(r,l){const h=$i(r,l);return h&&this.error(h),h}}function ae(o){if(o instanceof te)return ae(o.boundExpression);if(o instanceof Ln&&"error"===o.name||o instanceof Hs||o instanceof j)return!1;const r=o instanceof fi||o instanceof Ur;let l=!0;return o.eachChild(h=>{l=r?l&&ae(h):l&&h instanceof Yn}),!!l&&W(o)&&re(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ge(o,r){const l=o.length-1;let h,m,_=0,x=l,D=0;for(;_<=x;)if(D=Math.floor((_+x)/2),h=o[D],m=o[D+1],h<=r){if(D===l||r<m)return D;_=D+1}else{if(!(h>r))throw new Rn("Input is not a number.");x=D-1}return 0}class Ee{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[m,_]of h)this.labels.push(m),this.outputs.push(_)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,Le);if(!h)return null;const m=[];let _=null;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);for(let x=1;x<r.length;x+=2){const D=1===x?-1/0:r[x],C=r[x+1],A=x,R=x+1;if("number"!=typeof D)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=D)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const L=l.parse(C,R,_);if(!L)return null;_=_||L.type,m.push([D,L])}return new Ee(_,h,m)}evaluate(r){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=l[0])return h[0].evaluate(r);const _=l.length;return m>=l[_-1]?h[_-1].evaluate(r):h[ge(l,m)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}function me(o,r,l){return o*(1-l)+r*l}var We=Object.freeze({__proto__:null,number:me,color:function(o,r,l){return new Wt(me(o.r,r.r,l),me(o.g,r.g,l),me(o.b,r.b,l),me(o.a,r.a,l))},array:function(o,r,l){return o.map((h,m)=>me(h,r[m],l))}});const nt=4/29,at=6/29,Kt=3*at*at,bt=Math.PI/180,lt=180/Math.PI;function Ft(o){return o>.008856451679035631?Math.pow(o,1/3):o/Kt+nt}function dt(o){return o>at?o*o*o:Kt*(o-nt)}function wt(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function yt(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Cs(o){const r=yt(o.r),l=yt(o.g),h=yt(o.b),m=Ft((.4124564*r+.3575761*l+.1804375*h)/.95047),_=Ft((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*_-16,a:500*(m-_),b:200*(_-Ft((.0193339*r+.119192*l+.9503041*h)/1.08883)),alpha:o.a}}function ju(o){let r=(o.l+16)/116,l=isNaN(o.a)?r:r+o.a/500,h=isNaN(o.b)?r:r-o.b/200;return r=1*dt(r),l=.95047*dt(l),h=1.08883*dt(h),new Wt(wt(3.2404542*l-1.5371385*r-.4985314*h),wt(-.969266*l+1.8760108*r+.041556*h),wt(.0556434*l-.2040259*r+1.0572252*h),o.alpha)}function Qa(o,r,l){const h=r-o;return o+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const _t={forward:Cs,reverse:ju,interpolate:function(o,r,l){return{l:me(o.l,r.l,l),a:me(o.a,r.a,l),b:me(o.b,r.b,l),alpha:me(o.alpha,r.alpha,l)}}},Vo={forward:function(o){const{l:r,a:l,b:h}=Cs(o),m=Math.atan2(h,l)*lt;return{h:m<0?m+360:m,c:Math.sqrt(l*l+h*h),l:r,alpha:o.a}},reverse:function(o){const r=o.h*bt,l=o.c;return ju({l:o.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:o.alpha})},interpolate:function(o,r,l){return{h:Qa(o.h,r.h,l),c:me(o.c,r.c,l),l:me(o.l,r.l,l),alpha:me(o.alpha,r.alpha,l)}}};var $u=Object.freeze({__proto__:null,lab:_t,hcl:Vo});class Dt{constructor(r,l,h,m,_){this.type=r,this.operator=l,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[x,D]of _)this.labels.push(x),this.outputs.push(D)}static interpolationFactor(r,l,h,m){let _=0;if("exponential"===r.name)_=pa(l,r.base,h,m);else if("linear"===r.name)_=pa(l,1,h,m);else if("cubic-bezier"===r.name){const x=r.controlPoints;_=new hn(x[0],x[1],x[2],x[3]).solve(pa(l,1,h,m))}return _}static parse(r,l){let[h,m,_,...x]=r;if(!Array.isArray(m)||0===m.length)return l.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const A=m[1];if("number"!=typeof A)return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if("cubic-bezier"!==m[0])return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const A=m.slice(1);if(4!==A.length||A.some(R=>"number"!=typeof R||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:A}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,Le),!_)return null;const D=[];let C=null;"interpolate-hcl"===h||"interpolate-lab"===h?C=di:l.expectedType&&"value"!==l.expectedType.kind&&(C=l.expectedType);for(let A=0;A<x.length;A+=2){const R=x[A],L=x[A+1],N=A+3,U=A+4;if("number"!=typeof R)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(D.length&&D[D.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=l.parse(L,U,C);if(!$)return null;C=C||$.type,D.push([R,$])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new Dt(C,h,m,_,D):l.error(`Type ${mn(C)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=l[0])return h[0].evaluate(r);const _=l.length;if(m>=l[_-1])return h[_-1].evaluate(r);const x=ge(l,m),D=Dt.interpolationFactor(this.interpolation,m,l[x],l[x+1]),C=h[x].evaluate(r),A=h[x+1].evaluate(r);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](C,A,D):"interpolate-hcl"===this.operator?Vo.reverse(Vo.interpolate(Vo.forward(C),Vo.forward(A),D)):_t.reverse(_t.interpolate(_t.forward(C),_t.forward(A),D))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function pa(o,r,l,h){const m=h-l,_=o-l;return 0===m?0:1===r?_/m:(Math.pow(r,_)-1)/(Math.pow(r,m)-1)}class ft{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const m=l.expectedType;m&&"value"!==m.kind&&(h=m);const _=[];for(const D of r.slice(1)){const C=l.parse(D,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,_.push(C)}const x=m&&_.some(D=>$i(m,D.type));return new ft(x?ut:h,_)}evaluate(r){let l,h=null,m=0;for(const _ of this.args)if(m++,h=_.evaluate(r),h&&h instanceof Sr&&!h.available&&(l||(l=h.name),h=null,m===this.args.length&&(h=l)),null!==h)break;return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class cr{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let _=1;_<r.length-1;_+=2){const x=r[_];if("string"!=typeof x)return l.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const D=l.parse(r[_+1],_+1);if(!D)return null;h.push([x,D])}const m=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return m?new cr(h,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}class Bl{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,Le),m=l.parse(r[2],2,Br(l.expectedType||ut));return h&&m?new Bl(m.type.itemType,h,m):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Rn(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Rn(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Rn(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vl{constructor(r,l){this.type=gt,this.needle=r,this.haystack=l}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,ut),m=l.parse(r[2],2,ut);return h&&m?js(h.type,[gt,ht,Le,Xt,ut])?new Vl(h,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${mn(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!h)return!1;if(!Fo(l,["boolean","string","number","null"]))throw new Rn(`Expected first argument to be of type boolean, string, number or null, but found ${mn(xn(l))} instead.`);if(!Fo(h,["string","array"]))throw new Rn(`Expected second argument to be of type array or string, but found ${mn(xn(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class el{constructor(r,l,h){this.type=Le,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,ut),m=l.parse(r[2],2,ut);if(!h||!m)return null;if(!js(h.type,[gt,ht,Le,Xt,ut]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${mn(h.type)} instead`);if(4===r.length){const _=l.parse(r[3],3,Le);return _?new el(h,m,_):null}return new el(h,m)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Fo(l,["boolean","string","number","null"]))throw new Rn(`Expected first argument to be of type boolean, string, number or null, but found ${mn(xn(l))} instead.`);if(!Fo(h,["string","array"]))throw new Rn(`Expected second argument to be of type array or string, but found ${mn(xn(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return h.indexOf(l,m)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Uo{constructor(r,l,h,m,_,x){this.inputType=r,this.type=l,this.input=h,this.cases=m,this.outputs=_,this.otherwise=x}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,m;l.expectedType&&"value"!==l.expectedType.kind&&(m=l.expectedType);const _={},x=[];for(let A=2;A<r.length-1;A+=2){let R=r[A];const L=r[A+1];Array.isArray(R)||(R=[R]);const N=l.concat(A);if(0===R.length)return N.error("Expected at least one branch label.");for(const $ of R){if("number"!=typeof $&&"string"!=typeof $)return N.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,xn($)))return null}else h=xn($);if(void 0!==_[String($)])return N.error("Branch labels must be unique.");_[String($)]=x.length}const U=l.parse(L,A,m);if(!U)return null;m=m||U.type,x.push(U)}const D=l.parse(r[1],1,ut);if(!D)return null;const C=l.parse(r[r.length-1],r.length-1,m);return C?"value"!==D.type.kind&&l.concat(1).checkSubtype(h,D.type)?null:new Uo(h,m,D,_,x,C):null}evaluate(r){const l=this.input.evaluate(r);return(xn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],m={};for(const x of l){const D=m[this.cases[x]];void 0===D?(m[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[D][1].push(x)}const _=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,D]of h)r.push(1===D.length?_(D[0]):D.map(_)),r.push(this.outputs[x].serialize());return r.push(this.otherwise.serialize()),r}}class $r{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const m=[];for(let x=1;x<r.length-1;x+=2){const D=l.parse(r[x],x,gt);if(!D)return null;const C=l.parse(r[x+1],x+1,h);if(!C)return null;m.push([D,C]),h=h||C.type}const _=l.parse(r[r.length-1],r.length-1,h);return _?new $r(h,m,_):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class ma{constructor(r,l,h,m){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=m}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,ut),m=l.parse(r[2],2,Le);if(!h||!m)return null;if(!js(h.type,[Br(ut),ht,ut]))return l.error(`Expected first argument to be of type array or string, but found ${mn(h.type)} instead`);if(4===r.length){const _=l.parse(r[3],3,Le);return _?new ma(h.type,h,m,_):null}return new ma(h.type,h,m)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!Fo(l,["string","array"]))throw new Rn(`Expected first argument to be of type array or string, but found ${mn(xn(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return l.slice(h,m)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Hu(o,r){return"=="===o||"!="===o?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Dh(o,r,l,h){return 0===h.compare(r,l)}function si(o,r,l){const h="=="!==o&&"!="!==o;return class F1{constructor(_,x,D){this.type=gt,this.lhs=_,this.rhs=x,this.collator=D,this.hasUntypedArgument="value"===_.type.kind||"value"===x.type.kind}static parse(_,x){if(3!==_.length&&4!==_.length)return x.error("Expected two or three arguments.");const D=_[0];let C=x.parse(_[1],1,ut);if(!C)return null;if(!Hu(D,C.type))return x.concat(1).error(`"${D}" comparisons are not supported for type '${mn(C.type)}'.`);let A=x.parse(_[2],2,ut);if(!A)return null;if(!Hu(D,A.type))return x.concat(2).error(`"${D}" comparisons are not supported for type '${mn(A.type)}'.`);if(C.type.kind!==A.type.kind&&"value"!==C.type.kind&&"value"!==A.type.kind)return x.error(`Cannot compare types '${mn(C.type)}' and '${mn(A.type)}'.`);h&&("value"===C.type.kind&&"value"!==A.type.kind?C=new Ur(A.type,[C]):"value"!==C.type.kind&&"value"===A.type.kind&&(A=new Ur(C.type,[A])));let R=null;if(4===_.length){if("string"!==C.type.kind&&"string"!==A.type.kind&&"value"!==C.type.kind&&"value"!==A.type.kind)return x.error("Cannot use collator to compare non-string types.");if(R=x.parse(_[3],3,uo),!R)return null}return new F1(C,A,R)}evaluate(_){const x=this.lhs.evaluate(_),D=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const C=xn(x),A=xn(D);if(C.kind!==A.kind||"string"!==C.kind&&"number"!==C.kind)throw new Rn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${C.kind}, ${A.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=xn(x),A=xn(D);if("string"!==C.kind||"string"!==A.kind)return r(_,x,D)}return this.collator?l(_,x,D,this.collator.evaluate(_)):r(_,x,D)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[o];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const Eh=si("==",function(o,r,l){return r===l},Dh),Ch=si("!=",function(o,r,l){return r!==l},function(o,r,l,h){return!Dh(0,r,l,h)}),lf=si("<",function(o,r,l){return r<l},function(o,r,l,h){return h.compare(r,l)<0}),uf=si(">",function(o,r,l){return r>l},function(o,r,l,h){return h.compare(r,l)>0}),qu=si("<=",function(o,r,l){return r<=l},function(o,r,l,h){return h.compare(r,l)<=0}),Sh=si(">=",function(o,r,l){return r>=l},function(o,r,l,h){return h.compare(r,l)>=0});class Ul{constructor(r,l,h,m,_){this.type=ht,this.number=r,this.locale=l,this.currency=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(r,l){if(3!==r.length)return l.error("Expected two arguments.");const h=l.parse(r[1],1,Le);if(!h)return null;const m=r[2];if("object"!=typeof m||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let _=null;if(m.locale&&(_=l.parse(m.locale,1,ht),!_))return null;let x=null;if(m.currency&&(x=l.parse(m.currency,1,ht),!x))return null;let D=null;if(m["min-fraction-digits"]&&(D=l.parse(m["min-fraction-digits"],1,Le),!D))return null;let C=null;return m["max-fraction-digits"]&&(C=l.parse(m["max-fraction-digits"],1,Le),!C)?null:new Ul(h,_,x,D,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Gu{constructor(r){this.type=Le,this.input=r}static parse(r,l){if(2!==r.length)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${mn(h.type)} instead.`):new Gu(h):null}evaluate(r){const l=this.input.evaluate(r);if("string"==typeof l||Array.isArray(l))return l.length;throw new Rn(`Expected value to be of type string or array, but found ${mn(xn(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const hr={"==":Eh,"!=":Ch,">":uf,"<":lf,">=":Sh,"<=":qu,array:Ur,at:Bl,boolean:Ur,case:$r,coalesce:ft,collator:Hs,format:cs,image:Ir,in:Vl,"index-of":el,interpolate:Dt,"interpolate-hcl":Dt,"interpolate-lab":Dt,length:Gu,let:cr,literal:Yn,match:Uo,number:Ur,"number-format":Ul,object:Ur,slice:ma,step:Ee,string:Ur,"to-boolean":fi,"to-color":fi,"to-number":fi,"to-string":fi,var:te,within:j};function bn(o,[r,l,h,m]){r=r.evaluate(o),l=l.evaluate(o),h=h.evaluate(o);const _=m?m.evaluate(o):1,x=Ya(r,l,h,_);if(x)throw new Rn(x);return new Wt(r/255*_,l/255*_,h/255*_,_)}function Ih(o,r){return o in r}function Zu(o,r){const l=r[o];return void 0===l?null:l}function jo(o){return{type:o}}function Ke(o){return{result:"success",value:o}}function ga(o){return{result:"error",value:o}}function Ei(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function tl(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function nl(o){return!!o.expression&&o.expression.interpolated}function un(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function rl(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Wu(o){return o}function ya(o,r){const l="color"===r.type,h=o.stops&&"object"==typeof o.stops[0][0],m=h||!(h||void 0!==o.property),_=o.type||(nl(r)?"exponential":"interval");if(l&&((o=Ui({},o)).stops&&(o.stops=o.stops.map(A=>[A[0],Wt.parse(A[1])])),o.default=Wt.parse(o.default?o.default:r.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!$u[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let x,D,C;if("exponential"===_)x=Et;else if("interval"===_)x=Th;else if("categorical"===_){x=Xu,D=Object.create(null);for(const A of o.stops)D[A[0]]=A[1];C=typeof o.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);x=jl}if(h){const A={},R=[];for(let U=0;U<o.stops.length;U++){const $=o.stops[U],Y=$[0].zoom;void 0===A[Y]&&(A[Y]={zoom:Y,type:o.type,property:o.property,default:o.default,stops:[]},R.push(Y)),A[Y].stops.push([$[0].value,$[1]])}const L=[];for(const U of R)L.push([A[U].zoom,ya(A[U],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Dt.interpolationFactor.bind(void 0,N),zoomStops:L.map(U=>U[0]),evaluate:({zoom:U},$)=>Et({stops:L,base:o.base},r,U).evaluate(U,$)}}if(m){const A="exponential"===_?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Dt.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map(R=>R[0]),evaluate:({zoom:R})=>x(o,r,R,D,C)}}return{kind:"source",evaluate(A,R){const L=R&&R.properties?R.properties[o.property]:void 0;return void 0===L?po(o.default,r.default):x(o,r,L,D,C)}}}function po(o,r,l){return void 0!==o?o:void 0!==r?r:void 0!==l?l:void 0}function Xu(o,r,l,h,m){return po(typeof l===m?h[l]:void 0,o.default,r.default)}function Th(o,r,l){if("number"!==un(l))return po(o.default,r.default);const h=o.stops.length;if(1===h||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[h-1][0])return o.stops[h-1][1];const m=ge(o.stops.map(_=>_[0]),l);return o.stops[m][1]}function Et(o,r,l){const h=void 0!==o.base?o.base:1;if("number"!==un(l))return po(o.default,r.default);const m=o.stops.length;if(1===m||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[m-1][0])return o.stops[m-1][1];const _=ge(o.stops.map(R=>R[0]),l),x=function(R,L,N,U){const $=U-N,Y=R-N;return 0===$?0:1===L?Y/$:(Math.pow(L,Y)-1)/(Math.pow(L,$)-1)}(l,h,o.stops[_][0],o.stops[_+1][0]),D=o.stops[_][1],C=o.stops[_+1][1];let A=We[r.type]||Wu;if(o.colorSpace&&"rgb"!==o.colorSpace){const R=$u[o.colorSpace];A=(L,N)=>R.reverse(R.interpolate(R.forward(L),R.forward(N),x))}return"function"==typeof D.evaluate?{evaluate(...R){const L=D.evaluate.apply(void 0,R),N=C.evaluate.apply(void 0,R);if(void 0!==L&&void 0!==N)return A(L,N,x)}}:A(D,C,x)}function jl(o,r,l){return"color"===r.type?l=Wt.parse(l):"formatted"===r.type?l=ur.fromString(l.toString()):"resolvedImage"===r.type?l=Sr.fromString(l.toString()):un(l)===r.type||"enum"===r.type&&r.values[l]||(l=void 0),po(l,o.default,r.default)}Ln.register(hr,{error:[{kind:"error"},[ht],(o,[r])=>{throw new Rn(r.evaluate(o))}],typeof:[ht,[ut],(o,[r])=>mn(xn(r.evaluate(o)))],"to-rgba":[Br(Le,4),[di],(o,[r])=>r.evaluate(o).toArray()],rgb:[di,[Le,Le,Le],bn],rgba:[di,[Le,Le,Le,Le],bn],has:{type:gt,overloads:[[[ht],(o,[r])=>Ih(r.evaluate(o),o.properties())],[[ht,Ds],(o,[r,l])=>Ih(r.evaluate(o),l.evaluate(o))]]},get:{type:ut,overloads:[[[ht],(o,[r])=>Zu(r.evaluate(o),o.properties())],[[ht,Ds],(o,[r,l])=>Zu(r.evaluate(o),l.evaluate(o))]]},"feature-state":[ut,[ht],(o,[r])=>Zu(r.evaluate(o),o.featureState||{})],properties:[Ds,[],o=>o.properties()],"geometry-type":[ht,[],o=>o.geometryType()],id:[ut,[],o=>o.id()],zoom:[Le,[],o=>o.globals.zoom],"heatmap-density":[Le,[],o=>o.globals.heatmapDensity||0],"line-progress":[Le,[],o=>o.globals.lineProgress||0],accumulated:[ut,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[Le,jo(Le),(o,r)=>{let l=0;for(const h of r)l+=h.evaluate(o);return l}],"*":[Le,jo(Le),(o,r)=>{let l=1;for(const h of r)l*=h.evaluate(o);return l}],"-":{type:Le,overloads:[[[Le,Le],(o,[r,l])=>r.evaluate(o)-l.evaluate(o)],[[Le],(o,[r])=>-r.evaluate(o)]]},"/":[Le,[Le,Le],(o,[r,l])=>r.evaluate(o)/l.evaluate(o)],"%":[Le,[Le,Le],(o,[r,l])=>r.evaluate(o)%l.evaluate(o)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(o,[r,l])=>Math.pow(r.evaluate(o),l.evaluate(o))],sqrt:[Le,[Le],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[Le,[Le],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[Le,[Le],(o,[r])=>Math.log(r.evaluate(o))],log2:[Le,[Le],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[Le,[Le],(o,[r])=>Math.sin(r.evaluate(o))],cos:[Le,[Le],(o,[r])=>Math.cos(r.evaluate(o))],tan:[Le,[Le],(o,[r])=>Math.tan(r.evaluate(o))],asin:[Le,[Le],(o,[r])=>Math.asin(r.evaluate(o))],acos:[Le,[Le],(o,[r])=>Math.acos(r.evaluate(o))],atan:[Le,[Le],(o,[r])=>Math.atan(r.evaluate(o))],min:[Le,jo(Le),(o,r)=>Math.min(...r.map(l=>l.evaluate(o)))],max:[Le,jo(Le),(o,r)=>Math.max(...r.map(l=>l.evaluate(o)))],abs:[Le,[Le],(o,[r])=>Math.abs(r.evaluate(o))],round:[Le,[Le],(o,[r])=>{const l=r.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[Le,[Le],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[Le,[Le],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[gt,[ht,ut],(o,[r,l])=>o.properties()[r.value]===l.value],"filter-id-==":[gt,[ut],(o,[r])=>o.id()===r.value],"filter-type-==":[gt,[ht],(o,[r])=>o.geometryType()===r.value],"filter-<":[gt,[ht,ut],(o,[r,l])=>{const h=o.properties()[r.value],m=l.value;return typeof h==typeof m&&h<m}],"filter-id-<":[gt,[ut],(o,[r])=>{const l=o.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[gt,[ht,ut],(o,[r,l])=>{const h=o.properties()[r.value],m=l.value;return typeof h==typeof m&&h>m}],"filter-id->":[gt,[ut],(o,[r])=>{const l=o.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[gt,[ht,ut],(o,[r,l])=>{const h=o.properties()[r.value],m=l.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[gt,[ut],(o,[r])=>{const l=o.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[gt,[ht,ut],(o,[r,l])=>{const h=o.properties()[r.value],m=l.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[gt,[ut],(o,[r])=>{const l=o.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[gt,[ut],(o,[r])=>r.value in o.properties()],"filter-has-id":[gt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[gt,[Br(ht)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[gt,[Br(ut)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[gt,[ht,Br(ut)],(o,[r,l])=>l.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[gt,[ht,Br(ut)],(o,[r,l])=>function(h,m,_,x){for(;_<=x;){const D=_+x>>1;if(m[D]===h)return!0;m[D]>h?x=D-1:_=D+1}return!1}(o.properties()[r.value],l.value,0,l.value.length-1)],all:{type:gt,overloads:[[[gt,gt],(o,[r,l])=>r.evaluate(o)&&l.evaluate(o)],[jo(gt),(o,r)=>{for(const l of r)if(!l.evaluate(o))return!1;return!0}]]},any:{type:gt,overloads:[[[gt,gt],(o,[r,l])=>r.evaluate(o)||l.evaluate(o)],[jo(gt),(o,r)=>{for(const l of r)if(l.evaluate(o))return!0;return!1}]]},"!":[gt,[gt],(o,[r])=>!r.evaluate(o)],"is-supported-script":[gt,[ht],(o,[r])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(r.evaluate(o))}],upcase:[ht,[ht],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[ht,[ht],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[ht,jo(ut),(o,r)=>r.map(l=>Es(l.evaluate(o))).join("")],"resolved-locale":[ht,[uo],(o,[r])=>r.evaluate(o).resolvedLocale()]});class $l{constructor(r,l){var h;this.expression=r,this._warningHistory={},this._evaluator=new fo,this._defaultValue=l?"color"===(h=l).type&&rl(h.default)?new Wt(0,0,0,0):"color"===h.type?Wt.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(r,l,h,m,_,x){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,m,_,x){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Rn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function Hi(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in hr}function _a(o,r){const l=new ne(hr,[],r?function(m){const _={color:di,string:ht,number:Le,enum:ht,boolean:gt,formatted:ji,resolvedImage:co};return"array"===m.type?Br(_[m.value]||ut,m.length):_[m.type]}(r):void 0),h=l.parse(o,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return h?Ke(new $l(h,r)):ga(l.errors)}class Ku{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent="constant"!==r&&!J(l.expression)}evaluateWithoutErrorHandling(r,l,h,m,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,m,_,x)}evaluate(r,l,h,m,_,x){return this._styleExpression.evaluate(r,l,h,m,_,x)}}class hs{constructor(r,l,h,m){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==r&&!J(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,l,h,m,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,m,_,x)}evaluate(r,l,h,m,_,x){return this._styleExpression.evaluate(r,l,h,m,_,x)}interpolationFactor(r,l,h){return this.interpolationType?Dt.interpolationFactor(this.interpolationType,r,l,h):0}}function Ci(o,r){const l=_a(o,r);if("error"===l.result)return l;const h=l.value.expression,m=W(h);if(!m&&!Ei(r))return ga([new an("","data expressions not supported")]);const _=re(h,["zoom"]);if(!_&&!tl(r))return ga([new an("","zoom expressions not supported")]);const x=ql(h);return x||_?x instanceof an?ga([x]):x instanceof Dt&&!nl(r)?ga([new an("",'"interpolate" expressions cannot be used with this property')]):Ke(x?new hs(m?"camera":"composite",l.value,x.labels,x instanceof Dt?x.interpolation:void 0):new Ku(m?"constant":"source",l.value)):ga([new an("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hl{constructor(r,l){this._parameters=r,this._specification=l,Ui(this,ya(this._parameters,this._specification))}static deserialize(r){return new Hl(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ql(o){let r=null;if(o instanceof cr)r=ql(o.result);else if(o instanceof ft){for(const l of o.args)if(r=ql(l),r)break}else(o instanceof Ee||o instanceof Dt)&&o.input instanceof Ln&&"zoom"===o.input.name&&(r=o);return r instanceof an||o.eachChild(l=>{const h=ql(l);h instanceof an?r=h:!r&&h?r=new an("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new an("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}const Hr={};function $e(o,r,l={}){Object.defineProperty(r,"_classRegistryKey",{value:o,writeable:!1}),Hr[o]={klass:r,omit:l.omit||[],shallow:l.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",Kn),$e("Color",Wt),$e("Error",Error),$e("ResolvedImage",Sr),$e("StylePropertyFunction",Hl),$e("StyleExpression",$l,{omit:["_evaluator"]}),$e("ZoomDependentExpression",hs),$e("ZoomConstantExpression",Ku),$e("CompoundExpression",Ln,{omit:["_evaluate"]});for(const o in hr)hr[o]._classRegistryKey||$e(`Expression_${o}`,hr[o]);function Yu(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function va(o,r){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Yu(o)||lr(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const l=o;return r&&r.push(l.buffer),l}if(o instanceof ImageData)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const l=[];for(const h of o)l.push(va(h,r));return l}if("object"==typeof o){const l=o.constructor,h=l._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");const m=l.serialize?l.serialize(o,r):{};if(!l.serialize){for(const _ in o){if(!o.hasOwnProperty(_)||Hr[h].omit.indexOf(_)>=0)continue;const x=o[_];m[_]=Hr[h].shallow.indexOf(_)>=0?x:va(x,r)}o instanceof Error&&(m.message=o.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(m.$name=h),m}throw new Error("can't serialize object of type "+typeof o)}function il(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Yu(o)||lr(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(il);if("object"==typeof o){const r=o.$name||"Object";if(!Hr[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:l}=Hr[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(o);const h=Object.create(l.prototype);for(const m of Object.keys(o)){if("$name"===m)continue;const _=o[m];h[m]=Hr[r].shallow.indexOf(m)>=0?_:il(_)}return h}throw new Error("can't deserialize object of type "+typeof o)}class Be{constructor(r,l){this.x=r,this.y=l}clone(){return new Be(this.x,this.y)}add(r){return this.clone()._add(r)}sub(r){return this.clone()._sub(r)}multByPoint(r){return this.clone()._multByPoint(r)}divByPoint(r){return this.clone()._divByPoint(r)}mult(r){return this.clone()._mult(r)}div(r){return this.clone()._div(r)}rotate(r){return this.clone()._rotate(r)}rotateAround(r,l){return this.clone()._rotateAround(r,l)}matMult(r){return this.clone()._matMult(r)}unit(){return this.clone()._unit()}perp(){return this.clone()._perp()}round(){return this.clone()._round()}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(r){return this.x===r.x&&this.y===r.y}dist(r){return Math.sqrt(this.distSqr(r))}distSqr(r){const l=r.x-this.x,h=r.y-this.y;return l*l+h*h}angle(){return Math.atan2(this.y,this.x)}angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)}angleWith(r){return this.angleWithSep(r.x,r.y)}angleWithSep(r,l){return Math.atan2(this.x*l-this.y*r,this.x*r+this.y*l)}_matMult(r){const l=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=l,this}_add(r){return this.x+=r.x,this.y+=r.y,this}_sub(r){return this.x-=r.x,this.y-=r.y,this}_mult(r){return this.x*=r,this.y*=r,this}_div(r){return this.x/=r,this.y/=r,this}_multByPoint(r){return this.x*=r.x,this.y*=r.y,this}_divByPoint(r){return this.x/=r.x,this.y/=r.y,this}_unit(){return this._div(this.mag()),this}_perp(){const r=this.y;return this.y=this.x,this.x=-r,this}_rotate(r){const l=Math.cos(r),h=Math.sin(r),m=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=m,this}_rotateAround(r,l){const h=Math.cos(r),m=Math.sin(r),_=l.y+m*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-m*(this.y-l.y),this.y=_,this}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}static convert(r){if(r instanceof Be)return r;if(Array.isArray(r))return new Be(r[0],r[1]);if("number"==typeof r.x)return new Be(r.x,r.y);throw new Error(`Unable to convert to point: ${JSON.stringify(r)}`)}}$e("Point",Be);const Gl={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Ah="mapbox-tiles";let Si,$o=500,sl=50;function xa(){"undefined"==typeof caches||Si||(Si=caches.open(Ah))}let ol=1/0;const cn={supported:!1,testSupport:function(o){!Gs&&Vt&&(On?An(o):Ss=o)}};let Ss,Vt,Gs=!1,On=!1;function An(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Vt),o.isContextLost())return;cn.supported=!0}catch{}o.deleteTexture(r),Gs=!0}"undefined"!=typeof document&&(Vt=document.createElement("img"),Vt.onload=function(){Ss&&An(Ss),Ss=null,On=!0},Vt.onerror=function(){Gs=!0,Ss=null},Vt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ho={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ho);class al extends Error{constructor(r,l,h){super(r),this.status=l,this.url=h,this.name=this.constructor.name,this.message=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zs=kt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function Ju(o,r){const l=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Zs(),signal:l.signal});let m=!1,_=!1;return"json"===o.type&&h.headers.set("Accept","application/json"),((x,D,C)=>{if(_)return;const A=Date.now();fetch(h).then(R=>{return R.ok?(L=R,null,A,void("arrayBuffer"===o.type?L.arrayBuffer():"json"===o.type?L.json():L.text()).then($=>{_||(m=!0,r(null,$,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch($=>{_||r(new Error($.message))})):r(new al(R.statusText,R.status,o.url));var L}).catch(R=>{20!==R.code&&r(new Error(R.message))})})(),{cancel:()=>{_=!0,m||l.abort()}}}const ll=function(o,r){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r);if(!kt()){const h=o.url.substring(0,o.url.indexOf("://"));return(Gl.REGISTERED_PROTOCOLS[h]||Ju)(o,r)}}if(!(/^file:/.test(l=o.url)||/^file:/.test(Zs())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Ju(o,r);if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var l;return function(h,m){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(_.responseType="arraybuffer");for(const x in h.headers)_.setRequestHeader(x,h.headers[x]);return"json"===h.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===h.credentials,_.onerror=()=>{m(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let x=_.response;if("json"===h.type)try{x=JSON.parse(_.response)}catch(D){return m(D)}m(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else m(new al(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(o,r)},dr=function(o,r){return ll(Pt(o,{type:"arrayBuffer"}),r)};function qr(o){const r=window.document.createElement("a");return r.href=o,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const fr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ii,pi;Ii=[],pi=0;const mi=function(o,r){if(cn.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),pi>=Gl.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ii.push(_),_}pi++;let l=!1;const h=()=>{if(!l)for(l=!0,pi--;Ii.length&&pi<Gl.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Ii.shift(),{requestParameters:x,callback:D,cancelled:C}=_;C||(_.cancel=mi(x,D).cancel)}},m=dr(o,(_,x,D,C)=>{var A,R,L,N;h(),_?r(_):x&&(A=x,R=r,L=D,N=C,"function"==typeof createImageBitmap?function(U,$){const Y=new Blob([new Uint8Array(U)],{type:"image/png"});createImageBitmap(Y).then(Q=>{$(null,Q)}).catch(Q=>{$(new Error(`Could not load image because of ${Q.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(A,R):function(U,$,Y,Q){const se=new Image;se.onload=()=>{$(null,se),URL.revokeObjectURL(se.src),se.onload=null,window.requestAnimationFrame(()=>{se.src=fr})},se.onerror=()=>$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const pe=new Blob([new Uint8Array(U)],{type:"image/png"});se.cacheControl=Y,se.expires=Q,se.src=U.byteLength?URL.createObjectURL(pe):fr}(A,R,L,N))});return{cancel:()=>{m.cancel(),h()}}};function gi(o,r,l){l[o]&&-1!==l[o].indexOf(r)||(l[o]=l[o]||[],l[o].push(r))}function Ue(o,r,l){if(l&&l[o]){const h=l[o].indexOf(r);-1!==h&&l[o].splice(h,1)}}class Tt{constructor(r,l={}){Pt(this,l),this.type=r}}class wn extends Tt{constructor(r,l={}){super("error",Pt({error:r},l))}}class Gr{on(r,l){return this._listeners=this._listeners||{},gi(r,l,this._listeners),this}off(r,l){return Ue(r,l,this._listeners),Ue(r,l,this._oneTimeListeners),this}once(r,l){return this._oneTimeListeners=this._oneTimeListeners||{},gi(r,l,this._oneTimeListeners),this}fire(r,l){"string"==typeof r&&(r=new Tt(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const D of m)D.call(this,r);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const D of _)Ue(h,D,this._oneTimeListeners),D.call(this,r);const x=this._eventedParent;x&&(Pt(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof wn&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Pe{constructor(r,l,h,m){this.message=(r?`${r}: `:"")+h,m&&(this.identifier=m),null!=l&&l.__line__&&(this.line=l.__line__)}}function Is(o){const r=o.value;return r?[new Pe(o.key,r,"constants have been deprecated as of v8")]:[]}function It(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function oi(o){if(Array.isArray(o))return o.map(oi);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const l in o)r[l]=oi(o[l]);return r}return It(o)}function Tr(o){const r=o.key,l=o.value,h=o.valueSpec||{},m=o.objectElementValidators||{},_=o.style,x=o.styleSpec;let D=[];const C=un(l);if("object"!==C)return[new Pe(r,l,`object expected, ${C} found`)];for(const A in l){const R=A.split(".")[0],L=h[R]||h["*"];let N;if(m[R])N=m[R];else if(h[R])N=Mi;else if(m["*"])N=m["*"];else{if(!h["*"]){D.push(new Pe(r,l[A],`unknown property "${A}"`));continue}N=Mi}D=D.concat(N({key:(r&&`${r}.`)+A,value:l[A],valueSpec:L,style:_,styleSpec:x,object:l,objectKey:A},l))}for(const A in h)m[A]||h[A].required&&void 0===h[A].default&&void 0===l[A]&&D.push(new Pe(r,l,`missing required property "${A}"`));return D}function Ct(o){const r=o.value,l=o.valueSpec,h=o.style,m=o.styleSpec,_=o.key,x=o.arrayElementValidator||Mi;if("array"!==un(r))return[new Pe(_,r,`array expected, ${un(r)} found`)];if(l.length&&r.length!==l.length)return[new Pe(_,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new Pe(_,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let D={type:l.value,values:l.values};m.$version<7&&(D.function=l.function),"object"===un(l.value)&&(D=l.value);let C=[];for(let A=0;A<r.length;A++)C=C.concat(x({array:r,arrayIndex:A,value:r[A],valueSpec:D,style:h,styleSpec:m,key:`${_}[${A}]`}));return C}function ba(o){const r=o.key,l=o.value,h=o.valueSpec;let m=un(l);return"number"===m&&l!=l&&(m="NaN"),"number"!==m?[new Pe(r,l,`number expected, ${m} found`)]:"minimum"in h&&l<h.minimum?[new Pe(r,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new Pe(r,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function Ts(o){const r=o.valueSpec,l=It(o.value.type);let h,m,_,x={};const D="categorical"!==l&&void 0===o.value.property,C=!D,A="array"===un(o.value.stops)&&"array"===un(o.value.stops[0])&&"object"===un(o.value.stops[0][0]),R=Tr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(U){if("identity"===l)return[new Pe(U.key,U.value,'identity function may not have a "stops" property')];let $=[];const Y=U.value;return $=$.concat(Ct({key:U.key,value:Y,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:L})),"array"===un(Y)&&0===Y.length&&$.push(new Pe(U.key,Y,"array must have at least one stop")),$},default:function(U){return Mi({key:U.key,value:U.value,valueSpec:r,style:U.style,styleSpec:U.styleSpec})}}});return"identity"===l&&D&&R.push(new Pe(o.key,o.value,'missing required property "property"')),"identity"===l||o.value.stops||R.push(new Pe(o.key,o.value,'missing required property "stops"')),"exponential"===l&&o.valueSpec.expression&&!nl(o.valueSpec)&&R.push(new Pe(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(C&&!Ei(o.valueSpec)?R.push(new Pe(o.key,o.value,"property functions not supported")):D&&!tl(o.valueSpec)&&R.push(new Pe(o.key,o.value,"zoom functions not supported"))),"categorical"!==l&&!A||void 0!==o.value.property||R.push(new Pe(o.key,o.value,'"property" property is required')),R;function L(U){let $=[];const Y=U.value,Q=U.key;if("array"!==un(Y))return[new Pe(Q,Y,`array expected, ${un(Y)} found`)];if(2!==Y.length)return[new Pe(Q,Y,`array length 2 expected, length ${Y.length} found`)];if(A){if("object"!==un(Y[0]))return[new Pe(Q,Y,`object expected, ${un(Y[0])} found`)];if(void 0===Y[0].zoom)return[new Pe(Q,Y,"object stop key must have zoom")];if(void 0===Y[0].value)return[new Pe(Q,Y,"object stop key must have value")];if(_&&_>It(Y[0].zoom))return[new Pe(Q,Y[0].zoom,"stop zoom values must appear in ascending order")];It(Y[0].zoom)!==_&&(_=It(Y[0].zoom),m=void 0,x={}),$=$.concat(Tr({key:`${Q}[0]`,value:Y[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:ba,value:N}}))}else $=$.concat(N({key:`${Q}[0]`,value:Y[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},Y));return Hi(oi(Y[1]))?$.concat([new Pe(`${Q}[1]`,Y[1],"expressions are not allowed in function stops.")]):$.concat(Mi({key:`${Q}[1]`,value:Y[1],valueSpec:r,style:U.style,styleSpec:U.styleSpec}))}function N(U,$){const Y=un(U.value),Q=It(U.value),se=null!==U.value?U.value:$;if(h){if(Y!==h)return[new Pe(U.key,se,`${Y} stop domain type must match previous stop domain type ${h}`)]}else h=Y;if("number"!==Y&&"string"!==Y&&"boolean"!==Y)return[new Pe(U.key,se,"stop domain value must be a number, string, or boolean")];if("number"!==Y&&"categorical"!==l){let pe=`number expected, ${Y} found`;return Ei(r)&&void 0===l&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(U.key,se,pe)]}return"categorical"!==l||"number"!==Y||isFinite(Q)&&Math.floor(Q)===Q?"categorical"!==l&&"number"===Y&&void 0!==m&&Q<m?[new Pe(U.key,se,"stop domain values must appear in ascending order")]:(m=Q,"categorical"===l&&Q in x?[new Pe(U.key,se,"stop domain values must be unique")]:(x[Q]=!0,[])):[new Pe(U.key,se,`integer expected, found ${Q}`)]}}function ds(o){const r=("property"===o.expressionContext?Ci:_a)(oi(o.value),o.valueSpec);if("error"===r.result)return r.value.map(h=>new Pe(`${o.key}${h.key}`,o.value,h.message));const l=r.value.expression||r.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!l.outputDefined())return[new Pe(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!J(l))return[new Pe(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext&&!J(l))return[new Pe(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!re(l,["zoom","feature-state"]))return[new Pe(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!W(l))return[new Pe(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qi(o){const r=o.key,l=o.value,h=o.valueSpec,m=[];return Array.isArray(h.values)?-1===h.values.indexOf(It(l))&&m.push(new Pe(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(It(l))&&m.push(new Pe(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),m}function pr(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!pr(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}const wa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gi(o){if(null==o)return{filter:()=>!0,needGeometry:!1};pr(o)||(o=ul(o));const r=_a(o,wa);if("error"===r.result)throw new Error(r.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,m)=>r.value.evaluate(l,h,{},m),needGeometry:gn(o)}}function Zi(o,r){return o<r?-1:o>r?1:0}function gn(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let r=1;r<o.length;r++)if(gn(o[r]))return!0;return!1}function ul(o){if(!o)return!0;const r=o[0];return o.length<=1?"any"!==r:"=="===r?Zl(o[1],o[2],"=="):"!="===r?Wi(Zl(o[1],o[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Zl(o[1],o[2],r):"any"===r?(l=o.slice(1),["any"].concat(l.map(ul))):"all"===r?["all"].concat(o.slice(1).map(ul)):"none"===r?["all"].concat(o.slice(1).map(ul).map(Wi)):"in"===r?Da(o[1],o.slice(2)):"!in"===r?Wi(Da(o[1],o.slice(2))):"has"===r?mo(o[1]):"!has"===r?Wi(mo(o[1])):"within"!==r||o;var l}function Zl(o,r,l){switch(o){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,o,r]}}function Da(o,r){if(0===r.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",o,["literal",r.sort(Zi)]]:["filter-in-small",o,["literal",r]]}}function mo(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Wi(o){return["!",o]}function xr(o){return pr(oi(o.value))?ds(Ui({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xi(o)}function Xi(o){const r=o.value,l=o.key;if("array"!==un(r))return[new Pe(l,r,`array expected, ${un(r)} found`)];const h=o.styleSpec;let m,_=[];if(r.length<1)return[new Pe(l,r,"filter array must have at least 1 element")];switch(_=_.concat(qi({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:o.style,styleSpec:o.styleSpec})),It(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===It(r[1])&&_.push(new Pe(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&_.push(new Pe(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(m=un(r[1]),"string"!==m&&_.push(new Pe(`${l}[1]`,r[1],`string expected, ${m} found`)));for(let x=2;x<r.length;x++)m=un(r[x]),"$type"===It(r[1])?_=_.concat(qi({key:`${l}[${x}]`,value:r[x],valueSpec:h.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&_.push(new Pe(`${l}[${x}]`,r[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)_=_.concat(Xi({key:`${l}[${x}]`,value:r[x],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":m=un(r[1]),2!==r.length?_.push(new Pe(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==m&&_.push(new Pe(`${l}[1]`,r[1],`string expected, ${m} found`));break;case"within":m=un(r[1]),2!==r.length?_.push(new Pe(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==m&&_.push(new Pe(`${l}[1]`,r[1],`object expected, ${m} found`))}return _}function br(o,r){const l=o.key,h=o.style,m=o.styleSpec,_=o.value,x=o.objectKey,D=m[`${r}_${o.layerType}`];if(!D)return[];const C=x.match(/^(.*)-transition$/);if("paint"===r&&C&&D[C[1]]&&D[C[1]].transition)return Mi({key:l,value:_,valueSpec:m.transition,style:h,styleSpec:m});const A=o.valueSpec||D[x];if(!A)return[new Pe(l,_,`unknown property "${x}"`)];let R;if("string"===un(_)&&Ei(A)&&!A.tokens&&(R=/^{([^}]+)}$/.exec(_)))return[new Pe(l,_,`"${x}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const L=[];return"symbol"===o.layerType&&("text-field"===x&&h&&!h.glyphs&&L.push(new Pe(l,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&rl(oi(_))&&"identity"===It(_.type)&&L.push(new Pe(l,_,'"text-font" does not support identity functions'))),L.concat(Mi({key:o.key,value:_,valueSpec:A,style:h,styleSpec:m,expressionContext:"property",propertyType:r,propertyKey:x}))}function Qu(o){return br(o,"paint")}function Ki(o){return br(o,"layout")}function Ti(o){let r=[];const l=o.value,h=o.key,m=o.style,_=o.styleSpec;l.type||l.ref||r.push(new Pe(h,l,'either "type" or "ref" is required'));let x=It(l.type);const D=It(l.ref);if(l.id){const C=It(l.id);for(let A=0;A<o.arrayIndex;A++){const R=m.layers[A];It(R.id)===C&&r.push(new Pe(h,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(A=>{A in l&&r.push(new Pe(h,l[A],`"${A}" is prohibited for ref layers`))}),m.layers.forEach(A=>{It(A.id)===D&&(C=A)}),C?C.ref?r.push(new Pe(h,l.ref,"ref cannot reference another ref layer")):x=It(C.type):r.push(new Pe(h,l.ref,`ref layer "${D}" not found`))}else if("background"!==x)if(l.source){const C=m.sources&&m.sources[l.source],A=C&&It(C.type);C?"vector"===A&&"raster"===x?r.push(new Pe(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===A&&"raster"!==x?r.push(new Pe(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==A||l["source-layer"]?"raster-dem"===A&&"hillshade"!==x?r.push(new Pe(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!l.paint||!l.paint["line-gradient"]||"geojson"===A&&C.lineMetrics||r.push(new Pe(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Pe(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new Pe(h,l.source,`source "${l.source}" not found`))}else r.push(new Pe(h,l,'missing required property "source"'));return r=r.concat(Tr({key:h,value:l,valueSpec:_.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Mi({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:o.style,styleSpec:o.styleSpec,object:l,objectKey:"type"}),filter:xr,layout:C=>Tr({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":A=>Ki(Ui({layerType:x},A))}}),paint:C=>Tr({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":A=>Qu(Ui({layerType:x},A))}})}})),r}function fs(o){const r=o.value,l=o.key,h=un(r);return"string"!==h?[new Pe(l,r,`string expected, ${h} found`)]:[]}const Ea={promoteId:function({key:o,value:r}){if("string"===un(r))return fs({key:o,value:r});{const l=[];for(const h in r)l.push(...fs({key:`${o}.${h}`,value:r[h]}));return l}}};function go(o){const r=o.value,l=o.key,h=o.styleSpec,m=o.style;if(!r.type)return[new Pe(l,r,'"type" is required')];const _=It(r.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=Tr({key:l,value:r,valueSpec:h[`source_${_.replace("-","_")}`],style:o.style,styleSpec:h,objectElementValidators:Ea}),x;case"geojson":if(x=Tr({key:l,value:r,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:Ea}),r.cluster)for(const D in r.clusterProperties){const[C,A]=r.clusterProperties[D],R="string"==typeof C?[C,["accumulated"],["get",D]]:C;x.push(...ds({key:`${l}.${D}.map`,value:A,expressionContext:"cluster-map"})),x.push(...ds({key:`${l}.${D}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return Tr({key:l,value:r,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return Tr({key:l,value:r,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new Pe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qi({key:`${l}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:h})}}function Ai(o){const r=o.value,l=o.styleSpec,h=l.light,m=o.style;let _=[];const x=un(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new Pe("light",r,`object expected, ${x} found`)]),_;for(const D in r){const C=D.match(/^(.*)-transition$/);_=_.concat(C&&h[C[1]]&&h[C[1]].transition?Mi({key:D,value:r[D],valueSpec:l.transition,style:m,styleSpec:l}):h[D]?Mi({key:D,value:r[D],valueSpec:h[D],style:m,styleSpec:l}):[new Pe(D,r[D],`unknown property "${D}"`)])}return _}const ec={"*":()=>[],array:Ct,boolean:function(o){const r=o.value,l=o.key,h=un(r);return"boolean"!==h?[new Pe(l,r,`boolean expected, ${h} found`)]:[]},number:ba,color:function(o){const r=o.key,l=o.value,h=un(l);return"string"!==h?[new Pe(r,l,`color expected, ${h} found`)]:null===Zt(l)?[new Pe(r,l,`color expected, "${l}" found`)]:[]},constants:Is,enum:qi,filter:xr,function:Ts,layer:Ti,object:Tr,source:go,light:Ai,string:fs,formatted:function(o){return 0===fs(o).length?[]:ds(o)},resolvedImage:function(o){return 0===fs(o).length?[]:ds(o)}};function Mi(o){const r=o.value,l=o.valueSpec,h=o.styleSpec;return l.expression&&rl(It(r))?Ts(o):l.expression&&Hi(oi(r))?ds(o):l.type&&ec[l.type]?ec[l.type](o):Tr(Ui({},o,{valueSpec:l.type?h[l.type]:l}))}function Mh(o){const r=o.value,l=o.key,h=fs(o);return h.length||(-1===r.indexOf("{fontstack}")&&h.push(new Pe(l,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&h.push(new Pe(l,r,'"glyphs" url must include a "{range}" token'))),h}function Ws(o,r=ve){let l=[];return l=l.concat(Mi({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:Mh,"*":()=>[]}})),o.constants&&(l=l.concat(Is({key:"constants",value:o.constants,style:o,styleSpec:r}))),tc(l)}function tc(o){return[].concat(o).sort((r,l)=>r.line-l.line)}function Ca(o){return function(...r){return tc(o.apply(this,r))}}Ws.source=Ca(go),Ws.light=Ca(Ai),Ws.layer=Ca(Ti),Ws.filter=Ca(xr),Ws.paintProperty=Ca(Qu),Ws.layoutProperty=Ca(Ki);const qo=Ws,Wl=qo.light,Ph=qo.paintProperty,cf=qo.layoutProperty;function nc(o,r){let l=!1;if(r&&r.length)for(const h of r)o.fire(new wn(new Error(h.message))),l=!0;return l}class kh{constructor(){this.first=!0}update(r,l){const h=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=h,!0))}}const Fe={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function rc(o){for(const r of o)if(ic(r.charCodeAt(0)))return!0;return!1}function hf(o){for(const r of o)if(!df(r.charCodeAt(0)))return!1;return!0}function df(o){return!(Fe.Arabic(o)||Fe["Arabic Supplement"](o)||Fe["Arabic Extended-A"](o)||Fe["Arabic Presentation Forms-A"](o)||Fe["Arabic Presentation Forms-B"](o))}function ic(o){return!(746!==o&&747!==o&&(o<4352||!(Fe["Bopomofo Extended"](o)||Fe.Bopomofo(o)||Fe["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Fe["CJK Compatibility Ideographs"](o)||Fe["CJK Compatibility"](o)||Fe["CJK Radicals Supplement"](o)||Fe["CJK Strokes"](o)||!(!Fe["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Fe["CJK Unified Ideographs Extension A"](o)||Fe["CJK Unified Ideographs"](o)||Fe["Enclosed CJK Letters and Months"](o)||Fe["Hangul Compatibility Jamo"](o)||Fe["Hangul Jamo Extended-A"](o)||Fe["Hangul Jamo Extended-B"](o)||Fe["Hangul Jamo"](o)||Fe["Hangul Syllables"](o)||Fe.Hiragana(o)||Fe["Ideographic Description Characters"](o)||Fe.Kanbun(o)||Fe["Kangxi Radicals"](o)||Fe["Katakana Phonetic Extensions"](o)||Fe.Katakana(o)&&12540!==o||!(!Fe["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Fe["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Fe["Unified Canadian Aboriginal Syllabics"](o)||Fe["Unified Canadian Aboriginal Syllabics Extended"](o)||Fe["Vertical Forms"](o)||Fe["Yijing Hexagram Symbols"](o)||Fe["Yi Syllables"](o)||Fe["Yi Radicals"](o))))}function sc(o){return!(ic(o)||(r=o,Fe["Latin-1 Supplement"](r)&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||Fe["General Punctuation"](r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||Fe["Letterlike Symbols"](r)||Fe["Number Forms"](r)||Fe["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||Fe["Control Pictures"](r)&&9251!==r||Fe["Optical Character Recognition"](r)||Fe["Enclosed Alphanumerics"](r)||Fe["Geometric Shapes"](r)||Fe["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Fe["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Fe["CJK Symbols and Punctuation"](r)||Fe.Katakana(r)||Fe["Private Use Area"](r)||Fe["CJK Compatibility Forms"](r)||Fe["Small Form Variants"](r)||Fe["Halfwidth and Fullwidth Forms"](r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r}function Xl(o){return o>=1424&&o<=2303||Fe["Arabic Presentation Forms-A"](o)||Fe["Arabic Presentation Forms-B"](o)}function Kl(o,r){return!(!r&&Xl(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Fe.Khmer(o))}function ff(o){for(const r of o)if(Xl(r.charCodeAt(0)))return!0;return!1}const oc="deferred",ac="loading",As="loaded";let Yl=null,Pn="unavailable",Ms=null;const cl=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(Pn="error"),Yl&&Yl(o)};function Jl(){hl.fire(new Tt("pluginStateChange",{pluginStatus:Pn,pluginURL:Ms}))}const hl=new Gr,Sa=function(){return Pn},lc=function(){if(Pn!==oc||!Ms)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pn=ac,Jl(),Ms&&dr({url:Ms},o=>{o?cl(o):(Pn=As,Jl())})},ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pn===As||null!=ai.applyArabicShaping,isLoading:()=>Pn===ac,setState(o){Pn=o.pluginStatus,Ms=o.pluginURL},isParsed:()=>null!=ai.applyArabicShaping&&null!=ai.processBidirectionalText&&null!=ai.processStyledBidirectionalText,getPluginURL:()=>Ms};class Sn{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kh,this.transition={})}isSupportedScript(r){return function(l,h){for(const m of l)if(!Kl(m.charCodeAt(0),h))return!1;return!0}(r,ai.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,l=r-Math.floor(r),h=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class Zr{constructor(r,l){this.property=r,this.value=l,this.expression=function(h,m){if(rl(h))return new Hl(h,m);if(Hi(h)){const _=Ci(h,m);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=h;return"string"==typeof h&&"color"===m.type&&(_=Wt.parse(h)),{kind:"constant",evaluate:()=>_}}}(void 0===l?r.specification.default:l,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class dl{constructor(r){this.property=r,this.value=new Zr(r,void 0)}transitioned(r,l){return new Ia(this.property,this.value,l,Pt({},r.transition,this.transition),r.now)}untransitioned(){return new Ia(this.property,this.value,null,{},0)}}class Ql{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return rr(this._values[r].value.value)}setValue(r,l){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new dl(this._values[r].property)),this._values[r].value=new Zr(this._values[r].property,null===l?void 0:rr(l))}getTransition(r){return rr(this._values[r].transition)}setTransition(r,l){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new dl(this._values[r].property)),this._values[r].transition=rr(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(r[l]=h);const m=this.getTransition(l);void 0!==m&&(r[`${l}-transition`]=m)}return r}transitioned(r,l){const h=new fl(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(r,l._values[m]);return h}untransitioned(){const r=new fl(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Ia{constructor(r,l,h,m,_){this.property=r,this.value=l,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,r.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const m=r.now||0,_=this.value.possiblyEvaluate(r,l,h),x=this.prior;if(x){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return x.possiblyEvaluate(r,l,h);{const D=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,l,h),_,function(C){if(C<=0)return 0;if(C>=1)return 1;const A=C*C,R=A*C;return 4*(C<.5?R:3*(C-A)+R-.75)}(D))}}return _}}class fl{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const m=new In(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(r,l,h);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class pl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return rr(this._values[r].value)}setValue(r,l){this._values[r]=new Zr(this._values[r].property,null===l?void 0:rr(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const m=new In(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(r,l,h);return m}}class Yi{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,l,h,m){return this.property.evaluate(this.value,this.parameters,r,l,h,m)}}class In{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class qe{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const m=We[this.specification.type];return m?m(r,l,h):r}}class rt{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,m){return new Yi(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(l,null,{},h,m)}:r.expression,l)}interpolate(r,l,h){if("constant"!==r.value.kind||"constant"!==l.value.kind)return r;if(void 0===r.value.value||void 0===l.value.value)return new Yi(this,{kind:"constant",value:void 0},r.parameters);const m=We[this.specification.type];return m?new Yi(this,{kind:"constant",value:m(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,m,_,x){return"constant"===r.kind?r.value:r.evaluate(l,h,m,_,x)}}class yn extends rt{possiblyEvaluate(r,l,h,m){if(void 0===r.value)return new Yi(this,{kind:"constant",value:void 0},l);if("constant"===r.expression.kind){const _=r.expression.evaluate(l,null,{},h,m),x="resolvedImage"===r.property.specification.type&&"string"!=typeof _?_.name:_,D=this._calculate(x,x,x,l);return new Yi(this,{kind:"constant",value:D},l)}if("camera"===r.expression.kind){const _=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new Yi(this,{kind:"constant",value:_},l)}return new Yi(this,r.expression,l)}evaluate(r,l,h,m,_,x){if("source"===r.kind){const D=r.evaluate(l,h,m,_,x);return this._calculate(D,D,D,l)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},h,m),r.evaluate({zoom:Math.floor(l.zoom)},h,m),r.evaluate({zoom:Math.floor(l.zoom)+1},h,m),l):r.value}_calculate(r,l,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:h,to:l}}interpolate(r){return r}}class eu{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,m){if(void 0!==r.value){if("constant"===r.expression.kind){const _=r.expression.evaluate(l,null,{},h,m);return this._calculate(_,_,_,l)}return this._calculate(r.expression.evaluate(new Sn(Math.floor(l.zoom-1),l)),r.expression.evaluate(new Sn(Math.floor(l.zoom),l)),r.expression.evaluate(new Sn(Math.floor(l.zoom+1),l)),l)}}_calculate(r,l,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:h,to:l}}interpolate(r){return r}}class tu{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,m){return!!r.expression.evaluate(l,null,{},h,m)}interpolate(){return!1}}class Zn{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in r){const h=r[l];h.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new Zr(h,void 0),_=this.defaultTransitionablePropertyValues[l]=new dl(h);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate({})}}}$e("DataDrivenProperty",rt),$e("DataConstantProperty",qe),$e("CrossFadedDataDrivenProperty",yn),$e("CrossFadedProperty",eu),$e("ColorRampProperty",tu);const Wr="-transition";class ps extends Gr{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new pl(l.layout)),l.paint)){this._transitionablePaint=new Ql(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new In(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){null!=l&&this._validate(cf,`layers.${this.id}.layout.${r}`,r,l,h)||("visibility"!==r?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return r.endsWith(Wr)?this._transitionablePaint.getTransition(r.slice(0,-Wr.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(null!=l&&this._validate(Ph,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(r.endsWith(Wr))return this._transitionablePaint.setTransition(r.slice(0,-Wr.length),l||void 0),!1;{const m=this._transitionablePaint._values[r],_="cross-faded-data-driven"===m.property.specification["property-type"],x=m.value.isDataDriven(),D=m.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const C=this._transitionablePaint._values[r].value;return C.isDataDriven()||x||_||this._handleOverridablePaintPropertyUpdate(r,D,C)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),ar(r,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(r,l,h,m,_={}){return(!_||!1!==_.validate)&&nc(this,r.call(qo,{key:l,layerType:this.type,objectKey:h,value:m,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof Yi&&Ei(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const ml={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ms{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function s(o,r=1){let l=0,h=0;return{members:o.map(m=>{const _=ml[m.type].BYTES_PER_ELEMENT,x=l=c(l,Math.max(r,_)),D=m.components||1;return h=Math.max(h,_),l+=_*D,{name:m.name,type:m.type,components:D,offset:x}}),size:c(l,Math.max(h,r)),alignment:r}}function c(o,r){return Math.ceil(o/r)*r}class p extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const m=2*r;return this.int16[m+0]=l,this.int16[m+1]=h,r}}p.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",p);class g extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,m)}emplace(r,l,h,m,_){const x=4*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=m,this.int16[x+3]=_,r}}g.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",g);class b extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,h,m,_,x)}emplace(r,l,h,m,_,x,D){const C=6*r;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=m,this.int16[C+3]=_,this.int16[C+4]=x,this.int16[C+5]=D,r}}b.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",b);class E extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,h,m,_,x)}emplace(r,l,h,m,_,x,D){const C=4*r,A=8*r;return this.int16[C+0]=l,this.int16[C+1]=h,this.uint8[A+4]=m,this.uint8[A+5]=_,this.uint8[A+6]=x,this.uint8[A+7]=D,r}}E.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",E);class S extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const m=2*r;return this.float32[m+0]=l,this.float32[m+1]=h,r}}S.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",S);class T extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x,D,C,A,R){const L=this.length;return this.resize(L+1),this.emplace(L,r,l,h,m,_,x,D,C,A,R)}emplace(r,l,h,m,_,x,D,C,A,R,L){const N=10*r;return this.uint16[N+0]=l,this.uint16[N+1]=h,this.uint16[N+2]=m,this.uint16[N+3]=_,this.uint16[N+4]=x,this.uint16[N+5]=D,this.uint16[N+6]=C,this.uint16[N+7]=A,this.uint16[N+8]=R,this.uint16[N+9]=L,r}}T.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",T);class k extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x,D,C,A,R,L,N){const U=this.length;return this.resize(U+1),this.emplace(U,r,l,h,m,_,x,D,C,A,R,L,N)}emplace(r,l,h,m,_,x,D,C,A,R,L,N,U){const $=12*r;return this.int16[$+0]=l,this.int16[$+1]=h,this.int16[$+2]=m,this.int16[$+3]=_,this.uint16[$+4]=x,this.uint16[$+5]=D,this.uint16[$+6]=C,this.uint16[$+7]=A,this.int16[$+8]=R,this.int16[$+9]=L,this.int16[$+10]=N,this.int16[$+11]=U,r}}k.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",k);class F extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,h)}emplace(r,l,h,m){const _=3*r;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=m,r}}F.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",F);class B extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}B.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",B);class H extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x,D,C,A){const R=this.length;return this.resize(R+1),this.emplace(R,r,l,h,m,_,x,D,C,A)}emplace(r,l,h,m,_,x,D,C,A,R){const L=10*r,N=5*r;return this.int16[L+0]=l,this.int16[L+1]=h,this.int16[L+2]=m,this.int16[L+3]=_,this.int16[L+4]=x,this.int16[L+5]=D,this.uint32[N+3]=C,this.uint16[L+8]=A,this.uint16[L+9]=R,r}}H.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",H);class X extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,h,m,_,x)}emplace(r,l,h,m,_,x,D){const C=6*r;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=m,this.int16[C+3]=_,this.int16[C+4]=x,this.int16[C+5]=D,r}}X.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",X);class Z extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,m,_)}emplace(r,l,h,m,_,x){const D=4*r,C=8*r;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=m,this.int16[C+6]=_,this.int16[C+7]=x,r}}Z.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",Z);class V extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,m)}emplace(r,l,h,m,_){const x=12*r,D=3*r;return this.uint8[x+0]=l,this.uint8[x+1]=h,this.float32[D+1]=m,this.float32[D+2]=_,r}}V.prototype.bytesPerElement=12,$e("StructArrayLayout2ub2f12",V);class ee extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,h)}emplace(r,l,h,m){const _=3*r;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=m,r}}ee.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",ee);class ie extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y,Q,se){const pe=this.length;return this.resize(pe+1),this.emplace(pe,r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y,Q,se)}emplace(r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y,Q,se,pe){const he=24*r,_e=12*r,Ce=48*r;return this.int16[he+0]=l,this.int16[he+1]=h,this.uint16[he+2]=m,this.uint16[he+3]=_,this.uint32[_e+2]=x,this.uint32[_e+3]=D,this.uint32[_e+4]=C,this.uint16[he+10]=A,this.uint16[he+11]=R,this.uint16[he+12]=L,this.float32[_e+7]=N,this.float32[_e+8]=U,this.uint8[Ce+36]=$,this.uint8[Ce+37]=Y,this.uint8[Ce+38]=Q,this.uint32[_e+10]=se,this.int16[he+22]=pe,r}}ie.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class le extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y,Q,se,pe,he,_e,Ce,we,Oe,Je,ze,Ve,ke,je){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y,Q,se,pe,he,_e,Ce,we,Oe,Je,ze,Ve,ke,je)}emplace(r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y,Q,se,pe,he,_e,Ce,we,Oe,Je,ze,Ve,ke,je,Ne){const Te=34*r,it=17*r;return this.int16[Te+0]=l,this.int16[Te+1]=h,this.int16[Te+2]=m,this.int16[Te+3]=_,this.int16[Te+4]=x,this.int16[Te+5]=D,this.int16[Te+6]=C,this.int16[Te+7]=A,this.uint16[Te+8]=R,this.uint16[Te+9]=L,this.uint16[Te+10]=N,this.uint16[Te+11]=U,this.uint16[Te+12]=$,this.uint16[Te+13]=Y,this.uint16[Te+14]=Q,this.uint16[Te+15]=se,this.uint16[Te+16]=pe,this.uint16[Te+17]=he,this.uint16[Te+18]=_e,this.uint16[Te+19]=Ce,this.uint16[Te+20]=we,this.uint16[Te+21]=Oe,this.uint16[Te+22]=Je,this.uint32[it+12]=ze,this.float32[it+13]=Ve,this.float32[it+14]=ke,this.float32[it+15]=je,this.float32[it+16]=Ne,r}}le.prototype.bytesPerElement=68,$e("StructArrayLayout8i15ui1ul4f68",le);class oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}oe.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",oe);class be extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,h)}emplace(r,l,h,m){const _=3*r;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=m,r}}be.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",be);class de extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,l,h)}emplace(r,l,h,m){const _=4*r;return this.uint32[2*r+0]=l,this.uint16[_+2]=h,this.uint16[_+3]=m,r}}de.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",de);class ye extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const m=2*r;return this.uint16[m+0]=l,this.uint16[m+1]=h,r}}ye.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",ye);class Se extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}Se.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",Se);class Ae extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,m)}emplace(r,l,h,m,_){const x=4*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=m,this.float32[x+3]=_,r}}Ae.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",Ae);class fe extends ms{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Be(this.anchorPointX,this.anchorPointY)}}fe.prototype.size=20;class Re extends H{get(r){return new fe(this,r)}}$e("CollisionBoxArray",Re);class et extends ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}et.prototype.size=48;class st extends ie{get(r){return new et(this,r)}}$e("PlacedSymbolArray",st);class Yt extends ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Yt.prototype.size=68;class Ot extends le{get(r){return new Yt(this,r)}}$e("SymbolInstanceArray",Ot);class tt extends oe{getoffsetX(r){return this.float32[1*r+0]}}$e("GlyphOffsetArray",tt);class Ht extends be{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}$e("SymbolLineVertexArray",Ht);class Rt extends ms{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Rt.prototype.size=8;class At extends de{get(r){return new Rt(this,r)}}$e("FeatureIndexArray",At);class zn extends p{}class gs extends p{}class Ji extends b{}class Pi extends E{}class ki extends S{}class Xr extends T{}class Xs extends k{}class mr extends F{}class Nn extends B{}class rn extends X{}class gr extends V{}class er extends ee{}class dn extends ye{}const Ks=s([{name:"a_pos",components:2,type:"Int16"}],4),{members:gl}=Ks;class tr{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,m){let _=this.segments[this.segments.length-1];return r>tr.MAX_VERTEX_ARRAY_LENGTH&&kn(`Max vertices per segment is ${tr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!_||_.vertexLength+r>tr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==m&&(_.sortKey=m),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,m){return new tr([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function Bn(o,r){return 256*(o=ue(Math.floor(o),0,255))+ue(Math.floor(r),0,255)}tr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",tr);const li=s([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Tn={exports:{}},Ta=function(o,r){var l,h,m,_,x,D,C,A;for(h=o.length-(l=3&o.length),m=r,x=3432918353,D=461845907,A=0;A<h;)C=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,m=27492+(65535&(_=5*(65535&(m=(m^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*D+(((C>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(C=0,l){case 3:C^=(255&o.charCodeAt(A+2))<<16;case 2:C^=(255&o.charCodeAt(A+1))<<8;case 1:m^=C=(65535&(C=(C=(65535&(C^=255&o.charCodeAt(A)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*D+(((C>>>16)*D&65535)<<16)&4294967295}return m^=o.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},nu=function(o,r){for(var l,h=o.length,m=r^h,_=0;h>=4;)l=1540483477*(65535&(l=255&o.charCodeAt(_)|(255&o.charCodeAt(++_))<<8|(255&o.charCodeAt(++_))<<16|(255&o.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:m^=(255&o.charCodeAt(_+2))<<16;case 2:m^=(255&o.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&o.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};Tn.exports=Ta,Tn.exports.murmur3=Ta,Tn.exports.murmur2=nu;var Rh=Tn.exports;class cc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,m){this.ids.push(ru(r)),this.positions.push(l,h,m)}getPositions(r){const l=ru(r);let h=0,m=this.ids.length-1;for(;h<m;){const x=h+m>>1;this.ids[x]>=l?m=x:h=x+1}const _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(r,l){const h=new Float64Array(r.ids),m=new Uint32Array(r.positions);return yl(h,m,0,h.length-1),l&&l.push(h.buffer,m.buffer),{ids:h,positions:m}}static deserialize(r){const l=new cc;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function ru(o){const r=+o;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Rh(String(o))}function yl(o,r,l,h){for(;l<h;){const m=o[l+h>>1];let _=l-1,x=h+1;for(;;){do{_++}while(o[_]<m);do{x--}while(o[x]>m);if(_>=x)break;Aa(o,_,x),Aa(r,3*_,3*x),Aa(r,3*_+1,3*x+1),Aa(r,3*_+2,3*x+2)}x-l<h-x?(yl(o,r,l,x),l=x+1):(yl(o,r,x+1,h),h=x)}}function Aa(o,r,l){const h=o[r];o[r]=o[l],o[l]=h}$e("FeaturePositionMap",cc);class yo{constructor(r,l){this.gl=r.gl,this.location=l}}class iu extends yo{constructor(r,l){super(r,l),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class pf extends yo{constructor(r,l){super(r,l),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class _o extends yo{constructor(r,l){super(r,l),this.current=Wt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const su=new Float32Array(16);function Lh(o){return[Bn(255*o.r,255*o.g),Bn(255*o.b,255*o.a)]}class ou{constructor(r,l,h){this.value=r,this.uniformNames=l.map(m=>`u_${m}`),this.type=h}setUniform(r,l,h){r.set(h.constantOr(this.value))}getBinding(r,l,h){return"color"===this.type?new _o(r,l):new iu(r,l)}}class Ys{constructor(r,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=r.tlbr}setUniform(r,l,h,m){const _="u_pattern_to"===m?this.patternTo:"u_pattern_from"===m?this.patternFrom:"u_pixel_ratio_to"===m?this.pixelRatioTo:"u_pixel_ratio_from"===m?this.pixelRatioFrom:null;_&&r.set(_)}getBinding(r,l,h){return"u_pattern"===h.substr(0,9)?new pf(r,l):new iu(r,l)}}class Ps{constructor(r,l,h,m){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,l,h,m,_){const x=this.paintVertexArray.length,D=this.expression.evaluate(new Sn(0),l,{},m,[],_);this.paintVertexArray.resize(r),this._setPaintValue(x,r,D)}updatePaintArray(r,l,h,m){const _=this.expression.evaluate({zoom:0},h,m);this._setPaintValue(r,l,_)}_setPaintValue(r,l,h){if("color"===this.type){const m=Lh(h);for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=r;m<l;m++)this.paintVertexArray.emplace(m,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ks{constructor(r,l,h,m,_,x){this.expression=r,this.uniformNames=l.map(D=>`u_${D}_t`),this.type=h,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,l,h,m,_){const x=this.expression.evaluate(new Sn(this.zoom),l,{},m,[],_),D=this.expression.evaluate(new Sn(this.zoom+1),l,{},m,[],_),C=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(C,r,x,D)}updatePaintArray(r,l,h,m){const _=this.expression.evaluate({zoom:this.zoom},h,m),x=this.expression.evaluate({zoom:this.zoom+1},h,m);this._setPaintValue(r,l,_,x)}_setPaintValue(r,l,h,m){if("color"===this.type){const _=Lh(h),x=Lh(m);for(let D=r;D<l;D++)this.paintVertexArray.emplace(D,_[0],_[1],x[0],x[1])}else{for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l){const h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,m=ue(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);r.set(m)}getBinding(r,l,h){return new iu(r,l)}}class Zo{constructor(r,l,h,m,_,x){this.expression=r,this.type=l,this.useIntegerZoom=h,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,l,h){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(m,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,m,_){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(r,l,h,m){if(!m||!h)return;const{min:_,mid:x,max:D}=h,C=m[_],A=m[x],R=m[D];if(C&&A&&R)for(let L=r;L<l;L++)this.zoomInPaintVertexArray.emplace(L,A.tl[0],A.tl[1],A.br[0],A.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],A.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,A.tl[0],A.tl[1],A.br[0],A.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],A.pixelRatio,R.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,li.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,li.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class pm{constructor(r,l,h){this.binders={},this._buffers=[];const m=[];for(const _ in r.paint._values){if(!h(_))continue;const x=r.paint.get(_);if(!(x instanceof Yi&&Ei(x.property.specification)))continue;const D=hc(_,r.type),C=x.value,A=x.property.specification.type,R=x.property.useIntegerZoom,L=x.property.specification["property-type"],N="cross-faded"===L||"cross-faded-data-driven"===L;if("constant"===C.kind)this.binders[_]=N?new Ys(C.value,D):new ou(C.value,D,A),m.push(`/u_${_}`);else if("source"===C.kind||N){const U=Fh(_,A,"source");this.binders[_]=N?new Zo(C,A,R,l,U,r.id):new Ps(C,D,A,U),m.push(`/a_${_}`)}else{const U=Fh(_,A,"composite");this.binders[_]=new ks(C,D,A,R,l,U),m.push(`/z_${_}`)}}this.cacheKey=m.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof Ps||l instanceof ks?l.maxValue:0}populatePaintArrays(r,l,h,m,_){for(const x in this.binders){const D=this.binders[x];(D instanceof Ps||D instanceof ks||D instanceof Zo)&&D.populatePaintArray(r,l,h,m,_)}}setConstantPatternPositions(r,l){for(const h in this.binders){const m=this.binders[h];m instanceof Ys&&m.setConstantPatternPositions(r,l)}}updatePaintArrays(r,l,h,m,_){let x=!1;for(const D in r){const C=l.getPositions(D);for(const A of C){const R=h.feature(A.index);for(const L in this.binders){const N=this.binders[L];if((N instanceof Ps||N instanceof ks||N instanceof Zo)&&!0===N.expression.isStateDependent){const U=m.paint.get(L);N.expression=U.value,N.updatePaintArray(A.start,A.end,R,r[D],_),x=!0}}}}return x}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof ou||h instanceof Ys)&&r.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ps||h instanceof ks)for(let m=0;m<h.paintVertexAttributes.length;m++)r.push(h.paintVertexAttributes[m].name);else if(h instanceof Zo)for(let m=0;m<li.members.length;m++)r.push(li.members[m].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof ou||h instanceof Ys||h instanceof ks)for(const m of h.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,l){const h=[];for(const m in this.binders){const _=this.binders[m];if(_ instanceof ou||_ instanceof Ys||_ instanceof ks)for(const x of _.uniformNames)if(l[x]){const D=_.getBinding(r,l[x],x);h.push({name:x,property:m,binding:D})}}return h}setUniforms(r,l,h,m){for(const{name:_,property:x,binding:D}of l)this.binders[x].setUniform(D,m,h.get(x),_)}updatePaintBuffers(r){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(r&&h instanceof Zo){const m=2===r.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(h instanceof Ps||h instanceof ks)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof Ps||h instanceof ks||h instanceof Zo)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof Ps||l instanceof ks||l instanceof Zo)&&l.destroy()}}}class _l{constructor(r,l,h=(()=>!0)){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new pm(m,l,h);this.needsUpload=!1,this._featureMap=new cc,this._bufferOffset=0}populatePaintArrays(r,l,h,m,_,x){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(r,l,m,_,x);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,m){for(const _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,l,_,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function hc(o,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}function Fh(o,r,l){const m={"line-pattern":{source:Xr,composite:Xr},"fill-pattern":{source:Xr,composite:Xr},"fill-extrusion-pattern":{source:Xr,composite:Xr}}[o];return m&&m[l]||{color:{source:S,composite:Ae},number:{source:oe,composite:S}}[r][l]}$e("ConstantBinder",ou),$e("CrossFadedConstantBinder",Ys),$e("SourceExpressionBinder",Ps),$e("CrossFadedCompositeBinder",Zo),$e("CompositeExpressionBinder",ks),$e("ProgramConfiguration",pm,{omit:["_buffers"]}),$e("ProgramConfigurationSet",_l);var Wn=8192;const vl=Math.pow(2,14)-1,Oh=-vl-1;function Wo(o){const r=Wn/o.extent,l=o.loadGeometry();for(let h=0;h<l.length;h++){const m=l[h];for(let _=0;_<m.length;_++){const x=m[_],D=Math.round(x.x*r),C=Math.round(x.y*r);x.x=ue(D,Oh,vl),x.y=ue(C,Oh,vl),(D<x.x||D>x.x+1||C<x.y||C>x.y+1)&&kn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function ys(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?Wo(o):[]}}function dc(o,r,l,h,m){o.emplaceBack(2*r+(h+1)/2,2*l+(m+1)/2)}class Xo{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new zn,this.indexArray=new er,this.segments=new tr,this.programConfigurations=new _l(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h){const m=this.layers[0],_=[];let x=null,D=!1;"circle"===m.type&&(x=m.layout.get("circle-sort-key"),D=!x.isConstant());for(const{feature:C,id:A,index:R,sourceLayerIndex:L}of r){const N=this.layers[0]._featureFilter.needGeometry,U=ys(C,N);if(!this.layers[0]._featureFilter.filter(new Sn(this.zoom),U,h))continue;const $=D?x.evaluate(U,{},h):void 0,Y={id:A,properties:C.properties,type:C.type,sourceLayerIndex:L,index:R,geometry:N?U.geometry:Wo(C),patterns:{},sortKey:$};_.push(Y)}D&&_.sort((C,A)=>C.sortKey-A.sortKey);for(const C of _){const{geometry:A,index:R,sourceLayerIndex:L}=C,N=r[R].feature;this.addFeature(C,A,R,h),l.featureIndex.insert(N,A,R,L,this.index)}}update(r,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,gl),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,m){for(const _ of l)for(const x of _){const D=x.x,C=x.y;if(D<0||D>=Wn||C<0||C>=Wn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),R=A.vertexLength;dc(this.layoutVertexArray,D,C,-1,-1),dc(this.layoutVertexArray,D,C,1,-1),dc(this.layoutVertexArray,D,C,1,1),dc(this.layoutVertexArray,D,C,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},m)}}function fc(o,r){for(let l=0;l<o.length;l++)if(Ko(r,o[l]))return!0;for(let l=0;l<r.length;l++)if(Ko(o,r[l]))return!0;return!!mc(o,r)}function pc(o,r,l){return!!Ko(o,r)||!!zh(r,o,l)}function mm(o,r){if(1===o.length)return gc(r,o[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let m=0;m<h.length;m++)if(Ko(o,h[m]))return!0}for(let l=0;l<o.length;l++)if(gc(r,o[l]))return!0;for(let l=0;l<r.length;l++)if(mc(o,r[l]))return!0;return!1}function mf(o,r,l){if(o.length>1){if(mc(o,r))return!0;for(let h=0;h<r.length;h++)if(zh(r[h],o,l))return!0}for(let h=0;h<o.length;h++)if(zh(o[h],r,l))return!0;return!1}function mc(o,r){if(0===o.length||0===r.length)return!1;for(let l=0;l<o.length-1;l++){const h=o[l],m=o[l+1];for(let _=0;_<r.length-1;_++)if(gm(h,m,r[_],r[_+1]))return!0}return!1}function gm(o,r,l,h){return nn(o,l,h)!==nn(r,l,h)&&nn(o,r,l)!==nn(o,r,h)}function zh(o,r,l){const h=l*l;if(1===r.length)return o.distSqr(r[0])<h;for(let m=1;m<r.length;m++)if(xl(o,r[m-1],r[m])<h)return!0;return!1}function xl(o,r,l){const h=r.distSqr(l);if(0===h)return o.distSqr(r);const m=((o.x-r.x)*(l.x-r.x)+(o.y-r.y)*(l.y-r.y))/h;return o.distSqr(m<0?r:m>1?l:l.sub(r)._mult(m)._add(r))}function gc(o,r){let l,h,m,_=!1;for(let x=0;x<o.length;x++){l=o[x];for(let D=0,C=l.length-1;D<l.length;C=D++)h=l[D],m=l[C],h.y>r.y!=m.y>r.y&&r.x<(m.x-h.x)*(r.y-h.y)/(m.y-h.y)+h.x&&(_=!_)}return _}function Ko(o,r){let l=!1;for(let h=0,m=o.length-1;h<o.length;m=h++){const _=o[h],x=o[m];_.y>r.y!=x.y>r.y&&r.x<(x.x-_.x)*(r.y-_.y)/(x.y-_.y)+_.x&&(l=!l)}return l}function yc(o,r,l){const h=l[0],m=l[2];if(o.x<h.x&&r.x<h.x||o.x>m.x&&r.x>m.x||o.y<h.y&&r.y<h.y||o.y>m.y&&r.y>m.y)return!1;const _=nn(o,r,l[0]);return _!==nn(o,r,l[1])||_!==nn(o,r,l[2])||_!==nn(o,r,l[3])}function Yo(o,r,l){const h=r.paint.get(o).value;return"constant"===h.kind?h.value:l.programConfigurations.get(r.id).getMaxValue(o)}function _c(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function au(o,r,l,h,m){if(!r[0]&&!r[1])return o;const _=Be.convert(r)._mult(m);"viewport"===l&&_._rotate(-h);const x=[];for(let D=0;D<o.length;D++)x.push(o[D].sub(_));return x}$e("CircleBucket",Xo,{omit:["layers"]});const gf=new Zn({"circle-sort-key":new rt(ve.layout_circle["circle-sort-key"])});var yf={paint:new Zn({"circle-radius":new rt(ve.paint_circle["circle-radius"]),"circle-color":new rt(ve.paint_circle["circle-color"]),"circle-blur":new rt(ve.paint_circle["circle-blur"]),"circle-opacity":new rt(ve.paint_circle["circle-opacity"]),"circle-translate":new qe(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new qe(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qe(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qe(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rt(ve.paint_circle["circle-stroke-opacity"])}),layout:gf},Jo="undefined"!=typeof Float32Array?Float32Array:Array;function Nh(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function _f(o,r,l){var h=r[0],m=r[1],_=r[2],x=r[3],D=r[4],C=r[5],A=r[6],R=r[7],L=r[8],N=r[9],U=r[10],$=r[11],Y=r[12],Q=r[13],se=r[14],pe=r[15],he=l[0],_e=l[1],Ce=l[2],we=l[3];return o[0]=he*h+_e*D+Ce*L+we*Y,o[1]=he*m+_e*C+Ce*N+we*Q,o[2]=he*_+_e*A+Ce*U+we*se,o[3]=he*x+_e*R+Ce*$+we*pe,o[4]=(he=l[4])*h+(_e=l[5])*D+(Ce=l[6])*L+(we=l[7])*Y,o[5]=he*m+_e*C+Ce*N+we*Q,o[6]=he*_+_e*A+Ce*U+we*se,o[7]=he*x+_e*R+Ce*$+we*pe,o[8]=(he=l[8])*h+(_e=l[9])*D+(Ce=l[10])*L+(we=l[11])*Y,o[9]=he*m+_e*C+Ce*N+we*Q,o[10]=he*_+_e*A+Ce*U+we*se,o[11]=he*x+_e*R+Ce*$+we*pe,o[12]=(he=l[12])*h+(_e=l[13])*D+(Ce=l[14])*L+(we=l[15])*Y,o[13]=he*m+_e*C+Ce*N+we*Q,o[14]=he*_+_e*A+Ce*U+we*se,o[15]=he*x+_e*R+Ce*$+we*pe,o}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var vc=_f;function Ma(){var o=new Jo(4);return Jo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function xc(o,r,l,h){var m=new Jo(4);return m[0]=o,m[1]=r,m[2]=l,m[3]=h,m}function lu(o,r,l){var h=r[0],m=r[1],_=r[2],x=r[3];return o[0]=l[0]*h+l[4]*m+l[8]*_+l[12]*x,o[1]=l[1]*h+l[5]*m+l[9]*_+l[13]*x,o[2]=l[2]*h+l[6]*m+l[10]*_+l[14]*x,o[3]=l[3]*h+l[7]*m+l[11]*_+l[15]*x,o}function Bh(o,r){const l=lu(Ma(),xc(o.x,o.y,0,1),r);return new Be(l[0]/l[3],l[1]/l[3])}Ma();class Pa extends Xo{}$e("HeatmapBucket",Pa,{omit:["layers"]});var ym={paint:new Zn({"heatmap-radius":new rt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qe(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tu(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qe(ve.paint_heatmap["heatmap-opacity"])})};function uu(o,{width:r,height:l},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*l*h)throw new RangeError("mismatched image size")}else m=new Uint8Array(r*l*h);return o.width=r,o.height=l,o.data=m,o}function bl(o,{width:r,height:l},h){if(r===o.width&&l===o.height)return;const m=uu({},{width:r,height:l},h);Qo(o,m,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,r),height:Math.min(o.height,l)},h),o.width=r,o.height=l,o.data=m.data}function Qo(o,r,l,h,m,_){if(0===m.width||0===m.height)return r;if(m.width>o.width||m.height>o.height||l.x>o.width-m.width||l.y>o.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||h.x>r.width-m.width||h.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=o.data,D=r.data;for(let C=0;C<m.height;C++){const A=((l.y+C)*o.width+l.x)*_,R=((h.y+C)*r.width+h.x)*_;for(let L=0;L<m.width*_;L++)D[R+L]=x[A+L]}return r}class Js{constructor(r,l){uu(this,r,1,l)}resize(r){bl(this,r,1)}clone(){return new Js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,m,_){Qo(r,l,h,m,_,1)}}class Ar{constructor(r,l){uu(this,r,4,l)}resize(r){bl(this,r,4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ar({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,m,_){Qo(r,l,h,m,_,4)}}function Vh(o){const r={},l=o.resolution||256,h=o.clips?o.clips.length:1,m=o.image||new Ar({width:l,height:h}),_=(x,D,C)=>{r[o.evaluationKey]=C;const A=o.expression.evaluate(r);m.data[x+D+0]=Math.floor(255*A.r/A.a),m.data[x+D+1]=Math.floor(255*A.g/A.a),m.data[x+D+2]=Math.floor(255*A.b/A.a),m.data[x+D+3]=Math.floor(255*A.a)};if(o.clips)for(let x=0,D=0;x<h;++x,D+=4*l)for(let C=0,A=0;C<l;C++,A+=4){const R=C/(l-1),{start:L,end:N}=o.clips[x];_(D,A,L*(1-R)+N*R)}else for(let x=0,D=0;x<l;x++,D+=4)_(0,D,x/(l-1));return m}$e("AlphaImage",Js),$e("RGBAImage",Ar);var Uh={paint:new Zn({"hillshade-illumination-direction":new qe(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qe(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qe(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qe(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qe(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qe(ve.paint_hillshade["hillshade-accent-color"])})};const wl=s([{name:"a_pos",components:2,type:"Int16"}],4),{members:b_}=wl;var jh={exports:{}};function qt(o,r,l){l=l||2;var h,m,_,x,D,C,A,R=r&&r.length,L=R?r[0]*l:o.length,N=vf(o,0,L,l,!0),U=[];if(!N||N.next===N.prev)return U;if(R&&(N=function(Y,Q,se,pe){var he,_e,Ce,we=[];for(he=0,_e=Q.length;he<_e;he++)(Ce=vf(Y,Q[he]*pe,he<_e-1?Q[he+1]*pe:Y.length,pe,!1))===Ce.next&&(Ce.steiner=!0),we.push(du(Ce));for(we.sort(cu),he=0;he<we.length;he++)se=ka(se=S_(we[he],se),se.next);return se}(o,r,N,l)),o.length>80*l){h=_=o[0],m=x=o[1];for(var $=l;$<L;$+=l)(D=o[$])<h&&(h=D),(C=o[$+1])<m&&(m=C),D>_&&(_=D),C>x&&(x=C);A=0!==(A=Math.max(_-h,x-m))?1/A:0}return bc(N,U,l,h,m,A),U}function vf(o,r,l,h,m){var _,x;if(m===Dc(o,r,l,h)>0)for(_=r;_<l;_+=h)x=bf(_,o[_],o[_+1],x);else for(_=l-h;_>=r;_-=h)x=bf(_,o[_],o[_+1],x);return x&&Qi(x,x.next)&&(wc(x),x=x.next),x}function ka(o,r){if(!o)return o;r||(r=o);var l,h=o;do{if(l=!1,h.steiner||!Qi(h,h.next)&&0!==Qt(h.prev,h,h.next))h=h.next;else{if(wc(h),(h=r=h.prev)===h.next)break;l=!0}}while(l||h!==r);return r}function bc(o,r,l,h,m,_,x){if(o){!x&&_&&function(R,L,N,U){var $=R;do{null===$.z&&($.z=hu($.x,$.y,L,N,U)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==R);$.prevZ.nextZ=null,$.prevZ=null,function(Y){var Q,se,pe,he,_e,Ce,we,Oe,Je=1;do{for(se=Y,Y=null,_e=null,Ce=0;se;){for(Ce++,pe=se,we=0,Q=0;Q<Je&&(we++,pe=pe.nextZ);Q++);for(Oe=Je;we>0||Oe>0&&pe;)0!==we&&(0===Oe||!pe||se.z<=pe.z)?(he=se,se=se.nextZ,we--):(he=pe,pe=pe.nextZ,Oe--),_e?_e.nextZ=he:Y=he,he.prevZ=_e,_e=he;se=pe}_e.nextZ=null,Je*=2}while(Ce>1)}($)}(o,h,m,_);for(var D,C,A=o;o.prev!==o.next;)if(D=o.prev,C=o.next,_?D_(o,h,m,_):w_(o))r.push(D.i/l),r.push(o.i/l),r.push(C.i/l),wc(o),o=C.next,A=C.next;else if((o=C)===A){x?1===x?bc(o=E_(ka(o),r,l),r,l,h,m,_,2):2===x&&C_(o,r,l,h,m,_):bc(ka(o),r,l,h,m,_,1);break}}}function w_(o){var r=o.prev,l=o,h=o.next;if(Qt(r,l,h)>=0)return!1;for(var m=o.next.next;m!==o.prev;){if(fu(r.x,r.y,l.x,l.y,h.x,h.y,m.x,m.y)&&Qt(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function D_(o,r,l,h){var m=o.prev,_=o,x=o.next;if(Qt(m,_,x)>=0)return!1;for(var D=m.x>_.x?m.x>x.x?m.x:x.x:_.x>x.x?_.x:x.x,C=m.y>_.y?m.y>x.y?m.y:x.y:_.y>x.y?_.y:x.y,A=hu(m.x<_.x?m.x<x.x?m.x:x.x:_.x<x.x?_.x:x.x,m.y<_.y?m.y<x.y?m.y:x.y:_.y<x.y?_.y:x.y,r,l,h),R=hu(D,C,r,l,h),L=o.prevZ,N=o.nextZ;L&&L.z>=A&&N&&N.z<=R;){if(L!==o.prev&&L!==o.next&&fu(m.x,m.y,_.x,_.y,x.x,x.y,L.x,L.y)&&Qt(L.prev,L,L.next)>=0||(L=L.prevZ,N!==o.prev&&N!==o.next&&fu(m.x,m.y,_.x,_.y,x.x,x.y,N.x,N.y)&&Qt(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;L&&L.z>=A;){if(L!==o.prev&&L!==o.next&&fu(m.x,m.y,_.x,_.y,x.x,x.y,L.x,L.y)&&Qt(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;N&&N.z<=R;){if(N!==o.prev&&N!==o.next&&fu(m.x,m.y,_.x,_.y,x.x,x.y,N.x,N.y)&&Qt(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function E_(o,r,l){var h=o;do{var m=h.prev,_=h.next.next;!Qi(m,_)&&$h(m,h,h.next,_)&&Dl(m,_)&&Dl(_,m)&&(r.push(m.i/l),r.push(h.i/l),r.push(_.i/l),wc(h),wc(h.next),h=o=_),h=h.next}while(h!==o);return ka(h)}function C_(o,r,l,h,m,_){var x=o;do{for(var D=x.next.next;D!==x.prev;){if(x.i!==D.i&&_m(x,D)){var C=xf(x,D);return x=ka(x,x.next),C=ka(C,C.next),bc(x,r,l,h,m,_),void bc(C,r,l,h,m,_)}D=D.next}x=x.next}while(x!==o)}function cu(o,r){return o.x-r.x}function S_(o,r){var l=function(_,x){var D,C=x,A=_.x,R=_.y,L=-1/0;do{if(R<=C.y&&R>=C.next.y&&C.next.y!==C.y){var N=C.x+(R-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(N<=A&&N>L){if(L=N,N===A){if(R===C.y)return C;if(R===C.next.y)return C.next}D=C.x<C.next.x?C:C.next}}C=C.next}while(C!==x);if(!D)return null;if(A===L)return D;var U,$=D,Y=D.x,Q=D.y,se=1/0;C=D;do{A>=C.x&&C.x>=Y&&A!==C.x&&fu(R<Q?A:L,R,Y,Q,R<Q?L:A,R,C.x,C.y)&&(U=Math.abs(R-C.y)/(A-C.x),Dl(C,_)&&(U<se||U===se&&(C.x>D.x||C.x===D.x&&wr(D,C)))&&(D=C,se=U)),C=C.next}while(C!==$);return D}(o,r);if(!l)return r;var h=xf(l,o),m=ka(l,l.next);return ka(h,h.next),r===l?m:r}function wr(o,r){return Qt(o.prev,o,r.prev)<0&&Qt(r.next,o,o.next)<0}function hu(o,r,l,h,m){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-l)*m)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-h)*m)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function du(o){var r=o,l=o;do{(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next}while(r!==o);return l}function fu(o,r,l,h,m,_,x,D){return(m-x)*(r-D)-(o-x)*(_-D)>=0&&(o-x)*(h-D)-(l-x)*(r-D)>=0&&(l-x)*(_-D)-(m-x)*(h-D)>=0}function _m(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(l,h){var m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==h.i&&m.next.i!==h.i&&$h(m,m.next,l,h))return!0;m=m.next}while(m!==l);return!1}(o,r)&&(Dl(o,r)&&Dl(r,o)&&function(l,h){var m=l,_=!1,x=(l.x+h.x)/2,D=(l.y+h.y)/2;do{m.y>D!=m.next.y>D&&m.next.y!==m.y&&x<(m.next.x-m.x)*(D-m.y)/(m.next.y-m.y)+m.x&&(_=!_),m=m.next}while(m!==l);return _}(o,r)&&(Qt(o.prev,o,r.prev)||Qt(o,r.prev,r))||Qi(o,r)&&Qt(o.prev,o,o.next)>0&&Qt(r.prev,r,r.next)>0)}function Qt(o,r,l){return(r.y-o.y)*(l.x-r.x)-(r.x-o.x)*(l.y-r.y)}function Qi(o,r){return o.x===r.x&&o.y===r.y}function $h(o,r,l,h){var m=ea(Qt(o,r,l)),_=ea(Qt(o,r,h)),x=ea(Qt(l,h,o)),D=ea(Qt(l,h,r));return m!==_&&x!==D||!(0!==m||!Ra(o,l,r))||!(0!==_||!Ra(o,h,r))||!(0!==x||!Ra(l,o,h))||!(0!==D||!Ra(l,r,h))}function Ra(o,r,l){return r.x<=Math.max(o.x,l.x)&&r.x>=Math.min(o.x,l.x)&&r.y<=Math.max(o.y,l.y)&&r.y>=Math.min(o.y,l.y)}function ea(o){return o>0?1:o<0?-1:0}function Dl(o,r){return Qt(o.prev,o,o.next)<0?Qt(o,r,o.next)>=0&&Qt(o,o.prev,r)>=0:Qt(o,r,o.prev)<0||Qt(o,o.next,r)<0}function xf(o,r){var l=new wf(o.i,o.x,o.y),h=new wf(r.i,r.x,r.y),m=o.next,_=r.prev;return o.next=r,r.prev=o,l.next=m,m.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function bf(o,r,l,h){var m=new wf(o,r,l);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function wc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function wf(o,r,l){this.i=o,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dc(o,r,l,h){for(var m=0,_=r,x=l-h;_<l;_+=h)m+=(o[x]-o[_])*(o[_+1]+o[x+1]),x=_;return m}jh.exports=qt,jh.exports.default=qt,qt.deviation=function(o,r,l,h){var m=r&&r.length,_=Math.abs(Dc(o,0,m?r[0]*l:o.length,l));if(m)for(var x=0,D=r.length;x<D;x++)_-=Math.abs(Dc(o,r[x]*l,x<D-1?r[x+1]*l:o.length,l));var C=0;for(x=0;x<h.length;x+=3){var A=h[x]*l,R=h[x+1]*l,L=h[x+2]*l;C+=Math.abs((o[A]-o[L])*(o[R+1]-o[A+1])-(o[A]-o[R])*(o[L+1]-o[A+1]))}return 0===_&&0===C?0:Math.abs((C-_)/_)},qt.flatten=function(o){for(var r=o[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,m=0;m<o.length;m++){for(var _=0;_<o[m].length;_++)for(var x=0;x<r;x++)l.vertices.push(o[m][_][x]);m>0&&l.holes.push(h+=o[m-1].length)}return l};var Ri=jh.exports;function Hh(o,r,l,h,m){La(o,r,l||0,h||o.length-1,m||Df)}function La(o,r,l,h,m){for(;h>l;){if(h-l>600){var _=h-l+1,x=r-l+1,D=Math.log(_),C=.5*Math.exp(2*D/3),A=.5*Math.sqrt(D*C*(_-C)/_)*(x-_/2<0?-1:1);La(o,r,Math.max(l,Math.floor(r-x*C/_+A)),Math.min(h,Math.floor(r+(_-x)*C/_+A)),m)}var R=o[r],L=l,N=h;for(Ec(o,l,r),m(o[h],R)>0&&Ec(o,l,h);L<N;){for(Ec(o,L,N),L++,N--;m(o[L],R)<0;)L++;for(;m(o[N],R)>0;)N--}0===m(o[l],R)?Ec(o,l,N):Ec(o,++N,h),N<=r&&(l=N+1),r<=N&&(h=N-1)}}function Ec(o,r,l){var h=o[r];o[r]=o[l],o[l]=h}function Df(o,r){return o<r?-1:o>r?1:0}function qh(o,r){const l=o.length;if(l<=1)return[o];const h=[];let m,_;for(let x=0;x<l;x++){const D=ot(o[x]);0!==D&&(o[x].area=Math.abs(D),void 0===_&&(_=D<0),_===D<0?(m&&h.push(m),m=[o[x]]):m.push(o[x]))}if(m&&h.push(m),r>1)for(let x=0;x<h.length;x++)h[x].length<=r||(Hh(h[x],r,1,h[x].length-1,vm),h[x]=h[x].slice(0,r));return h}function vm(o,r){return r.area-o.area}function Gh(o,r,l){const h=l.patternDependencies;let m=!1;for(const _ of r){const x=_.paint.get(`${o}-pattern`);x.isConstant()||(m=!0);const D=x.constantOr(null);D&&(m=!0,h[D.to]=!0,h[D.from]=!0)}return m}function Zh(o,r,l,h,m){const _=m.patternDependencies;for(const x of r){const D=x.paint.get(`${o}-pattern`).value;if("constant"!==D.kind){let C=D.evaluate({zoom:h-1},l,{},m.availableImages),A=D.evaluate({zoom:h},l,{},m.availableImages),R=D.evaluate({zoom:h+1},l,{},m.availableImages);C=C&&C.name?C.name:C,A=A&&A.name?A.name:A,R=R&&R.name?R.name:R,_[C]=!0,_[A]=!0,_[R]=!0,l.patterns[x.id]={min:C,mid:A,max:R}}}return l}class Wh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gs,this.indexArray=new er,this.indexArray2=new dn,this.programConfigurations=new _l(r.layers,r.zoom),this.segments=new tr,this.segments2=new tr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h){this.hasPattern=Gh("fill",this.layers,l);const m=this.layers[0].layout.get("fill-sort-key"),_=!m.isConstant(),x=[];for(const{feature:D,id:C,index:A,sourceLayerIndex:R}of r){const L=this.layers[0]._featureFilter.needGeometry,N=ys(D,L);if(!this.layers[0]._featureFilter.filter(new Sn(this.zoom),N,h))continue;const U=_?m.evaluate(N,{},h,l.availableImages):void 0,$={id:C,properties:D.properties,type:D.type,sourceLayerIndex:R,index:A,geometry:L?N.geometry:Wo(D),patterns:{},sortKey:U};x.push($)}_&&x.sort((D,C)=>D.sortKey-C.sortKey);for(const D of x){const{geometry:C,index:A,sourceLayerIndex:R}=D;if(this.hasPattern){const L=Zh("fill",this.layers,D,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(D,C,A,h,{});l.featureIndex.insert(r[A].feature,C,A,R,this.index)}}update(r,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h)}addFeatures(r,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,b_),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,m,_){for(const x of qh(l,500)){let D=0;for(const U of x)D+=U.length;const C=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),A=C.vertexLength,R=[],L=[];for(const U of x){if(0===U.length)continue;U!==x[0]&&L.push(R.length/2);const $=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Y=$.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Y+U.length-1,Y),R.push(U[0].x),R.push(U[0].y);for(let Q=1;Q<U.length;Q++)this.layoutVertexArray.emplaceBack(U[Q].x,U[Q].y),this.indexArray2.emplaceBack(Y+Q-1,Y+Q),R.push(U[Q].x),R.push(U[Q].y);$.vertexLength+=U.length,$.primitiveLength+=U.length}const N=Ri(R,L);for(let U=0;U<N.length;U+=3)this.indexArray.emplaceBack(A+N[U],A+N[U+1],A+N[U+2]);C.vertexLength+=D,C.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,m)}}$e("FillBucket",Wh,{omit:["layers","patternFeatures"]});const Ef=new Zn({"fill-sort-key":new rt(ve.layout_fill["fill-sort-key"])});var Xh={paint:new Zn({"fill-antialias":new qe(ve.paint_fill["fill-antialias"]),"fill-opacity":new rt(ve.paint_fill["fill-opacity"]),"fill-color":new rt(ve.paint_fill["fill-color"]),"fill-outline-color":new rt(ve.paint_fill["fill-outline-color"]),"fill-translate":new qe(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new qe(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(ve.paint_fill["fill-pattern"])}),layout:Ef};const Cc=s([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:I_}=Cc;var _s={},Sc=vo;function vo(o,r){this.x=o,this.y=r}vo.prototype={clone:function(){return new vo(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,l=o.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),l=Math.sin(o),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(o,r){var l=Math.cos(o),h=Math.sin(o),m=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vo.convert=function(o){return o instanceof vo?o:Array.isArray(o)?new vo(o[0],o[1]):o};var xm=Sc,Cf=El;function El(o,r,l,h,m){this.properties={},this.extent=l,this.type=0,this._pbf=o,this._geometry=-1,this._keys=h,this._values=m,o.readFields(Sf,this,r)}function Sf(o,r,l){1==o?r.id=l.readVarint():2==o?function(h,m){for(var _=h.readVarint()+h.pos;h.pos<_;){var x=m._keys[h.readVarint()],D=m._values[h.readVarint()];m.properties[x]=D}}(l,r):3==o?r.type=l.readVarint():4==o&&(r._geometry=l.pos)}function bm(o){for(var r,l,h=0,m=0,_=o.length,x=_-1;m<_;x=m++)h+=((l=o[x]).x-(r=o[m]).x)*(r.y+l.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,l=o.readVarint()+o.pos,h=1,m=0,_=0,x=0,D=[];o.pos<l;){if(m<=0){var C=o.readVarint();h=7&C,m=C>>3}if(m--,1===h||2===h)_+=o.readSVarint(),x+=o.readSVarint(),1===h&&(r&&D.push(r),r=[]),r.push(new xm(_,x));else{if(7!==h)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&D.push(r),D},El.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,l=1,h=0,m=0,_=0,x=1/0,D=-1/0,C=1/0,A=-1/0;o.pos<r;){if(h<=0){var R=o.readVarint();l=7&R,h=R>>3}if(h--,1===l||2===l)(m+=o.readSVarint())<x&&(x=m),m>D&&(D=m),(_+=o.readSVarint())<C&&(C=_),_>A&&(A=_);else if(7!==l)throw new Error("unknown command "+l)}return[x,C,D,A]},El.prototype.toGeoJSON=function(o,r,l){var h,m,_=this.extent*Math.pow(2,l),x=this.extent*o,D=this.extent*r,C=this.loadGeometry(),A=El.types[this.type];function R(U){for(var $=0;$<U.length;$++){var Y=U[$];U[$]=[360*(Y.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+D)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(h=0;h<C.length;h++)L[h]=C[h][0];R(C=L);break;case 2:for(h=0;h<C.length;h++)R(C[h]);break;case 3:for(C=function(U){var $=U.length;if($<=1)return[U];for(var Y,Q,se=[],pe=0;pe<$;pe++){var he=bm(U[pe]);0!==he&&(void 0===Q&&(Q=he<0),Q===he<0?(Y&&se.push(Y),Y=[U[pe]]):Y.push(U[pe]))}return Y&&se.push(Y),se}(C),h=0;h<C.length;h++)for(m=0;m<C[h].length;m++)R(C[h][m])}1===C.length?C=C[0]:A="Multi"+A;var N={type:"Feature",geometry:{type:A,coordinates:C},properties:this.properties};return"id"in this&&(N.id=this.id),N};var pu=Cf,Kh=If;function If(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(vt,this,r),this.length=this._features.length}function vt(o,r,l){15===o?r.version=l.readVarint():1===o?r.name=l.readString():5===o?r.extent=l.readVarint():2===o?r._features.push(l.pos):3===o?r._keys.push(l.readString()):4===o&&r._values.push(function(h){for(var m=null,_=h.readVarint()+h.pos;h.pos<_;){var x=h.readVarint()>>3;m=1===x?h.readString():2===x?h.readFloat():3===x?h.readDouble():4===x?h.readVarint64():5===x?h.readVarint():6===x?h.readSVarint():7===x?h.readBoolean():null}return m}(l))}If.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new pu(this._pbf,r,this.extent,this._keys,this._values)};var Tf=Kh;function T_(o,r,l){if(3===o){var h=new Tf(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}_s.VectorTile=function(o,r){this.layers=o.readFields(T_,{},r)},_s.VectorTileFeature=Cf,_s.VectorTileLayer=Kh;const Yh=_s.VectorTileFeature.types,Fa=Math.pow(2,13);function mu(o,r,l,h,m,_,x,D){o.emplaceBack(r,l,2*Math.floor(h*Fa)+x,m*Fa*2,_*Fa*2,Math.round(D))}class Jh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Ji,this.indexArray=new er,this.programConfigurations=new _l(r.layers,r.zoom),this.segments=new tr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h){this.features=[],this.hasPattern=Gh("fill-extrusion",this.layers,l);for(const{feature:m,id:_,index:x,sourceLayerIndex:D}of r){const C=this.layers[0]._featureFilter.needGeometry,A=ys(m,C);if(!this.layers[0]._featureFilter.filter(new Sn(this.zoom),A,h))continue;const R={id:_,sourceLayerIndex:D,index:x,geometry:C?A.geometry:Wo(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Zh("fill-extrusion",this.layers,R,this.zoom,l)):this.addFeature(R,R.geometry,x,h,{}),l.featureIndex.insert(m,R.geometry,x,D,this.index,!0)}}addFeatures(r,l,h){for(const m of this.features){const{geometry:_}=m;this.addFeature(m,_,m.index,l,h)}}update(r,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,I_),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,m,_){for(const x of qh(l,500)){let D=0;for(const U of x)D+=U.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of x){if(0===U.length||gu(U))continue;let $=0;for(let Y=0;Y<U.length;Y++){const Q=U[Y];if(Y>=1){const se=U[Y-1];if(!wm(Q,se)){C.vertexLength+4>tr.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=Q.sub(se)._perp()._unit(),he=se.dist(Q);$+he>32768&&($=0),mu(this.layoutVertexArray,Q.x,Q.y,pe.x,pe.y,0,0,$),mu(this.layoutVertexArray,Q.x,Q.y,pe.x,pe.y,0,1,$),$+=he,mu(this.layoutVertexArray,se.x,se.y,pe.x,pe.y,0,0,$),mu(this.layoutVertexArray,se.x,se.y,pe.x,pe.y,0,1,$);const _e=C.vertexLength;this.indexArray.emplaceBack(_e,_e+2,_e+1),this.indexArray.emplaceBack(_e+1,_e+2,_e+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+D>tr.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),"Polygon"!==Yh[r.type])continue;const A=[],R=[],L=C.vertexLength;for(const U of x)if(0!==U.length){U!==x[0]&&R.push(A.length/2);for(let $=0;$<U.length;$++){const Y=U[$];mu(this.layoutVertexArray,Y.x,Y.y,0,0,1,1,0),A.push(Y.x),A.push(Y.y)}}const N=Ri(A,R);for(let U=0;U<N.length;U+=3)this.indexArray.emplaceBack(L+N[U],L+N[U+2],L+N[U+1]);C.primitiveLength+=N.length/3,C.vertexLength+=D}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,m)}}function wm(o,r){return o.x===r.x&&(o.x<0||o.x>Wn)||o.y===r.y&&(o.y<0||o.y>Wn)}function gu(o){return o.every(r=>r.x<0)||o.every(r=>r.x>Wn)||o.every(r=>r.y<0)||o.every(r=>r.y>Wn)}$e("FillExtrusionBucket",Jh,{omit:["layers","features"]});var Qs={paint:new Zn({"fill-extrusion-opacity":new qe(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qe(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qe(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qe(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Cl(o,r){return o.x*r.x+o.y*r.y}function Oa(o,r){if(1===o.length){let l=0;const h=r[l++];let m;for(;!m||h.equals(m);)if(m=r[l++],!m)return 1/0;for(;l<r.length;l++){const _=r[l],x=o[0],D=m.sub(h),C=_.sub(h),A=x.sub(h),R=Cl(D,D),L=Cl(D,C),N=Cl(C,C),U=Cl(A,D),$=Cl(A,C),Y=R*N-L*L,Q=(N*U-L*$)/Y,se=(R*$-L*U)/Y,pe=h.z*(1-Q-se)+m.z*Q+_.z*se;if(isFinite(pe))return pe}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}const Dm=s([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Af}=Dm,Qh=s([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ic}=Qh,Mf=_s.VectorTileFeature.types,Em=Math.cos(Math.PI/180*37.5),Pf=Math.pow(2,14)/.5;class ta{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Pi,this.layoutVertexArray2=new ki,this.indexArray=new er,this.programConfigurations=new _l(r.layers,r.zoom),this.segments=new tr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h){this.hasPattern=Gh("line",this.layers,l);const m=this.layers[0].layout.get("line-sort-key"),_=!m.isConstant(),x=[];for(const{feature:D,id:C,index:A,sourceLayerIndex:R}of r){const L=this.layers[0]._featureFilter.needGeometry,N=ys(D,L);if(!this.layers[0]._featureFilter.filter(new Sn(this.zoom),N,h))continue;const U=_?m.evaluate(N,{},h):void 0,$={id:C,properties:D.properties,type:D.type,sourceLayerIndex:R,index:A,geometry:L?N.geometry:Wo(D),patterns:{},sortKey:U};x.push($)}_&&x.sort((D,C)=>D.sortKey-C.sortKey);for(const D of x){const{geometry:C,index:A,sourceLayerIndex:R}=D;if(this.hasPattern){const L=Zh("line",this.layers,D,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(D,C,A,h,{});l.featureIndex.insert(r[A].feature,C,A,R,this.index)}}update(r,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h)}addFeatures(r,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Ic)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Af),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,m,_){const x=this.layers[0].layout,D=x.get("line-join").evaluate(r,{}),C=x.get("line-cap"),A=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const L of l)this.addLine(L,r,D,C,A,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,m)}addLine(r,l,h,m,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<r.length-1;se++)this.totalDistance+=r[se].dist(r[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===Mf[l.type];let C=r.length;for(;C>=2&&r[C-1].equals(r[C-2]);)C--;let A=0;for(;A<C-1&&r[A].equals(r[A+1]);)A++;if(C<(D?3:2))return;"bevel"===h&&(_=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let N,U,$,Y,Q;this.e1=this.e2=-1,D&&(N=r[C-2],Q=r[A].sub(N)._unit()._perp());for(let se=A;se<C;se++){if($=se===C-1?D?r[A+1]:void 0:r[se+1],$&&r[se].equals($))continue;Q&&(Y=Q),N&&(U=N),N=r[se],Q=$?$.sub(N)._unit()._perp():Y,Y=Y||Q;let pe=Y.add(Q);0===pe.x&&0===pe.y||pe._unit();const he=Y.x*Q.x+Y.y*Q.y,_e=pe.x*Q.x+pe.y*Q.y,Ce=0!==_e?1/_e:1/0,we=2*Math.sqrt(2-2*_e),Oe=_e<Em&&U&&$,Je=Y.x*Q.y-Y.y*Q.x>0;if(Oe&&se>A){const ke=N.dist(U);if(ke>2*R){const je=N.sub(N.sub(U)._mult(R/ke)._round());this.updateDistance(U,je),this.addCurrentVertex(je,Y,0,0,L),U=je}}const ze=U&&$;let Ve=ze?h:D?"butt":m;if(ze&&"round"===Ve&&(Ce<x?Ve="miter":Ce<=2&&(Ve="fakeround")),"miter"===Ve&&Ce>_&&(Ve="bevel"),"bevel"===Ve&&(Ce>2&&(Ve="flipbevel"),Ce<_&&(Ve="miter")),U&&this.updateDistance(U,N),"miter"===Ve)pe._mult(Ce),this.addCurrentVertex(N,pe,0,0,L);else if("flipbevel"===Ve){if(Ce>100)pe=Q.mult(-1);else{const ke=Ce*Y.add(Q).mag()/Y.sub(Q).mag();pe._perp()._mult(ke*(Je?-1:1))}this.addCurrentVertex(N,pe,0,0,L),this.addCurrentVertex(N,pe.mult(-1),0,0,L)}else if("bevel"===Ve||"fakeround"===Ve){const ke=-Math.sqrt(Ce*Ce-1),je=Je?ke:0,Ne=Je?0:ke;if(U&&this.addCurrentVertex(N,Y,je,Ne,L),"fakeround"===Ve){const Te=Math.round(180*we/Math.PI/20);for(let it=1;it<Te;it++){let Qe=it/Te;if(.5!==Qe){const Ut=Qe-.5;Qe+=Qe*Ut*(Qe-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Ut*Ut+(.848013+he*(.215638*he-1.06021)))}const Lt=Q.sub(Y)._mult(Qe)._add(Y)._unit()._mult(Je?-1:1);this.addHalfVertex(N,Lt.x,Lt.y,!1,Je,0,L)}}$&&this.addCurrentVertex(N,Q,-je,-Ne,L)}else if("butt"===Ve)this.addCurrentVertex(N,pe,0,0,L);else if("square"===Ve){const ke=U?1:-1;this.addCurrentVertex(N,pe,ke,ke,L)}else"round"===Ve&&(U&&(this.addCurrentVertex(N,Y,0,0,L),this.addCurrentVertex(N,Y,1,1,L,!0)),$&&(this.addCurrentVertex(N,Q,-1,-1,L,!0),this.addCurrentVertex(N,Q,0,0,L)));if(Oe&&se<C-1){const ke=N.dist($);if(ke>2*R){const je=N.add($.sub(N)._mult(R/ke)._round());this.updateDistance(N,je),this.addCurrentVertex(je,Q,0,0,L),N=je}}}}addCurrentVertex(r,l,h,m,_,x=!1){const D=l.y*m-l.x,C=-l.y-l.x*m;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,x,!1,h,_),this.addHalfVertex(r,D,C,x,!0,-m,_),this.distance>Pf/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(r,l,h,m,_,x))}addHalfVertex({x:r,y:l},h,m,_,x,D,C){const A=.5*(this.lineClips?this.scaledDistance*(Pf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(_?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(0===D?0:D<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),C.primitiveLength++),x?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}$e("LineBucket",ta,{omit:["layers","patternFeatures"]});const yu=new Zn({"line-cap":new qe(ve.layout_line["line-cap"]),"line-join":new rt(ve.layout_line["line-join"]),"line-miter-limit":new qe(ve.layout_line["line-miter-limit"]),"line-round-limit":new qe(ve.layout_line["line-round-limit"]),"line-sort-key":new rt(ve.layout_line["line-sort-key"])});var kf={paint:new Zn({"line-opacity":new rt(ve.paint_line["line-opacity"]),"line-color":new rt(ve.paint_line["line-color"]),"line-translate":new qe(ve.paint_line["line-translate"]),"line-translate-anchor":new qe(ve.paint_line["line-translate-anchor"]),"line-width":new rt(ve.paint_line["line-width"]),"line-gap-width":new rt(ve.paint_line["line-gap-width"]),"line-offset":new rt(ve.paint_line["line-offset"]),"line-blur":new rt(ve.paint_line["line-blur"]),"line-dasharray":new eu(ve.paint_line["line-dasharray"]),"line-pattern":new yn(ve.paint_line["line-pattern"]),"line-gradient":new tu(ve.paint_line["line-gradient"])}),layout:yu};const Cm=new class extends rt{possiblyEvaluate(o,r){return r=new Sn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,l,h){return r=Pt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,l,h)}}(kf.paint.properties["line-width"].specification);function ed(o,r){return r>0?r+2*o:o}Cm.useIntegerZoom=!0;const Sm=s([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),A_=s([{name:"a_projected_pos",components:3,type:"Float32"}],4);s([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Im=s([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);s([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rf=s([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tm=s([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Tc(o,r,l){return o.sections.forEach(h=>{h.text=function(m,_,x){const D=_.layout.get("text-transform").evaluate(x,{});return"uppercase"===D?m=m.toLocaleUpperCase():"lowercase"===D&&(m=m.toLocaleLowerCase()),ai.applyArabicShaping&&(m=ai.applyArabicShaping(m)),m}(h.text,r,l)}),o}s([{name:"triangle",components:3,type:"Uint16"}]),s([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),s([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),s([{type:"Float32",name:"offsetX"}]),s([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const za={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var td=en,Lf=function(o,r,l,h,m){var _,x,D=8*m-h-1,C=(1<<D)-1,A=C>>1,R=-7,L=l?m-1:0,N=l?-1:1,U=o[r+L];for(L+=N,_=U&(1<<-R)-1,U>>=-R,R+=D;R>0;_=256*_+o[r+L],L+=N,R-=8);for(x=_&(1<<-R)-1,_>>=-R,R+=h;R>0;x=256*x+o[r+L],L+=N,R-=8);if(0===_)_=1-A;else{if(_===C)return x?NaN:1/0*(U?-1:1);x+=Math.pow(2,h),_-=A}return(U?-1:1)*x*Math.pow(2,_-h)},Am=function(o,r,l,h,m,_){var x,D,C,A=8*_-m-1,R=(1<<A)-1,L=R>>1,N=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,U=h?0:_-1,$=h?1:-1,Y=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(D=isNaN(r)?1:0,x=R):(x=Math.floor(Math.log(r)/Math.LN2),r*(C=Math.pow(2,-x))<1&&(x--,C*=2),(r+=x+L>=1?N/C:N*Math.pow(2,1-L))*C>=2&&(x++,C/=2),x+L>=R?(D=0,x=R):x+L>=1?(D=(r*C-1)*Math.pow(2,m),x+=L):(D=r*Math.pow(2,L-1)*Math.pow(2,m),x=0));m>=8;o[l+U]=255&D,U+=$,D/=256,m-=8);for(x=x<<m|D,A+=m;A>0;o[l+U]=255&x,U+=$,x/=256,A-=8);o[l+U-$]|=128*Y};function en(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}en.Varint=0,en.Fixed64=1,en.Bytes=2,en.Fixed32=5;var eo,Ac=4294967296,nd=1/Ac,rd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function to(o){return o.type===en.Bytes?o.readVarint()+o.pos:o.pos+1}function Ff(o,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var m=l.pos-1;m>=o;m--)l.buf[m+h]=l.buf[m]}function Mm(o,r){for(var l=0;l<o.length;l++)r.writeVarint(o[l])}function Pm(o,r){for(var l=0;l<o.length;l++)r.writeSVarint(o[l])}function km(o,r){for(var l=0;l<o.length;l++)r.writeFloat(o[l])}function na(o,r){for(var l=0;l<o.length;l++)r.writeDouble(o[l])}function _u(o,r){for(var l=0;l<o.length;l++)r.writeBoolean(o[l])}function Rm(o,r){for(var l=0;l<o.length;l++)r.writeFixed32(o[l])}function M_(o,r){for(var l=0;l<o.length;l++)r.writeSFixed32(o[l])}function P_(o,r){for(var l=0;l<o.length;l++)r.writeFixed64(o[l])}function k_(o,r){for(var l=0;l<o.length;l++)r.writeSFixed64(o[l])}function id(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function vu(o,r,l){o[l]=r,o[l+1]=r>>>8,o[l+2]=r>>>16,o[l+3]=r>>>24}function sd(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}function Lm(o,r,l){1===o&&l.readMessage(Fm,r)}function Fm(o,r,l){if(3===o){const{id:h,bitmap:m,width:_,height:x,left:D,top:C,advance:A}=l.readMessage(Om,{});r.push({id:h,bitmap:new Js({width:_+6,height:x+6},m),metrics:{width:_,height:x,left:D,top:C,advance:A}})}}function Om(o,r,l){1===o?r.id=l.readVarint():2===o?r.bitmap=l.readBytes():3===o?r.width=l.readVarint():4===o?r.height=l.readVarint():5===o?r.left=l.readSVarint():6===o?r.top=l.readSVarint():7===o&&(r.advance=l.readVarint())}function Of(o){let r=0,l=0;for(const x of o)r+=x.w*x.h,l=Math.max(l,x.w);o.sort((x,D)=>D.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let m=0,_=0;for(const x of o)for(let D=h.length-1;D>=0;D--){const C=h[D];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,_=Math.max(_,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===C.w&&x.h===C.h){const A=h.pop();D<h.length&&(h[D]=A)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(h.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:m,h:_,fill:r/(m*_)||0}}en.prototype={destroy:function(){this.buf=null},readFields:function(o,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),m=h>>3,_=this.pos;this.type=7&h,o(m,r,this),this.pos===_&&this.skip(h)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=id(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=sd(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=id(this.buf,this.pos)+id(this.buf,this.pos+4)*Ac;return this.pos+=8,o},readSFixed64:function(){var o=id(this.buf,this.pos)+sd(this.buf,this.pos+4)*Ac;return this.pos+=8,o},readFloat:function(){var o=Lf(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Lf(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:function(m,_,x){var D,C,A=x.buf;if(D=(112&(C=A[x.pos++]))>>4,C<128||(D|=(127&(C=A[x.pos++]))<<3,C<128)||(D|=(127&(C=A[x.pos++]))<<10,C<128)||(D|=(127&(C=A[x.pos++]))<<17,C<128)||(D|=(127&(C=A[x.pos++]))<<24,C<128)||(D|=(1&(C=A[x.pos++]))<<31,C<128))return function Sl(o,r,l){return l?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}(m,D,_);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=h[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&rd?rd.decode(this.buf.subarray(r,o)):function(l,h,m){for(var _="",x=h;x<m;){var D,C,A,R=l[x],L=null,N=R>239?4:R>223?3:R>191?2:1;if(x+N>m)break;1===N?R<128&&(L=R):2===N?128==(192&(D=l[x+1]))&&(L=(31&R)<<6|63&D)<=127&&(L=null):3===N?(C=l[x+2],128==(192&(D=l[x+1]))&&128==(192&C)&&((L=(15&R)<<12|(63&D)<<6|63&C)<=2047||L>=55296&&L<=57343)&&(L=null)):4===N&&(C=l[x+2],A=l[x+3],128==(192&(D=l[x+1]))&&128==(192&C)&&128==(192&A)&&((L=(15&R)<<18|(63&D)<<12|(63&C)<<6|63&A)<=65535||L>=1114112)&&(L=null)),null===L?(L=65533,N=1):L>65535&&(L-=65536,_+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),_+=String.fromCharCode(L),x+=N}return _}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==en.Bytes)return o.push(this.readVarint(r));var l=to(this);for(o=o||[];this.pos<l;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==en.Bytes)return o.push(this.readSVarint());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==en.Bytes)return o.push(this.readBoolean());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==en.Bytes)return o.push(this.readFloat());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==en.Bytes)return o.push(this.readDouble());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==en.Bytes)return o.push(this.readFixed32());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==en.Bytes)return o.push(this.readSFixed32());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==en.Bytes)return o.push(this.readFixed64());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==en.Bytes)return o.push(this.readSFixed64());var r=to(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===en.Varint)for(;this.buf[this.pos++]>127;);else if(r===en.Bytes)this.pos=this.readVarint()+this.pos;else if(r===en.Fixed32)this.pos+=4;else{if(r!==en.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),vu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),vu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),vu(this.buf,-1&o,this.pos),vu(this.buf,Math.floor(o*nd),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),vu(this.buf,-1&o,this.pos),vu(this.buf,Math.floor(o*nd),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,l){var h,m,_,D;if(r>=0?(h=r%4294967296|0,m=r/4294967296|0):(m=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,m=m+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),_=h,(D=l).buf[D.pos++]=127&_|128,_>>>=7,D.buf[D.pos++]=127&_|128,_>>>=7,D.buf[D.pos++]=127&_|128,_>>>=7,D.buf[D.pos++]=127&_|128,D.buf[D.pos]=127&(_>>>=7),function(_,x){var D=(7&_)<<4;x.buf[x.pos++]|=D|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(m,l)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(h,m,_){for(var x,D,C=0;C<m.length;C++){if((x=m.charCodeAt(C))>55295&&x<57344){if(!D){x>56319||C+1===m.length?(h[_++]=239,h[_++]=191,h[_++]=189):D=x;continue}if(x<56320){h[_++]=239,h[_++]=191,h[_++]=189,D=x;continue}x=D-55296<<10|x-56320|65536,D=null}else D&&(h[_++]=239,h[_++]=191,h[_++]=189,D=null);x<128?h[_++]=x:(x<2048?h[_++]=x>>6|192:(x<65536?h[_++]=x>>12|224:(h[_++]=x>>18|240,h[_++]=x>>12&63|128),h[_++]=x>>6&63|128),h[_++]=63&x|128)}return _}(this.buf,o,this.pos);var l=this.pos-r;l>=128&&Ff(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(o){this.realloc(4),Am(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Am(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=o[l]},writeRawMessage:function(o,r){this.pos++;var l=this.pos;o(r,this);var h=this.pos-l;h>=128&&Ff(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(o,r,l){this.writeTag(o,en.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,Mm,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,Pm,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,_u,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,km,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,na,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,Rm,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,M_,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,P_,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,k_,r)},writeBytesField:function(o,r){this.writeTag(o,en.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,en.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,en.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,en.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,en.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,en.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,en.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,en.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,en.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,en.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,Boolean(r))}};class zf{constructor(r,{pixelRatio:l,version:h,stretchX:m,stretchY:_,content:x}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=m,this.stretchY=_,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Nf{constructor(r,l){const h={},m={};this.haveRenderCallbacks=[];const _=[];this.addImages(r,h,_),this.addImages(l,m,_);const{w:x,h:D}=Of(_),C=new Ar({width:x||1,height:D||1});for(const A in r){const R=r[A],L=h[A].paddedRect;Ar.copy(R.data,C,{x:0,y:0},{x:L.x+1,y:L.y+1},R.data)}for(const A in l){const R=l[A],L=m[A].paddedRect,N=L.x+1,U=L.y+1,$=R.data.width,Y=R.data.height;Ar.copy(R.data,C,{x:0,y:0},{x:N,y:U},R.data),Ar.copy(R.data,C,{x:0,y:Y-1},{x:N,y:U-1},{width:$,height:1}),Ar.copy(R.data,C,{x:0,y:0},{x:N,y:U+Y},{width:$,height:1}),Ar.copy(R.data,C,{x:$-1,y:0},{x:N-1,y:U},{width:1,height:Y}),Ar.copy(R.data,C,{x:0,y:0},{x:N+$,y:U},{width:1,height:Y})}this.image=C,this.iconPositions=h,this.patternPositions=m}addImages(r,l,h){for(const m in r){const _=r[m],x={x:0,y:0,w:_.data.width+2,h:_.data.height+2};h.push(x),l[m]=new zf(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(r,l){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[m,_]=r.tl;h.update(l.data,void 0,{x:m,y:_})}}$e("ImagePosition",zf),$e("ImageAtlas",Nf),y.WritingMode=void 0,(eo=y.WritingMode||(y.WritingMode={}))[eo.none=0]="none",eo[eo.horizontal=1]="horizontal",eo[eo.vertical=2]="vertical",eo[eo.horizontalOnly=3]="horizontalOnly";class Il{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new Il;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new Il;return l.imageName=r,l}}class yi{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new yi;for(let m=0;m<r.sections.length;m++){const _=r.sections[m];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let l="";for(let h=0;h<r.length;h++){const m=r.charCodeAt(h+1)||null,_=r.charCodeAt(h-1)||null;l+=m&&sc(m)&&!za[r[h+1]]||_&&sc(_)&&!za[r[h-1]]||!za[r[h]]?r[h]:za[r[h]]}return l}(this.text)}trim(){let r=0;for(let h=0;h<this.text.length&&xu[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&xu[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new yi;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(Il.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let m=0;m<r.text.length;++m)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(0===l.length)return void kn("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Il.forImage(l)),this.sectionIndex.push(this.sections.length-1)):kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ra(o,r,l,h,m,_,x,D,C,A,R,L,N,U,$,Y){const Q=yi.fromFeature(o,m);let se;L===y.WritingMode.vertical&&Q.verticalizePunctuation();const{processBidirectionalText:pe,processStyledBidirectionalText:he}=ai;if(pe&&1===Q.sections.length){se=[];const we=pe(Q.toString(),bu(Q,A,_,r,h,U,$));for(const Oe of we){const Je=new yi;Je.text=Oe,Je.sections=Q.sections;for(let ze=0;ze<Oe.length;ze++)Je.sectionIndex.push(0);se.push(Je)}}else if(he){se=[];const we=he(Q.text,Q.sectionIndex,bu(Q,A,_,r,h,U,$));for(const Oe of we){const Je=new yi;Je.text=Oe[0],Je.sectionIndex=Oe[1],Je.sections=Q.sections,se.push(Je)}}else se=function(we,Oe){const Je=[],ze=we.text;let Ve=0;for(const ke of Oe)Je.push(we.substring(Ve,ke)),Ve=ke;return Ve<ze.length&&Je.push(we.substring(Ve,ze.length)),Je}(Q,bu(Q,A,_,r,h,U,$));const _e=[],Ce={positionedLines:_e,text:Q.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(we,Oe,Je,ze,Ve,ke,je,Ne,Te,it,Qe,Lt){let Ut=0,fn=-17,Dn=0,yr=0;const Xn="right"===Ne?1:"left"===Ne?0:.5;let jn=0;for(const nr of Ve){nr.trim();const Dr=nr.getMaxScale(),Er=24*(Dr-1),Yr={positionedGlyphs:[],lineOffset:0};we.positionedLines[jn]=Yr;const Fi=Yr.positionedGlyphs;let ui=0;if(!nr.length()){fn+=ke,++jn;continue}for(let sr=0;sr<nr.length();sr++){const Mt=nr.getSection(sr),Oi=nr.getSectionIndex(sr),En=nr.getCharCode(sr);let Jr=0,ts=null,Fs=null,Os=null,wo=24;const vs=!(Te===y.WritingMode.horizontal||!Qe&&!ic(En)||Qe&&(xu[En]||($n=En,Fe.Arabic($n)||Fe["Arabic Supplement"]($n)||Fe["Arabic Extended-A"]($n)||Fe["Arabic Presentation Forms-A"]($n)||Fe["Arabic Presentation Forms-B"]($n))));if(Mt.imageName){const zi=ze[Mt.imageName];if(!zi)continue;Os=Mt.imageName,we.iconsInText=we.iconsInText||!0,Fs=zi.paddedRect;const xi=zi.displaySize;Mt.scale=24*Mt.scale/Lt,ts={width:xi[0],height:xi[1],left:1,top:-3,advance:vs?xi[1]:xi[0]},Jr=Er+(24-xi[1]*Mt.scale),wo=ts.advance;const Do=vs?xi[0]*Mt.scale-24*Dr:xi[1]*Mt.scale-24*Dr;Do>0&&Do>ui&&(ui=Do)}else{const zi=Je[Mt.fontStack],xi=zi&&zi[En];if(xi&&xi.rect)Fs=xi.rect,ts=xi.metrics;else{const Do=Oe[Mt.fontStack],Su=Do&&Do[En];if(!Su)continue;ts=Su.metrics}Jr=24*(Dr-Mt.scale)}vs?(we.verticalizable=!0,Fi.push({glyph:En,imageName:Os,x:Ut,y:fn+Jr,vertical:vs,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:Oi,metrics:ts,rect:Fs}),Ut+=wo*Mt.scale+it):(Fi.push({glyph:En,imageName:Os,x:Ut,y:fn+Jr,vertical:vs,scale:Mt.scale,fontStack:Mt.fontStack,sectionIndex:Oi,metrics:ts,rect:Fs}),Ut+=ts.advance*Mt.scale+it)}0!==Fi.length&&(Dn=Math.max(Ut-it,Dn),L_(Fi,0,Fi.length-1,Xn,ui)),Ut=0;const Mn=ke*Dr+ui;Yr.lineOffset=Math.max(ui,Er),fn+=Mn,yr=Math.max(Mn,yr),++jn}var $n;const Mr=fn- -17,{horizontalAlign:Pr,verticalAlign:vi}=wu(je);(function(nr,Dr,Er,Yr,Fi,ui,Mn,sr,Mt){const Oi=(Dr-Er)*Fi;let En=0;En=ui!==Mn?-sr*Yr- -17:(-Yr*Mt+.5)*Mn;for(const Jr of nr)for(const ts of Jr.positionedGlyphs)ts.x+=Oi,ts.y+=En})(we.positionedLines,Xn,Pr,vi,Dn,yr,ke,Mr,Ve.length),we.top+=-vi*Mr,we.bottom=we.top+Mr,we.left+=-Pr*Dn,we.right=we.left+Dn}(Ce,r,l,h,se,x,D,C,L,A,N,Y),!function(we){for(const Oe of we)if(0!==Oe.positionedGlyphs.length)return!1;return!0}(_e)&&Ce}const xu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Bf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function od(o,r,l,h,m,_){if(r.imageName){const x=h[r.imageName];return x?x.displaySize[0]*r.scale*24/_+m:0}{const x=l[r.fontStack],D=x&&x[o];return D?D.metrics.advance*r.scale+m:0}}function zm(o,r,l,h){const m=Math.pow(o-r,2);return h?o<r?m/2:2*m:m+Math.abs(l)*l}function R_(o,r,l){let h=0;return 10===o&&(h-=1e4),l&&(h+=150),40!==o&&65288!==o||(h+=50),41!==r&&65289!==r||(h+=50),h}function Nm(o,r,l,h,m,_){let x=null,D=zm(r,l,m,_);for(const C of h){const A=zm(r-C.x,l,m,_)+C.badness;A<=D&&(x=C,D=A)}return{index:o,x:r,priorBreak:x,badness:D}}function Mc(o){return o?Mc(o.priorBreak).concat(o.index):[]}function bu(o,r,l,h,m,_,x){if("point"!==_)return[];if(!o)return[];const D=[],C=function(N,U,$,Y,Q,se){let pe=0;for(let he=0;he<N.length();he++){const _e=N.getSection(he);pe+=od(N.getCharCode(he),_e,Y,Q,U,se)}return pe/Math.max(1,Math.ceil(pe/$))}(o,r,l,h,m,x),A=o.text.indexOf("\u200b")>=0;let R=0;for(let N=0;N<o.length();N++){const U=o.getSection(N),$=o.getCharCode(N);if(xu[$]||(R+=od($,U,h,m,r,x)),N<o.length()-1){const Y=!((L=$)<11904||!(Fe["Bopomofo Extended"](L)||Fe.Bopomofo(L)||Fe["CJK Compatibility Forms"](L)||Fe["CJK Compatibility Ideographs"](L)||Fe["CJK Compatibility"](L)||Fe["CJK Radicals Supplement"](L)||Fe["CJK Strokes"](L)||Fe["CJK Symbols and Punctuation"](L)||Fe["CJK Unified Ideographs Extension A"](L)||Fe["CJK Unified Ideographs"](L)||Fe["Enclosed CJK Letters and Months"](L)||Fe["Halfwidth and Fullwidth Forms"](L)||Fe.Hiragana(L)||Fe["Ideographic Description Characters"](L)||Fe["Kangxi Radicals"](L)||Fe["Katakana Phonetic Extensions"](L)||Fe.Katakana(L)||Fe["Vertical Forms"](L)||Fe["Yi Radicals"](L)||Fe["Yi Syllables"](L)));(Bf[$]||Y||U.imageName)&&D.push(Nm(N+1,R,C,D,R_($,o.getCharCode(N+1),Y&&A),!1))}}var L;return Mc(Nm(o.length(),R,C,D,0,!0))}function wu(o){let r=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function L_(o,r,l,h,m){if(!h&&!m)return;const _=o[l],x=(o[l].x+_.metrics.advance*_.scale)*h;for(let D=r;D<=l;D++)o[D].x-=x,o[D].y+=m}function F_(o,r,l){const{horizontalAlign:h,verticalAlign:m}=wu(l),_=r[0]-o.displaySize[0]*h,x=r[1]-o.displaySize[1]*m;return{image:o,top:x,bottom:x+o.displaySize[1],left:_,right:_+o.displaySize[0]}}function ad(o,r,l,h,m,_){const x=o.image;let D;if(x.content){const Q=x.content,se=x.pixelRatio||1;D=[Q[0]/se,Q[1]/se,x.displaySize[0]-Q[2]/se,x.displaySize[1]-Q[3]/se]}const C=r.left*_,A=r.right*_;let R,L,N,U;"width"===l||"both"===l?(U=m[0]+C-h[3],L=m[0]+A+h[1]):(U=m[0]+(C+A-x.displaySize[0])/2,L=U+x.displaySize[0]);const $=r.top*_,Y=r.bottom*_;return"height"===l||"both"===l?(R=m[1]+$-h[0],N=m[1]+Y+h[2]):(R=m[1]+($+Y-x.displaySize[1])/2,N=R+x.displaySize[1]),{image:x,top:R,right:L,bottom:N,left:U,collisionPadding:D}}const no=128;function ld(o,r){const{expression:l}=r;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new Sn(o+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:m}=l;let _=0;for(;_<h.length&&h[_]<=o;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<o+1;)x++;x=Math.min(h.length-1,x);const D=h[_],C=h[x];return"composite"===l.kind?{kind:"composite",minZoom:D,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:D,maxZoom:C,minSize:l.evaluate(new Sn(D)),maxSize:l.evaluate(new Sn(C)),interpolationType:m}}}function Vf(o,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:m}){return"source"===o.kind?h/no:"composite"===o.kind?me(h/no,m/no,l):r}function Uf(o,r){let l=0,h=0;if("constant"===o.kind)h=o.layoutSize;else if("source"!==o.kind){const{interpolationType:m,minZoom:_,maxZoom:x}=o,D=m?ue(Dt.interpolationFactor(m,r,_,x),0,1):0;"camera"===o.kind?h=me(o.minSize,o.maxSize,D):l=D}return{uSizeT:l,uSize:h}}var jf=Object.freeze({__proto__:null,getSizeData:ld,evaluateSizeForFeature:Vf,evaluateSizeForZoom:Uf,SIZE_PACK_FACTOR:no});class Rs extends Be{constructor(r,l,h,m){super(r,l),this.angle=h,void 0!==m&&(this.segment=m)}clone(){return new Rs(this.x,this.y,this.angle,this.segment)}}function $f(o,r,l,h,m){if(void 0===r.segment)return!0;let _=r,x=r.segment+1,D=0;for(;D>-l/2;){if(x--,x<0)return!1;D-=o[x].dist(_),_=o[x]}D+=o[x].dist(o[x+1]),x++;const C=[];let A=0;for(;D<l/2;){const R=o[x],L=o[x+1];if(!L)return!1;let N=o[x-1].angleTo(R)-R.angleTo(L);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:D,angleDelta:N}),A+=N;D-C[0].distance>h;)A-=C.shift().angleDelta;if(A>m)return!1;x++,D+=R.dist(L)}return!0}function Pc(o){let r=0;for(let l=0;l<o.length-1;l++)r+=o[l].dist(o[l+1]);return r}function Hf(o,r,l){return o?.6*r*l:0}function ir(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function Bm(o,r,l,h,m,_){const x=Hf(l,m,_),D=ir(l,h)*_;let C=0;const A=Pc(o)/2;for(let R=0;R<o.length-1;R++){const L=o[R],N=o[R+1],U=L.dist(N);if(C+U>A){const $=(A-C)/U,Y=me(L.x,N.x,$),Q=me(L.y,N.y,$),se=new Rs(Y,Q,N.angleTo(L),R);return se._round(),!x||$f(o,se,D,x,r)?se:void 0}C+=U}}function Vm(o,r,l,h,m,_,x,D,C){const A=Hf(h,_,x),R=ir(h,m),L=R*x,N=0===o[0].x||o[0].x===C||0===o[0].y||o[0].y===C;return r-L<r/4&&(r=L+r/4),kc(o,N?r/2*D%r:(R/2+2*_)*x*D%r,r,A,l,L,N,!1,C)}function kc(o,r,l,h,m,_,x,D,C){const A=_/2,R=Pc(o);let L=0,N=r-l,U=[];for(let $=0;$<o.length-1;$++){const Y=o[$],Q=o[$+1],se=Y.dist(Q),pe=Q.angleTo(Y);for(;N+l<L+se;){N+=l;const he=(N-L)/se,_e=me(Y.x,Q.x,he),Ce=me(Y.y,Q.y,he);if(_e>=0&&_e<C&&Ce>=0&&Ce<C&&N-A>=0&&N+A<=R){const we=new Rs(_e,Ce,pe,$);we._round(),h&&!$f(o,we,_,h,m)||U.push(we)}}L+=se}return D||U.length||x||(U=kc(o,L/2,l,h,m,_,x,!0,C)),U}function ud(o,r,l,h,m){const _=[];for(let x=0;x<o.length;x++){const D=o[x];let C;for(let A=0;A<D.length-1;A++){let R=D[A],L=D[A+1];R.x<r&&L.x<r||(R.x<r?R=new Be(r,R.y+(r-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x<r&&(L=new Be(r,R.y+(r-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y<l&&L.y<l||(R.y<l?R=new Be(R.x+(l-R.y)/(L.y-R.y)*(L.x-R.x),l)._round():L.y<l&&(L=new Be(R.x+(l-R.y)/(L.y-R.y)*(L.x-R.x),l)._round()),R.x>=h&&L.x>=h||(R.x>=h?R=new Be(h,R.y+(h-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x>=h&&(L=new Be(h,R.y+(h-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y>=m&&L.y>=m||(R.y>=m?R=new Be(R.x+(m-R.y)/(L.y-R.y)*(L.x-R.x),m)._round():L.y>=m&&(L=new Be(R.x+(m-R.y)/(L.y-R.y)*(L.x-R.x),m)._round()),C&&R.equals(C[C.length-1])||(C=[R],_.push(C)),C.push(L)))))}}return _}function qf(o,r,l,h){const m=[],_=o.image,x=_.pixelRatio,D=_.paddedRect.w-2,C=_.paddedRect.h-2,A=o.right-o.left,R=o.bottom-o.top,L=_.stretchX||[[0,D]],N=_.stretchY||[[0,C]],U=(ke,je)=>ke+je[1]-je[0],$=L.reduce(U,0),Y=N.reduce(U,0),Q=D-$,se=C-Y;let pe=0,he=$,_e=0,Ce=Y,we=0,Oe=Q,Je=0,ze=se;if(_.content&&h){const ke=_.content;pe=Rc(L,0,ke[0]),_e=Rc(N,0,ke[1]),he=Rc(L,ke[0],ke[2]),Ce=Rc(N,ke[1],ke[3]),we=ke[0]-pe,Je=ke[1]-_e,Oe=ke[2]-ke[0]-he,ze=ke[3]-ke[1]-Ce}const Ve=(ke,je,Ne,Te)=>{const it=Lc(ke.stretch-pe,he,A,o.left),Qe=Fc(ke.fixed-we,Oe,ke.stretch,$),Lt=Lc(je.stretch-_e,Ce,R,o.top),Ut=Fc(je.fixed-Je,ze,je.stretch,Y),fn=Lc(Ne.stretch-pe,he,A,o.left),Dn=Fc(Ne.fixed-we,Oe,Ne.stretch,$),yr=Lc(Te.stretch-_e,Ce,R,o.top),Xn=Fc(Te.fixed-Je,ze,Te.stretch,Y),jn=new Be(it,Lt),$n=new Be(fn,Lt),Mr=new Be(fn,yr),Pr=new Be(it,yr),vi=new Be(Qe/x,Ut/x),nr=new Be(Dn/x,Xn/x),Dr=r*Math.PI/180;if(Dr){const Fi=Math.sin(Dr),ui=Math.cos(Dr),Mn=[ui,-Fi,Fi,ui];jn._matMult(Mn),$n._matMult(Mn),Pr._matMult(Mn),Mr._matMult(Mn)}const Er=ke.stretch+ke.fixed,Yr=je.stretch+je.fixed;return{tl:jn,tr:$n,bl:Pr,br:Mr,tex:{x:_.paddedRect.x+1+Er,y:_.paddedRect.y+1+Yr,w:Ne.stretch+Ne.fixed-Er,h:Te.stretch+Te.fixed-Yr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vi,pixelOffsetBR:nr,minFontScaleX:Oe/x/A,minFontScaleY:ze/x/R,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){const ke=Gf(L,Q,$),je=Gf(N,se,Y);for(let Ne=0;Ne<ke.length-1;Ne++){const Te=ke[Ne],it=ke[Ne+1];for(let Qe=0;Qe<je.length-1;Qe++)m.push(Ve(Te,je[Qe],it,je[Qe+1]))}}else m.push(Ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:C+1}));return m}function Rc(o,r,l){let h=0;for(const m of o)h+=Math.max(r,Math.min(l,m[1]))-Math.max(r,Math.min(l,m[0]));return h}function Gf(o,r,l){const h=[{fixed:-1,stretch:0}];for(const[m,_]of o){const x=h[h.length-1];h.push({fixed:m-x.stretch,stretch:x.stretch}),h.push({fixed:m-x.stretch,stretch:x.stretch+(_-m)})}return h.push({fixed:r+1,stretch:l}),h}function Lc(o,r,l,h){return o/r*l+h}function Fc(o,r,l,h){return o-r*l/h}$e("Anchor",Rs);class cd{constructor(r,l,h,m,_,x,D,C,A,R){if(this.boxStartIndex=r.length,A){let L=x.top,N=x.bottom;const U=x.collisionPadding;U&&(L-=U[1],N+=U[3]);let $=N-L;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let L=x.top*D-C,N=x.bottom*D+C,U=x.left*D-C,$=x.right*D+C;const Y=x.collisionPadding;if(Y&&(U-=Y[0]*D,L-=Y[1]*D,$+=Y[2]*D,N+=Y[3]*D),R){const Q=new Be(U,L),se=new Be($,L),pe=new Be(U,N),he=new Be($,N),_e=R*Math.PI/180;Q._rotate(_e),se._rotate(_e),pe._rotate(_e),he._rotate(_e),U=Math.min(Q.x,se.x,pe.x,he.x),$=Math.max(Q.x,se.x,pe.x,he.x),L=Math.min(Q.y,se.y,pe.y,he.y),N=Math.max(Q.y,se.y,pe.y,he.y)}r.emplaceBack(l.x,l.y,U,L,$,N,h,m,_)}this.boxEndIndex=r.length}}class O_{constructor(r=[],l=Du){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,m=l[r];for(;r>0;){const _=r-1>>1,x=l[_];if(h(m,x)>=0)break;l[r]=x,r=_}l[r]=m}_down(r){const{data:l,compare:h}=this,m=this.length>>1,_=l[r];for(;r<m;){let x=1+(r<<1),D=l[x];const C=x+1;if(C<this.length&&h(l[C],D)<0&&(x=C,D=l[C]),h(D,_)>=0)break;l[r]=D,r=x}l[r]=_}}function Du(o,r){return o<r?-1:o>r?1:0}function _i(o,r=1,l=!1){let h=1/0,m=1/0,_=-1/0,x=-1/0;const D=o[0];for(let U=0;U<D.length;U++){const $=D[U];(!U||$.x<h)&&(h=$.x),(!U||$.y<m)&&(m=$.y),(!U||$.x>_)&&(_=$.x),(!U||$.y>x)&&(x=$.y)}const C=Math.min(_-h,x-m);let A=C/2;const R=new O_([],hd);if(0===C)return new Be(h,m);for(let U=h;U<_;U+=C)for(let $=m;$<x;$+=C)R.push(new Ba(U+A,$+A,A,o));let L=function(U){let $=0,Y=0,Q=0;const se=U[0];for(let pe=0,he=se.length,_e=he-1;pe<he;_e=pe++){const Ce=se[pe],we=se[_e],Oe=Ce.x*we.y-we.x*Ce.y;Y+=(Ce.x+we.x)*Oe,Q+=(Ce.y+we.y)*Oe,$+=3*Oe}return new Ba(Y/$,Q/$,0,U)}(o),N=R.length;for(;R.length;){const U=R.pop();(U.d>L.d||!L.d)&&(L=U,l&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,N)),U.max-L.d<=r||(A=U.h/2,R.push(new Ba(U.p.x-A,U.p.y-A,A,o)),R.push(new Ba(U.p.x+A,U.p.y-A,A,o)),R.push(new Ba(U.p.x-A,U.p.y+A,A,o)),R.push(new Ba(U.p.x+A,U.p.y+A,A,o)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${L.d}`)),L.p}function hd(o,r){return r.max-o.max}function Ba(o,r,l,h){this.p=new Be(o,r),this.h=l,this.d=function(m,_){let x=!1,D=1/0;for(let C=0;C<_.length;C++){const A=_[C];for(let R=0,L=A.length,N=L-1;R<L;N=R++){const U=A[R],$=A[N];U.y>m.y!=$.y>m.y&&m.x<($.x-U.x)*(m.y-U.y)/($.y-U.y)+U.x&&(x=!x),D=Math.min(D,xl(m,U,$))}}return(x?1:-1)*Math.sqrt(D)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const Oc=Number.POSITIVE_INFINITY;function Kr(o,r){return r[1]!==Oc?function(l,h,m){let _=0,x=0;switch(h=Math.abs(h),m=Math.abs(m),l){case"top-right":case"top-left":case"top":x=m-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-m}switch(l){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,x]}(o,r[0],r[1]):function(l,h){let m=0,_=0;h<0&&(h=0);const x=h/Math.sqrt(2);switch(l){case"top-right":case"top-left":_=x-7;break;case"bottom-right":case"bottom-left":_=7-x;break;case"bottom":_=7-h;break;case"top":_=h-7}switch(l){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=h;break;case"right":m=-h}return[m,_]}(o,r[0])}function Va(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dd(o,r,l,h,m,_,x,D,C,A,R){let L=_.textMaxSize.evaluate(r,{});void 0===L&&(L=x);const N=o.layers[0].layout,U=N.get("icon-offset").evaluate(r,{},R),$=fd(l.horizontal),Y=x/24,Q=o.tilePixelRatio*Y,se=o.tilePixelRatio*L/24,pe=o.tilePixelRatio*D,he=o.tilePixelRatio*N.get("symbol-spacing"),_e=N.get("text-padding")*o.tilePixelRatio,Ce=N.get("icon-padding")*o.tilePixelRatio,we=N.get("text-max-angle")/180*Math.PI,Oe="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),Je="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),ze=N.get("symbol-placement"),Ve=he/2,ke=N.get("icon-text-fit");let je;h&&"none"!==ke&&(o.allowVerticalPlacement&&l.vertical&&(je=ad(h,l.vertical,ke,N.get("icon-text-fit-padding"),U,Y)),$&&(h=ad(h,$,ke,N.get("icon-text-fit-padding"),U,Y)));const Ne=(Te,it)=>{it.x<0||it.x>=Wn||it.y<0||it.y>=Wn||function(Qe,Lt,Ut,fn,Dn,yr,Xn,jn,$n,Mr,Pr,vi,nr,Dr,Er,Yr,Fi,ui,Mn,sr,Mt,Oi,En,Jr,ts){const Fs=Qe.addToLineVertexArray(Lt,Ut);let Os,wo,vs,zi,xi=0,Do=0,Su=0,St=0,Dd=-1,Vc=-1;const ro={};let Iu=Rh(""),ns=0,Uc=0;if(void 0===jn._unevaluatedLayout.getValue("text-radial-offset")?[ns,Uc]=jn.layout.get("text-offset").evaluate(Mt,{},Jr).map(Qr=>24*Qr):(ns=24*jn.layout.get("text-radial-offset").evaluate(Mt,{},Jr),Uc=Oc),Qe.allowVerticalPlacement&&fn.vertical){const Qr=jn.layout.get("text-rotate").evaluate(Mt,{},Jr)+90;vs=new cd($n,Lt,Mr,Pr,vi,fn.vertical,nr,Dr,Er,Qr),Xn&&(zi=new cd($n,Lt,Mr,Pr,vi,Xn,Fi,ui,Er,Qr))}if(Dn){const Qr=jn.layout.get("icon-rotate").evaluate(Mt,{}),xs="none"!==jn.layout.get("icon-text-fit"),$c=qf(Dn,Qr,En,xs),Tu=Xn?qf(Xn,Qr,En,xs):void 0;wo=new cd($n,Lt,Mr,Pr,vi,Dn,Fi,ui,!1,Qr),xi=4*$c.length;const op=Qe.iconSizeData;let $a=null;"source"===op.kind?($a=[no*jn.layout.get("icon-size").evaluate(Mt,{})],$a[0]>ia&&kn(`${Qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===op.kind&&($a=[no*Oi.compositeIconSizes[0].evaluate(Mt,{},Jr),no*Oi.compositeIconSizes[1].evaluate(Mt,{},Jr)],($a[0]>ia||$a[1]>ia)&&kn(`${Qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qe.addSymbols(Qe.icon,$c,$a,sr,Mn,Mt,y.WritingMode.none,Lt,Fs.lineStartIndex,Fs.lineLength,-1,Jr),Dd=Qe.icon.placedSymbolArray.length-1,Tu&&(Do=4*Tu.length,Qe.addSymbols(Qe.icon,Tu,$a,sr,Mn,Mt,y.WritingMode.vertical,Lt,Fs.lineStartIndex,Fs.lineLength,-1,Jr),Vc=Qe.icon.placedSymbolArray.length-1)}const rp=Object.keys(fn.horizontal);for(const Qr of rp){const xs=fn.horizontal[Qr];if(!Os){Iu=Rh(xs.text);const Tu=jn.layout.get("text-rotate").evaluate(Mt,{},Jr);Os=new cd($n,Lt,Mr,Pr,vi,xs,nr,Dr,Er,Tu)}const $c=1===xs.positionedLines.length;if(Su+=Zf(Qe,Lt,xs,yr,jn,Er,Mt,Yr,Fs,fn.vertical?y.WritingMode.horizontal:y.WritingMode.horizontalOnly,$c?rp:[Qr],ro,Dd,Oi,Jr),$c)break}fn.vertical&&(St+=Zf(Qe,Lt,fn.vertical,yr,jn,Er,Mt,Yr,Fs,y.WritingMode.vertical,["vertical"],ro,Vc,Oi,Jr));const Ed=Os?Os.boxStartIndex:Qe.collisionBoxArray.length,Eo=Os?Os.boxEndIndex:Qe.collisionBoxArray.length,Cd=vs?vs.boxStartIndex:Qe.collisionBoxArray.length,ip=vs?vs.boxEndIndex:Qe.collisionBoxArray.length,Sd=wo?wo.boxStartIndex:Qe.collisionBoxArray.length,z_=wo?wo.boxEndIndex:Qe.collisionBoxArray.length,sp=zi?zi.boxStartIndex:Qe.collisionBoxArray.length,N_=zi?zi.boxEndIndex:Qe.collisionBoxArray.length;let Ni=-1;const ja=(Qr,xs)=>Qr&&Qr.circleDiameter?Math.max(Qr.circleDiameter,xs):xs;Ni=ja(Os,Ni),Ni=ja(vs,Ni),Ni=ja(wo,Ni),Ni=ja(zi,Ni);const jc=Ni>-1?1:0;jc&&(Ni*=ts/24),Qe.glyphOffsetArray.length>=Tl.MAX_GLYPHS&&kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Mt.sortKey&&Qe.addToSortKeyRanges(Qe.symbolInstances.length,Mt.sortKey),Qe.symbolInstances.emplaceBack(Lt.x,Lt.y,ro.right>=0?ro.right:-1,ro.center>=0?ro.center:-1,ro.left>=0?ro.left:-1,ro.vertical||-1,Dd,Vc,Iu,Ed,Eo,Cd,ip,Sd,z_,sp,N_,Mr,Su,St,xi,Do,jc,0,nr,ns,Uc,Ni)}(o,it,Te,l,h,m,je,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,Q,_e,Oe,C,pe,Ce,Je,U,r,_,A,R,x)};if("line"===ze)for(const Te of ud(r.geometry,0,0,Wn,Wn)){const it=Vm(Te,he,we,l.vertical||$,h,24,se,o.overscaling,Wn);for(const Qe of it){const Lt=$;Lt&&Um(o,Lt.text,Ve,Qe)||Ne(Te,Qe)}}else if("line-center"===ze){for(const Te of r.geometry)if(Te.length>1){const it=Bm(Te,we,l.vertical||$,h,24,se);it&&Ne(Te,it)}}else if("Polygon"===r.type)for(const Te of qh(r.geometry,0)){const it=_i(Te,16);Ne(Te[0],new Rs(it.x,it.y,0))}else if("LineString"===r.type)for(const Te of r.geometry)Ne(Te,new Rs(Te[0].x,Te[0].y,0));else if("Point"===r.type)for(const Te of r.geometry)for(const it of Te)Ne([it],new Rs(it.x,it.y,0))}const ia=32640;function Zf(o,r,l,h,m,_,x,D,C,A,R,L,N,U,$){const Y=function(pe,he,_e,Ce,we,Oe,Je,ze){const Ve=Ce.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,ke=[];for(const je of he.positionedLines)for(const Ne of je.positionedGlyphs){if(!Ne.rect)continue;const Te=Ne.rect||{};let it=4,Qe=!0,Lt=1,Ut=0;const fn=(we||ze)&&Ne.vertical,Dn=Ne.metrics.advance*Ne.scale/2;if(ze&&he.verticalizable){const Mn=24*(Ne.scale-1),sr=(24-Ne.metrics.width*Ne.scale)/2;Ut=je.lineOffset/2-(Ne.imageName?-sr:Mn)}if(Ne.imageName){const Mn=Je[Ne.imageName];Qe=Mn.sdf,Lt=Mn.pixelRatio,it=1/Lt}const yr=we?[Ne.x+Dn,Ne.y]:[0,0];let Xn=we?[0,0]:[Ne.x+Dn+_e[0],Ne.y+_e[1]-Ut],jn=[0,0];fn&&(jn=Xn,Xn=[0,0]);const $n=(Ne.metrics.left-it)*Ne.scale-Dn+Xn[0],Mr=(-Ne.metrics.top-it)*Ne.scale+Xn[1],Pr=$n+Te.w*Ne.scale/Lt,vi=Mr+Te.h*Ne.scale/Lt,nr=new Be($n,Mr),Dr=new Be(Pr,Mr),Er=new Be($n,vi),Yr=new Be(Pr,vi);if(fn){const Mn=new Be(-Dn,Dn- -17),sr=-Math.PI/2,Mt=12-Dn,Oi=new Be(22-Mt,-(Ne.imageName?Mt:0)),En=new Be(...jn);nr._rotateAround(sr,Mn)._add(Oi)._add(En),Dr._rotateAround(sr,Mn)._add(Oi)._add(En),Er._rotateAround(sr,Mn)._add(Oi)._add(En),Yr._rotateAround(sr,Mn)._add(Oi)._add(En)}if(Ve){const Mn=Math.sin(Ve),sr=Math.cos(Ve),Mt=[sr,-Mn,Mn,sr];nr._matMult(Mt),Dr._matMult(Mt),Er._matMult(Mt),Yr._matMult(Mt)}const Fi=new Be(0,0),ui=new Be(0,0);ke.push({tl:nr,tr:Dr,bl:Er,br:Yr,tex:Te,writingMode:he.writingMode,glyphOffset:yr,sectionIndex:Ne.sectionIndex,isSDF:Qe,pixelOffsetTL:Fi,pixelOffsetBR:ui,minFontScaleX:0,minFontScaleY:0})}return ke}(0,l,D,m,_,x,h,o.allowVerticalPlacement),Q=o.textSizeData;let se=null;"source"===Q.kind?(se=[no*m.layout.get("text-size").evaluate(x,{})],se[0]>ia&&kn(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Q.kind&&(se=[no*U.compositeTextSizes[0].evaluate(x,{},$),no*U.compositeTextSizes[1].evaluate(x,{},$)],(se[0]>ia||se[1]>ia)&&kn(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,Y,se,D,_,x,A,r,C.lineStartIndex,C.lineLength,N,$);for(const pe of R)L[pe]=o.text.placedSymbolArray.length-1;return 4*Y.length}function fd(o){for(const r in o)return o[r];return null}function Um(o,r,l,h){const m=o.compareText;if(r in m){const _=m[r];for(let x=_.length-1;x>=0;x--)if(h.dist(_[x])<l)return!0}else m[r]=[];return m[r].push(h),!1}const Wf=_s.VectorTileFeature.types,jm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Eu(o,r,l,h,m,_,x,D,C,A,R,L,N){const U=D?Math.min(ia,Math.round(D[0])):0,$=D?Math.min(ia,Math.round(D[1])):0;o.emplaceBack(r,l,Math.round(32*h),Math.round(32*m),_,x,(U<<1)+(C?1:0),$,16*A,16*R,256*L,256*N)}function pd(o,r,l){o.emplaceBack(r.x,r.y,l),o.emplaceBack(r.x,r.y,l),o.emplaceBack(r.x,r.y,l),o.emplaceBack(r.x,r.y,l)}function $m(o){for(const r of o.sections)if(ff(r.text))return!0;return!1}class Cu{constructor(r){this.layoutVertexArray=new Xs,this.indexArray=new er,this.programConfigurations=r,this.segments=new tr,this.dynamicLayoutVertexArray=new mr,this.opacityVertexArray=new Nn,this.placedSymbolArray=new st}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,l,h,m){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Sm.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,A_.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,jm,!0),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",Cu);class md{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new tr,this.collisionVertexArray=new gr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Im.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",md);class Tl{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Nh([]),this.placementViewportMatrix=Nh([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ld(this.zoom,l["text-size"]),this.iconSizeData=ld(this.zoom,l["icon-size"]);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&!m.isConstant(),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===h.get("symbol-placement")&&(this.writingModes=h.get("text-writing-mode").map(x=>y.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new Cu(new _l(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Cu(new _l(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new tt,this.lineVertexArray=new Ht,this.symbolInstances=new Ot}calculateGlyphDependencies(r,l,h,m,_){for(let x=0;x<r.length;x++)if(l[r.charCodeAt(x)]=!0,(h||m)&&_){const D=za[r.charAt(x)];D&&(l[D.charCodeAt(0)]=!0)}}populate(r,l,h){const m=this.layers[0],_=m.layout,x=_.get("text-font"),D=_.get("text-field"),C=_.get("icon-image"),A=("constant"!==D.value.kind||D.value.value instanceof ur&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),R="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!A&&!R)return;const N=l.iconDependencies,U=l.glyphDependencies,$=l.availableImages,Y=new Sn(this.zoom);for(const{feature:Q,id:se,index:pe,sourceLayerIndex:he}of r){const _e=m._featureFilter.needGeometry,Ce=ys(Q,_e);if(!m._featureFilter.filter(Y,Ce,h))continue;let we,Oe;if(_e||(Ce.geometry=Wo(Q)),A){const ze=m.getValueAndResolveTokens("text-field",Ce,h,$),Ve=ur.factory(ze);$m(Ve)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Sa()||this.hasRTLText&&ai.isParsed())&&(we=Tc(Ve,m,Ce))}if(R){const ze=m.getValueAndResolveTokens("icon-image",Ce,h,$);Oe=ze instanceof Sr?ze:Sr.fromString(ze)}if(!we&&!Oe)continue;const Je=this.sortFeaturesByKey?L.evaluate(Ce,{},h):void 0;if(this.features.push({id:se,text:we,icon:Oe,index:pe,sourceLayerIndex:he,geometry:Ce.geometry,properties:Q.properties,type:Wf[Q.type],sortKey:Je}),Oe&&(N[Oe.name]=!0),we){const ze=x.evaluate(Ce,{},h).join(","),Ve="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(y.WritingMode.vertical)>=0;for(const ke of we.sections)if(ke.image)N[ke.image.name]=!0;else{const je=rc(we.toString()),Ne=ke.fontStack||ze,Te=U[Ne]=U[Ne]||{};this.calculateGlyphDependencies(ke.text,Te,Ve,this.allowVerticalPlacement,je)}}}"line"===_.get("symbol-placement")&&(this.features=function(Q){const se={},pe={},he=[];let _e=0;function Ce(ze){he.push(Q[ze]),_e++}function we(ze,Ve,ke){const je=pe[ze];return delete pe[ze],pe[Ve]=je,he[je].geometry[0].pop(),he[je].geometry[0]=he[je].geometry[0].concat(ke[0]),je}function Oe(ze,Ve,ke){const je=se[Ve];return delete se[Ve],se[ze]=je,he[je].geometry[0].shift(),he[je].geometry[0]=ke[0].concat(he[je].geometry[0]),je}function Je(ze,Ve,ke){const je=ke?Ve[0][Ve[0].length-1]:Ve[0][0];return`${ze}:${je.x}:${je.y}`}for(let ze=0;ze<Q.length;ze++){const Ve=Q[ze],ke=Ve.geometry,je=Ve.text?Ve.text.toString():null;if(!je){Ce(ze);continue}const Ne=Je(je,ke),Te=Je(je,ke,!0);if(Ne in pe&&Te in se&&pe[Ne]!==se[Te]){const it=Oe(Ne,Te,ke),Qe=we(Ne,Te,he[it].geometry);delete se[Ne],delete pe[Te],pe[Je(je,he[Qe].geometry,!0)]=Qe,he[it].geometry=null}else Ne in pe?we(Ne,Te,ke):Te in se?Oe(Ne,Te,ke):(Ce(ze),se[Ne]=_e-1,pe[Te]=_e-1)}return he.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,se)=>Q.sortKey-se.sortKey)}update(r,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(void 0!==r.segment){let m=r.dist(l[r.segment+1]),_=r.dist(l[r.segment]);const x={};for(let D=r.segment+1;D<l.length;D++)x[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:m},D<l.length-1&&(m+=l[D+1].dist(l[D]));for(let D=r.segment||0;D>=0;D--)x[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:_},D>0&&(_+=l[D-1].dist(l[D]));for(let D=0;D<l.length;D++){const C=x[D];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,m,_,x,D,C,A,R,L,N){const U=r.indexArray,$=r.layoutVertexArray,Y=r.segments.prepareSegment(4*l.length,$,U,this.canOverlap?x.sortKey:void 0),Q=this.glyphOffsetArray.length,se=Y.vertexLength,pe=this.allowVerticalPlacement&&D===y.WritingMode.vertical?Math.PI/2:0,he=x.text&&x.text.sections;for(let _e=0;_e<l.length;_e++){const{tl:Ce,tr:we,bl:Oe,br:Je,tex:ze,pixelOffsetTL:Ve,pixelOffsetBR:ke,minFontScaleX:je,minFontScaleY:Ne,glyphOffset:Te,isSDF:it,sectionIndex:Qe}=l[_e],Lt=Y.vertexLength,Ut=Te[1];Eu($,C.x,C.y,Ce.x,Ut+Ce.y,ze.x,ze.y,h,it,Ve.x,Ve.y,je,Ne),Eu($,C.x,C.y,we.x,Ut+we.y,ze.x+ze.w,ze.y,h,it,ke.x,Ve.y,je,Ne),Eu($,C.x,C.y,Oe.x,Ut+Oe.y,ze.x,ze.y+ze.h,h,it,Ve.x,ke.y,je,Ne),Eu($,C.x,C.y,Je.x,Ut+Je.y,ze.x+ze.w,ze.y+ze.h,h,it,ke.x,ke.y,je,Ne),pd(r.dynamicLayoutVertexArray,C,pe),U.emplaceBack(Lt,Lt+1,Lt+2),U.emplaceBack(Lt+1,Lt+2,Lt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),_e!==l.length-1&&Qe===l[_e+1].sectionIndex||r.programConfigurations.populatePaintArrays($.length,x,x.index,{},N,he&&he[Qe])}r.placedSymbolArray.emplaceBack(C.x,C.y,Q,this.glyphOffsetArray.length-Q,se,A,R,C.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],D,0,!1,0,L)}_addCollisionDebugVertex(r,l,h,m,_,x){return l.emplaceBack(0,0),r.emplaceBack(h.x,h.y,m,_,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,l,h,m,_,x,D){const C=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),A=C.vertexLength,R=_.layoutVertexArray,L=_.collisionVertexArray,N=D.anchorX,U=D.anchorY;this._addCollisionDebugVertex(R,L,x,N,U,new Be(r,l)),this._addCollisionDebugVertex(R,L,x,N,U,new Be(h,l)),this._addCollisionDebugVertex(R,L,x,N,U,new Be(h,m)),this._addCollisionDebugVertex(R,L,x,N,U,new Be(r,m)),C.vertexLength+=4;const $=_.indexArray;$.emplaceBack(A,A+1),$.emplaceBack(A+1,A+2),$.emplaceBack(A+2,A+3),$.emplaceBack(A+3,A),C.primitiveLength+=4}addDebugCollisionBoxes(r,l,h,m){for(let _=r;_<l;_++){const x=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new md(rn,Rf.members,dn),this.iconCollisionBox=new md(rn,Rf.members,dn);for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(r,l,h,m,_,x,D,C,A){const R={};for(let L=l;L<h;L++){const N=r.get(L);R.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},R.textFeatureIndex=N.featureIndex;break}for(let L=m;L<_;L++){const N=r.get(L);R.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},R.verticalTextFeatureIndex=N.featureIndex;break}for(let L=x;L<D;L++){const N=r.get(L);R.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},R.iconFeatureIndex=N.featureIndex;break}for(let L=C;L<A;L++){const N=r.get(L);R.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},R.verticalIconFeatureIndex=N.featureIndex;break}return R}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),m=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<m;_+=4)r.indexArray.emplaceBack(_,_+1,_+2),r.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),m=[],_=[],x=[];for(let D=0;D<this.symbolInstances.length;++D){x.push(D);const C=this.symbolInstances.get(D);m.push(0|Math.round(l*C.anchorX+h*C.anchorY)),_.push(C.featureIndex)}return x.sort((D,C)=>m[D]-m[C]||_[C]-_[D]),x}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((m,_,x)=>{m>=0&&x.indexOf(m)===_&&this.addIndicesForPlacedSymbol(this.text,m)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$e("SymbolBucket",Tl,{omit:["layers","collisionBoxArray","features","compareText"]}),Tl.MAX_GLYPHS=65535,Tl.addDynamicAttributes=pd;const gd=new Zn({"symbol-placement":new qe(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new qe(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qe(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qe(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qe(ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qe(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new qe(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qe(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new rt(ve.layout_symbol["icon-size"]),"icon-text-fit":new qe(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qe(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new rt(ve.layout_symbol["icon-image"]),"icon-rotate":new rt(ve.layout_symbol["icon-rotate"]),"icon-padding":new qe(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new qe(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new rt(ve.layout_symbol["icon-offset"]),"icon-anchor":new rt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qe(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qe(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qe(ve.layout_symbol["text-rotation-alignment"]),"text-field":new rt(ve.layout_symbol["text-field"]),"text-font":new rt(ve.layout_symbol["text-font"]),"text-size":new rt(ve.layout_symbol["text-size"]),"text-max-width":new rt(ve.layout_symbol["text-max-width"]),"text-line-height":new qe(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new rt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new rt(ve.layout_symbol["text-justify"]),"text-radial-offset":new rt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qe(ve.layout_symbol["text-variable-anchor"]),"text-anchor":new rt(ve.layout_symbol["text-anchor"]),"text-max-angle":new qe(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new qe(ve.layout_symbol["text-writing-mode"]),"text-rotate":new rt(ve.layout_symbol["text-rotate"]),"text-padding":new qe(ve.layout_symbol["text-padding"]),"text-keep-upright":new qe(ve.layout_symbol["text-keep-upright"]),"text-transform":new rt(ve.layout_symbol["text-transform"]),"text-offset":new rt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new qe(ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qe(ve.layout_symbol["text-ignore-placement"]),"text-optional":new qe(ve.layout_symbol["text-optional"])});var yd={paint:new Zn({"icon-opacity":new rt(ve.paint_symbol["icon-opacity"]),"icon-color":new rt(ve.paint_symbol["icon-color"]),"icon-halo-color":new rt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new rt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new qe(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new qe(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new rt(ve.paint_symbol["text-opacity"]),"text-color":new rt(ve.paint_symbol["text-color"],{runtimeType:di,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new rt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new rt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new rt(ve.paint_symbol["text-halo-blur"]),"text-translate":new qe(ve.paint_symbol["text-translate"]),"text-translate-anchor":new qe(ve.paint_symbol["text-translate-anchor"])}),layout:gd};class Xf{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Xt,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",Xf,{omit:["defaultValue"]});class xo extends ps{constructor(r){super(r,yd)}recalculate(r,l){if(super.recalculate(r,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const _ of h)m.indexOf(_)<0&&m.push(_);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,m){const _=this.layout.get(r).evaluate(l,{},h,m),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||Hi(x.value)||!_?_:(D=l.properties,_.replace(/{([^{}]+)}/g,(A,R)=>R in D?String(D[R]):""));var D}createBucket(r){return new Tl(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of yd.paint.overridableProperties){if(!xo.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new Xf(l),m=new $l(h,l.property.specification);let _=null;_="constant"===l.value.kind||"source"===l.value.kind?new Ku("source",m):new hs("composite",m,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new Yi(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&xo.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),m=yd.paint.properties[l];let _=!1;const x=D=>{for(const C of D)if(m.overrides&&m.overrides.hasOverride(C))return void(_=!0)};if("constant"===h.value.kind&&h.value.value instanceof ur)x(h.value.value.sections);else if("source"===h.value.kind){const D=A=>{_||(A instanceof Yn&&xn(A.value)===ji?x(A.value.sections):A instanceof cs?x(A.sections):A.eachChild(D))},C=h.value;C._styleExpression&&D(C._styleExpression.expression)}return _}}var Hm={paint:new Zn({"background-color":new qe(ve.paint_background["background-color"]),"background-pattern":new eu(ve.paint_background["background-pattern"]),"background-opacity":new qe(ve.paint_background["background-opacity"])})},qm={paint:new Zn({"raster-opacity":new qe(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new qe(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qe(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qe(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new qe(ve.paint_raster["raster-saturation"]),"raster-contrast":new qe(ve.paint_raster["raster-contrast"]),"raster-resampling":new qe(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new qe(ve.paint_raster["raster-fade-duration"])})};class Gm extends ps{constructor(r){super(r,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const Zm={circle:class extends ps{constructor(o){super(o,yf)}createBucket(o){return new Xo(o)}queryRadius(o){const r=o;return Yo("circle-radius",this,r)+Yo("circle-stroke-width",this,r)+_c(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,l,h,m,_,x,D){const C=au(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,x),A=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l),R="map"===this.paint.get("circle-pitch-alignment"),L=R?C:($=D,C.map(Y=>Bh(Y,$))),N=R?A*x:A;var $;for(const U of h)for(const $ of U){const Y=R?$:Bh($,D);let Q=N;const se=lu(Ma(),xc($.x,$.y,0,1),D);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?Q*=se[3]/_.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(Q*=_.cameraToCenterDistance/se[3]),pc(L,Y,Q))return!0}return!1}},heatmap:class extends ps{constructor(o){super(o,ym),this._updateColorRamp()}createBucket(o){return new Pa(o)}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends ps{constructor(o){super(o,Uh)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends ps{constructor(o){super(o,Xh)}recalculate(o,r){super.recalculate(o,r);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Wh(o)}queryRadius(){return _c(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,l,h,m,_,x){return mm(au(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,x),h)}isTileClipped(){return!0}},"fill-extrusion":class extends ps{constructor(o){super(o,Qs)}createBucket(o){return new Jh(o)}queryRadius(){return _c(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,r,l,h,m,_,x,D){const C=au(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,x),A=this.paint.get("fill-extrusion-height").evaluate(r,l),R=this.paint.get("fill-extrusion-base").evaluate(r,l),L=function(U,$,Y,Q){const se=[];for(const pe of U){const he=xc(pe.x,pe.y,0,1);lu(he,he,$),se.push(new Be(he[0]/he[3],he[1]/he[3]))}return se}(C,D),N=function(U,$,Y,Q){const se=[],pe=[],he=Q[8]*$,_e=Q[9]*$,Ce=Q[10]*$,we=Q[11]*$,Oe=Q[8]*Y,Je=Q[9]*Y,ze=Q[10]*Y,Ve=Q[11]*Y;for(const ke of U){const je=[],Ne=[];for(const Te of ke){const it=Te.x,Qe=Te.y,Lt=Q[0]*it+Q[4]*Qe+Q[12],Ut=Q[1]*it+Q[5]*Qe+Q[13],fn=Q[2]*it+Q[6]*Qe+Q[14],Dn=Q[3]*it+Q[7]*Qe+Q[15],yr=fn+Ce,Xn=Dn+we,jn=Lt+Oe,$n=Ut+Je,Mr=fn+ze,Pr=Dn+Ve,vi=new Be((Lt+he)/Xn,(Ut+_e)/Xn);vi.z=yr/Xn,je.push(vi);const nr=new Be(jn/Pr,$n/Pr);nr.z=Mr/Pr,Ne.push(nr)}se.push(je),pe.push(Ne)}return[se,pe]}(h,R,A,D);return function(U,$,Y){let Q=1/0;mm(Y,$)&&(Q=Oa(Y,$[0]));for(let se=0;se<$.length;se++){const pe=$[se],he=U[se];for(let _e=0;_e<pe.length-1;_e++){const Ce=pe[_e],we=[Ce,pe[_e+1],he[_e+1],he[_e],Ce];fc(Y,we)&&(Q=Math.min(Q,Oa(Y,we)))}}return Q!==1/0&&Q}(N[0],N[1],L)}},line:class extends ps{constructor(o){super(o,kf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){"line-gradient"===o&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ee,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=Cm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new ta(o)}queryRadius(o){const r=o,l=ed(Yo("line-width",this,r),Yo("line-gap-width",this,r)),h=Yo("line-offset",this,r);return l/2+Math.abs(h)+_c(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,l,h,m,_,x){const D=au(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,x),C=x/2*ed(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),A=this.paint.get("line-offset").evaluate(r,l);return A&&(h=function(R,L){const N=[],U=new Be(0,0);for(let $=0;$<R.length;$++){const Y=R[$],Q=[];for(let se=0;se<Y.length;se++){const pe=Y[se-1],he=Y[se],_e=Y[se+1],Ce=0===se?U:he.sub(pe)._unit()._perp(),we=se===Y.length-1?U:_e.sub(he)._unit()._perp(),Oe=Ce._add(we)._unit();Oe._mult(1/(Oe.x*we.x+Oe.y*we.y)),Q.push(Oe._mult(L)._add(he))}N.push(Q)}return N}(h,A*x)),function(R,L,N){for(let U=0;U<L.length;U++){const $=L[U];if(R.length>=3)for(let Y=0;Y<$.length;Y++)if(Ko(R,$[Y]))return!0;if(mf(R,$,N))return!0}return!1}(D,h,C)}isTileClipped(){return!0}},symbol:xo,background:class extends ps{constructor(o){super(o,Hm)}},raster:class extends ps{constructor(o){super(o,qm)}}};class Wm{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const _d=6371008.8;class Un{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Un(jt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,m=r.lat*l,_=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((r.lng-this.lng)*l);return _d*Math.acos(Math.min(_,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new Ua(new Un(this.lng-h,this.lat-l),new Un(this.lng+h,this.lat+l))}static convert(r){if(r instanceof Un)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Un(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Un(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ua{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Un?new Un(r.lng,r.lat):Un.convert(r),this}setSouthWest(r){return this._sw=r instanceof Un?new Un(r.lng,r.lat):Un.convert(r),this}extend(r){const l=this._sw,h=this._ne;let m,_;if(r instanceof Un)m=r,_=r;else{if(!(r instanceof Ua))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Ua.convert(r)):this.extend(Un.convert(r)):this;if(m=r._sw,_=r._ne,!m||!_)return this}return l||h?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new Un(m.lng,m.lat),this._ne=new Un(_.lng,_.lat)),this}getCenter(){return new Un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Un(this.getWest(),this.getNorth())}getSouthEast(){return new Un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=Un.convert(r);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}static convert(r){return r instanceof Ua?r:r&&new Ua(r)}}const Kf=2*Math.PI*_d;function Yf(o){return Kf*Math.cos(o*Math.PI/180)}function vd(o){return(180+o)/360}function Jf(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Qf(o,r){return o/Yf(r)}function xd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class bo{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=Un.convert(r);return new bo(vd(h.lng),Jf(h.lat),Qf(l,h.lat))}toLngLat(){return new Un(360*this.x-180,xd(this.y))}toAltitude(){return this.z*Yf(xd(this.y))}meterInMercatorCoordinateUnits(){return 1/Kf*(r=xd(this.y),1/Math.cos(r*Math.PI/180));var r}}function Ls(o,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[o*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class ep{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=zc(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=(_=this.y,x=this.z,D=Ls(256*(m=this.x),256*(_=Math.pow(2,x)-_-1),x),C=Ls(256*(m+1),256*(_+1),x),D[0]+","+D[1]+","+C[0]+","+C[1]);var m,_,x,D,C;const A=function(R,L,N){let U,$="";for(let Y=R;Y>0;Y--)U=1<<Y-1,$+=(L&U?1:0)+(N&U?2:0);return $}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,devicePixelRatio>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,h)}getTilePoint(r){const l=Math.pow(2,this.z);return new Be((r.x*l-this.x)*Wn,(r.y*l-this.y)*Wn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xm{constructor(r,l){this.wrap=r,this.canonical=l,this.key=zc(r,l.z,l.z,l.x,l.y)}}class es{constructor(r,l,h,m,_){this.overscaledZ=r,this.wrap=l,this.canonical=new ep(h,+m,+_),this.key=zc(l,r,h,m,_)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new es(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new es(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l){const h=this.canonical.z-r;return r>this.canonical.z?zc(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y):zc(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new es(l,this.wrap,l,h,m),new es(l,this.wrap,l,h+1,m),new es(l,this.wrap,l,h,m+1),new es(l,this.wrap,l,h+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new es(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new bo(r.x-this.wrap,r.y))}}function zc(o,r,l,h,m){(o*=2)<0&&(o=-1*o-1);const _=1<<l;return(_*_*o+_*m+h).toString(36)+l.toString(36)+r.toString(36)}$e("CanonicalTileID",ep),$e("OverscaledTileID",es,{omit:["posMatrix"]});class Li{constructor(r,l,h){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return void kn(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const m=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=h||"mapbox";for(let _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]}get(r,l){const h=new Uint8Array(this.data.buffer),m=4*this._idx(r,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[m],h[m+1],h[m+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}_unpackMapbox(r,l,h){return(256*r*256+256*l+h)/10-1e4}_unpackTerrarium(r,l,h){return 256*r+l+h/256-32768}getPixels(){return new Ar({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,_=l*this.dim+this.dim,x=h*this.dim,D=h*this.dim+this.dim;switch(l){case-1:m=_-1;break;case 1:_=m+1}switch(h){case-1:x=D-1;break;case 1:D=x+1}const C=-l*this.dim,A=-h*this.dim;for(let R=x;R<D;R++)for(let L=m;L<_;L++)this.data[this._idx(L,R)]=r.data[this._idx(L+C,R+A)]}}$e("DEMData",Li);class Nc{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}var Bc,o;class tp{constructor(r,l,h,m,_){this.type="Feature",this._vectorTileFeature=r,r._z=l,r._x=h,r._y=m,this.properties=r.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r=function(l,h){var m={};for(var _ in l)Object.prototype.hasOwnProperty.call(l,_)&&h.indexOf(_)<0&&(m[_]=l[_]);if(null!=l&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(_=Object.getOwnPropertySymbols(l);x<_.length;x++)h.indexOf(_[x])<0&&Object.prototype.propertyIsEnumerable.call(l,_[x])&&(m[_[x]]=l[_[x]])}return m}(this,["_geometry","_vectorTileFeature"]);return r.geometry=this.geometry,r}}class bd{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Kn(Wn,16,0),this.grid3D=new Kn(Wn,16,0),this.featureIndexArray=new At,this.promoteId=l}insert(r,l,h,m,_,x){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,_);const C=x?this.grid3D:this.grid;for(let A=0;A<l.length;A++){const R=l[A],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<R.length;N++){const U=R[N];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}L[0]<Wn&&L[1]<Wn&&L[2]>=0&&L[3]>=0&&C.insert(D,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new _s.VectorTile(new td(this.rawTileData)).layers,this.sourceLayerCoder=new Nc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,l,h,m){this.loadVTLayers();const _=r.params||{},x=Wn/r.tileSize/r.scale,D=Gi(_.filter),C=r.queryGeometry,A=r.queryPadding*x,R=wd(C),L=this.grid.query(R.minX-A,R.minY-A,R.maxX+A,R.maxY+A),N=wd(r.cameraQueryGeometry),U=this.grid3D.query(N.minX-A,N.minY-A,N.maxX+A,N.maxY+A,(Q,se,pe,he)=>function(_e,Ce,we,Oe,Je){for(const Ve of _e)if(Ce<=Ve.x&&we<=Ve.y&&Oe>=Ve.x&&Je>=Ve.y)return!0;const ze=[new Be(Ce,we),new Be(Ce,Je),new Be(Oe,Je),new Be(Oe,we)];if(_e.length>2)for(const Ve of ze)if(Ko(_e,Ve))return!0;for(let Ve=0;Ve<_e.length-1;Ve++)if(yc(_e[Ve],_e[Ve+1],ze))return!0;return!1}(r.cameraQueryGeometry,Q-A,se-A,pe+A,he+A));for(const Q of U)L.push(Q);L.sort(np);const $={};let Y;for(let Q=0;Q<L.length;Q++){const se=L[Q];if(se===Y)continue;Y=se;const pe=this.featureIndexArray.get(se);let he=null;this.loadMatchingFeature($,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,D,_.layers,_.availableImages,l,h,m,(_e,Ce,we)=>(he||(he=Wo(_e)),Ce.queryIntersectsFeature(C,_e,we,he,this.z,r.transform,x,r.pixelPosMatrix)))}return $}loadMatchingFeature(r,l,h,m,_,x,D,C,A,R,L){const N=this.bucketLayerIDs[l];if(x&&!function(Q,se){for(let pe=0;pe<Q.length;pe++)if(se.indexOf(Q[pe])>=0)return!0;return!1}(x,N))return;const U=this.sourceLayerCoder.decode(h),$=this.vtLayers[U].feature(m);if(_.needGeometry){const Q=ys($,!0);if(!_.filter(new Sn(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!_.filter(new Sn(this.tileID.overscaledZ),$))return;const Y=this.getId($,U);for(let Q=0;Q<N.length;Q++){const se=N[Q];if(x&&x.indexOf(se)<0)continue;const pe=C[se];if(!pe)continue;let he={};Y&&R&&(he=R.getState(pe.sourceLayer||"_geojsonTileLayer",Y));const _e=Pt({},A[se]);_e.paint=Al(_e.paint,pe.paint,$,he,D),_e.layout=Al(_e.layout,pe.layout,$,he,D);const Ce=!L||L($,pe,he);if(!Ce)continue;const we=new tp($,this.z,this.x,this.y,Y);we.layer=_e;let Oe=r[se];void 0===Oe&&(Oe=r[se]=[]),Oe.push({featureIndex:m,feature:we,intersectionZ:Ce})}}lookupSymbolFeatures(r,l,h,m,_,x,D,C){const A={};this.loadVTLayers();const R=Gi(_);for(const L of r)this.loadMatchingFeature(A,h,m,L,R,x,D,C,l);return A}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;return this.promoteId&&(h=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof h&&(h=Number(h))),h}}function Al(o,r,l,h,m){return on(o,(_,x)=>{const D=r instanceof In?r.get(x):null;return D&&D.evaluate?D.evaluate(l,h,m):D})}function wd(o){let r=1/0,l=1/0,h=-1/0,m=-1/0;for(const _ of o)r=Math.min(r,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),m=Math.max(m,_.y);return{minX:r,minY:l,maxX:h,maxY:m}}function np(o,r){return r-o}$e("FeatureIndex",bd,{omit:["rawTileData","sourceLayerCoder"]}),(o=Bc||(Bc={})).create="create",o.load="load",o.fullLoad="fullLoad",y.ARRAY_TYPE=Jo,y.Actor=class{constructor(o,r,l){this.target=o,this.parent=r,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_n(["receive","process"],this),this.invoker=new Wm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kt()?o:window}send(o,r,l,h,m=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[_]=l);const x=Or(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:o,hasCallback:!!l,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:va(r,x)},x),{cancel:()=>{l&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(o){const r=o.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){delete this.tasks[l];const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h()}else kt()||r.mustQueue?(this.tasks[l]=r,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,r)}process(){if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),r=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(o,r)}processTask(o,r){if("<response>"===r.type){const l=this.callbacks[o];delete this.callbacks[o],l&&(r.error?l(il(r.error)):l(null,il(r.data)))}else{let l=!1;const h=Or(this.globalScope)?void 0:[],m=r.hasCallback?(D,C)=>{l=!0,delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:D?va(D):null,data:va(C,h)},h)}:D=>{l=!0};let _=null;const x=il(r.data);if(this.parent[r.type])_=this.parent[r.type](r.sourceMapId,x,m);else if(this.parent.getWorkerSource){const D=r.type.split(".");_=this.parent.getWorkerSource(r.sourceMapId,D[0],x.source)[D[1]](x,m)}else m(new Error(`Could not find function ${r.type}`));!l&&_&&_.cancel&&(this.cancelCallbacks[o]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},y.AlphaImage=Js,y.CanonicalTileID=ep,y.CollisionBoxArray=Re,y.CollisionCircleLayoutArray=class extends Z{},y.Color=Wt,y.DEMData=Li,y.DataConstantProperty=qe,y.DictionaryCoder=Nc,y.EXTENT=Wn,y.ErrorEvent=wn,y.EvaluationParameters=Sn,y.Event=Tt,y.Evented=Gr,y.FeatureIndex=bd,y.FillBucket=Wh,y.FillExtrusionBucket=Jh,y.GeoJSONFeature=tp,y.ImageAtlas=Nf,y.ImagePosition=zf,y.LineBucket=ta,y.LineStripIndexArray=class extends Se{},y.LngLat=Un,y.LngLatBounds=Ua,y.MercatorCoordinate=bo,y.ONE_EM=24,y.OverscaledTileID=es,y.Point=Be,y.PosArray=class extends p{},y.Properties=Zn,y.QuadTriangleArray=class extends ee{},y.RGBAImage=Ar,y.RasterBoundsArray=class extends g{},y.RequestPerformance=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return 0===o.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},y.ResourceType=Ho,y.SegmentVector=tr,y.SymbolBucket=Tl,y.Transitionable=Ql,y.TriangleIndexArray=er,y.Uniform1f=iu,y.Uniform1i=class extends yo{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},y.Uniform2f=class extends yo{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},y.Uniform3f=class extends yo{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},y.Uniform4f=pf,y.UniformColor=_o,y.UniformMatrix4f=class extends yo{constructor(o,r){super(o,r),this.current=su}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},y.UnwrappedTileID=Xm,y.ValidationError=Pe,y.ZoomHistory=kh,y.addDynamicAttributes=pd,y.asyncAll=function(o,r,l){if(!o.length)return l(null,[]);let h=o.length;const m=new Array(o.length);let _=null;o.forEach((x,D)=>{r(x,(C,A)=>{C&&(_=C),m[D]=A,0==--h&&l(_,m)})})},y.bezier=hi,y.bindAll=_n,y.cacheEntryPossiblyAdded=function(o){ol++,ol>sl&&(o.getActor().send("enforceCacheSizeLimit",$o),ol=0)},y.clamp=ue,y.clearTileCache=function(o){const r=caches.delete(Ah);o&&r.catch(o).then(()=>o())},y.clipLine=ud,y.clone=function(o){var r=new Jo(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},y.clone$1=rr,y.collisionCircleLayout=Tm,y.config=Gl,y.create=function(){var o=new Jo(16);return Jo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},y.createExpression=_a,y.createFilter=Gi,y.createLayout=s,y.createStyleLayer=function(o){return"custom"===o.type?new Gm(o):new Zm[o.type](o)},y.dot=function(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]+o[3]*r[3]},y.ease=Ze,y.emitValidationErrors=nc,y.enforceCacheSizeLimit=function(o){xa(),Si&&Si.then(r=>{r.keys().then(l=>{for(let h=0;h<l.length-o;h++)r.delete(l[h])})})},y.evaluateSizeForFeature=Vf,y.evaluateSizeForZoom=Uf,y.evaluateVariableOffset=Kr,y.evented=hl,y.exported=zr,y.exported$1=cn,y.extend=Pt,y.filterObject=ar,y.fromValues=xc,y.getAnchorAlignment=wu,y.getAnchorJustification=Va,y.getArrayBuffer=dr,y.getImage=mi,y.getJSON=function(o,r){return ll(Pt(o,{type:"json"}),r)},y.getRTLTextPluginStatus=Sa,y.getReferrer=Zs,y.getVideo=function(o,r){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<o.length;h++){const m=window.document.createElement("source");qr(o[h])||(l.crossOrigin="Anonymous"),m.src=o[h],l.appendChild(m)}return{cancel:()=>{}}},y.identity=Nh,y.invert=function(o,r){var l=r[0],h=r[1],m=r[2],_=r[3],x=r[4],D=r[5],C=r[6],A=r[7],R=r[8],L=r[9],N=r[10],U=r[11],$=r[12],Y=r[13],Q=r[14],se=r[15],pe=l*D-h*x,he=l*C-m*x,_e=l*A-_*x,Ce=h*C-m*D,we=h*A-_*D,Oe=m*A-_*C,Je=R*Y-L*$,ze=R*Q-N*$,Ve=R*se-U*$,ke=L*Q-N*Y,je=L*se-U*Y,Ne=N*se-U*Q,Te=pe*Ne-he*je+_e*ke+Ce*Ve-we*ze+Oe*Je;return Te?(o[0]=(D*Ne-C*je+A*ke)*(Te=1/Te),o[1]=(m*je-h*Ne-_*ke)*Te,o[2]=(Y*Oe-Q*we+se*Ce)*Te,o[3]=(N*we-L*Oe-U*Ce)*Te,o[4]=(C*Ve-x*Ne-A*ze)*Te,o[5]=(l*Ne-m*Ve+_*ze)*Te,o[6]=(Q*_e-$*Oe-se*he)*Te,o[7]=(R*Oe-N*_e+U*he)*Te,o[8]=(x*je-D*Ve+A*Je)*Te,o[9]=(h*Ve-l*je-_*Je)*Te,o[10]=($*we-Y*_e+se*pe)*Te,o[11]=(L*_e-R*we-U*pe)*Te,o[12]=(D*ze-x*ke-C*Je)*Te,o[13]=(l*ke-h*ze+m*Je)*Te,o[14]=(Y*he-$*Ce-Q*pe)*Te,o[15]=(R*Ce-L*he+N*pe)*Te,o):null},y.isImageBitmap=lr,y.keysDifference=function(o,r){const l=[];for(const h in o)h in r||l.push(h);return l},y.lazyLoadRTLTextPlugin=function(){ai.isLoading()||ai.isLoaded()||"deferred"!==Sa()||lc()},y.makeRequest=ll,y.mapObject=on,y.mercatorXfromLng=vd,y.mercatorYfromLat=Jf,y.mercatorZfromAltitude=Qf,y.mul=vc,y.multiply=_f,y.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},y.number=me,y.ortho=function(o,r,l,h,m,_,x){var D=1/(r-l),C=1/(h-m),A=1/(_-x);return o[0]=-2*D,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*C,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*A,o[11]=0,o[12]=(r+l)*D,o[13]=(m+h)*C,o[14]=(x+_)*A,o[15]=1,o},y.parseCacheControl=qn,y.parseGlyphPBF=function(o){return new td(o).readFields(Lm,[])},y.pbf=td,y.performSymbolLayout=function(o,r,l,h,m,_,x){o.createArrays(),o.tilePixelRatio=Wn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const D=o.layers[0].layout,C=o.layers[0]._unevaluatedLayout._values,A={layoutIconSize:C["icon-size"].possiblyEvaluate(new Sn(o.zoom+1),x),layoutTextSize:C["text-size"].possiblyEvaluate(new Sn(o.zoom+1),x),textMaxSize:C["text-size"].possiblyEvaluate(new Sn(18))};if("composite"===o.textSizeData.kind){const{minZoom:$,maxZoom:Y}=o.textSizeData;A.compositeTextSizes=[C["text-size"].possiblyEvaluate(new Sn($),x),C["text-size"].possiblyEvaluate(new Sn(Y),x)]}if("composite"===o.iconSizeData.kind){const{minZoom:$,maxZoom:Y}=o.iconSizeData;A.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new Sn($),x),C["icon-size"].possiblyEvaluate(new Sn(Y),x)]}const R=24*D.get("text-line-height"),L="map"===D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),N=D.get("text-keep-upright"),U=D.get("text-size");for(const $ of o.features){const Y=D.get("text-font").evaluate($,{},x).join(","),Q=U.evaluate($,{},x),se=A.layoutTextSize.evaluate($,{},x),pe=A.layoutIconSize.evaluate($,{},x),he={horizontal:{},vertical:void 0},_e=$.text;let Ce,we=[0,0];if(_e){const ze=_e.toString(),Ve=24*D.get("text-letter-spacing").evaluate($,{},x),ke=hf(ze)?Ve:0,je=D.get("text-anchor").evaluate($,{},x),Ne=D.get("text-variable-anchor");if(!Ne){const Ut=D.get("text-radial-offset").evaluate($,{},x);we=Ut?Kr(je,[24*Ut,Oc]):D.get("text-offset").evaluate($,{},x).map(fn=>24*fn)}let Te=L?"center":D.get("text-justify").evaluate($,{},x);const it=D.get("symbol-placement"),Qe="point"===it?24*D.get("text-max-width").evaluate($,{},x):0,Lt=()=>{o.allowVerticalPlacement&&rc(ze)&&(he.vertical=ra(_e,r,l,m,Y,Qe,R,je,"left",ke,we,y.WritingMode.vertical,!0,it,se,Q))};if(!L&&Ne){const Ut="auto"===Te?Ne.map(Dn=>Va(Dn)):[Te];let fn=!1;for(let Dn=0;Dn<Ut.length;Dn++){const yr=Ut[Dn];if(!he.horizontal[yr])if(fn)he.horizontal[yr]=he.horizontal[0];else{const Xn=ra(_e,r,l,m,Y,Qe,R,"center",yr,ke,we,y.WritingMode.horizontal,!1,it,se,Q);Xn&&(he.horizontal[yr]=Xn,fn=1===Xn.positionedLines.length)}}Lt()}else{"auto"===Te&&(Te=Va(je));const Ut=ra(_e,r,l,m,Y,Qe,R,je,Te,ke,we,y.WritingMode.horizontal,!1,it,se,Q);Ut&&(he.horizontal[Te]=Ut),Lt(),rc(ze)&&L&&N&&(he.vertical=ra(_e,r,l,m,Y,Qe,R,je,Te,ke,we,y.WritingMode.vertical,!1,it,se,Q))}}let Oe=!1;if($.icon&&$.icon.name){const ze=h[$.icon.name];ze&&(Ce=F_(m[$.icon.name],D.get("icon-offset").evaluate($,{},x),D.get("icon-anchor").evaluate($,{},x)),Oe=!!ze.sdf,void 0===o.sdfIcons?o.sdfIcons=Oe:o.sdfIcons!==Oe&&kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ze.pixelRatio!==o.pixelRatio||0!==D.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Je=fd(he.horizontal)||he.vertical;o.iconsInText=!!Je&&Je.iconsInText,(Je||Ce)&&dd(o,$,he,Ce,h,A,se,pe,we,Oe,x)}_&&o.generateCollisionDebugBuffers()},y.perspective=function(o,r,l,h,m){var _,x=1/Math.tan(r/2);return o[0]=x/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=x,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=m&&m!==1/0?(o[10]=(m+h)*(_=1/(h-m)),o[14]=2*m*h*_):(o[10]=-1,o[14]=-2*h),o},y.pick=function(o,r){const l={};for(let h=0;h<r.length;h++){const m=r[h];m in o&&(l[m]=o[m])}return l},y.plugin=ai,y.pointGeometry=Sc,y.polygonIntersectsPolygon=fc,y.potpack=Of,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=$e,y.registerForPluginStateChange=function(o){return o({pluginStatus:Pn,pluginURL:Ms}),hl.on("pluginStateChange",o),o},y.renderColorRamp=Vh,y.rotateX=function(o,r,l){var h=Math.sin(l),m=Math.cos(l),_=r[4],x=r[5],D=r[6],C=r[7],A=r[8],R=r[9],L=r[10],N=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=_*m+A*h,o[5]=x*m+R*h,o[6]=D*m+L*h,o[7]=C*m+N*h,o[8]=A*m-_*h,o[9]=R*m-x*h,o[10]=L*m-D*h,o[11]=N*m-C*h,o},y.rotateZ=function(o,r,l){var h=Math.sin(l),m=Math.cos(l),_=r[0],x=r[1],D=r[2],C=r[3],A=r[4],R=r[5],L=r[6],N=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=_*m+A*h,o[1]=x*m+R*h,o[2]=D*m+L*h,o[3]=C*m+N*h,o[4]=A*m-_*h,o[5]=R*m-x*h,o[6]=L*m-D*h,o[7]=N*m-C*h,o},y.scale=function(o,r,l){var h=l[0],m=l[1],_=l[2];return o[0]=r[0]*h,o[1]=r[1]*h,o[2]=r[2]*h,o[3]=r[3]*h,o[4]=r[4]*m,o[5]=r[5]*m,o[6]=r[6]*m,o[7]=r[7]*m,o[8]=r[8]*_,o[9]=r[9]*_,o[10]=r[10]*_,o[11]=r[11]*_,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o},y.scale$1=function(o,r,l){return o[0]=r[0]*l,o[1]=r[1]*l,o[2]=r[2]*l,o[3]=r[3]*l,o},y.setCacheLimits=function(o,r){$o=o,sl=r},y.setRTLTextPlugin=function(o,r,l=!1){if(Pn===oc||Pn===ac||Pn===As)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ms=zr.resolveURL(o),Pn=oc,Yl=r,Jl(),l||lc()},y.spec=ve,y.sphericalToCartesian=function([o,r,l]){return r+=90,r*=Math.PI/180,l*=Math.PI/180,{x:o*Math.cos(r)*Math.sin(l),y:o*Math.sin(r)*Math.sin(l),z:o*Math.cos(l)}},y.symbolSize=jf,y.toEvaluationFeature=ys,y.transformMat4=lu,y.translate=function(o,r,l){var h,m,_,x,D,C,A,R,L,N,U,$,Y=l[0],Q=l[1],se=l[2];return r===o?(o[12]=r[0]*Y+r[4]*Q+r[8]*se+r[12],o[13]=r[1]*Y+r[5]*Q+r[9]*se+r[13],o[14]=r[2]*Y+r[6]*Q+r[10]*se+r[14],o[15]=r[3]*Y+r[7]*Q+r[11]*se+r[15]):(m=r[1],_=r[2],x=r[3],D=r[4],C=r[5],A=r[6],R=r[7],L=r[8],N=r[9],U=r[10],$=r[11],o[0]=h=r[0],o[1]=m,o[2]=_,o[3]=x,o[4]=D,o[5]=C,o[6]=A,o[7]=R,o[8]=L,o[9]=N,o[10]=U,o[11]=$,o[12]=h*Y+D*Q+L*se+r[12],o[13]=m*Y+C*Q+N*se+r[13],o[14]=_*Y+A*Q+U*se+r[14],o[15]=x*Y+R*Q+$*se+r[15]),o},y.triggerPluginCompletionEvent=cl,y.unicodeBlockLookup=Fe,y.uniqueId=function(){return pn++},y.validateCustomStyleLayer=function(o){const r=[],l=o.id;return void 0===l&&r.push({message:`layers.${l}: missing required property "id"`}),void 0===o.render&&r.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},y.validateLight=Wl,y.validateStyle=qo,y.vectorTile=_s,y.warnOnce=kn,y.wrap=jt}),Us(0,function(y){function hn(q){const P=typeof q;if("number"===P||"boolean"===P||"string"===P||null==q)return JSON.stringify(q);if(Array.isArray(q)){let W="[";for(const J of q)W+=`${hn(J)},`;return`${W}]`}const O=Object.keys(q).sort();let j="{";for(let W=0;W<O.length;W++)j+=`${JSON.stringify(O[W])}:${hn(q[O[W]])},`;return`${j}}`}function ci(q){let P="";for(const O of y.refProperties)P+=`/${hn(q[O])}`;return P}class hi{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,O){for(const W of P){this._layerConfigs[W.id]=W;const J=this._layers[W.id]=y.createStyleLayer(W);J._featureFilter=y.createFilter(J.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of O)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const j=function(W,J){const re={};for(let ne=0;ne<W.length;ne++){const ae=J&&J[W[ne].id]||ci(W[ne]);J&&(J[W[ne].id]=ae);let ge=re[ae];ge||(ge=re[ae]=[]),ge.push(W[ne])}const te=[];for(const ne in re)te.push(re[ne]);return te}(Object.values(this._layerConfigs),this.keyCache);for(const W of j){const J=W.map(Ee=>this._layers[Ee.id]),re=J[0];if("none"===re.visibility)continue;const te=re.source||"";let ne=this.familiesBySource[te];ne||(ne=this.familiesBySource[te]={});const ae=re.sourceLayer||"_geojsonTileLayer";let ge=ne[ae];ge||(ge=ne[ae]=[]),ge.push(J)}}}class Ze{constructor(P){const O={},j=[];for(const te in P){const ne=P[te],ae=O[te]={};for(const ge in ne){const Ee=ne[+ge];if(!Ee||0===Ee.bitmap.width||0===Ee.bitmap.height)continue;const me={x:0,y:0,w:Ee.bitmap.width+2,h:Ee.bitmap.height+2};j.push(me),ae[ge]={rect:me,metrics:Ee.metrics}}}const{w:W,h:J}=y.potpack(j),re=new y.AlphaImage({width:W||1,height:J||1});for(const te in P){const ne=P[te];for(const ae in ne){const ge=ne[+ae];if(!ge||0===ge.bitmap.width||0===ge.bitmap.height)continue;const Ee=O[te][ae].rect;y.AlphaImage.copy(ge.bitmap,re,{x:0,y:0},{x:Ee.x+1,y:Ee.y+1},ge.bitmap)}}this.image=re,this.positions=O}}y.register("GlyphAtlas",Ze);class ue{constructor(P){this.tileID=new y.OverscaledTileID(P.tileID.overscaledZ,P.tileID.wrap,P.tileID.canonical.z,P.tileID.canonical.x,P.tileID.canonical.y),this.uid=P.uid,this.zoom=P.zoom,this.pixelRatio=P.pixelRatio,this.tileSize=P.tileSize,this.source=P.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=P.showCollisionBoxes,this.collectResourceTiming=!!P.collectResourceTiming,this.returnDependencies=!!P.returnDependencies,this.promoteId=P.promoteId}parse(P,O,j,W,J){this.status="parsing",this.data=P,this.collisionBoxArray=new y.CollisionBoxArray;const re=new y.DictionaryCoder(Object.keys(P.layers).sort()),te=new y.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];const ne={},ae={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},ge=O.familiesBySource[this.source];for(const bt in ge){const lt=P.layers[bt];if(!lt)continue;1===lt.version&&y.warnOnce(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ft=re.encode(bt),dt=[];for(let wt=0;wt<lt.length;wt++){const yt=lt.feature(wt),Cs=te.getId(yt,bt);dt.push({feature:yt,id:Cs,index:wt,sourceLayerIndex:Ft})}for(const wt of ge[bt]){const yt=wt[0];yt.minzoom&&this.zoom<Math.floor(yt.minzoom)||yt.maxzoom&&this.zoom>=yt.maxzoom||"none"!==yt.visibility&&(jt(wt,this.zoom,j),(ne[yt.id]=yt.createBucket({index:te.bucketLayerIDs.length,layers:wt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(dt,ae,this.tileID.canonical),te.bucketLayerIDs.push(wt.map(Cs=>Cs.id)))}}let Ee,me,We,He;const Ye=y.mapObject(ae.glyphDependencies,bt=>Object.keys(bt).map(Number));Object.keys(Ye).length?W.send("getGlyphs",{uid:this.uid,stacks:Ye},(bt,lt)=>{Ee||(Ee=bt,me=lt,Kt.call(this))}):me={};const nt=Object.keys(ae.iconDependencies);nt.length?W.send("getImages",{icons:nt,source:this.source,tileID:this.tileID,type:"icons"},(bt,lt)=>{Ee||(Ee=bt,We=lt,Kt.call(this))}):We={};const at=Object.keys(ae.patternDependencies);function Kt(){if(Ee)return J(Ee);if(me&&We&&He){const bt=new Ze(me),lt=new y.ImageAtlas(We,He);for(const Ft in ne){const dt=ne[Ft];dt instanceof y.SymbolBucket?(jt(dt.layers,this.zoom,j),y.performSymbolLayout(dt,me,bt.positions,We,lt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):dt.hasPattern&&(dt instanceof y.LineBucket||dt instanceof y.FillBucket||dt instanceof y.FillExtrusionBucket)&&(jt(dt.layers,this.zoom,j),dt.addFeatures(ae,this.tileID.canonical,lt.patternPositions))}this.status="done",J(null,{buckets:Object.values(ne).filter(Ft=>!Ft.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bt.image,imageAtlas:lt,glyphMap:this.returnDependencies?me:null,iconMap:this.returnDependencies?We:null,glyphPositions:this.returnDependencies?bt.positions:null})}}at.length?W.send("getImages",{icons:at,source:this.source,tileID:this.tileID,type:"patterns"},(bt,lt)=>{Ee||(Ee=bt,He=lt,Kt.call(this))}):He={},Kt.call(this)}}function jt(q,P,O){const j=new y.EvaluationParameters(P);for(const W of q)W.recalculate(j,O)}function Pt(q,P){const O=y.getArrayBuffer(q.request,(j,W,J,re)=>{j?P(j):W&&P(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(W)),rawData:W,cacheControl:J,expires:re})});return()=>{O.cancel(),P()}}class pn{constructor(P,O,j,W){this.actor=P,this.layerIndex=O,this.availableImages=j,this.loadVectorData=W||Pt,this.loading={},this.loaded={}}loadTile(P,O){const j=P.uid;this.loading||(this.loading={});const W=!!(P&&P.request&&P.request.collectResourceTiming)&&new y.RequestPerformance(P.request),J=this.loading[j]=new ue(P);J.abort=this.loadVectorData(P,(re,te)=>{if(delete this.loading[j],re||!te)return J.status="done",this.loaded[j]=J,O(re);const ne=te.rawData,ae={};te.expires&&(ae.expires=te.expires),te.cacheControl&&(ae.cacheControl=te.cacheControl);const ge={};if(W){const Ee=W.finish();Ee&&(ge.resourceTiming=JSON.parse(JSON.stringify(Ee)))}J.vectorTile=te.vectorTile,J.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ee,me)=>{if(Ee||!me)return O(Ee);O(null,y.extend({rawTileData:ne.slice(0)},me,ae,ge))}),this.loaded=this.loaded||{},this.loaded[j]=J})}reloadTile(P,O){const j=this.loaded,W=P.uid,J=this;if(j&&j[W]){const re=j[W];re.showCollisionBoxes=P.showCollisionBoxes;const te=(ne,ae)=>{const ge=re.reloadCallback;ge&&(delete re.reloadCallback,re.parse(re.vectorTile,J.layerIndex,this.availableImages,J.actor,ge)),O(ne,ae)};"parsing"===re.status?re.reloadCallback=te:"done"===re.status&&(re.vectorTile?re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}}abortTile(P,O){const j=this.loading,W=P.uid;j&&j[W]&&j[W].abort&&(j[W].abort(),delete j[W]),O()}removeTile(P,O){const j=this.loaded,W=P.uid;j&&j[W]&&delete j[W],O()}}class _n{constructor(){this.loaded={}}loadTile(P,O){const{uid:j,encoding:W,rawImageData:J}=P,re=y.isImageBitmap(J)?this.getImageData(J):J,te=new y.DEMData(j,re,W);this.loaded=this.loaded||{},this.loaded[j]=te,O(null,te)}getImageData(P){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const O=this.offscreenCanvasContext.getImageData(-1,-1,P.width+2,P.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:O.width,height:O.height},O.data)}removeTile(P){const O=this.loaded,j=P.uid;O&&O[j]&&delete O[j]}}var on=function q(P,O){var j,W=P&&P.type;if("FeatureCollection"===W)for(j=0;j<P.features.length;j++)q(P.features[j],O);else if("GeometryCollection"===W)for(j=0;j<P.geometries.length;j++)q(P.geometries[j],O);else if("Feature"===W)q(P.geometry,O);else if("Polygon"===W)ar(P.coordinates,O);else if("MultiPolygon"===W)for(j=0;j<P.coordinates.length;j++)ar(P.coordinates[j],O);return P};function ar(q,P){if(0!==q.length){rr(q[0],P);for(var O=1;O<q.length;O++)rr(q[O],!P)}}function rr(q,P){for(var O=0,j=0,W=0,J=q.length,re=J-1;W<J;re=W++){var te=(q[W][0]-q[re][0])*(q[re][1]+q[W][1]),ne=O+te;j+=Math.abs(O)>=Math.abs(te)?O-ne+te:te-ne+O,O=ne}O+j>=0!=!!P&&q.reverse()}const vn=y.vectorTile.VectorTileFeature.prototype.toGeoJSON;class kn{constructor(P){this._feature=P,this.extent=y.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(1===this._feature.type){const P=[];for(const O of this._feature.geometry)P.push([new y.Point(O[0],O[1])]);return P}{const P=[];for(const O of this._feature.geometry){const j=[];for(const W of O)j.push(new y.Point(W[0],W[1]));P.push(j)}return P}}toGeoJSON(P,O,j){return vn.call(this,P,O,j)}}class nn{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=P.length,this._features=P}feature(P){return new kn(this._features[P])}}var ot={exports:{}},kt=y.pointGeometry,qn=y.vectorTile.VectorTileFeature,Gn=vr;function vr(q,P){this.options=P||{},this.features=q,this.length=q.length}function Fr(q,P){this.id="number"==typeof q.id?q.id:void 0,this.type=q.type,this.rawGeometry=1===q.type?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=P||4096}vr.prototype.feature=function(q){return new Fr(this.features[q],this.options.extent)},Fr.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var P=0;P<q.length;P++){for(var O=q[P],j=[],W=0;W<O.length;W++)j.push(new kt(O[W][0],O[W][1]));this.geometry.push(j)}return this.geometry},Fr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,P=1/0,O=-1/0,j=1/0,W=-1/0,J=0;J<q.length;J++)for(var re=q[J],te=0;te<re.length;te++){var ne=re[te];P=Math.min(P,ne.x),O=Math.max(O,ne.x),j=Math.min(j,ne.y),W=Math.max(W,ne.y)}return[P,j,O,W]},Fr.prototype.toGeoJSON=qn.prototype.toGeoJSON;var Or=y.pbf,lr=Gn;function zr(q){var P=new Or;return function(O,j){for(var W in O.layers)j.writeMessage(3,Kn,O.layers[W])}(q,P),P.finish()}function Kn(q,P){var O;P.writeVarintField(15,q.version||1),P.writeStringField(1,q.name||""),P.writeVarintField(5,q.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<q.length;O++)j.feature=q.feature(O),P.writeMessage(2,Zt,j);var W=j.keys;for(O=0;O<W.length;O++)P.writeStringField(3,W[O]);var J=j.values;for(O=0;O<J.length;O++)P.writeMessage(4,Nr,J[O])}function Zt(q,P){var O=q.feature;void 0!==O.id&&P.writeVarintField(1,O.id),P.writeMessage(2,Vi,q),P.writeVarintField(3,O.type),P.writeMessage(4,ls,O)}function Vi(q,P){var O=q.feature,j=q.keys,W=q.values,J=q.keycache,re=q.valuecache;for(var te in O.properties){var ne=O.properties[te],ae=J[te];if(null!==ne){void 0===ae&&(j.push(te),J[te]=ae=j.length-1),P.writeVarint(ae);var ge=typeof ne;"string"!==ge&&"boolean"!==ge&&"number"!==ge&&(ne=JSON.stringify(ne));var Ee=ge+":"+ne,me=re[Ee];void 0===me&&(W.push(ne),re[Ee]=me=W.length-1),P.writeVarint(me)}}}function ri(q,P){return(P<<3)+(7&q)}function wi(q){return q<<1^q>>31}function ls(q,P){for(var O=q.loadGeometry(),j=q.type,W=0,J=0,re=O.length,te=0;te<re;te++){var ne=O[te],ae=1;1===j&&(ae=ne.length),P.writeVarint(ri(1,ae));for(var ge=3===j?ne.length-1:ne.length,Ee=0;Ee<ge;Ee++){1===Ee&&1!==j&&P.writeVarint(ri(2,ge-1));var me=ne[Ee].x-W,We=ne[Ee].y-J;P.writeVarint(wi(me)),P.writeVarint(wi(We)),W+=me,J+=We}3===j&&P.writeVarint(ri(7,1))}}function Nr(q,P){var O=typeof q;"string"===O?P.writeStringField(1,q):"boolean"===O?P.writeBooleanField(7,q):"number"===O&&(q%1!=0?P.writeDoubleField(3,q):q<0?P.writeSVarintField(6,q):P.writeVarintField(5,q))}ot.exports=zr,ot.exports.fromVectorTileJs=zr,ot.exports.fromGeojsonVt=function(q,P){P=P||{};var O={};for(var j in q)O[j]=new lr(q[j].features,P),O[j].name=j,O[j].version=P.version,O[j].extent=P.extent;return zr({layers:O})},ot.exports.GeoJSONWrapper=lr;var Wt=ot.exports;function Ui(q,P,O,j,W,J){if(W-j<=O)return;const re=j+W>>1;an(q,P,re,j,W,J%2),Ui(q,P,O,j,re-1,J+1),Ui(q,P,O,re+1,W,J+1)}function an(q,P,O,j,W,J){for(;W>j;){if(W-j>600){const ae=W-j+1,ge=O-j+1,Ee=Math.log(ae),me=.5*Math.exp(2*Ee/3),We=.5*Math.sqrt(Ee*me*(ae-me)/ae)*(ge-ae/2<0?-1:1);an(q,P,O,Math.max(j,Math.floor(O-ge*me/ae+We)),Math.min(W,Math.floor(O+(ae-ge)*me/ae+We)),J)}const re=P[2*O+J];let te=j,ne=W;for(Cn(q,P,j,O),P[2*W+J]>re&&Cn(q,P,j,W);te<ne;){for(Cn(q,P,te,ne),te++,ne--;P[2*te+J]<re;)te++;for(;P[2*ne+J]>re;)ne--}P[2*j+J]===re?Cn(q,P,j,ne):(ne++,Cn(q,P,ne,W)),ne<=O&&(j=ne+1),O<=ne&&(W=ne-1)}}function Cn(q,P,O,j){Xt(q,O,j),Xt(P,2*O,2*j),Xt(P,2*O+1,2*j+1)}function Xt(q,P,O){const j=q[P];q[P]=q[O],q[O]=j}function Le(q,P,O,j){const W=q-O,J=P-j;return W*W+J*J}const ht=q=>q[0],gt=q=>q[1];class di{constructor(P,O=ht,j=gt,W=64,J=Float64Array){this.nodeSize=W,this.points=P;const re=P.length<65536?Uint16Array:Uint32Array,te=this.ids=new re(P.length),ne=this.coords=new J(2*P.length);for(let ae=0;ae<P.length;ae++)te[ae]=ae,ne[2*ae]=O(P[ae]),ne[2*ae+1]=j(P[ae]);Ui(te,ne,W,0,te.length-1,0)}range(P,O,j,W){return function(J,re,te,ne,ae,ge,Ee){const me=[0,J.length-1,0],We=[];let He,Ye;for(;me.length;){const nt=me.pop(),at=me.pop(),Kt=me.pop();if(at-Kt<=Ee){for(let Ft=Kt;Ft<=at;Ft++)He=re[2*Ft],Ye=re[2*Ft+1],He>=te&&He<=ae&&Ye>=ne&&Ye<=ge&&We.push(J[Ft]);continue}const bt=Math.floor((Kt+at)/2);He=re[2*bt],Ye=re[2*bt+1],He>=te&&He<=ae&&Ye>=ne&&Ye<=ge&&We.push(J[bt]);const lt=(nt+1)%2;(0===nt?te<=He:ne<=Ye)&&(me.push(Kt),me.push(bt-1),me.push(lt)),(0===nt?ae>=He:ge>=Ye)&&(me.push(bt+1),me.push(at),me.push(lt))}return We}(this.ids,this.coords,P,O,j,W,this.nodeSize)}within(P,O,j){return function(W,J,re,te,ne,ae){const ge=[0,W.length-1,0],Ee=[],me=ne*ne;for(;ge.length;){const We=ge.pop(),He=ge.pop(),Ye=ge.pop();if(He-Ye<=ae){for(let lt=Ye;lt<=He;lt++)Le(J[2*lt],J[2*lt+1],re,te)<=me&&Ee.push(W[lt]);continue}const nt=Math.floor((Ye+He)/2),at=J[2*nt],Kt=J[2*nt+1];Le(at,Kt,re,te)<=me&&Ee.push(W[nt]);const bt=(We+1)%2;(0===We?re-ne<=at:te-ne<=Kt)&&(ge.push(Ye),ge.push(nt-1),ge.push(bt)),(0===We?re+ne>=at:te+ne>=Kt)&&(ge.push(nt+1),ge.push(He),ge.push(bt))}return Ee}(this.ids,this.coords,P,O,j,this.nodeSize)}}const Ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:q=>q},ut=Math.fround||(uo=new Float32Array(1),q=>(uo[0]=+q,uo[0]));var uo;class ji{constructor(P){this.options=$s(Object.create(Ds),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:O,minZoom:j,maxZoom:W,nodeSize:J}=this.options;O&&console.time("total time");const re=`prepare ${P.length} points`;O&&console.time(re),this.points=P;let te=[];for(let ne=0;ne<P.length;ne++)P[ne].geometry&&te.push(Br(P[ne],ne));this.trees[W+1]=new di(te,Vr,ur,J,Float32Array),O&&console.timeEnd(re);for(let ne=W;ne>=j;ne--){const ae=+Date.now();te=this._cluster(te,ne),this.trees[ne]=new di(te,Vr,ur,J,Float32Array),O&&console.log("z%d: %d clusters in %dms",ne,te.length,+Date.now()-ae)}return O&&console.timeEnd("total time"),this}getClusters(P,O){let j=((P[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,P[1]));let J=180===P[2]?180:((P[2]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)j=-180,J=180;else if(j>J){const ge=this.getClusters([j,W,180,re],O),Ee=this.getClusters([-180,W,J,re],O);return ge.concat(Ee)}const te=this.trees[this._limitZoom(O)],ne=te.range($i(j),js(re),$i(J),js(W)),ae=[];for(const ge of ne){const Ee=te.points[ge];ae.push(Ee.numPoints?mn(Ee):this.points[Ee.index])}return ae}getChildren(P){const O=this._getOriginId(P),j=this._getOriginZoom(P),W="No cluster with the specified id.",J=this.trees[j];if(!J)throw new Error(W);const re=J.points[O];if(!re)throw new Error(W);const te=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ne=J.within(re.x,re.y,te),ae=[];for(const ge of ne){const Ee=J.points[ge];Ee.parentId===P&&ae.push(Ee.numPoints?mn(Ee):this.points[Ee.index])}if(0===ae.length)throw new Error(W);return ae}getLeaves(P,O,j){const W=[];return this._appendLeaves(W,P,O=O||10,j=j||0,0),W}getTile(P,O,j){const W=this.trees[this._limitZoom(P)],J=Math.pow(2,P),{extent:re,radius:te}=this.options,ne=te/re,ae=(j-ne)/J,ge=(j+1+ne)/J,Ee={features:[]};return this._addTileFeatures(W.range((O-ne)/J,ae,(O+1+ne)/J,ge),W.points,O,j,J,Ee),0===O&&this._addTileFeatures(W.range(1-ne/J,ae,1,ge),W.points,J,j,J,Ee),O===J-1&&this._addTileFeatures(W.range(0,ae,ne/J,ge),W.points,-1,j,J,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(P){let O=this._getOriginZoom(P)-1;for(;O<=this.options.maxZoom;){const j=this.getChildren(P);if(O++,1!==j.length)break;P=j[0].properties.cluster_id}return O}_appendLeaves(P,O,j,W,J){const re=this.getChildren(O);for(const te of re){const ne=te.properties;if(ne&&ne.cluster?J+ne.point_count<=W?J+=ne.point_count:J=this._appendLeaves(P,ne.cluster_id,j,W,J):J<W?J++:P.push(te),P.length===j)break}return J}_addTileFeatures(P,O,j,W,J,re){for(const te of P){const ne=O[te],ae=ne.numPoints;let ge,Ee,me;if(ae)ge=$t(ne),Ee=ne.x,me=ne.y;else{const Ye=this.points[ne.index];ge=Ye.properties,Ee=$i(Ye.geometry.coordinates[0]),me=js(Ye.geometry.coordinates[1])}const We={type:1,geometry:[[Math.round(this.options.extent*(Ee*J-j)),Math.round(this.options.extent*(me*J-W))]],tags:ge};let He;ae?He=ne.id:this.options.generateId?He=ne.index:this.points[ne.index].id&&(He=this.points[ne.index].id),void 0!==He&&(We.id=He),re.features.push(We)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(+P,this.options.maxZoom+1))}_cluster(P,O){const j=[],{radius:W,extent:J,reduce:re,minPoints:te}=this.options,ne=W/(J*Math.pow(2,O));for(let ae=0;ae<P.length;ae++){const ge=P[ae];if(ge.zoom<=O)continue;ge.zoom=O;const Ee=this.trees[O+1],me=Ee.within(ge.x,ge.y,ne),We=ge.numPoints||1;let He=We;for(const Ye of me){const nt=Ee.points[Ye];nt.zoom>O&&(He+=nt.numPoints||1)}if(He>We&&He>=te){let Ye=ge.x*We,nt=ge.y*We,at=re&&We>1?this._map(ge,!0):null;const Kt=(ae<<5)+(O+1)+this.points.length;for(const bt of me){const lt=Ee.points[bt];if(lt.zoom<=O)continue;lt.zoom=O;const Ft=lt.numPoints||1;Ye+=lt.x*Ft,nt+=lt.y*Ft,lt.parentId=Kt,re&&(at||(at=this._map(ge,!0)),re(at,this._map(lt)))}ge.parentId=Kt,j.push(co(Ye/He,nt/He,Kt,He,at))}else if(j.push(ge),He>1)for(const Ye of me){const nt=Ee.points[Ye];nt.zoom<=O||(nt.zoom=O,j.push(nt))}}return j}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,O){if(P.numPoints)return O?$s({},P.properties):P.properties;const j=this.points[P.index].properties,W=this.options.map(j);return O&&W===j?$s({},W):W}}function co(q,P,O,j,W){return{x:ut(q),y:ut(P),zoom:1/0,id:O,parentId:-1,numPoints:j,properties:W}}function Br(q,P){const[O,j]=q.geometry.coordinates;return{x:ut($i(O)),y:ut(js(j)),zoom:1/0,index:P,parentId:-1}}function mn(q){return{type:"Feature",id:q.id,properties:$t(q),geometry:{type:"Point",coordinates:[(P=q.x,360*(P-.5)),Fo(q.y)]}};var P}function $t(q){const P=q.numPoints,O=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return $s($s({},q.properties),{cluster:!0,cluster_id:q.id,point_count:P,point_count_abbreviated:O})}function $i(q){return q/360+.5}function js(q){const P=Math.sin(q*Math.PI/180),O=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return O<0?0:O>1?1:O}function Fo(q){const P=(180-360*q)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function $s(q,P){for(const O in P)q[O]=P[O];return q}function Vr(q){return q.x}function ur(q){return q.y}function Sr(q,P,O,j){for(var W,J=j,re=O-P>>1,te=O-P,ne=q[P],ae=q[P+1],ge=q[O],Ee=q[O+1],me=P+3;me<O;me+=3){var We=Ya(q[me],q[me+1],ne,ae,ge,Ee);if(We>J)W=me,J=We;else if(We===J){var He=Math.abs(me-re);He<te&&(W=me,te=He)}}J>j&&(W-P>3&&Sr(q,P,W,j),q[W+2]=J,O-W>3&&Sr(q,W,O,j))}function Ya(q,P,O,j,W,J){var re=W-O,te=J-j;if(0!==re||0!==te){var ne=((q-O)*re+(P-j)*te)/(re*re+te*te);ne>1?(O=W,j=J):ne>0&&(O+=re*ne,j+=te*ne)}return(re=q-O)*re+(te=P-j)*te}function us(q,P,O,j){var W={id:void 0===q?null:q,type:P,geometry:O,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var re=J.geometry,te=J.type;if("Point"===te||"MultiPoint"===te||"LineString"===te)xn(J,re);else if("Polygon"===te||"MultiLineString"===te)for(var ne=0;ne<re.length;ne++)xn(J,re[ne]);else if("MultiPolygon"===te)for(ne=0;ne<re.length;ne++)for(var ae=0;ae<re[ne].length;ae++)xn(J,re[ne][ae])}(W),W}function xn(q,P){for(var O=0;O<P.length;O+=3)q.minX=Math.min(q.minX,P[O]),q.minY=Math.min(q.minY,P[O+1]),q.maxX=Math.max(q.maxX,P[O]),q.maxY=Math.max(q.maxY,P[O+1])}function Es(q,P,O,j){if(P.geometry){var W=P.geometry.coordinates,J=P.geometry.type,re=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),te=[],ne=P.id;if(O.promoteId?ne=P.properties[O.promoteId]:O.generateId&&(ne=j||0),"Point"===J)Yn(W,te);else if("MultiPoint"===J)for(var ae=0;ae<W.length;ae++)Yn(W[ae],te);else if("LineString"===J)Rn(W,te,re,!1);else if("MultiLineString"===J){if(O.lineMetrics){for(ae=0;ae<W.length;ae++)Rn(W[ae],te=[],re,!1),q.push(us(ne,"LineString",te,P.properties));return}Oo(W,te,re,!1)}else if("Polygon"===J)Oo(W,te,re,!0);else{if("MultiPolygon"!==J){if("GeometryCollection"===J){for(ae=0;ae<P.geometry.geometries.length;ae++)Es(q,{id:ne,geometry:P.geometry.geometries[ae],properties:P.properties},O,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<W.length;ae++){var ge=[];Oo(W[ae],ge,re,!0),te.push(ge)}}q.push(us(ne,J,te,P.properties))}}function Yn(q,P){P.push(Ur(q[0])),P.push(cs(q[1])),P.push(0)}function Rn(q,P,O,j){for(var W,J,re=0,te=0;te<q.length;te++){var ne=Ur(q[te][0]),ae=cs(q[te][1]);P.push(ne),P.push(ae),P.push(0),te>0&&(re+=j?(W*ae-ne*J)/2:Math.sqrt(Math.pow(ne-W,2)+Math.pow(ae-J,2))),W=ne,J=ae}var ge=P.length-3;P[2]=1,Sr(P,0,ge,O),P[ge+2]=1,P.size=Math.abs(re),P.start=0,P.end=P.size}function Oo(q,P,O,j){for(var W=0;W<q.length;W++){var J=[];Rn(q[W],J,O,j),P.push(J)}}function Ur(q){return q/360+.5}function cs(q){var P=Math.sin(q*Math.PI/180),O=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return O<0?0:O>1?1:O}function Ir(q,P,O,j,W,J,re,te){if(j/=P,J>=(O/=P)&&re<j)return q;if(re<O||J>=j)return null;for(var ne=[],ae=0;ae<q.length;ae++){var ge=q[ae],Ee=ge.geometry,me=ge.type,We=0===W?ge.minX:ge.minY,He=0===W?ge.maxX:ge.maxY;if(We>=O&&He<j)ne.push(ge);else if(!(He<O||We>=j)){var Ye=[];if("Point"===me||"MultiPoint"===me)ha(Ee,Ye,O,j,W);else if("LineString"===me)fi(Ee,Ye,O,j,W,!1,te.lineMetrics);else if("MultiLineString"===me)fo(Ee,Ye,O,j,W,!1);else if("Polygon"===me)fo(Ee,Ye,O,j,W,!0);else if("MultiPolygon"===me)for(var nt=0;nt<Ee.length;nt++){var at=[];fo(Ee[nt],at,O,j,W,!0),at.length&&Ye.push(at)}if(Ye.length){if(te.lineMetrics&&"LineString"===me){for(nt=0;nt<Ye.length;nt++)ne.push(us(ge.id,me,Ye[nt],ge.tags));continue}"LineString"!==me&&"MultiLineString"!==me||(1===Ye.length?(me="LineString",Ye=Ye[0]):me="MultiLineString"),"Point"!==me&&"MultiPoint"!==me||(me=3===Ye.length?"Point":"MultiPoint"),ne.push(us(ge.id,me,Ye,ge.tags))}}}return ne.length?ne:null}function ha(q,P,O,j,W){for(var J=0;J<q.length;J+=3){var re=q[J+W];re>=O&&re<=j&&(P.push(q[J]),P.push(q[J+1]),P.push(q[J+2]))}}function fi(q,P,O,j,W,J,re){for(var te,ne,ae=ho(q),ge=0===W?Hs:Jn,Ee=q.start,me=0;me<q.length-3;me+=3){var We=q[me],He=q[me+1],Ye=q[me+2],nt=q[me+3],at=q[me+4],Kt=0===W?We:He,bt=0===W?nt:at,lt=!1;re&&(te=Math.sqrt(Math.pow(We-nt,2)+Math.pow(He-at,2))),Kt<O?bt>O&&(ne=ge(ae,We,He,nt,at,O),re&&(ae.start=Ee+te*ne)):Kt>j?bt<j&&(ne=ge(ae,We,He,nt,at,j),re&&(ae.start=Ee+te*ne)):Ln(ae,We,He,Ye),bt<O&&Kt>=O&&(ne=ge(ae,We,He,nt,at,O),lt=!0),bt>j&&Kt<=j&&(ne=ge(ae,We,He,nt,at,j),lt=!0),!J&&lt&&(re&&(ae.end=Ee+te*ne),P.push(ae),ae=ho(q)),re&&(Ee+=te)}var Ft=q.length-3;We=q[Ft],He=q[Ft+1],Ye=q[Ft+2],(Kt=0===W?We:He)>=O&&Kt<=j&&Ln(ae,We,He,Ye),Ft=ae.length-3,J&&Ft>=3&&(ae[Ft]!==ae[0]||ae[Ft+1]!==ae[1])&&Ln(ae,ae[0],ae[1],ae[2]),ae.length&&P.push(ae)}function ho(q){var P=[];return P.size=q.size,P.start=q.start,P.end=q.end,P}function fo(q,P,O,j,W,J){for(var re=0;re<q.length;re++)fi(q[re],P,O,j,W,J,!1)}function Ln(q,P,O,j){q.push(P),q.push(O),q.push(j)}function Hs(q,P,O,j,W,J){var re=(J-P)/(j-P);return q.push(J),q.push(O+(W-O)*re),q.push(1),re}function Jn(q,P,O,j,W,J){var re=(J-O)/(W-O);return q.push(P+(j-P)*re),q.push(J),q.push(1),re}function ii(q,P){for(var O=[],j=0;j<q.length;j++){var W,J=q[j],re=J.type;if("Point"===re||"MultiPoint"===re||"LineString"===re)W=Qn(J.geometry,P);else if("MultiLineString"===re||"Polygon"===re){W=[];for(var te=0;te<J.geometry.length;te++)W.push(Qn(J.geometry[te],P))}else if("MultiPolygon"===re)for(W=[],te=0;te<J.geometry.length;te++){for(var ne=[],ae=0;ae<J.geometry[te].length;ae++)ne.push(Qn(J.geometry[te][ae],P));W.push(ne)}O.push(us(J.id,re,W,J.tags))}return O}function Qn(q,P){var O=[];O.size=q.size,void 0!==q.start&&(O.start=q.start,O.end=q.end);for(var j=0;j<q.length;j+=3)O.push(q[j]+P,q[j+1],q[j+2]);return O}function da(q,P){if(q.transformed)return q;var O,j,W,J=1<<q.z,re=q.x,te=q.y;for(O=0;O<q.features.length;O++){var ne=q.features[O],ae=ne.geometry,ge=ne.type;if(ne.geometry=[],1===ge)for(j=0;j<ae.length;j+=2)ne.geometry.push(qs(ae[j],ae[j+1],P,J,re,te));else for(j=0;j<ae.length;j++){var Ee=[];for(W=0;W<ae[j].length;W+=2)Ee.push(qs(ae[j][W],ae[j][W+1],P,J,re,te));ne.geometry.push(Ee)}}return q.transformed=!0,q}function qs(q,P,O,j,W,J){return[Math.round(O*(q*j-W)),Math.round(O*(P*j-J))]}function zo(q,P,O,j,W){for(var J=P===W.maxZoom?0:W.tolerance/((1<<P)*W.extent),re={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:j,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<q.length;te++){re.numFeatures++,Ja(re,q[te],J,W);var ne=q[te].minX,ae=q[te].minY,ge=q[te].maxX,Ee=q[te].maxY;ne<re.minX&&(re.minX=ne),ae<re.minY&&(re.minY=ae),ge>re.maxX&&(re.maxX=ge),Ee>re.maxY&&(re.maxY=Ee)}return re}function Ja(q,P,O,j){var W=P.geometry,J=P.type,re=[];if("Point"===J||"MultiPoint"===J)for(var te=0;te<W.length;te+=3)re.push(W[te]),re.push(W[te+1]),q.numPoints++,q.numSimplified++;else if("LineString"===J)No(re,W,q,O,!1,!1);else if("MultiLineString"===J||"Polygon"===J)for(te=0;te<W.length;te++)No(re,W[te],q,O,"Polygon"===J,0===te);else if("MultiPolygon"===J)for(var ne=0;ne<W.length;ne++){var ae=W[ne];for(te=0;te<ae.length;te++)No(re,ae[te],q,O,!0,0===te)}if(re.length){var ge=P.tags||null;if("LineString"===J&&j.lineMetrics){for(var Ee in ge={},P.tags)ge[Ee]=P.tags[Ee];ge.mapbox_clip_start=W.start/W.size,ge.mapbox_clip_end=W.end/W.size}var me={geometry:re,type:"Polygon"===J||"MultiPolygon"===J?3:"LineString"===J||"MultiLineString"===J?2:1,tags:ge};null!==P.id&&(me.id=P.id),q.features.push(me)}}function No(q,P,O,j,W,J){var re=j*j;if(j>0&&P.size<(W?re:j))O.numPoints+=P.length/3;else{for(var te=[],ne=0;ne<P.length;ne+=3)(0===j||P[ne+2]>re)&&(O.numSimplified++,te.push(P[ne]),te.push(P[ne+1])),O.numPoints++;W&&function(ae,ge){for(var Ee=0,me=0,We=ae.length,He=We-2;me<We;He=me,me+=2)Ee+=(ae[me]-ae[He])*(ae[me+1]+ae[He+1]);if(Ee>0===ge)for(me=0,We=ae.length;me<We/2;me+=2){var Ye=ae[me],nt=ae[me+1];ae[me]=ae[We-2-me],ae[me+1]=ae[We-1-me],ae[We-2-me]=Ye,ae[We-1-me]=nt}}(te,J),q.push(te)}}function Bo(q,P){var O=(P=this.options=function(W,J){for(var re in J)W[re]=J[re];return W}(Object.create(this.options),P)).debug;if(O&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var W,J,re,te,ne,ae,j=function(W,J){var re=[];if("FeatureCollection"===W.type)for(var te=0;te<W.features.length;te++)Es(re,W.features[te],J,te);else Es(re,"Feature"===W.type?W:{geometry:W},J);return re}(q,P);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=W=j,ne=Ir(W,1,-1-(re=(J=P).buffer/J.extent),re,0,-1,2,J),ae=Ir(W,1,1-re,2+re,0,-1,2,J),(ne||ae)&&(te=Ir(W,1,-re,1+re,0,-1,2,J)||[],ne&&(te=ii(ne,1).concat(te)),ae&&(te=te.concat(ii(ae,-1)))),(j=te).length&&this.splitTile(j,0,0,0),O&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jr(q,P,O){return 32*((1<<q)*O+P)+q}function fa(q,P){const O=q.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const j=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!j)return P(null,null);const W=new nn(j.features);let J=Wt(W);0===J.byteOffset&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),P(null,{vectorTile:W,rawData:J.buffer})}Bo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bo.prototype.splitTile=function(q,P,O,j,W,J,re){for(var te=[q,P,O,j],ne=this.options,ae=ne.debug;te.length;){j=te.pop(),O=te.pop(),P=te.pop(),q=te.pop();var ge=1<<P,Ee=jr(P,O,j),me=this.tiles[Ee];if(!me&&(ae>1&&console.time("creation"),me=this.tiles[Ee]=zo(q,P,O,j,ne),this.tileCoords.push({z:P,x:O,y:j}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,O,j,me.numFeatures,me.numPoints,me.numSimplified),console.timeEnd("creation"));var We="z"+P;this.stats[We]=(this.stats[We]||0)+1,this.total++}if(me.source=q,W){if(P===ne.maxZoom||P===W)continue;var He=1<<W-P;if(O!==Math.floor(J/He)||j!==Math.floor(re/He))continue}else if(P===ne.indexMaxZoom||me.numPoints<=ne.indexMaxPoints)continue;if(me.source=null,0!==q.length){ae>1&&console.time("clipping");var Ye,nt,at,Kt,bt,lt,Ft=.5*ne.buffer/ne.extent,dt=.5-Ft,wt=.5+Ft,yt=1+Ft;Ye=nt=at=Kt=null,bt=Ir(q,ge,O-Ft,O+wt,0,me.minX,me.maxX,ne),lt=Ir(q,ge,O+dt,O+yt,0,me.minX,me.maxX,ne),q=null,bt&&(Ye=Ir(bt,ge,j-Ft,j+wt,1,me.minY,me.maxY,ne),nt=Ir(bt,ge,j+dt,j+yt,1,me.minY,me.maxY,ne),bt=null),lt&&(at=Ir(lt,ge,j-Ft,j+wt,1,me.minY,me.maxY,ne),Kt=Ir(lt,ge,j+dt,j+yt,1,me.minY,me.maxY,ne),lt=null),ae>1&&console.timeEnd("clipping"),te.push(Ye||[],P+1,2*O,2*j),te.push(nt||[],P+1,2*O,2*j+1),te.push(at||[],P+1,2*O+1,2*j),te.push(Kt||[],P+1,2*O+1,2*j+1)}}},Bo.prototype.getTile=function(q,P,O){var j=this.options,W=j.extent,J=j.debug;if(q<0||q>24)return null;var re=1<<q,te=jr(q,P=(P%re+re)%re,O);if(this.tiles[te])return da(this.tiles[te],W);J>1&&console.log("drilling down to z%d-%d-%d",q,P,O);for(var ne,ae=q,ge=P,Ee=O;!ne&&ae>0;)ae--,ge=Math.floor(ge/2),Ee=Math.floor(Ee/2),ne=this.tiles[jr(ae,ge,Ee)];return ne&&ne.source?(J>1&&console.log("found parent tile z%d-%d-%d",ae,ge,Ee),J>1&&console.time("drilling down"),this.splitTile(ne.source,ae,ge,Ee,q,P,O),J>1&&console.timeEnd("drilling down"),this.tiles[te]?da(this.tiles[te],W):null):null};class Fn extends pn{constructor(P,O,j,W){super(P,O,j,fa),W&&(this.loadGeoJSON=W)}loadData(P,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=O,this._pendingLoadDataParams=P,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const P=this._pendingCallback,O=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const j=!!(O&&O.request&&O.request.collectResourceTiming)&&new y.RequestPerformance(O.request);this.loadGeoJSON(O,(W,J)=>{if(W||!J)return P(W);if("object"!=typeof J)return P(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{on(J,!0);try{if(O.filter){const te=y.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===te.result)throw new Error(te.value.map(ae=>`${ae.key}: ${ae.message}`).join(", "));const ne=J.features.filter(ae=>te.value.evaluate({zoom:0},ae));J={type:"FeatureCollection",features:ne}}this._geoJSONIndex=O.cluster?new ji(function({superclusterOptions:te,clusterProperties:ne}){if(!ne||!te)return te;const ae={},ge={},Ee={accumulated:null,zoom:0},me={properties:null},We=Object.keys(ne);for(const He of We){const[Ye,nt]=ne[He],at=y.createExpression(nt),Kt=y.createExpression("string"==typeof Ye?[Ye,["accumulated"],["get",He]]:Ye);ae[He]=at.value,ge[He]=Kt.value}return te.map=He=>{me.properties=He;const Ye={};for(const nt of We)Ye[nt]=ae[nt].evaluate(Ee,me);return Ye},te.reduce=(He,Ye)=>{me.properties=Ye;for(const nt of We)Ee.accumulated=He[nt],He[nt]=ge[nt].evaluate(Ee,me)},te}(O)).load(J.features):new Bo(te=J,O.geojsonVtOptions)}catch(te){return P(te)}this.loaded={};const re={};if(j){const te=j.finish();te&&(re.resourceTiming={},re.resourceTiming[O.source]=JSON.parse(JSON.stringify(te)))}P(null,re)}var te})}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(P,O){const j=this.loaded;return j&&j[P.uid]?super.reloadTile(P,O):this.loadTile(P,O)}loadGeoJSON(P,O){if(P.request)y.getJSON(P.request,O);else{if("string"!=typeof P.data)return O(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return O(null,JSON.parse(P.data))}catch{return O(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}removeSource(P,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(P,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(j){O(j)}}getClusterChildren(P,O){try{O(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(j){O(j)}}getClusterLeaves(P,O){try{O(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(j){O(j)}}}class Di{constructor(P){this.self=P,this.actor=new y.Actor(P,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:pn,geojson:Fn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,j)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=j},this.self.registerRTLTextPlugin=O=>{if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=O.applyArabicShaping,y.plugin.processBidirectionalText=O.processBidirectionalText,y.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(P,O){this.referrer=O}setImages(P,O,j){this.availableImages[P]=O;for(const W in this.workerSources[P]){const J=this.workerSources[P][W];for(const re in J)J[re].availableImages=O}j()}setLayers(P,O,j){this.getLayerIndex(P).replace(O),j()}updateLayers(P,O,j){this.getLayerIndex(P).update(O.layers,O.removedIds),j()}loadTile(P,O,j){this.getWorkerSource(P,O.type,O.source).loadTile(O,j)}loadDEMTile(P,O,j){this.getDEMWorkerSource(P,O.source).loadTile(O,j)}reloadTile(P,O,j){this.getWorkerSource(P,O.type,O.source).reloadTile(O,j)}abortTile(P,O,j){this.getWorkerSource(P,O.type,O.source).abortTile(O,j)}removeTile(P,O,j){this.getWorkerSource(P,O.type,O.source).removeTile(O,j)}removeDEMTile(P,O){this.getDEMWorkerSource(P,O.source).removeTile(O)}removeSource(P,O,j){if(!this.workerSources[P]||!this.workerSources[P][O.type]||!this.workerSources[P][O.type][O.source])return;const W=this.workerSources[P][O.type][O.source];delete this.workerSources[P][O.type][O.source],void 0!==W.removeSource?W.removeSource(O,j):j()}loadWorkerSource(P,O,j){try{this.self.importScripts(O.url),j()}catch(W){j(W.toString())}}syncRTLPluginState(P,O,j){try{y.plugin.setState(O);const W=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&null!=W){this.self.importScripts(W);const J=y.plugin.isParsed();j(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${W}`),J)}}catch(W){j(W.toString())}}getAvailableImages(P){let O=this.availableImages[P];return O||(O=[]),O}getLayerIndex(P){let O=this.layerIndexes[P];return O||(O=this.layerIndexes[P]=new hi),O}getWorkerSource(P,O,j){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][O]||(this.workerSources[P][O]={}),this.workerSources[P][O][j]||(this.workerSources[P][O][j]=new this.workerSourceTypes[O]({send:(J,re,te)=>{this.actor.send(J,re,te,P)}},this.getLayerIndex(P),this.getAvailableImages(P))),this.workerSources[P][O][j]}getDEMWorkerSource(P,O){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][O]||(this.demWorkerSources[P][O]=new _n),this.demWorkerSources[P][O]}enforceCacheSizeLimit(P,O){y.enforceCacheSizeLimit(O)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Di(self)),Di}),Us(0,function(y){var hn=ci;function ci(d){return s=d,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,g,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{g=new Worker(E),p=!0}catch{p=!1}return g&&g.terminate(),URL.revokeObjectURL(E),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var g=p.getContext("2d");if(!g)return!1;var b=g.getImageData(0,0,1,1);return b&&b.width===p.width}()||(void 0===hi[c=s&&s.failIfMajorPerformanceCaveat]&&(hi[c]=function(p){var g,E,S,T,b=(E=p,S=document.createElement("canvas"),(T=Object.create(ci.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,S.getContext("webgl",T)||S.getContext("experimental-webgl",T));if(!b)return!1;try{g=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!g||b.isContextLost())&&(b.shaderSource(g,"void main() {}"),b.compileShader(g),!0===b.getShaderParameter(g,b.COMPILE_STATUS))}(c)),!hi[c]||document.documentMode));var s,c}var hi={};function Ze(d,s){if(Array.isArray(d)){if(!Array.isArray(s)||d.length!==s.length)return!1;for(let c=0;c<d.length;c++)if(!Ze(d[c],s[c]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==s){if("object"!=typeof s||Object.keys(d).length!==Object.keys(s).length)return!1;for(const c in d)if(!Ze(d[c],s[c]))return!1;return!0}return d===s}ci.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class ue{static testProp(s){if(!ue.docStyle)return s[0];for(let c=0;c<s.length;c++)if(s[c]in ue.docStyle)return s[c];return s[0]}static create(s,c,p){const g=window.document.createElement(s);return void 0!==c&&(g.className=c),p&&p.appendChild(g),g}static createNS(s,c){return window.document.createElementNS(s,c)}static disableDrag(){ue.docStyle&&ue.selectProp&&(ue.userSelect=ue.docStyle[ue.selectProp],ue.docStyle[ue.selectProp]="none")}static enableDrag(){ue.docStyle&&ue.selectProp&&(ue.docStyle[ue.selectProp]=ue.userSelect)}static setTransform(s,c){s.style[ue.transformProp]=c}static addEventListener(s,c,p,g={}){s.addEventListener(c,p,"passive"in g?g:g.capture)}static removeEventListener(s,c,p,g={}){s.removeEventListener(c,p,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",ue.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ue.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ue.suppressClickInternal,!0)},0)}static mousePos(s,c){const p=s.getBoundingClientRect();return new y.Point(c.clientX-p.left-s.clientLeft,c.clientY-p.top-s.clientTop)}static touchPos(s,c){const p=s.getBoundingClientRect(),g=[];for(let b=0;b<c.length;b++)g.push(new y.Point(c[b].clientX-p.left-s.clientLeft,c[b].clientY-p.top-s.clientTop));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}ue.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,ue.selectProp=ue.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ue.transformProp=ue.testProp(["transform","WebkitTransform"]);class jt{constructor(s){this._transformRequestFn=s}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeSpriteURL(s,c,p){const g=function(b){const E=b.match(Pt);if(!E)throw new Error(`Unable to parse URL "${b}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(s);return g.path+=`${c}${p}`,function(b){const E=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${E}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const Pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pn(d){var s=new y.ARRAY_TYPE(3);return s[0]=d[0],s[1]=d[1],s[2]=d[2],s}function _n(d,s,c){var p=new y.ARRAY_TYPE(3);return p[0]=d,p[1]=s,p[2]=c,p}var on,ar=function(d,s,c){return d[0]=s[0]-c[0],d[1]=s[1]-c[1],d[2]=s[2]-c[2],d};on=new y.ARRAY_TYPE(3),y.ARRAY_TYPE!=Float32Array&&(on[0]=0,on[1]=0,on[2]=0);var d,rr=function(d){var s=d[0],c=d[1];return s*s+c*c};d=new y.ARRAY_TYPE(2),y.ARRAY_TYPE!=Float32Array&&(d[0]=0,d[1]=0);class vn{constructor(s,c,p,g){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(c,g)}update(s,c,p){const{width:g,height:b}=s,E=!(this.size&&this.size[0]===g&&this.size[1]===b||p),{context:S}=this,{gl:T}=S;if(this.useMipmap=Boolean(c&&c.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!c||!1!==c.premultiply)),E)this.size=[g,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||y.isImageBitmap(s)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,s):T.texImage2D(T.TEXTURE_2D,0,this.format,g,b,0,this.format,T.UNSIGNED_BYTE,s.data);else{const{x:k,y:F}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||y.isImageBitmap(s)?T.texSubImage2D(T.TEXTURE_2D,0,k,F,T.RGBA,T.UNSIGNED_BYTE,s):T.texSubImage2D(T.TEXTURE_2D,0,k,F,g,b,T.RGBA,T.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(s,c,p){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||s),this.filter=s),c!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,c),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function kn(d){const{userImage:s}=d;return!!(s&&s.render&&s.render())&&(d.data.replace(new Uint8Array(s.data.buffer)),!0)}class nn extends y.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:c,callback:p}of this.requestors)this._notify(c,p);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,c){this._validate(s,c)&&(this.images[s]=c)}_validate(s,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new y.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new y.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new y.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,c){if(!s)return!0;let p=0;for(const g of s){if(g[0]<p||g[1]<g[0]||c<g[1])return!1;p=g[1]}return!0}_validateContent(s,c){return!(s&&(4!==s.length||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c){c.version=this.images[s].version+1,this.images[s]=c,this.updatedImages[s]=!0}removeImage(s){const c=this.images[s];delete this.images[s],delete this.patterns[s],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,c){let p=!0;if(!this.isLoaded())for(const g of s)this.images[g]||(p=!1);this.isLoaded()||p?this._notify(s,c):this.requestors.push({ids:s,callback:c})}_notify(s,c){const p={};for(const g of s){this.images[g]||this.fire(new y.Event("styleimagemissing",{id:g}));const b=this.images[g];b?p[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:y.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,p)}getPixelSize(){const{width:s,height:c}=this.atlasImage;return{width:s,height:c}}getPattern(s){const c=this.patterns[s],p=this.getImage(s);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new y.ImagePosition(g,p);this.patterns[s]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const c=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new vn(s,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:c,h:p}=y.potpack(s),g=this.atlasImage;g.resize({width:c||1,height:p||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],S=E.x+1,T=E.y+1,k=this.images[b].data,F=k.width,B=k.height;y.RGBAImage.copy(k,g,{x:0,y:0},{x:S,y:T},{width:F,height:B}),y.RGBAImage.copy(k,g,{x:0,y:B-1},{x:S,y:T-1},{width:F,height:1}),y.RGBAImage.copy(k,g,{x:0,y:0},{x:S,y:T+B},{width:F,height:1}),y.RGBAImage.copy(k,g,{x:F-1,y:0},{x:S-1,y:T},{width:1,height:B}),y.RGBAImage.copy(k,g,{x:0,y:0},{x:S+F,y:T},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const c of s){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.images[c];kn(p)&&this.updateImage(c,p)}}}const ot=1e20;function kt(d,s,c,p,g,b,E,S,T){for(let k=s;k<s+p;k++)qn(d,c*b+k,b,g,E,S,T);for(let k=c;k<c+g;k++)qn(d,k*b+s,1,p,E,S,T)}function qn(d,s,c,p,g,b,E){b[0]=0,E[0]=-ot,E[1]=ot,g[0]=d[s];for(let S=1,T=0,k=0;S<p;S++){g[S]=d[s+S*c];const F=S*S;do{const B=b[T];k=(g[S]-g[B]+F-B*B)/(S-B)/2}while(k<=E[T]&&--T>-1);T++,b[T]=S,E[T]=k,E[T+1]=ot}for(let S=0,T=0;S<p;S++){for(;E[T+1]<S;)T++;const k=b[T],F=S-k;d[s+S*c]=g[k]+F*F}}class Gn{constructor(s,c){this.requestManager=s,this.localIdeographFontFamily=c,this.entries={}}setURL(s){this.url=s}getGlyphs(s,c){const p=[];for(const g in s)for(const b of s[g])p.push({stack:g,id:b});y.asyncAll(p,({stack:g,id:b},E)=>{let S=this.entries[g];S||(S=this.entries[g]={glyphs:{},requests:{},ranges:{}});let T=S.glyphs[b];if(void 0!==T)return void E(null,{stack:g,id:b,glyph:T});if(T=this._tinySDF(S,g,b),T)return S.glyphs[b]=T,void E(null,{stack:g,id:b,glyph:T});const k=Math.floor(b/256);if(256*k>65535)return void E(new Error("glyphs > 65535 not supported"));if(S.ranges[k])return void E(null,{stack:g,id:b,glyph:T});let F=S.requests[k];F||(F=S.requests[k]=[],Gn.loadGlyphRange(g,k,this.url,this.requestManager,(B,H)=>{if(H){for(const X in H)this._doesCharSupportLocalGlyph(+X)||(S.glyphs[+X]=H[+X]);S.ranges[k]=!0}for(const X of F)X(B,H);delete S.requests[k]})),F.push((B,H)=>{B?E(B):H&&E(null,{stack:g,id:b,glyph:H[b]||null})})},(g,b)=>{if(g)c(g);else if(b){const E={};for(const{stack:S,id:T,glyph:k}of b)(E[S]||(E[S]={}))[T]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};c(null,E)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(y.unicodeBlockLookup["CJK Unified Ideographs"](s)||y.unicodeBlockLookup["Hangul Syllables"](s)||y.unicodeBlockLookup.Hiragana(s)||y.unicodeBlockLookup.Katakana(s))}_tinySDF(s,c,p){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let b=s.tinySDF;if(!b){let E="400";/bold/i.test(c)?E="900":/medium/i.test(c)?E="500":/light/i.test(c)&&(E="200"),b=s.tinySDF=new Gn.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:g,fontWeight:E})}return{id:p,bitmap:new y.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(p)).data),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}}Gn.loadGlyphRange=function(d,s,c,p,g){const b=256*s,E=b+255,S=p.transformRequest(c.replace("{fontstack}",d).replace("{range}",`${b}-${E}`),y.ResourceType.Glyphs);y.getArrayBuffer(S,(T,k)=>{if(T)g(T);else if(k){const F={};for(const B of y.parseGlyphPBF(k))F[B.id]=B;g(null,F)}})},Gn.TinySDF=class{constructor({fontSize:d=24,buffer:s=3,radius:c=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:E="normal"}){this.buffer=s,this.cutoff=p,this.radius=c;const S=this.size=d+4*s,T=this._createCanvas(S),k=this.ctx=T.getContext("2d",{willReadFrequently:!0});k.font=`${E} ${b} ${d}px ${g}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(d){const s=document.createElement("canvas");return s.width=s.height=d,s}draw(d){const{width:s,actualBoundingBoxAscent:c,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(d),E=Math.floor(c),S=Math.min(this.size-this.buffer,Math.ceil(b-g)),T=Math.min(this.size-this.buffer,Math.ceil(c)+Math.ceil(p)),k=S+2*this.buffer,F=T+2*this.buffer,B=k*F,H=new Uint8ClampedArray(B),X={data:H,width:k,height:F,glyphWidth:S,glyphHeight:T,glyphTop:E,glyphLeft:0,glyphAdvance:s};if(0===S||0===T)return X;const{ctx:Z,buffer:V,gridInner:ee,gridOuter:ie}=this;Z.clearRect(V,V,S,T),Z.fillText(d,V,V+E+1);const le=Z.getImageData(V,V,S,T);ie.fill(ot,0,B),ee.fill(0,0,B);for(let oe=0;oe<T;oe++)for(let be=0;be<S;be++){const de=le.data[4*(oe*S+be)+3]/255;if(0===de)continue;const ye=(oe+V)*k+be+V;if(1===de)ie[ye]=0,ee[ye]=ot;else{const Se=.5-de;ie[ye]=Se>0?Se*Se:0,ee[ye]=Se<0?Se*Se:0}}kt(ie,0,0,k,F,k,this.f,this.v,this.z),kt(ee,V,V,S,T,k,this.f,this.v,this.z);for(let oe=0;oe<B;oe++){const be=Math.sqrt(ie[oe])-Math.sqrt(ee[oe]);H[oe]=Math.round(255-255*(be/this.radius+this.cutoff))}return X}};const vr=new y.Properties({anchor:new y.DataConstantProperty(y.spec.light.anchor),position:new class{constructor(){this.specification=y.spec.light.position}possiblyEvaluate(d,s){return y.sphericalToCartesian(d.expression.evaluate(s))}interpolate(d,s,c){return{x:y.number(d.x,s.x,c),y:y.number(d.y,s.y,c),z:y.number(d.z,s.z,c)}}},color:new y.DataConstantProperty(y.spec.light.color),intensity:new y.DataConstantProperty(y.spec.light.intensity)}),Fr="-transition";class Or extends y.Evented{constructor(s){super(),this._transitionable=new y.Transitionable(vr),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c={}){if(!this._validate(y.validateLight,s,c))for(const p in s){const g=s[p];p.endsWith(Fr)?this._transitionable.setTransition(p.slice(0,-Fr.length),g):this._transitionable.setValue(p,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,p){return(!p||!1!==p.validate)&&y.emitValidationErrors(this,s.call(y.validateStyle,y.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:y.spec})))}}class lr{constructor(s,c){this.width=s,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,c){const p=s.join(",")+String(c);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,c)),this.dashEntry[p]}getDashRanges(s,c,p){const g=[];let b=s.length%2==1?-s[s.length-1]*p:0,E=s[0]*p,S=!0;g.push({left:b,right:E,isDash:S,zeroLength:0===s[0]});let T=s[0];for(let k=1;k<s.length;k++){S=!S;const F=s[k];b=T*p,T+=F,E=T*p,g.push({left:b,right:E,isDash:S,zeroLength:0===F})}return g}addRoundDash(s,c,p){const g=c/2;for(let b=-p;b<=p;b++){const E=this.width*(this.nextRow+p+b);let S=0,T=s[S];for(let k=0;k<this.width;k++){k/T.right>1&&(T=s[++S]);const F=Math.abs(k-T.left),B=Math.abs(k-T.right),H=Math.min(F,B);let X;const Z=b/p*(g+1);if(T.isDash){const V=g-Math.abs(Z);X=Math.sqrt(H*H+V*V)}else X=g-Math.sqrt(H*H+Z*Z);this.data[E+k]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(s){for(let S=s.length-1;S>=0;--S){const T=s[S],k=s[S+1];T.zeroLength?s.splice(S,1):k&&k.isDash===T.isDash&&(k.left=T.left,s.splice(S,1))}const c=s[0],p=s[s.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const g=this.width*this.nextRow;let b=0,E=s[b];for(let S=0;S<this.width;S++){S/E.right>1&&(E=s[++b]);const T=Math.abs(S-E.left),k=Math.abs(S-E.right),F=Math.min(T,k);this.data[g+S]=Math.max(0,Math.min(255,(E.isDash?F:-F)+128))}}addDash(s,c){const p=c?7:0,g=2*p+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;let b=0;for(let S=0;S<s.length;S++)b+=s[S];if(0!==b){const S=this.width/b,T=this.getDashRanges(s,this.width,S);c?this.addRoundDash(T,S,p):this.addRegularDash(T)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=g,this.dirty=!0,E}bind(s){const c=s.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}class zr{constructor(s,c){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=y.uniqueId();const p=this.workerPool.acquire(this.id);for(let g=0;g<p.length;g++){const b=new zr.Actor(p[g],c,this.id);b.name=`Worker ${g}`,this.actors.push(b)}}broadcast(s,c,p){y.asyncAll(this.actors,(g,b)=>{g.send(s,c,b)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Kn(d,s,c){const p=function(g,b){if(g)return c(g);if(b){const E=y.pick(y.extend(b,d),["tiles","minzoom","maxzoom","attribution","maplibreLogo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),c(null,E)}};return d.url?y.getJSON(s.transformRequest(d.url,y.ResourceType.Source),p):y.exported.frame(()=>p(null,d))}zr.Actor=y.Actor;class Zt{constructor(s,c,p){this.bounds=y.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),p=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*c),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*c);return s.x>=p&&s.x<b&&s.y>=g&&s.y<E}}class Vi extends y.Evented{constructor(s,c,p,g){super(),this.id=s,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},c),y.extend(this,y.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,(s,c)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new y.ErrorEvent(s)):c&&(y.extend(this,c),c.bounds&&(this.tileBounds=new Zt(c.bounds,this.minzoom,this.maxzoom)),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return y.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const p=s.tileID.canonical.url(this.tiles,this.scheme);s.request=y.getImage(this.map._requestManager.transformRequest(p,y.ResourceType.Tile),(g,b)=>{if(delete s.request,s.aborted)s.state="unloaded",c(null);else if(g)s.state="errored",c(g);else if(b){this.map._refreshExpiredTiles&&s.setExpiryData(b),delete b.cacheControl,delete b.expires;const E=this.map.painter.context,S=E.gl;s.texture=this.map.painter.getTileTexture(b.width),s.texture?s.texture.update(b,{useMipmap:!0}):(s.texture=new vn(E,b,S.RGBA,{useMipmap:!0}),s.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),s.state="loaded",y.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c()}unloadTile(s,c){s.texture&&this.map.painter.saveTileTexture(s.texture),c()}hasTransition(){return!1}}let ri;var wi=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ls extends y.Evented{constructor(s,c,p,g){super(),this.id=s,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=c}load(s,c){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),(p,g)=>{this._loaded=!0,p?this.fire(new y.ErrorEvent(p)):g&&(this.image=g,s&&(this.coordinates=s),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const c=s.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(g){let b=1/0,E=1/0,S=-1/0,T=-1/0;for(const H of g)b=Math.min(b,H.x),E=Math.min(E,H.y),S=Math.max(S,H.x),T=Math.max(T,H.y);const k=Math.max(S-b,T-E),F=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,F);return new y.CanonicalTileID(F,Math.floor((b+S)/2*B),Math.floor((E+T)/2*B))}(c),this.minzoom=this.maxzoom=this.tileID.z;const p=c.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new y.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new vn(s,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const p in this.tiles){const g=this.tiles[p];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}loadTile(s,c){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},c(null)):(s.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Nr={vector:class extends y.Evented{constructor(d,s,c,p){if(super(),this.id=d,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(s,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Kn(this._options,this.map._requestManager,(d,s)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new y.ErrorEvent(d)):s&&(y.extend(this,s),s.bounds&&(this.tileBounds=new Zt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return y.extend({},this._options)}loadTile(d,s){const c=d.tileID.canonical.url(this.tiles,this.scheme),p={request:this.map._requestManager.transformRequest(c,y.ResourceType.Tile),uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(b,E){return delete d.request,d.aborted?s(null):b&&404!==b.status?s(b):(E&&E.resourceTiming&&(d.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&d.setExpiryData(E),d.loadVectorData(E,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,d.actor&&"expired"!==d.state?"loading"===d.state?d.reloadCallback=s:d.request=d.actor.send("reloadTile",p,g.bind(this)):(d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",p,g.bind(this)))}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id},void 0)}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}},raster:Vi,"raster-dem":class extends Vi{constructor(d,s,c,p){super(d,s,c,p),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(d,s){const c=d.tileID.canonical.url(this.tiles,this.scheme);function p(g,b){g&&(d.state="errored",s(g)),b&&(d.dem=b,d.needsHillshadePrepare=!0,d.state="loaded",s(null))}d.request=y.getImage(this.map._requestManager.transformRequest(c,y.ResourceType.Tile),function(g,b){if(delete d.request,d.aborted)d.state="unloaded",s(null);else if(g)d.state="errored",s(g);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData(b),delete b.cacheControl,delete b.expires;const E=y.isImageBitmap(b)&&(null==ri&&(ri="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),ri)?b:y.exported.getImageData(b,1),S={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:E,encoding:this.encoding};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",S,p.bind(this)))}}.bind(this)),d.neighboringTiles=this._getNeighboringTiles(d.tileID)}_getNeighboringTiles(d){const s=d.canonical,c=Math.pow(2,s.z),p=(s.x-1+c)%c,g=0===s.x?d.wrap-1:d.wrap,b=(s.x+1+c)%c,E=s.x+1===c?d.wrap+1:d.wrap,S={};return S[new y.OverscaledTileID(d.overscaledZ,g,s.z,p,s.y).key]={backfilled:!1},S[new y.OverscaledTileID(d.overscaledZ,E,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(S[new y.OverscaledTileID(d.overscaledZ,g,s.z,p,s.y-1).key]={backfilled:!1},S[new y.OverscaledTileID(d.overscaledZ,d.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new y.OverscaledTileID(d.overscaledZ,E,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<c&&(S[new y.OverscaledTileID(d.overscaledZ,g,s.z,p,s.y+1).key]={backfilled:!1},S[new y.OverscaledTileID(d.overscaledZ,d.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new y.OverscaledTileID(d.overscaledZ,E,s.z,b,s.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded",d.actor&&d.actor.send("removeDEMTile",{uid:d.uid,source:this.id})}},geojson:class extends y.Evented{constructor(d,s,c,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=s.data,this._options=y.extend({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*g,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*g,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?Math.min(s.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:y.EXTENT,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(d){this.map=d,this.load()}setData(d){return this._data=d,this._updateWorkerData("content"),this}getClusterExpansionZoom(d,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},s),this}getClusterChildren(d,s){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},s),this}getClusterLeaves(d,s,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:s,offset:c},p),this}_updateWorkerData(d){const s=y.extend({},this.workerOptions),c=this._data;"string"==typeof c?(s.request=this.map._requestManager.transformRequest(y.exported.resolveURL(c),y.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoads++,this.fire(new y.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return;let b=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:s.source},null),p)return void this.fire(new y.ErrorEvent(p));const E={dataType:"source",sourceDataType:d};this._collectResourceTiming&&b&&b.length>0&&y.extend(E,{resourceTiming:b}),this.fire(new y.Event("data",E))})}loaded(){return 0===this._pendingLoads}loadTile(d,s){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const p={type:this.type,uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request=this.actor.send(c,p,(g,b)=>(delete d.request,d.unloadVectorData(),d.aborted?s(null):g?s(g):(d.loadVectorData(b,this.map.painter,"reloadTile"===c),s(null))))}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return y.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ls{constructor(d,s,c,p){super(d,s,c,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const s of d.urls)this.urls.push(this.map._requestManager.transformRequest(s,y.ResourceType.Source).url);y.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new y.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const s=this.video.seekable;d<s.start(0)||d>s.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,s=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new vn(d,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ls,canvas:class extends ls{constructor(d,s,c,p){super(d,s,c,p),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(g=>!Array.isArray(g)||2!==g.length||g.some(b=>"number"!=typeof b))||this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new vn(s,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const g=this.tiles[p];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}};function Wt(d,s){const c=y.create();return y.translate(c,c,[1,1,0]),y.scale(c,c,[.5*d.width,.5*d.height,1]),y.multiply(c,c,d.calculatePosMatrix(s.toUnwrapped()))}function Ui(d,s,c,p,g,b){const E=function(B,H,X){if(B)for(const Z of B){const V=H[Z];if(V&&V.source===X&&"fill-extrusion"===V.type)return!0}else for(const Z in H){const V=H[Z];if(V.source===X&&"fill-extrusion"===V.type)return!0}return!1}(g&&g.layers,s,d.id),S=b.maxPitchScaleFactor(),T=d.tilesIn(p,S,E);T.sort(an);const k=[];for(const B of T)k.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,c,d._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,g,b,S,Wt(d.transform,B.tileID))});const F=function(B){const H={},X={};for(const Z of B){const V=Z.queryResults,ee=Z.wrappedTileID,ie=X[ee]=X[ee]||{};for(const le in V){const oe=V[le],be=ie[le]=ie[le]||{},de=H[le]=H[le]||[];for(const ye of oe)be[ye.featureIndex]||(be[ye.featureIndex]=!0,de.push(ye))}}return H}(k);for(const B in F)F[B].forEach(H=>{const X=H.feature,Z=d.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=Z});return F}function an(d,s){const c=d.tileID,p=s.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}class Cn{constructor(s,c){this.tileID=s,this.uid=y.uniqueId(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const c=s+this.timeAdded;c<y.exported.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(s,c,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,b){const E={};if(!b)return E;for(const S of g){const T=S.layerIds.map(k=>b.getLayer(k)).filter(Boolean);if(0!==T.length){S.layers=T,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(k=>T.filter(F=>F.id===k)[0]));for(const k of T)E[k.id]=S}}return E}(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof y.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof y.SymbolBucket&&b.hasRTLText){this.hasRTLText=!0,y.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(g).queryRadius(b))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new y.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(s)}const c=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vn(s,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vn(s,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,c,p,g,b,E,S,T,k,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:F,transform:T,params:S,queryPadding:this.queryPadding*k},s,c,p):{}}querySourceFeatures(s,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const g=p.loadVTLayers(),b=c?c.sourceLayer:"",E=g._geojsonTileLayer||g[b];if(!E)return;const S=y.createFilter(c&&c.filter),{z:T,x:k,y:F}=this.tileID.canonical,B={z:T,x:k,y:F};for(let H=0;H<E.length;H++){const X=E.feature(H);if(S.needGeometry){const ee=y.toEvaluationFeature(X,!0);if(!S.filter(new y.EvaluationParameters(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!S.filter(new y.EvaluationParameters(this.tileID.overscaledZ),X))continue;const Z=p.getId(X,b),V=new y.GeoJSONFeature(X,T,k,F,Z);V.tile=B,s.push(V)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const p=y.parseCacheControl(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let g=!1;if(this.expirationTime>p)g=!1;else if(c)if(this.expirationTime<c)g=!0;else{const b=this.expirationTime-c;b?this.expirationTime=p+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(s,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(s).length)return;const p=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!c.style.hasLayer(g))continue;const b=this.buckets[g],E=b.layers[0].sourceLayer||"_geojsonTileLayer",S=p[E],T=s[E];if(!S||!T||0===Object.keys(T).length)continue;b.update(T,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=c&&c.style&&c.style.getLayer(g);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=y.exported.now()+s}setDependencies(s,c){const p={};for(const g of c)p[g]=!0;this.dependencies[s]=p}hasDependency(s,c){for(const p of s){const g=this.dependencies[p];if(g)for(const b of c)if(g[b])return!0}return!1}}class Xt{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,p){const g=s.wrapped().key;void 0===this.data[g]&&(this.data[g]=[]);const b={value:c,timeout:void 0};if(void 0!==p&&(b.timeout=setTimeout(()=>{this.remove(s,b)},p)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const p=s.wrapped().key,g=void 0===c?0:this.data[p].indexOf(c),b=this.data[p][g];return this.data[p].splice(g,1),b.timeout&&clearTimeout(b.timeout),0===this.data[p].length&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const p in this.data)for(const g of this.data[p])s(g.value)||c.push(g);for(const p of c)this.remove(p.value.tileID,p)}}class Le{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,p){const g=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},y.extend(this.stateChanges[s][g],p),null===this.deletedStates[s]){this.deletedStates[s]={};for(const b in this.state[s])b!==g&&(this.deletedStates[s][b]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][g]){this.deletedStates[s][g]={};for(const b in this.state[s][g])p[b]||(this.deletedStates[s][g][b]=null)}else for(const b in p)this.deletedStates[s]&&this.deletedStates[s][g]&&null===this.deletedStates[s][g][b]&&delete this.deletedStates[s][g][b]}removeFeatureState(s,c,p){if(null===this.deletedStates[s])return;const g=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&void 0!==c)null!==this.deletedStates[s][g]&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][p]=null);else if(void 0!==c)if(this.stateChanges[s]&&this.stateChanges[s][g])for(p in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][p]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,c){const p=String(c),g=y.extend({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(null===this.deletedStates[s])return{};if(this.deletedStates[s]){const b=this.deletedStates[s][c];if(null===b)return{};for(const E in b)delete g[E]}return g}initializeTileState(s,c){s.setFeatureState(this.state,c)}coalesceChanges(s,c){const p={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),y.extend(this.state[g][E],this.stateChanges[g][E]),b[E]=this.state[g][E];p[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(null===this.deletedStates[g])for(const E in this.state[g])b[E]={},this.state[g][E]={};else for(const E in this.deletedStates[g]){if(null===this.deletedStates[g][E])this.state[g][E]={};else for(const S of Object.keys(this.deletedStates[g][E]))delete this.state[g][E][S];b[E]=this.state[g][E]}p[g]=p[g]||{},y.extend(p[g],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(p).length)for(const g in s)s[g].setFeatureState(p,c)}}class ht extends y.Evented{constructor(s,c,p){super(),this.id=s,this.dispatcher=p,this.on("data",g=>{"source"===g.dataType&&"metadata"===g.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===g.dataType&&"content"===g.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("error",()=>{this._sourceErrored=!0}),this._source=function(g,b,E,S){const T=new Nr[b.type](g,b,E,S);if(T.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${T.id}`);return y.bindAll(["load","abort","unload","serialize","prepare"],T),T}(s,c,p,this),this._tiles={},this._cache=new Xt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Le}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const c=this._tiles[s];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s,()=>{})}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(gt).map(s=>s.key)}getRenderableIds(s){const c=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&c.push(this._tiles[p]);return s?c.sort((p,g)=>{const b=p.tileID,E=g.tileID,S=new y.Point(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),T=new y.Point(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||T.y-S.y||T.x-S.x}).map(p=>p.tileID.key):c.map(p=>p.tileID).sort(gt).map(p=>p.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(s,"reloading")}}_reloadTile(s,c){const p=this._tiles[s];p&&("loading"!==p.state&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,s,c)))}_tileLoaded(s,c,p,g){if(g)return s.state="errored",void(404!==g.status?this._source.fire(new y.ErrorEvent(g,{tile:s})):this.update(this.transform));s.timeAdded=y.exported.now(),"expired"===p&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),"raster-dem"===this.getSource().type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const c=this.getRenderableIds();for(let g=0;g<c.length;g++){const b=c[g];if(s.neighboringTiles&&s.neighboringTiles[b]){const E=this.getTileByID(b);p(s,E),p(E,s)}}function p(g,b){g.needsHillshadePrepare=!0;let E=b.tileID.canonical.x-g.tileID.canonical.x;const S=b.tileID.canonical.y-g.tileID.canonical.y,T=Math.pow(2,g.tileID.canonical.z),k=b.tileID.key;0===E&&0===S||Math.abs(S)>1||(Math.abs(E)>1&&(1===Math.abs(E+T)?E+=T:1===Math.abs(E-T)&&(E-=T)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,E,S),g.neighboringTiles&&g.neighboringTiles[k]&&(g.neighboringTiles[k].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,p,g){for(const b in this._tiles){let E=this._tiles[b];if(g[b]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>p)continue;let S=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const k=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[k.key],E&&E.hasData()&&(S=k)}let T=S;for(;T.overscaledZ>c;)if(T=T.scaledTo(T.overscaledZ-1),s[T.key]){g[S.key]=S;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=s.overscaledZ-1;p>=c;p--){const g=s.scaledTo(p),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const c=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(c*p*5),b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(s){const c=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,c){const p={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),p[b.tileID.key]=b}this._tiles=p;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s){if(this.transform=s,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?c=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new y.OverscaledTileID(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(c=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(c=c.filter(T=>this._source.hasTile(T)))):c=[];const p=s.coveringZoomLevel(this._source),g=Math.max(p-ht.maxOverzooming,this._source.minzoom),b=Math.max(p+ht.maxUnderzooming,this._source.minzoom),E=this._updateRetainedTiles(c,p);if(di(this._source.type)){const T={},k={},F=Object.keys(E);for(const B of F){const H=E[B],X=this._tiles[B];if(!X||X.fadeEndTime&&X.fadeEndTime<=y.exported.now())continue;const Z=this.findLoadedParent(H,g);Z&&(this._addTile(Z.tileID),T[Z.tileID.key]=Z.tileID),k[B]=H}this._retainLoadedChildren(k,p,b,E);for(const B in T)E[B]||(this._coveredTiles[B]=!0,E[B]=T[B])}for(const T in E)this._tiles[T].clearFadeHold();const S=y.keysDifference(this._tiles,E);for(const T of S){const k=this._tiles[T];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,c){const p={},g={},b=Math.max(c-ht.maxOverzooming,this._source.minzoom),E=Math.max(c+ht.maxUnderzooming,this._source.minzoom),S={};for(const T of s){const k=this._addTile(T);p[T.key]=T,k.hasData()||c<this._source.maxzoom&&(S[T.key]=T)}this._retainLoadedChildren(S,c,E,p);for(const T of s){let k=this._tiles[T.key];if(k.hasData())continue;if(c+1>this._source.maxzoom){const B=T.children(this._source.maxzoom)[0],H=this.getTile(B);if(H&&H.hasData()){p[B.key]=B;continue}}else{const B=T.children(this._source.maxzoom);if(p[B[0].key]&&p[B[1].key]&&p[B[2].key]&&p[B[3].key])continue}let F=k.wasRequested();for(let B=T.overscaledZ-1;B>=b;--B){const H=T.scaledTo(B);if(g[H.key]||(g[H.key]=!0,k=this.getTile(H),!k&&F&&(k=this._addTile(H)),k&&(p[H.key]=H,F=k.wasRequested(),k.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let p,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){p=this._loadedParentTiles[g.key];break}c.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;g=b}for(const b of c)this._loadedParentTiles[b]=p}}_addTile(s){let c=this._tiles[s.key];if(c)return c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const p=c;return c||(c=new Cn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))),c.uses++,this._tiles[s.key]=c,p||this._source.fire(new y.Event("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=c.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&"reloading"!==c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,c,p){const g=[],b=this.transform;if(!b)return g;const E=p?b.getCameraQueryGeometry(s):s,S=s.map(Z=>b.pointCoordinate(Z)),T=E.map(Z=>b.pointCoordinate(Z)),k=this.getIds();let F=1/0,B=1/0,H=-1/0,X=-1/0;for(const Z of T)F=Math.min(F,Z.x),B=Math.min(B,Z.y),H=Math.max(H,Z.x),X=Math.max(X,Z.y);for(let Z=0;Z<k.length;Z++){const V=this._tiles[k[Z]];if(V.holdingForFade())continue;const ee=V.tileID,ie=Math.pow(2,b.zoom-V.tileID.overscaledZ),le=c*V.queryPadding*y.EXTENT/V.tileSize/ie,oe=[ee.getTilePoint(new y.MercatorCoordinate(F,B)),ee.getTilePoint(new y.MercatorCoordinate(H,X))];if(oe[0].x-le<y.EXTENT&&oe[0].y-le<y.EXTENT&&oe[1].x+le>=0&&oe[1].y+le>=0){const be=S.map(ye=>ee.getTilePoint(ye)),de=T.map(ye=>ee.getTilePoint(ye));g.push({tile:V,tileID:ee,queryGeometry:be,cameraQueryGeometry:de,scale:ie})}}return g}getVisibleCoordinates(s){const c=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of c)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(di(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=y.exported.now())return!0}return!1}setFeatureState(s,c,p){this._state.updateState(s=s||"_geojsonTileLayer",c,p)}removeFeatureState(s,c,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,p)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,p){const g=this._tiles[s];g&&g.setDependencies(c,p)}reloadTilesForDependencies(s,c){for(const p in this._tiles)this._tiles[p].hasDependency(s,c)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,c))}}function gt(d,s){const c=Math.abs(2*d.wrap)-+(d.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return d.overscaledZ-s.overscaledZ||p-c||s.canonical.y-d.canonical.y||s.canonical.x-d.canonical.x}function di(d){return"raster"===d||"image"===d||"video"===d}ht.maxOverzooming=10,ht.maxUnderzooming=3;const Ds="mapboxgl_preloaded_worker_pool";class ut{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ut.workerCount;)this.workers.push(new Worker(ms.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ds]}numActive(){return Object.keys(this.active).length}}const uo=Math.floor(y.exported.hardwareConcurrency/2);let ji;function co(){return ji||(ji=new ut),ji}function Br(d,s){const c={};for(const p in d)"ref"!==p&&(c[p]=d[p]);return y.refProperties.forEach(p=>{p in s&&(c[p]=s[p])}),c}function mn(d){d=d.slice();const s=Object.create(null);for(let c=0;c<d.length;c++)s[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=Br(d[c],s[d[c].ref]));return d}ut.workerCount=Math.max(Math.min(uo,6),1);const $t={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $i(d,s,c){c.push({command:$t.addSource,args:[d,s[d]]})}function js(d,s,c){s.push({command:$t.removeSource,args:[d]}),c[d]=!0}function Fo(d,s,c,p){js(d,c,p),$i(d,s,c)}function $s(d,s,c){let p;for(p in d[c])if(Object.prototype.hasOwnProperty.call(d[c],p)&&"data"!==p&&!Ze(d[c][p],s[c][p]))return!1;for(p in s[c])if(Object.prototype.hasOwnProperty.call(s[c],p)&&"data"!==p&&!Ze(d[c][p],s[c][p]))return!1;return!0}function Vr(d,s,c,p,g,b){let E;for(E in s=s||{},d=d||{})Object.prototype.hasOwnProperty.call(d,E)&&(Ze(d[E],s[E])||c.push({command:b,args:[p,E,s[E],g]}));for(E in s)Object.prototype.hasOwnProperty.call(s,E)&&!Object.prototype.hasOwnProperty.call(d,E)&&(Ze(d[E],s[E])||c.push({command:b,args:[p,E,s[E],g]}))}function ur(d){return d.id}function Sr(d,s){return d[s.id]=s,d}class Ya{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=y.clamp(s,0,1);let c=1,p=this._distances[c];const g=s*this.paddedLength+this.padding;for(;p<g&&c<this._distances.length;)p=this._distances[++c];const b=c-1,E=this._distances[b],S=p-E,T=S>0?(g-E)/S:0;return this.points[b].mult(1-T).add(this.points[c].mult(T))}}class us{constructor(s,c,p){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(c/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,p,g,b){this._forEachCell(c,p,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(s,c,p,g){this._forEachCell(c-g,p-g,c+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(p),this.circles.push(g)}_insertBoxCell(s,c,p,g,b,E){this.boxCells[b].push(E)}_insertCircleCell(s,c,p,g,b,E){this.circleCells[b].push(E)}_query(s,c,p,g,b,E){if(p<0||s>this.width||g<0||c>this.height)return[];const S=[];if(s<=0&&c<=0&&this.width<=p&&this.height<=g){if(b)return[{key:null,x1:s,y1:c,x2:p,y2:g}];for(let T=0;T<this.boxKeys.length;T++)S.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const k=this.circles[3*T],F=this.circles[3*T+1],B=this.circles[3*T+2];S.push({key:this.circleKeys[T],x1:k-B,y1:F-B,x2:k+B,y2:F+B})}}else this._forEachCell(s,c,p,g,this._queryCell,S,{hitTest:b,seenUids:{box:{},circle:{}}},E);return S}query(s,c,p,g){return this._query(s,c,p,g,!1,null)}hitTest(s,c,p,g,b){return this._query(s,c,p,g,!0,b).length>0}hitTestCircle(s,c,p,g){const b=s-p,E=s+p,S=c-p,T=c+p;if(E<0||b>this.width||T<0||S>this.height)return!1;const k=[];return this._forEachCell(b,S,E,T,this._queryCellCircle,k,{hitTest:!0,circle:{x:s,y:c,radius:p},seenUids:{box:{},circle:{}}},g),k.length>0}_queryCell(s,c,p,g,b,E,S,T){const{seenUids:k,hitTest:F}=S,B=this.boxCells[b];if(null!==B){const X=this.bboxes;for(const Z of B)if(!k.box[Z]){k.box[Z]=!0;const V=4*Z,ee=this.boxKeys[Z];if(s<=X[V+2]&&c<=X[V+3]&&p>=X[V+0]&&g>=X[V+1]&&(!T||T(ee))&&(E.push({key:ee,x1:X[V],y1:X[V+1],x2:X[V+2],y2:X[V+3]}),F))return!0}}const H=this.circleCells[b];if(null!==H){const X=this.circles;for(const Z of H)if(!k.circle[Z]){k.circle[Z]=!0;const V=3*Z,ee=this.circleKeys[Z];if(this._circleAndRectCollide(X[V],X[V+1],X[V+2],s,c,p,g)&&(!T||T(ee))){const ie=X[V],le=X[V+1],oe=X[V+2];if(E.push({key:ee,x1:ie-oe,y1:le-oe,x2:ie+oe,y2:le+oe}),F)return!0}}}return!1}_queryCellCircle(s,c,p,g,b,E,S,T){const{circle:k,seenUids:F}=S,B=this.boxCells[b];if(null!==B){const X=this.bboxes;for(const Z of B)if(!F.box[Z]){F.box[Z]=!0;const V=4*Z,ee=this.boxKeys[Z];if(this._circleAndRectCollide(k.x,k.y,k.radius,X[V+0],X[V+1],X[V+2],X[V+3])&&(!T||T(ee)))return E.push(!0),!0}}const H=this.circleCells[b];if(null!==H){const X=this.circles;for(const Z of H)if(!F.circle[Z]){F.circle[Z]=!0;const V=3*Z,ee=this.circleKeys[Z];if(this._circlesCollide(X[V],X[V+1],X[V+2],k.x,k.y,k.radius)&&(!T||T(ee)))return E.push(!0),!0}}}_forEachCell(s,c,p,g,b,E,S,T){const k=this._convertToXCellCoord(s),F=this._convertToYCellCoord(c),B=this._convertToXCellCoord(p),H=this._convertToYCellCoord(g);for(let X=k;X<=B;X++)for(let Z=F;Z<=H;Z++)if(b.call(this,s,c,p,g,this.xCellCount*Z+X,E,S,T))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,p,g,b,E){const S=g-s,T=b-c,k=p+E;return k*k>S*S+T*T}_circleAndRectCollide(s,c,p,g,b,E,S){const T=(E-g)/2,k=Math.abs(s-(g+T));if(k>T+p)return!1;const F=(S-b)/2,B=Math.abs(c-(b+F));if(B>F+p)return!1;if(k<=T||B<=F)return!0;const H=k-T,X=B-F;return H*H+X*X<=p*p}}function xn(d,s,c,p,g){const b=y.create();return s?(y.scale(b,b,[1/g,1/g,1]),c||y.rotateZ(b,b,p.angle)):y.multiply(b,p.labelPlaneMatrix,d),b}function Es(d,s,c,p,g){if(s){const b=y.clone(d);return y.scale(b,b,[g,g,1]),c||y.rotateZ(b,b,-p.angle),b}return p.glCoordMatrix}function Yn(d,s){const c=y.fromValues(d.x,d.y,0,1);Hs(c,c,s);const p=c[3];return{point:new y.Point(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Rn(d,s){return.5+d/s*.5}function Oo(d,s){const c=d[0]/d[3],p=d[1]/d[3];return c>=-s[0]&&c<=s[0]&&p>=-s[1]&&p<=s[1]}function Ur(d,s,c,p,g,b,E,S){const T=p?d.textSizeData:d.iconSizeData,k=y.evaluateSizeForZoom(T,c.transform.zoom),F=[256/c.width*2+1,256/c.height*2+1],B=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;B.clear();const H=d.lineVertexArray,X=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,Z=c.transform.width/c.transform.height;let V=!1;for(let ee=0;ee<X.length;ee++){const ie=X.get(ee);if(ie.hidden||ie.writingMode===y.WritingMode.vertical&&!V){Ln(ie.numGlyphs,B);continue}V=!1;const le=y.fromValues(ie.anchorX,ie.anchorY,0,1);if(y.transformMat4(le,le,s),!Oo(le,F)){Ln(ie.numGlyphs,B);continue}const oe=Rn(c.transform.cameraToCenterDistance,le[3]),be=y.evaluateSizeForFeature(T,k,ie),de=E?be/oe:be*oe,ye=new y.Point(ie.anchorX,ie.anchorY),Se=Yn(ye,g).point,Ae={},fe=ha(ie,de,!1,S,s,g,b,d.glyphOffsetArray,H,B,Se,ye,Ae,Z);V=fe.useVertical,(fe.notEnoughRoom||V||fe.needsFlipping&&ha(ie,de,!0,S,s,g,b,d.glyphOffsetArray,H,B,Se,ye,Ae,Z).notEnoughRoom)&&Ln(ie.numGlyphs,B)}p?d.text.dynamicLayoutVertexBuffer.updateData(B):d.icon.dynamicLayoutVertexBuffer.updateData(B)}function cs(d,s,c,p,g,b,E,S,T,k,F){const B=S.glyphStartIndex+S.numGlyphs,H=S.lineStartIndex,X=S.lineStartIndex+S.lineLength,Z=s.getoffsetX(S.glyphStartIndex),V=s.getoffsetX(B-1),ee=ho(d*Z,c,p,g,b,E,S.segment,H,X,T,k,F);if(!ee)return null;const ie=ho(d*V,c,p,g,b,E,S.segment,H,X,T,k,F);return ie?{first:ee,last:ie}:null}function Ir(d,s,c,p){return d===y.WritingMode.horizontal&&Math.abs(c.y-s.y)>Math.abs(c.x-s.x)*p?{useVertical:!0}:(d===y.WritingMode.vertical?s.y<c.y:s.x>c.x)?{needsFlipping:!0}:null}function ha(d,s,c,p,g,b,E,S,T,k,F,B,H,X){const Z=s/24,V=d.lineOffsetX*Z,ee=d.lineOffsetY*Z;let ie;if(d.numGlyphs>1){const le=d.glyphStartIndex+d.numGlyphs,oe=d.lineStartIndex,be=d.lineStartIndex+d.lineLength,de=cs(Z,S,V,ee,c,F,B,d,T,b,H);if(!de)return{notEnoughRoom:!0};const ye=Yn(de.first.point,E).point,Se=Yn(de.last.point,E).point;if(p&&!c){const Ae=Ir(d.writingMode,ye,Se,X);if(Ae)return Ae}ie=[de.first];for(let Ae=d.glyphStartIndex+1;Ae<le-1;Ae++)ie.push(ho(Z*S.getoffsetX(Ae),V,ee,c,F,B,d.segment,oe,be,T,b,H));ie.push(de.last)}else{if(p&&!c){const oe=Yn(B,g).point,be=d.lineStartIndex+d.segment+1,de=new y.Point(T.getx(be),T.gety(be)),ye=Yn(de,g),Se=ye.signedDistanceFromCamera>0?ye.point:fi(B,de,oe,1,g),Ae=Ir(d.writingMode,oe,Se,X);if(Ae)return Ae}const le=ho(Z*S.getoffsetX(d.glyphStartIndex),V,ee,c,F,B,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,T,b,H);if(!le)return{notEnoughRoom:!0};ie=[le]}for(const le of ie)y.addDynamicAttributes(k,le.point,le.angle);return{}}function fi(d,s,c,p,g){const b=Yn(d.add(d.sub(s)._unit()),g).point,E=c.sub(b);return c.add(E._mult(p/E.mag()))}function ho(d,s,c,p,g,b,E,S,T,k,F,B){const H=p?d-s:d+s;let X=H>0?1:-1,Z=0;p&&(X*=-1,Z=Math.PI),X<0&&(Z+=Math.PI);let V=X>0?S+E:S+E+1,ee=g,ie=g,le=0,oe=0;const be=Math.abs(H),de=[];for(;le+oe<=be;){if(V+=X,V<S||V>=T)return null;if(ie=ee,de.push(ee),ee=B[V],void 0===ee){const Re=new y.Point(k.getx(V),k.gety(V)),et=Yn(Re,F);if(et.signedDistanceFromCamera>0)ee=B[V]=et.point;else{const st=V-X;ee=fi(0===le?b:new y.Point(k.getx(st),k.gety(st)),Re,ie,be-le+1,F)}}le+=oe,oe=ie.dist(ee)}const ye=(be-le)/oe,Se=ee.sub(ie),Ae=Se.mult(ye)._add(ie);Ae._add(Se._unit()._perp()._mult(c*X));const fe=Z+Math.atan2(ee.y-ie.y,ee.x-ie.x);return de.push(Ae),{point:Ae,angle:fe,path:de}}const fo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ln(d,s){for(let c=0;c<d;c++){const p=s.length;s.resize(p+4),s.float32.set(fo,3*p)}}function Hs(d,s,c){const p=s[0],g=s[1];return d[0]=c[0]*p+c[4]*g+c[12],d[1]=c[1]*p+c[5]*g+c[13],d[3]=c[3]*p+c[7]*g+c[15],d}const Jn=100;class ii{constructor(s,c=new us(s.width+200,s.height+200,25),p=new us(s.width+200,s.height+200,25)){this.transform=s,this.grid=c,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Jn,this.screenBottomBoundary=s.height+Jn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200}placeCollisionBox(s,c,p,g,b){const E=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY),S=p*E.perspectiveRatio,T=s.x1*S+E.point.x,k=s.y1*S+E.point.y,F=s.x2*S+E.point.x,B=s.y2*S+E.point.y;return!this.isInsideGrid(T,k,F,B)||!c&&this.grid.hitTest(T,k,F,B,b)?{box:[],offscreen:!1}:{box:[T,k,F,B],offscreen:this.isOffscreen(T,k,F,B)}}placeCollisionCircles(s,c,p,g,b,E,S,T,k,F,B,H,X){const Z=[],V=new y.Point(c.anchorX,c.anchorY),ee=Yn(V,E),ie=Rn(this.transform.cameraToCenterDistance,ee.signedDistanceFromCamera),le=(F?b/ie:b*ie)/y.ONE_EM,oe=Yn(V,S).point,be=cs(le,g,c.lineOffsetX*le,c.lineOffsetY*le,!1,oe,V,c,p,S,{});let de=!1,ye=!1,Se=!0;if(be){const Ae=.5*H*ie+X,fe=new y.Point(-100,-100),Re=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),et=new Ya,st=be.first,Yt=be.last;let Ot=[];for(let Rt=st.path.length-1;Rt>=1;Rt--)Ot.push(st.path[Rt]);for(let Rt=1;Rt<Yt.path.length;Rt++)Ot.push(Yt.path[Rt]);const tt=2.5*Ae;if(T){const Rt=Ot.map(At=>Yn(At,T));Ot=Rt.some(At=>At.signedDistanceFromCamera<=0)?[]:Rt.map(At=>At.point)}let Ht=[];if(Ot.length>0){const Rt=Ot[0].clone(),At=Ot[0].clone();for(let zn=1;zn<Ot.length;zn++)Rt.x=Math.min(Rt.x,Ot[zn].x),Rt.y=Math.min(Rt.y,Ot[zn].y),At.x=Math.max(At.x,Ot[zn].x),At.y=Math.max(At.y,Ot[zn].y);Ht=Rt.x>=fe.x&&At.x<=Re.x&&Rt.y>=fe.y&&At.y<=Re.y?[Ot]:At.x<fe.x||Rt.x>Re.x||At.y<fe.y||Rt.y>Re.y?[]:y.clipLine([Ot],fe.x,fe.y,Re.x,Re.y)}for(const Rt of Ht){et.reset(Rt,.25*Ae);let At=0;At=et.length<=.5*Ae?1:Math.ceil(et.paddedLength/tt)+1;for(let zn=0;zn<At;zn++){const gs=zn/Math.max(At-1,1),Ji=et.lerp(gs),Pi=Ji.x+Jn,ki=Ji.y+Jn;Z.push(Pi,ki,Ae,0);const Xr=Pi-Ae,Xs=ki-Ae,mr=Pi+Ae,Nn=ki+Ae;if(Se=Se&&this.isOffscreen(Xr,Xs,mr,Nn),ye=ye||this.isInsideGrid(Xr,Xs,mr,Nn),!s&&this.grid.hitTestCircle(Pi,ki,Ae,B)&&(de=!0,!k))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!k&&de||!ye?[]:Z,offscreen:Se,collisionDetected:de}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let p=1/0,g=1/0,b=-1/0,E=-1/0;for(const F of s){const B=new y.Point(F.x+Jn,F.y+Jn);p=Math.min(p,B.x),g=Math.min(g,B.y),b=Math.max(b,B.x),E=Math.max(E,B.y),c.push(B)}const S=this.grid.query(p,g,b,E).concat(this.ignoredGrid.query(p,g,b,E)),T={},k={};for(const F of S){const B=F.key;if(void 0===T[B.bucketInstanceId]&&(T[B.bucketInstanceId]={}),T[B.bucketInstanceId][B.featureIndex])continue;const H=[new y.Point(F.x1,F.y1),new y.Point(F.x2,F.y1),new y.Point(F.x2,F.y2),new y.Point(F.x1,F.y2)];y.polygonIntersectsPolygon(c,H)&&(T[B.bucketInstanceId][B.featureIndex]=!0,void 0===k[B.bucketInstanceId]&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(s,c,p,g,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:b},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,p,g,b){const E=c?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:g,collisionGroupID:b};for(let T=0;T<s.length;T+=4)E.insertCircle(S,s[T],s[T+1],s[T+2])}projectAndGetPerspectiveRatio(s,c,p){const g=y.fromValues(c,p,0,1);return Hs(g,g,s),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+Jn,(-g[1]/g[3]+1)/2*this.transform.height+Jn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(s,c,p,g){return p<Jn||s>=this.screenRightBoundary||g<Jn||c>this.screenBottomBoundary}isInsideGrid(s,c,p,g){return p>=0&&s<this.gridRightBoundary&&g>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=y.identity([]);return y.translate(s,s,[-100,-100,0]),s}}function Qn(d,s,c){return s*(y.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}class da{constructor(s,c,p,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):g&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class qs{constructor(s,c,p,g,b){this.text=new da(s?s.text:null,c,p,b),this.icon=new da(s?s.icon:null,c,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zo{constructor(s,c,p){this.text=s,this.icon=c,this.skipFade=p}}class Ja{constructor(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]}}class No{constructor(s,c,p,g,b){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=b}}class Bo{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[s]}}function jr(d,s,c,p,g){const{horizontalAlign:b,verticalAlign:E}=y.getAnchorAlignment(d),S=-(b-.5)*s,T=-(E-.5)*c,k=y.evaluateVariableOffset(d,p);return new y.Point(S+k[0]*g,T+k[1]*g)}function fa(d,s,c,p,g,b){const{x1:E,x2:S,y1:T,y2:k,anchorPointX:F,anchorPointY:B}=d,H=new y.Point(s,c);return p&&H._rotate(g?b:-b),{x1:E+H.x,y1:T+H.y,x2:S+H.x,y2:k+H.y,anchorPointX:F,anchorPointY:B}}class Fn{constructor(s,c,p,g){this.transform=s.clone(),this.collisionIndex=new ii(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Bo(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,p,g){const b=p.getBucket(c),E=p.latestFeatureIndex;if(!b||!E||c.id!==b.layerIds[0])return;const S=p.collisionBoxArray,T=b.layers[0].layout,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),F=p.tileSize/y.EXTENT,B=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),H="map"===T.get("text-pitch-alignment"),X="map"===T.get("text-rotation-alignment"),Z=Qn(p,1,this.transform.zoom),V=xn(B,H,X,this.transform,Z);let ee=null;if(H){const le=Es(B,H,X,this.transform,Z);ee=y.multiply([],this.transform.labelPlaneMatrix,le)}this.retainedQueryData[b.bucketInstanceId]=new No(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,p.tileID);const ie={bucket:b,layout:T,posMatrix:B,textLabelPlaneMatrix:V,labelToScreenMatrix:ee,scale:k,textPixelRatio:F,holdingForFade:p.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const le of b.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:be,symbolInstanceEnd:de}=le;s.push({sortKey:oe,symbolInstanceStart:be,symbolInstanceEnd:de,parameters:ie})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(s,c,p,g,b,E,S,T,k,F,B,H,X,Z,V){const ee=[H.textOffset0,H.textOffset1],ie=jr(s,p,g,ee,b),le=this.collisionIndex.placeCollisionBox(fa(c,ie.x,ie.y,E,S,this.transform.angle),B,T,k,F.predicate);if((!V||0!==this.collisionIndex.placeCollisionBox(fa(V,ie.x,ie.y,E,S,this.transform.angle),B,T,k,F.predicate).box.length)&&le.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[H.crossTileID].anchor),this.variableOffsets[H.crossTileID]={textOffset:ee,width:p,height:g,anchor:s,textBoxScale:b,prevAnchor:oe},this.markUsedJustification(X,s,H,Z),X.allowVerticalPlacement&&(this.markUsedOrientation(X,Z,H),this.placedOrientations[H.crossTileID]=Z),{shift:ie,placedGlyphBoxes:le}}}placeLayerBucketPart(s,c,p){const{bucket:g,layout:b,posMatrix:E,textLabelPlaneMatrix:S,labelToScreenMatrix:T,textPixelRatio:k,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:H,collisionGroup:X}=s.parameters,Z=b.get("text-optional"),V=b.get("icon-optional"),ee=b.get("text-allow-overlap"),ie=b.get("icon-allow-overlap"),le="map"===b.get("text-rotation-alignment"),oe="map"===b.get("text-pitch-alignment"),be="none"!==b.get("icon-text-fit"),de="viewport-y"===b.get("symbol-z-order"),ye=ee&&(ie||!g.hasIconData()||V),Se=ie&&(ee||!g.hasTextData()||Z);!g.collisionArrays&&B&&g.deserializeCollisionBoxes(B);const Ae=(fe,Re)=>{if(c[fe.crossTileID])return;if(F)return void(this.placements[fe.crossTileID]=new zo(!1,!1,!1));let et=!1,st=!1,Yt=!0,Ot=null,tt={box:null,offscreen:null},Ht={box:null,offscreen:null},Rt=null,At=null,zn=null,gs=0,Ji=0,Pi=0;Re.textFeatureIndex?gs=Re.textFeatureIndex:fe.useRuntimeCollisionCircles&&(gs=fe.featureIndex),Re.verticalTextFeatureIndex&&(Ji=Re.verticalTextFeatureIndex);const ki=Re.textBox;if(ki){const mr=rn=>{let gr=y.WritingMode.horizontal;if(g.allowVerticalPlacement&&!rn&&this.prevPlacement){const er=this.prevPlacement.placedOrientations[fe.crossTileID];er&&(this.placedOrientations[fe.crossTileID]=er,gr=er,this.markUsedOrientation(g,gr,fe))}return gr},Nn=(rn,gr)=>{if(g.allowVerticalPlacement&&fe.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const er of g.writingModes)if(er===y.WritingMode.vertical?(tt=gr(),Ht=tt):tt=rn(),tt&&tt.box&&tt.box.length)break}else tt=rn()};if(b.get("text-variable-anchor")){let rn=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]){const dn=this.prevPlacement.variableOffsets[fe.crossTileID];rn.indexOf(dn.anchor)>0&&(rn=rn.filter(Ks=>Ks!==dn.anchor),rn.unshift(dn.anchor))}const gr=(dn,Ks,gl)=>{const tr=dn.x2-dn.x1,Bn=dn.y2-dn.y1,li=fe.textBoxScale,Tn=be&&!ie?Ks:null;let Go={box:[],offscreen:!1};const uc=ee?2*rn.length:rn.length;for(let Ta=0;Ta<uc;++Ta){const nu=this.attemptAnchorPlacement(rn[Ta%rn.length],dn,tr,Bn,li,le,oe,k,E,X,Ta>=rn.length,fe,g,gl,Tn);if(nu&&(Go=nu.placedGlyphBoxes,Go&&Go.box&&Go.box.length)){et=!0,Ot=nu.shift;break}}return Go};Nn(()=>gr(ki,Re.iconBox,y.WritingMode.horizontal),()=>{const dn=Re.verticalTextBox;return g.allowVerticalPlacement&&!(tt&&tt.box&&tt.box.length)&&fe.numVerticalGlyphVertices>0&&dn?gr(dn,Re.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),tt&&(et=tt.box,Yt=tt.offscreen);const er=mr(tt&&tt.box);if(!et&&this.prevPlacement){const dn=this.prevPlacement.variableOffsets[fe.crossTileID];dn&&(this.variableOffsets[fe.crossTileID]=dn,this.markUsedJustification(g,dn.anchor,fe,er))}}else{const rn=(gr,er)=>{const dn=this.collisionIndex.placeCollisionBox(gr,ee,k,E,X.predicate);return dn&&dn.box&&dn.box.length&&(this.markUsedOrientation(g,er,fe),this.placedOrientations[fe.crossTileID]=er),dn};Nn(()=>rn(ki,y.WritingMode.horizontal),()=>{const gr=Re.verticalTextBox;return g.allowVerticalPlacement&&fe.numVerticalGlyphVertices>0&&gr?rn(gr,y.WritingMode.vertical):{box:null,offscreen:null}}),mr(tt&&tt.box&&tt.box.length)}}if(Rt=tt,et=Rt&&Rt.box&&Rt.box.length>0,Yt=Rt&&Rt.offscreen,fe.useRuntimeCollisionCircles){const mr=g.text.placedSymbolArray.get(fe.centerJustifiedTextSymbolIndex),Nn=y.evaluateSizeForFeature(g.textSizeData,H,mr),rn=b.get("text-padding");At=this.collisionIndex.placeCollisionCircles(ee,mr,g.lineVertexArray,g.glyphOffsetArray,Nn,E,S,T,p,oe,X.predicate,fe.collisionCircleDiameter,rn),et=ee||At.circles.length>0&&!At.collisionDetected,Yt=Yt&&At.offscreen}if(Re.iconFeatureIndex&&(Pi=Re.iconFeatureIndex),Re.iconBox){const mr=Nn=>{const rn=be&&Ot?fa(Nn,Ot.x,Ot.y,le,oe,this.transform.angle):Nn;return this.collisionIndex.placeCollisionBox(rn,ie,k,E,X.predicate)};Ht&&Ht.box&&Ht.box.length&&Re.verticalIconBox?(zn=mr(Re.verticalIconBox),st=zn.box.length>0):(zn=mr(Re.iconBox),st=zn.box.length>0),Yt=Yt&&zn.offscreen}const Xr=Z||0===fe.numHorizontalGlyphVertices&&0===fe.numVerticalGlyphVertices,Xs=V||0===fe.numIconVertices;if(Xr||Xs?Xs?Xr||(st=st&&et):et=st&&et:st=et=st&&et,et&&Rt&&Rt.box&&this.collisionIndex.insertCollisionBox(Rt.box,b.get("text-ignore-placement"),g.bucketInstanceId,Ht&&Ht.box&&Ji?Ji:gs,X.ID),st&&zn&&this.collisionIndex.insertCollisionBox(zn.box,b.get("icon-ignore-placement"),g.bucketInstanceId,Pi,X.ID),At&&(et&&this.collisionIndex.insertCollisionCircles(At.circles,b.get("text-ignore-placement"),g.bucketInstanceId,gs,X.ID),p)){const mr=g.bucketInstanceId;let Nn=this.collisionCircleArrays[mr];void 0===Nn&&(Nn=this.collisionCircleArrays[mr]=new Ja);for(let rn=0;rn<At.circles.length;rn+=4)Nn.circles.push(At.circles[rn+0]),Nn.circles.push(At.circles[rn+1]),Nn.circles.push(At.circles[rn+2]),Nn.circles.push(At.collisionDetected?1:0)}this.placements[fe.crossTileID]=new zo(et||ye,st||Se,Yt||g.justReloaded),c[fe.crossTileID]=!0};if(de){const fe=g.getSortedSymbolIndexes(this.transform.angle);for(let Re=fe.length-1;Re>=0;--Re){const et=fe[Re];Ae(g.symbolInstances.get(et),g.collisionArrays[et])}}else for(let fe=s.symbolInstanceStart;fe<s.symbolInstanceEnd;fe++)Ae(g.symbolInstances.get(fe),g.collisionArrays[fe]);if(p&&g.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[g.bucketInstanceId];y.invert(fe.invProjMatrix,E),fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,c,p,g){let b;b=g===y.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(c)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=b>=0&&S!==b?0:p.crossTileID)}markUsedOrientation(s,c,p){const g=c===y.WritingMode.horizontal||c===y.WritingMode.horizontalOnly?c:0,b=c===y.WritingMode.vertical?c:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of E)s.text.placedSymbolArray.get(S).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const g=c?c.symbolFadeChange(s):1,b=c?c.opacities:{},E=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const T in this.placements){const k=this.placements[T],F=b[T];F?(this.opacities[T]=new qs(F,g,k.text,k.icon),p=p||k.text!==F.text.placed||k.icon!==F.icon.placed):(this.opacities[T]=new qs(null,g,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const T in b){const k=b[T];if(!this.opacities[T]){const F=new qs(k,g,!1,!1);F.isHidden()||(this.opacities[T]=F,p=p||k.text.placed||k.icon.placed)}}for(const T in E)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=E[T]);for(const T in S)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=S[T]);p?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c){const p={};for(const g of c){const b=g.getBucket(s);b&&g.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,g.collisionBoxArray)}}updateBucketOpacities(s,c,p){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0].layout,b=new qs(null,0,!1,!1,!0),E=g.get("text-allow-overlap"),S=g.get("icon-allow-overlap"),T=g.get("text-variable-anchor"),k="map"===g.get("text-rotation-alignment"),F="map"===g.get("text-pitch-alignment"),B="none"!==g.get("icon-text-fit"),H=new qs(null,0,E&&(S||!s.hasIconData()||g.get("icon-optional")),S&&(E||!s.hasTextData()||g.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const X=(Z,V,ee)=>{for(let ie=0;ie<V/4;ie++)Z.opacityVertexArray.emplaceBack(ee)};for(let Z=0;Z<s.symbolInstances.length;Z++){const V=s.symbolInstances.get(Z),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:ie,crossTileID:le}=V;let oe=this.opacities[le];c[le]?oe=b:oe||(oe=H,this.opacities[le]=oe),c[le]=!0;const be=V.numIconVertices>0,de=this.placedOrientations[V.crossTileID],ye=de===y.WritingMode.vertical,Se=de===y.WritingMode.horizontal||de===y.WritingMode.horizontalOnly;if(ee>0||ie>0){const Ae=te(oe.text);X(s.text,ee,ye?ne:Ae),X(s.text,ie,Se?ne:Ae);const fe=oe.text.isHidden();[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach(st=>{st>=0&&(s.text.placedSymbolArray.get(st).hidden=fe||ye?1:0)}),V.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(V.verticalPlacedTextSymbolIndex).hidden=fe||Se?1:0);const Re=this.variableOffsets[V.crossTileID];Re&&this.markUsedJustification(s,Re.anchor,V,de);const et=this.placedOrientations[V.crossTileID];et&&(this.markUsedJustification(s,"left",V,et),this.markUsedOrientation(s,et,V))}if(be){const Ae=te(oe.icon),fe=!(B&&V.verticalPlacedIconSymbolIndex&&ye);V.placedIconSymbolIndex>=0&&(X(s.icon,V.numIconVertices,fe?Ae:ne),s.icon.placedSymbolArray.get(V.placedIconSymbolIndex).hidden=oe.icon.isHidden()),V.verticalPlacedIconSymbolIndex>=0&&(X(s.icon,V.numVerticalIconVertices,fe?ne:Ae),s.icon.placedSymbolArray.get(V.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ae=s.collisionArrays[Z];if(Ae){let fe=new y.Point(0,0);if(Ae.textBox||Ae.verticalTextBox){let et=!0;if(T){const st=this.variableOffsets[le];st?(fe=jr(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),k&&fe._rotate(F?this.transform.angle:-this.transform.angle)):et=!1}Ae.textBox&&Di(s.textCollisionBox.collisionVertexArray,oe.text.placed,!et||ye,fe.x,fe.y),Ae.verticalTextBox&&Di(s.textCollisionBox.collisionVertexArray,oe.text.placed,!et||Se,fe.x,fe.y)}const Re=Boolean(!Se&&Ae.verticalIconBox);Ae.iconBox&&Di(s.iconCollisionBox.collisionVertexArray,oe.icon.placed,Re,B?fe.x:0,B?fe.y:0),Ae.verticalIconBox&&Di(s.iconCollisionBox.collisionVertexArray,oe.icon.placed,!Re,B?fe.x:0,B?fe.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Z.invProjMatrix,s.placementViewportMatrix=Z.viewportMatrix,s.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function Di(d,s,c,p,g){d.emplaceBack(s?1:0,c?1:0,p||0,g||0),d.emplaceBack(s?1:0,c?1:0,p||0,g||0),d.emplaceBack(s?1:0,c?1:0,p||0,g||0),d.emplaceBack(s?1:0,c?1:0,p||0,g||0)}const q=Math.pow(2,25),P=Math.pow(2,24),O=Math.pow(2,17),j=Math.pow(2,16),W=Math.pow(2,9),J=Math.pow(2,8),re=Math.pow(2,1);function te(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const s=d.placed?1:0,c=Math.floor(127*d.opacity);return c*q+s*P+c*O+s*j+c*W+s*J+c*re+s}const ne=0;class ae{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,c,p,g,b){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(E,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,T)=>S.sortKey-T.sortKey));this._currentPartIndex<E.length;)if(c.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class ge{constructor(s,c,p,g,b,E,S){this.placement=new Fn(s,b,E,S),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(s,c,p){const g=y.exported.now(),b=()=>{const E=y.exported.now()-g;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ae(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Ee=512/y.EXTENT/2;class me{constructor(s,c,p){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let g=0;g<c.length;g++){const b=c.get(g),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,s)})}}getScaledCoordinates(s,c){const p=Ee/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*y.EXTENT+s.anchorX)*p),y:Math.floor((c.canonical.y*y.EXTENT+s.anchorY)*p)}}findMatches(s,c,p){const g=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let b=0;b<s.length;b++){const E=s.get(b);if(E.crossTileID)continue;const S=this.indexedSymbolInstances[E.key];if(!S)continue;const T=this.getScaledCoordinates(E,c);for(const k of S)if(Math.abs(k.coord.x-T.x)<=g&&Math.abs(k.coord.y-T.y)<=g&&!p[k.crossTileID]){p[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class We{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class He{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(0!==c)for(const p in this.indexes){const g=this.indexes[p],b={};for(const E in g){const S=g[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),b[S.tileID.key]=S}this.indexes[p]=b}this.lng=s}addBucket(s,c,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>s.overscaledZ)for(const S in E){const T=E[S];T.tileID.isChildOf(s)&&T.findMatches(c.symbolInstances,s,g)}else{const S=E[s.scaledTo(Number(b)).key];S&&S.findMatches(c.symbolInstances,s,g)}}for(let b=0;b<c.symbolInstances.length;b++){const E=c.symbolInstances.get(b);E.crossTileID||(E.crossTileID=p.generate(),g[E.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new me(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const p in c.indexedSymbolInstances)for(const g of c.indexedSymbolInstances[p])delete this.usedCrossTileIDs[s][g.crossTileID]}removeStaleBuckets(s){let c=!1;for(const p in this.indexes){const g=this.indexes[p];for(const b in g)s[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[b]),delete g[b],c=!0)}return c}}class Ye{constructor(){this.layerIndexes={},this.crossTileIDs=new We,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,p){let g=this.layerIndexes[s.id];void 0===g&&(g=this.layerIndexes[s.id]=new He);let b=!1;const E={};g.handleWrapJump(p);for(const S of c){const T=S.getBucket(s);T&&s.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,T,this.crossTileIDs)&&(b=!0),E[T.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(s){const c={};s.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const nt=(d,s)=>y.emitValidationErrors(d,s&&s.filter(c=>"source.canvas"!==c.identifier)),at=y.pick($t,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Kt=y.pick($t,["setCenter","setZoom","setBearing","setPitch"]),bt=function(){const d={},s=y.spec.$version;for(const c in y.spec.$root){const p=y.spec.$root[c];if(p.required){let g=null;g="version"===c?s:"array"===p.type?[]:{},null!=g&&(d[c]=g)}}return d}();class lt extends y.Evented{constructor(s,c={}){super(),this.map=s,this.dispatcher=new zr(co(),this),this.imageManager=new nn,this.imageManager.setEventedParent(this),this.glyphManager=new Gn(s._requestManager,c.localIdeographFontFamily),this.lineAtlas=new lr(256,512),this.crossTileSymbolIndex=new Ye,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());const p=this;this._rtlTextPluginCallback=lt.registerForPluginStateChange(g=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(b,E)=>{if(y.triggerPluginCompletionEvent(b),E&&E.every(S=>S))for(const S in p.sourceCaches)p.sourceCaches[S].reload()})}),this.on("data",g=>{if("source"!==g.dataType||"metadata"!==g.sourceDataType)return;const b=this.sourceCaches[g.sourceId];if(!b)return;const E=b.getSource();if(E&&E.vectorLayerIds)for(const S in this._layers){const T=this._layers[S];T.source===E.id&&this._validateLayer(T)}})}loadURL(s,c={}){this.fire(new y.Event("dataloading",{dataType:"style"}));const p="boolean"!=typeof c.validate||c.validate,g=this.map._requestManager.transformRequest(s,y.ResourceType.Style);this._request=y.getJSON(g,(b,E)=>{this._request=null,b?this.fire(new y.ErrorEvent(b)):E&&this._load(E,p)})}loadJSON(s,c={}){this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.exported.frame(()=>{this._request=null,this._load(s,!1!==c.validate)})}loadEmpty(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(bt,!1)}_load(s,c){if(c&&nt(this,y.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const g in s.sources)this.addSource(g,s.sources[g],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);const p=mn(this.stylesheet.layers);this._order=p.map(g=>g.id),this._layers={},this._serializedLayers={};for(let g of p)g=y.createStyleLayer(g),g.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=g,this._serializedLayers[g.id]=g.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Or(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(c,p,g){let b,E,S;const T=devicePixelRatio>1?"@2x":"";let k=y.getJSON(p.transformRequest(p.normalizeSpriteURL(c,T,".json"),y.ResourceType.SpriteJSON),(H,X)=>{k=null,S||(S=H,b=X,B())}),F=y.getImage(p.transformRequest(p.normalizeSpriteURL(c,T,".png"),y.ResourceType.SpriteImage),(H,X)=>{F=null,S||(S=H,E=X,B())});function B(){if(S)g(S);else if(b&&E){const H=y.exported.getImageData(E),X={};for(const Z in b){const{width:V,height:ee,x:ie,y:le,sdf:oe,pixelRatio:be,stretchX:de,stretchY:ye,content:Se}=b[Z],Ae=new y.RGBAImage({width:V,height:ee});y.RGBAImage.copy(H,Ae,{x:ie,y:le},{x:0,y:0},{width:V,height:ee}),X[Z]={data:Ae,pixelRatio:be,sdf:oe,stretchX:de,stretchY:ye,content:Se}}g(null,X)}}return{cancel(){k&&(k.cancel(),k=null),F&&(F.cancel(),F=null)}}}(s,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new y.ErrorEvent(c));else if(p)for(const g in p)this.imageManager.addImage(g,p[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))})}_validateLayer(s){const c=this.sourceCaches[s.source];if(!c)return;const p=s.sourceLayer;if(!p)return;const g=c.getSource();("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(p))&&this.fire(new y.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const c=[];for(const p of s){const g=this._layers[p];"custom"!==g.type&&c.push(g.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const c=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const E in this._updatedSources){const S=this._updatedSources[E];"reload"===S?this._reloadSource(E):"clear"===S&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];p[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in p){const b=this.sourceCaches[g];p[g]!==b.used&&b.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,c&&this.fire(new y.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),nt(this,y.validateStyle(s)))return!1;(s=y.clone$1(s)).layers=mn(s.layers);const c=function(g,b){if(!g)return[{command:$t.setStyle,args:[b]}];let E=[];try{if(!Ze(g.version,b.version))return[{command:$t.setStyle,args:[b]}];Ze(g.center,b.center)||E.push({command:$t.setCenter,args:[b.center]}),Ze(g.zoom,b.zoom)||E.push({command:$t.setZoom,args:[b.zoom]}),Ze(g.bearing,b.bearing)||E.push({command:$t.setBearing,args:[b.bearing]}),Ze(g.pitch,b.pitch)||E.push({command:$t.setPitch,args:[b.pitch]}),Ze(g.sprite,b.sprite)||E.push({command:$t.setSprite,args:[b.sprite]}),Ze(g.glyphs,b.glyphs)||E.push({command:$t.setGlyphs,args:[b.glyphs]}),Ze(g.transition,b.transition)||E.push({command:$t.setTransition,args:[b.transition]}),Ze(g.light,b.light)||E.push({command:$t.setLight,args:[b.light]});const S={},T=[];!function(F,B,H,X){let Z;for(Z in B=B||{},F=F||{})Object.prototype.hasOwnProperty.call(F,Z)&&(Object.prototype.hasOwnProperty.call(B,Z)||js(Z,H,X));for(Z in B)Object.prototype.hasOwnProperty.call(B,Z)&&(Object.prototype.hasOwnProperty.call(F,Z)?Ze(F[Z],B[Z])||("geojson"===F[Z].type&&"geojson"===B[Z].type&&$s(F,B,Z)?H.push({command:$t.setGeoJSONSourceData,args:[Z,B[Z].data]}):Fo(Z,B,H,X)):$i(Z,B,H))}(g.sources,b.sources,T,S);const k=[];g.layers&&g.layers.forEach(F=>{S[F.source]?E.push({command:$t.removeLayer,args:[F.id]}):k.push(F)}),E=E.concat(T),function(F,B,H){B=B||[];const X=(F=F||[]).map(ur),Z=B.map(ur),V=F.reduce(Sr,{}),ee=B.reduce(Sr,{}),ie=X.slice(),le=Object.create(null);let oe,be,de,ye,Se,Ae,fe;for(oe=0,be=0;oe<X.length;oe++)de=X[oe],Object.prototype.hasOwnProperty.call(ee,de)?be++:(H.push({command:$t.removeLayer,args:[de]}),ie.splice(ie.indexOf(de,be),1));for(oe=0,be=0;oe<Z.length;oe++)de=Z[Z.length-1-oe],ie[ie.length-1-oe]!==de&&(Object.prototype.hasOwnProperty.call(V,de)?(H.push({command:$t.removeLayer,args:[de]}),ie.splice(ie.lastIndexOf(de,ie.length-be),1)):be++,Ae=ie[ie.length-oe],H.push({command:$t.addLayer,args:[ee[de],Ae]}),ie.splice(ie.length-oe,0,de),le[de]=!0);for(oe=0;oe<Z.length;oe++)if(de=Z[oe],ye=V[de],Se=ee[de],!le[de]&&!Ze(ye,Se))if(Ze(ye.source,Se.source)&&Ze(ye["source-layer"],Se["source-layer"])&&Ze(ye.type,Se.type)){for(fe in Vr(ye.layout,Se.layout,H,de,null,$t.setLayoutProperty),Vr(ye.paint,Se.paint,H,de,null,$t.setPaintProperty),Ze(ye.filter,Se.filter)||H.push({command:$t.setFilter,args:[de,Se.filter]}),Ze(ye.minzoom,Se.minzoom)&&Ze(ye.maxzoom,Se.maxzoom)||H.push({command:$t.setLayerZoomRange,args:[de,Se.minzoom,Se.maxzoom]}),ye)Object.prototype.hasOwnProperty.call(ye,fe)&&"layout"!==fe&&"paint"!==fe&&"filter"!==fe&&"metadata"!==fe&&"minzoom"!==fe&&"maxzoom"!==fe&&(0===fe.indexOf("paint.")?Vr(ye[fe],Se[fe],H,de,fe.slice(6),$t.setPaintProperty):Ze(ye[fe],Se[fe])||H.push({command:$t.setLayerProperty,args:[de,fe,Se[fe]]}));for(fe in Se)Object.prototype.hasOwnProperty.call(Se,fe)&&!Object.prototype.hasOwnProperty.call(ye,fe)&&"layout"!==fe&&"paint"!==fe&&"filter"!==fe&&"metadata"!==fe&&"minzoom"!==fe&&"maxzoom"!==fe&&(0===fe.indexOf("paint.")?Vr(ye[fe],Se[fe],H,de,fe.slice(6),$t.setPaintProperty):Ze(ye[fe],Se[fe])||H.push({command:$t.setLayerProperty,args:[de,fe,Se[fe]]}))}else H.push({command:$t.removeLayer,args:[de]}),Ae=ie[ie.lastIndexOf(de)+1],H.push({command:$t.addLayer,args:[Se,Ae]})}(k,b.layers,E)}catch(S){console.warn("Unable to compute style diff:",S),E=[{command:$t.setStyle,args:[b]}]}return E}(this.serialize(),s).filter(g=>!(g.command in Kt));if(0===c.length)return!1;const p=c.filter(g=>!(g.command in at));if(p.length>0)throw new Error(`Unimplemented: ${p.map(g=>g.command).join(", ")}.`);return c.forEach(g=>{"setTransition"!==g.command&&this[g.command].apply(this,g.args)}),this.stylesheet=s,!0}addImage(s,c){if(this.getImage(s))return this.fire(new y.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,c),this._afterImageUpdated(s)}updateImage(s,c){this.imageManager.updateImage(s,c)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new y.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,c,p={}){if(this._checkLoaded(),void 0!==this.sourceCaches[s])throw new Error(`Source "${s}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(y.validateStyle.source,`sources.${s}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const g=this.sourceCaches[s]=new ht(s,c,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),void 0===this.sourceCaches[s])throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new y.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const c=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],c.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),c.setEventedParent(null),c.clearTiles(),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,c){this._checkLoaded(),this.sourceCaches[s].getSource().setData(c),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,c,p={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new y.ErrorEvent(new Error(`Layer "${g}" already exists on this map.`)));let b;if("custom"===s.type){if(nt(this,y.validateCustomStyleLayer(s)))return;b=y.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(g,s.source),s=y.clone$1(s),s=y.extend(s,{source:g})),this._validate(y.validateStyle.layer,`layers.${g}`,s,{arrayIndex:-1},p))return;b=y.createStyleLayer(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[b.id]=b.serialize()}const E=c?this._order.indexOf(c):this._order.length;if(c&&-1===E)this.fire(new y.ErrorEvent(new Error(`Cannot add layer "${g}" before non-existing layer "${c}".`)));else{if(this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&"custom"!==b.type){const S=this._removedLayers[g];delete this._removedLayers[g],S.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(s,c){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new y.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===c)return;const p=this._order.indexOf(s);this._order.splice(p,1);const g=c?this._order.indexOf(c):this._order.length;c&&-1===g?this.fire(new y.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${c}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const c=this._layers[s];if(!c)return void this.fire(new y.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));c.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=c,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],c.onRemove&&c.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,c,p){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===c&&g.maxzoom===p||(null!=c&&(g.minzoom=c),null!=p&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new y.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,c,p={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!Ze(g.filter,c))return null==c?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(y.validateStyle.filter,`layers.${g.id}.filter`,c,null,p)||(g.filter=y.clone$1(c),this._updateLayer(g)))}else this.fire(new y.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return y.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,c,p,g={}){this._checkLoaded();const b=this.getLayer(s);b?Ze(b.getLayoutProperty(c),p)||(b.setLayoutProperty(c,p,g),this._updateLayer(b)):this.fire(new y.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,c){const p=this.getLayer(s);if(p)return p.getLayoutProperty(c);this.fire(new y.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,c,p,g={}){this._checkLoaded();const b=this.getLayer(s);b?Ze(b.getPaintProperty(c),p)||(b.setPaintProperty(c,p,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new y.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,c){return this.getLayer(s).getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const p=s.source,g=s.sourceLayer,b=this.sourceCaches[p];if(void 0===b)return void this.fire(new y.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=b.getSource().type;"geojson"===E&&g?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==E||g?(void 0===s.id&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,s.id,c)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,c){this._checkLoaded();const p=s.source,g=this.sourceCaches[p];if(void 0===g)return void this.fire(new y.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=g.getSource().type,E="vector"===b?s.sourceLayer:void 0;"vector"!==b||E?c&&"string"!=typeof s.id&&"number"!=typeof s.id?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(E,s.id,c):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const c=s.source,p=s.sourceLayer,g=this.sourceCaches[c];if(void 0!==g)return"vector"!==g.getSource().type||p?(void 0===s.id&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),g.getFeatureState(p,s.id)):void this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new y.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&"raster"!==this.sourceCaches[s.source].getSource().type&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const c=E=>"fill-extrusion"===this._layers[E].type,p={},g=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(c(S)){p[S]=E;for(const T of s){const k=T[S];if(k)for(const F of k)g.push(F)}}}g.sort((E,S)=>S.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(c(S))for(let T=g.length-1;T>=0;T--){const k=g[T].feature;if(p[k.layer.id]<E)break;b.push(k),g.pop()}else for(const T of s){const k=T[S];if(k)for(const F of k)b.push(F.feature)}}return b}queryRenderedFeatures(s,c,p){c&&c.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const g={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of c.layers){const S=this._layers[E];if(!S)return this.fire(new y.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];g[S.source]=!0}}const b=[];c.availableImages=this._availableImages;for(const E in this.sourceCaches)c.layers&&!g[E]||b.push(Ui(this.sourceCaches[E],this._layers,this._serializedLayers,s,c,p));return this.placement&&b.push(function(E,S,T,k,F,B,H){const X={},Z=B.queryRenderedSymbols(k),V=[];for(const ee of Object.keys(Z).map(Number))V.push(H[ee]);V.sort(an);for(const ee of V){const ie=ee.featureIndex.lookupSymbolFeatures(Z[ee.bucketInstanceId],S,ee.bucketIndex,ee.sourceLayerIndex,F.filter,F.layers,F.availableImages,E);for(const le in ie){const oe=X[le]=X[le]||[],be=ie[le];be.sort((de,ye)=>{const Se=ee.featureSortOrder;if(Se){const Ae=Se.indexOf(de.featureIndex);return Se.indexOf(ye.featureIndex)-Ae}return ye.featureIndex-de.featureIndex});for(const de of be)oe.push(de)}}for(const ee in X)X[ee].forEach(ie=>{const le=ie.feature,oe=T[E[ee].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=oe});return X}(this._layers,this._serializedLayers,this.sourceCaches,s,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,c){c&&c.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const p=this.sourceCaches[s];return p?function(g,b){const E=g.getRenderableIds().map(k=>g.getTileByID(k)),S=[],T={};for(let k=0;k<E.length;k++){const F=E[k],B=F.tileID.canonical.key;T[B]||(T[B]=!0,F.querySourceFeatures(S,b))}return S}(p,c):[]}addSourceType(s,c,p){return lt.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(lt.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,c={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const E in s)if(!Ze(s[E],p[E])){g=!0;break}if(!g)return;const b={now:y.exported.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,c),this.light.updateTransitions(b)}_validate(s,c,p,g,b={}){return(!b||!1!==b.validate)&&nt(this,s.call(y.validateStyle,y.extend({key:c,style:this.serialize(),value:p,styleSpec:y.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches)this.sourceCaches[s].clearTiles(),this.sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const c in this.sourceCaches)this.sourceCaches[c].update(s)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,c,p,g,b=!1){let E=!1,S=!1;const T={};for(const k of this._order){const F=this._layers[k];if("symbol"!==F.type)continue;if(!T[F.source]){const H=this.sourceCaches[F.source];T[F.source]=H.getRenderableIds(!0).map(X=>H.getTileByID(X)).sort((X,Z)=>Z.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(Z.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(F,T[F.source],s.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||0===p)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.exported.now(),s.zoom))&&(this.pauseablePlacement=new ge(s,this._order,b,c,p,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.exported.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const k of this._order){const F=this._layers[k];"symbol"===F.type&&this.placement.updateLayerOpacities(F,T[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,c,p){this.imageManager.getImages(c.icons,p),this._updateTilesForChangedImages();const g=this.sourceCaches[c.source];g&&g.setDependencies(c.tileID.key,c.type,c.icons)}getGlyphs(s,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(s,c,p){return y.makeRequest(c,p)}}lt.getSourceType=function(d){return Nr[d]},lt.setSourceType=function(d,s){Nr[d]=s},lt.registerForPluginStateChange=y.registerForPluginStateChange;var Ft=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),dt={prelude:wt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),background:wt("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:wt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wt("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:wt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:wt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:wt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:wt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:wt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:wt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:wt("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:wt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:wt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:wt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),lineGradient:wt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),linePattern:wt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:wt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:wt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:wt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),symbolSDF:wt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:wt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}")};function wt(d,s){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),g=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=b?b.concat(g):g,S={};return{fragmentSource:d=d.replace(c,(T,k,F,B,H)=>(S[H]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${H}\nvarying ${F} ${B} ${H};\n#else\nuniform ${F} ${B} u_${H};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${H}\n    ${F} ${B} ${H} = u_${H};\n#endif\n`)),vertexSource:s=s.replace(c,(T,k,F,B,H)=>{const X="float"===B?"vec2":"vec4",Z=H.match(/color/)?"color":X;return S[H]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${F} ${X} a_${H};\nvarying ${F} ${B} ${H};\n#else\nuniform ${F} ${B} u_${H};\n#endif\n`:"vec4"===Z?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = a_${H};\n#else\n    ${F} ${B} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);\n#else\n    ${F} ${B} ${H} = u_${H};\n#endif\n`:"define"===k?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${F} ${X} a_${H};\n#else\nuniform ${F} ${B} u_${H};\n#endif\n`:"vec4"===Z?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${F} ${B} ${H} = a_${H};\n#else\n    ${F} ${B} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${F} ${B} ${H} = unpack_mix_${Z}(a_${H}, u_${H}_t);\n#else\n    ${F} ${B} ${H} = u_${H};\n#endif\n`}),staticAttributes:p,staticUniforms:E}}class yt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,c,p,g,b,E,S,T){this.context=s;let k=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!k&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(k=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===p&&!k&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===T?(s.bindVertexArrayOES.set(this.vao),S&&S.bind(),b&&b.dynamicDraw&&b.bind(),T&&T.bind()):this.freshBind(c,p,g,b,E,S,T)}freshBind(s,c,p,g,b,E,S){let T;const k=s.numAttributes,F=this.context,B=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S;else{T=F.currentNumAttributes||0;for(let H=k;H<T;H++)B.disableVertexAttribArray(H)}c.enableAttributes(B,s);for(const H of p)H.enableAttributes(B,s);E&&E.enableAttributes(B,s),S&&S.enableAttributes(B,s),c.bind(),c.setVertexAttribPointers(B,s,b);for(const H of p)H.bind(),H.setVertexAttribPointers(B,s,b);E&&(E.bind(),E.setVertexAttribPointers(B,s,b)),g&&g.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,s,b)),F.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Cs(d){const s=[];for(let c=0;c<d.length;c++){if(null===d[c])continue;const p=d[c].split(" ");s.push(p.pop())}return s}class ju{constructor(s,c,p,g,b,E){const S=s.gl;this.program=S.createProgram();const T=Cs(p.staticAttributes),k=g?g.getBinderAttributes():[],F=T.concat(k),B=p.staticUniforms?Cs(p.staticUniforms):[],H=g?g.getBinderUniforms():[],X=B.concat(H),Z=[];for(const de of X)Z.indexOf(de)<0&&Z.push(de);const V=g?g.defines():[];E&&V.push("#define OVERDRAW_INSPECTOR;");const ee=V.concat(dt.prelude.fragmentSource,p.fragmentSource).join("\n"),ie=V.concat(dt.prelude.vertexSource,p.vertexSource).join("\n"),le=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(le,ee),S.compileShader(le),S.attachShader(this.program,le);const oe=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(oe,ie),S.compileShader(oe),S.attachShader(this.program,oe),this.attributes={};const be={};this.numAttributes=F.length;for(let de=0;de<this.numAttributes;de++)F[de]&&(S.bindAttribLocation(this.program,de,F[de]),this.attributes[F[de]]=de);S.linkProgram(this.program),S.deleteShader(oe),S.deleteShader(le);for(let de=0;de<Z.length;de++){const ye=Z[de];if(ye&&!be[ye]){const Se=S.getUniformLocation(this.program,ye);Se&&(be[ye]=Se)}}this.fixedUniforms=b(s,be),this.binderUniforms=g?g.getUniforms(s,be):[]}draw(s,c,p,g,b,E,S,T,k,F,B,H,X,Z,V,ee){const ie=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(g),s.setColorMode(b),s.setCullFace(E);for(const oe in this.fixedUniforms)this.fixedUniforms[oe].set(S[oe]);Z&&Z.setUniforms(s,this.binderUniforms,H,{zoom:X});const le={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[c];for(const oe of B.get()){const be=oe.vaos||(oe.vaos={});(be[T]||(be[T]=new yt)).bind(s,this,k,Z?Z.getPaintVertexBuffers():[],F,oe.vertexOffset,V,ee),ie.drawElements(c,oe.primitiveLength*le,ie.UNSIGNED_SHORT,oe.primitiveOffset*le*2)}}}function Qa(d,s,c){const p=1/Qn(c,1,s.transform.tileZoom),g=Math.pow(2,c.tileID.overscaledZ),b=c.tileSize*Math.pow(2,s.transform.tileZoom)/g,E=b*(c.tileID.canonical.x+c.tileID.wrap*g),S=b*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const _t=(d,s,c,p)=>{const g=s.style.light,b=g.properties.get("position"),E=_n(b.x,b.y,b.z),S=(k=new y.ARRAY_TYPE(9),y.ARRAY_TYPE!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k);var k;"viewport"===g.properties.get("anchor")&&function(k,F){var B=Math.sin(F),H=Math.cos(F);k[0]=H,k[1]=B,k[2]=0,k[3]=-B,k[4]=H,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(S,-s.transform.angle),function(k,F,B){var H=F[0],X=F[1],Z=F[2];k[0]=H*B[0]+X*B[3]+Z*B[6],k[1]=H*B[1]+X*B[4]+Z*B[7],k[2]=H*B[2]+X*B[5]+Z*B[8]}(E,E,S);const T=g.properties.get("color");return{u_matrix:d,u_lightpos:E,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+c,u_opacity:p}},Vo=(d,s,c,p,g,b,E)=>y.extend(_t(d,s,c,p),Qa(b,s,E),{u_height_factor:-Math.pow(2,g.overscaledZ)/E.tileSize/8}),$u=d=>({u_matrix:d}),Dt=(d,s,c,p)=>y.extend($u(d),Qa(c,s,p)),pa=(d,s)=>({u_matrix:d,u_world:s}),ft=(d,s,c,p,g)=>y.extend(Dt(d,s,c,p),{u_world:g}),cr=(d,s,c,p)=>{const g=d.transform;let b,E;if("map"===p.paint.get("circle-pitch-alignment")){const S=Qn(c,1,g.zoom);b=!0,E=[S,S]}else b=!1,E=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+("map"===p.paint.get("circle-pitch-scale")),u_matrix:d.translatePosMatrix(s.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:devicePixelRatio,u_extrude_scale:E}},Bl=(d,s,c)=>{const p=Qn(c,1,s.zoom),g=Math.pow(2,s.zoom-c.tileID.overscaledZ),b=c.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*g),s.pixelsToGLUnits[1]/(p*g)],u_overscale_factor:b}},Vl=(d,s,c=1)=>({u_matrix:d,u_color:s,u_overlay:0,u_overlay_scale:c}),el=d=>({u_matrix:d}),Uo=(d,s,c,p)=>({u_matrix:d,u_extrude_scale:Qn(s,1,c),u_intensity:p});function $r(d,s){const c=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new y.MercatorCoordinate(0,p/c).toLngLat().lat,new y.MercatorCoordinate(0,(p+1)/c).toLngLat().lat]}const ma=(d,s,c)=>{const p=d.transform;return{u_matrix:Ch(d,s,c),u_ratio:1/Qn(s,1,p.zoom),u_device_pixel_ratio:devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Hu=(d,s,c,p)=>y.extend(ma(d,s,c),{u_image:0,u_image_height:p}),Dh=(d,s,c,p)=>{const g=d.transform,b=Eh(s,g);return{u_matrix:Ch(d,s,c),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Qn(s,1,g.zoom),u_device_pixel_ratio:devicePixelRatio,u_image:0,u_scale:[b,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},si=(d,s,c,p,g)=>{const b=d.lineAtlas,E=Eh(s,d.transform),S="round"===c.layout.get("line-cap"),T=b.getDash(p.from,S),k=b.getDash(p.to,S),F=T.width*g.fromScale,B=k.width*g.toScale;return y.extend(ma(d,s,c),{u_patternscale_a:[E/F,-T.height/2],u_patternscale_b:[E/B,-k.height/2],u_sdfgamma:b.width/(256*Math.min(F,B)*devicePixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:k.y,u_mix:g.t})};function Eh(d,s){return 1/Qn(d,1,s.tileZoom)}function Ch(d,s,c){return d.translatePosMatrix(s.tileID.posMatrix,s,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const lf=(d,s,c,p,g)=>{return{u_matrix:d,u_tl_parent:s,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(E=g.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:uf(g.paint.get("raster-hue-rotate"))};var b,E};function uf(d){d*=Math.PI/180;const s=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const qu=(d,s,c,p,g,b,E,S,T,k)=>{const F=g.transform;return{u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:F.width/F.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+T,u_pitch_with_map:+p,u_texsize:k,u_texture:0}},Sh=(d,s,c,p,g,b,E,S,T,k,F)=>{const B=g.transform;return y.extend(qu(d,s,c,p,g,b,E,S,T,k),{u_gamma_scale:p?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:devicePixelRatio,u_is_halo:+F})},Ul=(d,s,c,p,g,b,E,S,T,k)=>y.extend(Sh(d,s,c,p,g,b,E,S,!0,T,!0),{u_texsize_icon:k,u_texture_icon:1}),Gu=(d,s,c)=>({u_matrix:d,u_opacity:s,u_color:c}),hr=(d,s,c,p,g,b)=>y.extend(function(E,S,T,k){const F=T.imageManager.getPattern(E.from.toString()),B=T.imageManager.getPattern(E.to.toString()),{width:H,height:X}=T.imageManager.getPixelSize(),Z=Math.pow(2,k.tileID.overscaledZ),V=k.tileSize*Math.pow(2,T.transform.tileZoom)/Z,ee=V*(k.tileID.canonical.x+k.tileID.wrap*Z),ie=V*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[H,X],u_mix:S.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Qn(k,1,T.transform.tileZoom),u_pixel_coord_upper:[ee>>16,ie>>16],u_pixel_coord_lower:[65535&ee,65535&ie]}}(p,b,c,g),{u_matrix:d,u_opacity:s}),bn={fillExtrusion:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_lightpos:new y.Uniform3f(d,s.u_lightpos),u_lightintensity:new y.Uniform1f(d,s.u_lightintensity),u_lightcolor:new y.Uniform3f(d,s.u_lightcolor),u_vertical_gradient:new y.Uniform1f(d,s.u_vertical_gradient),u_opacity:new y.Uniform1f(d,s.u_opacity)}),fillExtrusionPattern:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_lightpos:new y.Uniform3f(d,s.u_lightpos),u_lightintensity:new y.Uniform1f(d,s.u_lightintensity),u_lightcolor:new y.Uniform3f(d,s.u_lightcolor),u_vertical_gradient:new y.Uniform1f(d,s.u_vertical_gradient),u_height_factor:new y.Uniform1f(d,s.u_height_factor),u_image:new y.Uniform1i(d,s.u_image),u_texsize:new y.Uniform2f(d,s.u_texsize),u_pixel_coord_upper:new y.Uniform2f(d,s.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(d,s.u_pixel_coord_lower),u_scale:new y.Uniform3f(d,s.u_scale),u_fade:new y.Uniform1f(d,s.u_fade),u_opacity:new y.Uniform1f(d,s.u_opacity)}),fill:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix)}),fillPattern:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_image:new y.Uniform1i(d,s.u_image),u_texsize:new y.Uniform2f(d,s.u_texsize),u_pixel_coord_upper:new y.Uniform2f(d,s.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(d,s.u_pixel_coord_lower),u_scale:new y.Uniform3f(d,s.u_scale),u_fade:new y.Uniform1f(d,s.u_fade)}),fillOutline:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_world:new y.Uniform2f(d,s.u_world)}),fillOutlinePattern:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_world:new y.Uniform2f(d,s.u_world),u_image:new y.Uniform1i(d,s.u_image),u_texsize:new y.Uniform2f(d,s.u_texsize),u_pixel_coord_upper:new y.Uniform2f(d,s.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(d,s.u_pixel_coord_lower),u_scale:new y.Uniform3f(d,s.u_scale),u_fade:new y.Uniform1f(d,s.u_fade)}),circle:(d,s)=>({u_camera_to_center_distance:new y.Uniform1f(d,s.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(d,s.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(d,s.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(d,s.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(d,s.u_matrix)}),collisionBox:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_camera_to_center_distance:new y.Uniform1f(d,s.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(d,s.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(d,s.u_extrude_scale),u_overscale_factor:new y.Uniform1f(d,s.u_overscale_factor)}),collisionCircle:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_inv_matrix:new y.UniformMatrix4f(d,s.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(d,s.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(d,s.u_viewport_size)}),debug:(d,s)=>({u_color:new y.UniformColor(d,s.u_color),u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_overlay:new y.Uniform1i(d,s.u_overlay),u_overlay_scale:new y.Uniform1f(d,s.u_overlay_scale)}),clippingMask:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix)}),heatmap:(d,s)=>({u_extrude_scale:new y.Uniform1f(d,s.u_extrude_scale),u_intensity:new y.Uniform1f(d,s.u_intensity),u_matrix:new y.UniformMatrix4f(d,s.u_matrix)}),heatmapTexture:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_world:new y.Uniform2f(d,s.u_world),u_image:new y.Uniform1i(d,s.u_image),u_color_ramp:new y.Uniform1i(d,s.u_color_ramp),u_opacity:new y.Uniform1f(d,s.u_opacity)}),hillshade:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_image:new y.Uniform1i(d,s.u_image),u_latrange:new y.Uniform2f(d,s.u_latrange),u_light:new y.Uniform2f(d,s.u_light),u_shadow:new y.UniformColor(d,s.u_shadow),u_highlight:new y.UniformColor(d,s.u_highlight),u_accent:new y.UniformColor(d,s.u_accent)}),hillshadePrepare:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_image:new y.Uniform1i(d,s.u_image),u_dimension:new y.Uniform2f(d,s.u_dimension),u_zoom:new y.Uniform1f(d,s.u_zoom),u_unpack:new y.Uniform4f(d,s.u_unpack)}),line:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_ratio:new y.Uniform1f(d,s.u_ratio),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(d,s.u_units_to_pixels)}),lineGradient:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_ratio:new y.Uniform1f(d,s.u_ratio),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(d,s.u_units_to_pixels),u_image:new y.Uniform1i(d,s.u_image),u_image_height:new y.Uniform1f(d,s.u_image_height)}),linePattern:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_texsize:new y.Uniform2f(d,s.u_texsize),u_ratio:new y.Uniform1f(d,s.u_ratio),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_image:new y.Uniform1i(d,s.u_image),u_units_to_pixels:new y.Uniform2f(d,s.u_units_to_pixels),u_scale:new y.Uniform3f(d,s.u_scale),u_fade:new y.Uniform1f(d,s.u_fade)}),lineSDF:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_ratio:new y.Uniform1f(d,s.u_ratio),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(d,s.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(d,s.u_patternscale_a),u_patternscale_b:new y.Uniform2f(d,s.u_patternscale_b),u_sdfgamma:new y.Uniform1f(d,s.u_sdfgamma),u_image:new y.Uniform1i(d,s.u_image),u_tex_y_a:new y.Uniform1f(d,s.u_tex_y_a),u_tex_y_b:new y.Uniform1f(d,s.u_tex_y_b),u_mix:new y.Uniform1f(d,s.u_mix)}),raster:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_tl_parent:new y.Uniform2f(d,s.u_tl_parent),u_scale_parent:new y.Uniform1f(d,s.u_scale_parent),u_buffer_scale:new y.Uniform1f(d,s.u_buffer_scale),u_fade_t:new y.Uniform1f(d,s.u_fade_t),u_opacity:new y.Uniform1f(d,s.u_opacity),u_image0:new y.Uniform1i(d,s.u_image0),u_image1:new y.Uniform1i(d,s.u_image1),u_brightness_low:new y.Uniform1f(d,s.u_brightness_low),u_brightness_high:new y.Uniform1f(d,s.u_brightness_high),u_saturation_factor:new y.Uniform1f(d,s.u_saturation_factor),u_contrast_factor:new y.Uniform1f(d,s.u_contrast_factor),u_spin_weights:new y.Uniform3f(d,s.u_spin_weights)}),symbolIcon:(d,s)=>({u_is_size_zoom_constant:new y.Uniform1i(d,s.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(d,s.u_is_size_feature_constant),u_size_t:new y.Uniform1f(d,s.u_size_t),u_size:new y.Uniform1f(d,s.u_size),u_camera_to_center_distance:new y.Uniform1f(d,s.u_camera_to_center_distance),u_pitch:new y.Uniform1f(d,s.u_pitch),u_rotate_symbol:new y.Uniform1i(d,s.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(d,s.u_aspect_ratio),u_fade_change:new y.Uniform1f(d,s.u_fade_change),u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(d,s.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(d,s.u_coord_matrix),u_is_text:new y.Uniform1i(d,s.u_is_text),u_pitch_with_map:new y.Uniform1i(d,s.u_pitch_with_map),u_texsize:new y.Uniform2f(d,s.u_texsize),u_texture:new y.Uniform1i(d,s.u_texture)}),symbolSDF:(d,s)=>({u_is_size_zoom_constant:new y.Uniform1i(d,s.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(d,s.u_is_size_feature_constant),u_size_t:new y.Uniform1f(d,s.u_size_t),u_size:new y.Uniform1f(d,s.u_size),u_camera_to_center_distance:new y.Uniform1f(d,s.u_camera_to_center_distance),u_pitch:new y.Uniform1f(d,s.u_pitch),u_rotate_symbol:new y.Uniform1i(d,s.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(d,s.u_aspect_ratio),u_fade_change:new y.Uniform1f(d,s.u_fade_change),u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(d,s.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(d,s.u_coord_matrix),u_is_text:new y.Uniform1i(d,s.u_is_text),u_pitch_with_map:new y.Uniform1i(d,s.u_pitch_with_map),u_texsize:new y.Uniform2f(d,s.u_texsize),u_texture:new y.Uniform1i(d,s.u_texture),u_gamma_scale:new y.Uniform1f(d,s.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(d,s.u_is_halo)}),symbolTextAndIcon:(d,s)=>({u_is_size_zoom_constant:new y.Uniform1i(d,s.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(d,s.u_is_size_feature_constant),u_size_t:new y.Uniform1f(d,s.u_size_t),u_size:new y.Uniform1f(d,s.u_size),u_camera_to_center_distance:new y.Uniform1f(d,s.u_camera_to_center_distance),u_pitch:new y.Uniform1f(d,s.u_pitch),u_rotate_symbol:new y.Uniform1i(d,s.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(d,s.u_aspect_ratio),u_fade_change:new y.Uniform1f(d,s.u_fade_change),u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(d,s.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(d,s.u_coord_matrix),u_is_text:new y.Uniform1i(d,s.u_is_text),u_pitch_with_map:new y.Uniform1i(d,s.u_pitch_with_map),u_texsize:new y.Uniform2f(d,s.u_texsize),u_texsize_icon:new y.Uniform2f(d,s.u_texsize_icon),u_texture:new y.Uniform1i(d,s.u_texture),u_texture_icon:new y.Uniform1i(d,s.u_texture_icon),u_gamma_scale:new y.Uniform1f(d,s.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(d,s.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(d,s.u_is_halo)}),background:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_opacity:new y.Uniform1f(d,s.u_opacity),u_color:new y.UniformColor(d,s.u_color)}),backgroundPattern:(d,s)=>({u_matrix:new y.UniformMatrix4f(d,s.u_matrix),u_opacity:new y.Uniform1f(d,s.u_opacity),u_image:new y.Uniform1i(d,s.u_image),u_pattern_tl_a:new y.Uniform2f(d,s.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(d,s.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(d,s.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(d,s.u_pattern_br_b),u_texsize:new y.Uniform2f(d,s.u_texsize),u_mix:new y.Uniform1f(d,s.u_mix),u_pattern_size_a:new y.Uniform2f(d,s.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(d,s.u_pattern_size_b),u_scale_a:new y.Uniform1f(d,s.u_scale_a),u_scale_b:new y.Uniform1f(d,s.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(d,s.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(d,s.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(d,s.u_tile_units_to_pixels)})};class Ih{constructor(s,c,p){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jo{constructor(s,c,p,g){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=g,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let p=0;p<this.attributes.length;p++){const g=c.attributes[this.attributes[p].name];void 0!==g&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,c,p){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],E=c.attributes[b.name];void 0!==E&&s.vertexAttribPointer(E,b.components,s[Zu[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ke{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ga extends Ke{getDefault(){return y.Color.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ei extends Ke{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class tl extends Ke{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class nl extends Ke{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class un extends Ke{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class rl extends Ke{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Wu extends Ke{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class ya extends Ke{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class po extends Ke{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Xu extends Ke{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Th extends Ke{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class Et extends Ke{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class jl extends Ke{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class $l extends Ke{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Hi extends Ke{getDefault(){return y.Color.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class _a extends Ke{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Ku extends Ke{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class hs extends Ke{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Ci extends Ke{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Hl extends Ke{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class ql extends Ke{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Hr extends Ke{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class $e extends Ke{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Yu extends Ke{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class va extends Ke{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class il extends Ke{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Be extends Ke{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Gl extends Ke{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class Ah extends Ke{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Si extends Ke{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ln extends Ke{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class $o extends Ke{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class sl extends $o{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class xa extends $o{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ol{constructor(s,c,p,g){this.context=s,this.width=c,this.height=p;const b=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new sl(s,b),g&&(this.depthAttachment=new xa(s,b))}destroy(){const s=this.context.gl,c=this.colorAttachment.get();if(c&&s.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class cn{constructor(s,c,p){this.blendFunction=s,this.blendColor=c,this.mask=p}}cn.Replace=[1,0],cn.disabled=new cn(cn.Replace,y.Color.transparent,[!1,!1,!1,!1]),cn.unblended=new cn(cn.Replace,y.Color.transparent,[!0,!0,!0,!0]),cn.alphaBlended=new cn([1,771],y.Color.transparent,[!0,!0,!0,!0]);class Ss{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ga(this),this.clearDepth=new Ei(this),this.clearStencil=new tl(this),this.colorMask=new nl(this),this.depthMask=new un(this),this.stencilMask=new rl(this),this.stencilFunc=new Wu(this),this.stencilOp=new ya(this),this.stencilTest=new po(this),this.depthRange=new Xu(this),this.depthTest=new Th(this),this.depthFunc=new Et(this),this.blend=new jl(this),this.blendFunc=new $l(this),this.blendColor=new Hi(this),this.blendEquation=new _a(this),this.cullFace=new Ku(this),this.cullFaceSide=new hs(this),this.frontFace=new Ci(this),this.program=new Hl(this),this.activeTexture=new ql(this),this.viewport=new Hr(this),this.bindFramebuffer=new $e(this),this.bindRenderbuffer=new Yu(this),this.bindTexture=new va(this),this.bindVertexBuffer=new il(this),this.bindElementBuffer=new Be(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Gl(this),this.pixelStoreUnpack=new Ah(this),this.pixelStoreUnpackPremultiplyAlpha=new Si(this),this.pixelStoreUnpackFlipY=new ln(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c){return new Ih(this,s,c)}createVertexBuffer(s,c,p){return new jo(this,s,c,p)}createRenderbuffer(s,c,p){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,s,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(s,c,p){return new ol(this,s,c,p)}clear({color:s,depth:c}){const p=this.gl;let g=0;s&&(g|=p.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(g|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p.clear(g)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){Ze(s.blendFunction,cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Vt{constructor(s,c,p){this.func=s,this.mask=c,this.range=p}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);class On{constructor(s,c,p,g,b,E){this.test=s,this.ref=c,this.mask=p,this.fail=g,this.depthFail=b,this.pass=E}}On.disabled=new On({func:519,mask:0},0,0,7680,7680,7680);class An{constructor(s,c,p){this.enable=s,this.mode=c,this.frontFace=p}}let Ho;function al(d,s,c,p,g,b,E){const S=d.context,T=S.gl,k=d.useProgram("collisionBox"),F=[];let B=0,H=0;for(let oe=0;oe<p.length;oe++){const be=p[oe],de=s.getTile(be),ye=de.getBucket(c);if(!ye)continue;let Se=be.posMatrix;0===g[0]&&0===g[1]||(Se=d.translatePosMatrix(be.posMatrix,de,g,b));const Ae=E?ye.textCollisionBox:ye.iconCollisionBox,fe=ye.collisionCircleArray;if(fe.length>0){const Re=y.create(),et=Se;y.mul(Re,ye.placementInvProjMatrix,d.transform.glCoordMatrix),y.mul(Re,Re,ye.placementViewportMatrix),F.push({circleArray:fe,circleOffset:H,transform:et,invTransform:Re}),B+=fe.length/4,H=B}Ae&&k.draw(S,T.LINES,Vt.disabled,On.disabled,d.colorModeForRenderPass(),An.disabled,Bl(Se,d.transform,de),c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,d.transform.zoom,null,null,Ae.collisionVertexBuffer)}if(!E||!F.length)return;const X=d.useProgram("collisionCircle"),Z=new y.CollisionCircleLayoutArray;Z.resize(4*B),Z._trim();let V=0;for(const oe of F)for(let be=0;be<oe.circleArray.length/4;be++){const de=4*be,ye=oe.circleArray[de+0],Se=oe.circleArray[de+1],Ae=oe.circleArray[de+2],fe=oe.circleArray[de+3];Z.emplace(V++,ye,Se,Ae,fe,0),Z.emplace(V++,ye,Se,Ae,fe,1),Z.emplace(V++,ye,Se,Ae,fe,2),Z.emplace(V++,ye,Se,Ae,fe,3)}(!Ho||Ho.length<2*B)&&(Ho=function(oe){const be=2*oe,de=new y.QuadTriangleArray;de.resize(be),de._trim();for(let ye=0;ye<be;ye++){const Se=6*ye;de.uint16[Se+0]=4*ye+0,de.uint16[Se+1]=4*ye+1,de.uint16[Se+2]=4*ye+2,de.uint16[Se+3]=4*ye+2,de.uint16[Se+4]=4*ye+3,de.uint16[Se+5]=4*ye+0}return de}(B));const ee=S.createIndexBuffer(Ho,!0),ie=S.createVertexBuffer(Z,y.collisionCircleLayout.members,!0);for(const oe of F){const be={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(le=d.transform).cameraToCenterDistance,u_viewport_size:[le.width,le.height]};X.draw(S,T.TRIANGLES,Vt.disabled,On.disabled,d.colorModeForRenderPass(),An.disabled,be,c.id,ie,ee,y.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,d.transform.zoom,null,null,null)}var le;ie.destroy(),ee.destroy()}An.disabled=new An(!1,1029,2305),An.backCCW=new An(!0,1029,2305);const Zs=y.identity(new Float32Array(16));function Ju(d,s,c,p,g,b){const{horizontalAlign:E,verticalAlign:S}=y.getAnchorAlignment(d),T=-(E-.5)*s,k=-(S-.5)*c,F=y.evaluateVariableOffset(d,p);return new y.Point((T/g+F[0])*b,(k/g+F[1])*b)}function ll(d,s,c,p,g,b,E,S,T,k,F){const B=d.text.placedSymbolArray,H=d.text.dynamicLayoutVertexArray,X=d.icon.dynamicLayoutVertexArray,Z={};H.clear();for(let V=0;V<B.length;V++){const ee=B.get(V),ie=d.allowVerticalPlacement&&!ee.placedOrientation,le=ee.hidden||!ee.crossTileID||ie?null:p[ee.crossTileID];if(le){const oe=new y.Point(ee.anchorX,ee.anchorY),be=Yn(oe,c?S:E),de=Rn(b.cameraToCenterDistance,be.signedDistanceFromCamera);let ye=g.evaluateSizeForFeature(d.textSizeData,k,ee)*de/y.ONE_EM;c&&(ye*=d.tilePixelRatio/T);const{width:Se,height:Ae,anchor:fe,textOffset:Re,textBoxScale:et}=le,st=Ju(fe,Se,Ae,Re,et,ye),Yt=c?Yn(oe.add(st),E).point:be.point.add(s?st.rotate(-b.angle):st),Ot=d.allowVerticalPlacement&&ee.placedOrientation===y.WritingMode.vertical?Math.PI/2:0;for(let tt=0;tt<ee.numGlyphs;tt++)y.addDynamicAttributes(H,Yt,Ot);F&&ee.associatedIconIndex>=0&&(Z[ee.associatedIconIndex]={shiftedAnchor:Yt,angle:Ot})}else Ln(ee.numGlyphs,H)}if(F){X.clear();const V=d.icon.placedSymbolArray;for(let ee=0;ee<V.length;ee++){const ie=V.get(ee);if(ie.hidden)Ln(ie.numGlyphs,X);else{const le=Z[ee];if(le)for(let oe=0;oe<ie.numGlyphs;oe++)y.addDynamicAttributes(X,le.shiftedAnchor,le.angle);else Ln(ie.numGlyphs,X)}}d.icon.dynamicLayoutVertexBuffer.updateData(X)}d.text.dynamicLayoutVertexBuffer.updateData(H)}function dr(d,s,c){return c.iconsInText&&s?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function qr(d,s,c,p,g,b,E,S,T,k,F,B){const H=d.context,X=H.gl,Z=d.transform,V="map"===S,ee="map"===T,ie=V&&"point"!==c.layout.get("symbol-placement"),le=V&&!ee&&!ie,oe=!c.layout.get("symbol-sort-key").isConstant();let be=!1;const de=d.depthModeForSublayer(0,Vt.ReadOnly),ye=c.layout.get("text-variable-anchor"),Se=[];for(const Ae of p){const fe=s.getTile(Ae),Re=fe.getBucket(c);if(!Re)continue;const et=g?Re.text:Re.icon;if(!et||!et.segments.get().length)continue;const st=et.programConfigurations.get(c.id),Yt=g||Re.sdfIcons,Ot=g?Re.textSizeData:Re.iconSizeData,tt=ee||0!==Z.pitch,Ht=d.useProgram(dr(Yt,g,Re),st),Rt=y.evaluateSizeForZoom(Ot,Z.zoom);let At,zn,gs,Ji,Pi=[0,0],ki=null;if(g){if(zn=fe.glyphAtlasTexture,gs=X.LINEAR,At=fe.glyphAtlasTexture.size,Re.iconsInText){Pi=fe.imageAtlasTexture.size,ki=fe.imageAtlasTexture;const Bn="composite"===Ot.kind||"camera"===Ot.kind;Ji=tt||d.options.rotating||d.options.zooming||Bn?X.LINEAR:X.NEAREST}}else{const Bn=1!==c.layout.get("icon-size").constantOr(0)||Re.iconsNeedLinear;zn=fe.imageAtlasTexture,gs=Yt||d.options.rotating||d.options.zooming||Bn||tt?X.LINEAR:X.NEAREST,At=fe.imageAtlasTexture.size}const Xr=Qn(fe,1,d.transform.zoom),Xs=xn(Ae.posMatrix,ee,V,d.transform,Xr),mr=Es(Ae.posMatrix,ee,V,d.transform,Xr),Nn=ye&&Re.hasTextData(),rn="none"!==c.layout.get("icon-text-fit")&&Nn&&Re.hasIconData();ie&&Ur(Re,Ae.posMatrix,d,g,Xs,mr,ee,k);const gr=d.translatePosMatrix(Ae.posMatrix,fe,b,E),er=ie||g&&ye||rn?Zs:Xs,dn=d.translatePosMatrix(mr,fe,b,E,!0),Ks=Yt&&0!==c.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1);let gl;gl=Yt?Re.iconsInText?Ul(Ot.kind,Rt,le,ee,d,gr,er,dn,At,Pi):Sh(Ot.kind,Rt,le,ee,d,gr,er,dn,g,At,!0):qu(Ot.kind,Rt,le,ee,d,gr,er,dn,g,At);const tr={program:Ht,buffers:et,uniformValues:gl,atlasTexture:zn,atlasTextureIcon:ki,atlasInterpolation:gs,atlasInterpolationIcon:Ji,isSDF:Yt,hasHalo:Ks};if(oe&&Re.canOverlap){be=!0;const Bn=et.segments.get();for(const li of Bn)Se.push({segments:new y.SegmentVector([li]),sortKey:li.sortKey,state:tr})}else Se.push({segments:et.segments,sortKey:0,state:tr})}be&&Se.sort((Ae,fe)=>Ae.sortKey-fe.sortKey);for(const Ae of Se){const fe=Ae.state;if(H.activeTexture.set(X.TEXTURE0),fe.atlasTexture.bind(fe.atlasInterpolation,X.CLAMP_TO_EDGE),fe.atlasTextureIcon&&(H.activeTexture.set(X.TEXTURE1),fe.atlasTextureIcon&&fe.atlasTextureIcon.bind(fe.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),fe.isSDF){const Re=fe.uniformValues;fe.hasHalo&&(Re.u_is_halo=1,fr(fe.buffers,Ae.segments,c,d,fe.program,de,F,B,Re)),Re.u_is_halo=0}fr(fe.buffers,Ae.segments,c,d,fe.program,de,F,B,fe.uniformValues)}}function fr(d,s,c,p,g,b,E,S,T){const k=p.context;g.draw(k,k.gl.TRIANGLES,b,E,S,An.disabled,T,c.id,d.layoutVertexBuffer,d.indexBuffer,s,c.paint,p.transform.zoom,d.programConfigurations.get(c.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ii(d,s,c,p,g,b,E){const S=d.context.gl,T=c.paint.get("fill-pattern"),k=T&&T.constantOr(1),F=c.getCrossfadeParameters();let B,H,X,Z,V;E?(H=k&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(H=k?"fillPattern":"fill",B=S.TRIANGLES);for(const ee of p){const ie=s.getTile(ee);if(k&&!ie.patternsLoaded())continue;const le=ie.getBucket(c);if(!le)continue;const oe=le.programConfigurations.get(c.id),be=d.useProgram(H,oe);k&&(d.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),oe.updatePaintBuffers(F));const de=T.constantOr(null);if(de&&ie.imageAtlas){const Se=ie.imageAtlas,Ae=Se.patternPositions[de.to.toString()],fe=Se.patternPositions[de.from.toString()];Ae&&fe&&oe.setConstantPatternPositions(Ae,fe)}const ye=d.translatePosMatrix(ee.posMatrix,ie,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){Z=le.indexBuffer2,V=le.segments2;const Se=[S.drawingBufferWidth,S.drawingBufferHeight];X="fillOutlinePattern"===H&&k?ft(ye,d,F,ie,Se):pa(ye,Se)}else Z=le.indexBuffer,V=le.segments,X=k?Dt(ye,d,F,ie):$u(ye);be.draw(d.context,B,g,d.stencilModeForClipping(ee),b,An.disabled,X,c.id,le.layoutVertexBuffer,Z,V,c.paint,d.transform.zoom,oe)}}function pi(d,s,c,p,g,b,E){const S=d.context,T=S.gl,k=c.paint.get("fill-extrusion-pattern"),F=k.constantOr(1),B=c.getCrossfadeParameters(),H=c.paint.get("fill-extrusion-opacity");for(const X of p){const Z=s.getTile(X),V=Z.getBucket(c);if(!V)continue;const ee=V.programConfigurations.get(c.id),ie=d.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ee);F&&(d.context.activeTexture.set(T.TEXTURE0),Z.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),ee.updatePaintBuffers(B));const le=k.constantOr(null);if(le&&Z.imageAtlas){const ye=Z.imageAtlas,Se=ye.patternPositions[le.to.toString()],Ae=ye.patternPositions[le.from.toString()];Se&&Ae&&ee.setConstantPatternPositions(Se,Ae)}const oe=d.translatePosMatrix(X.posMatrix,Z,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),be=c.paint.get("fill-extrusion-vertical-gradient"),de=F?Vo(oe,d,be,H,X,B,Z):_t(oe,d,be,H);ie.draw(S,S.gl.TRIANGLES,g,b,E,An.backCCW,de,c.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,c.paint,d.transform.zoom,ee)}}function mi(d,s,c,p,g,b){const E=d.context,S=E.gl,T=s.fbo;if(!T)return;const k=d.useProgram("hillshade");E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,T.colorAttachment.get());const F=((B,H,X)=>{const Z=X.paint.get("hillshade-shadow-color"),V=X.paint.get("hillshade-highlight-color"),ee=X.paint.get("hillshade-accent-color");let ie=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===X.paint.get("hillshade-illumination-anchor")&&(ie-=B.transform.angle);const le=!B.options.moving;return{u_matrix:B.transform.calculatePosMatrix(H.tileID.toUnwrapped(),le),u_image:0,u_latrange:$r(0,H.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ie],u_shadow:Z,u_highlight:V,u_accent:ee}})(d,s,c);k.draw(E,S.TRIANGLES,p,g,b,An.disabled,F,c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function gi(d,s,c,p,g,b){const E=d.context,S=E.gl,T=s.dem;if(T&&T.data){const k=T.dim,F=T.stride,B=T.getPixels();if(E.activeTexture.set(S.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||d.getTileTexture(F),s.demTexture){const X=s.demTexture;X.update(B,{premultiply:!1}),X.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else s.demTexture=new vn(E,B,S.RGBA,{premultiply:!1}),s.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);E.activeTexture.set(S.TEXTURE0);let H=s.fbo;if(!H){const X=new vn(E,{width:k,height:k,data:null},S.RGBA);X.bind(S.LINEAR,S.CLAMP_TO_EDGE),H=s.fbo=E.createFramebuffer(k,k,!0),H.colorAttachment.set(X.texture)}E.bindFramebuffer.set(H.framebuffer),E.viewport.set([0,0,k,k]),d.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,p,g,b,An.disabled,((X,Z)=>{const V=Z.stride,ee=y.create();return y.ortho(ee,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(ee,ee,[0,-y.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[V,V],u_zoom:X.overscaledZ,u_unpack:Z.getUnpackVector()}})(s.tileID,T),c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Ue(d,s,c,p,g){const b=p.paint.get("raster-fade-duration");if(b>0){const E=y.exported.now(),S=(E-d.timeAdded)/b,T=s?(E-s.timeAdded)/b:-1,k=c.getSource(),F=g.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!s||Math.abs(s.tileID.overscaledZ-F)>Math.abs(d.tileID.overscaledZ-F),H=B&&d.refreshedUponExpiration?1:y.clamp(B?S:1-T,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),s?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const Tt=new y.Color(1,0,0,1),wn=new y.Color(0,1,0,1),Gr=new y.Color(0,0,1,1),ve=new y.Color(1,0,1,1),Pe=new y.Color(0,1,1,1);function Is(d,s,c,p){oi(d,0,s+c/2,d.transform.width,c,p)}function It(d,s,c,p){oi(d,s-c/2,0,c,d.transform.height,p)}function oi(d,s,c,p,g,b){const E=d.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*devicePixelRatio,c*devicePixelRatio,p*devicePixelRatio,g*devicePixelRatio),E.clear({color:b}),S.disable(S.SCISSOR_TEST)}function Tr(d,s,c){const p=d.context,g=p.gl,b=c.posMatrix,E=d.useProgram("debug"),S=Vt.disabled,T=On.disabled,k=d.colorModeForRenderPass(),F="$debug";p.activeTexture.set(g.TEXTURE0),d.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),E.draw(p,g.LINE_STRIP,S,T,k,An.disabled,Vl(b,y.Color.red),F,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments);const B=s.getTileByID(c.key).latestRawTileData,H=Math.floor((B&&B.byteLength||0)/1024),X=s.getTile(c).tileSize,Z=512/Math.min(X,512)*(c.overscaledZ/d.transform.zoom)*.5;let V=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(V+=` => ${c.overscaledZ}`),function(ee,ie){ee.initDebugOverlayCanvas();const le=ee.debugOverlayCanvas,oe=ee.context.gl,be=ee.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,le.width,le.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(ie,5,5),be.strokeText(ie,5,5),ee.debugOverlayTexture.update(le),ee.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(d,`${V} ${H}kb`),E.draw(p,g.TRIANGLES,S,T,cn.alphaBlended,An.disabled,Vl(b,y.Color.transparent,Z),F,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const Ct={symbol:function(d,s,c,p,g){if("translucent"!==d.renderPass)return;const b=On.disabled,E=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,T,k,F,B,H,X){const Z=T.transform,V="map"===B,ee="map"===H;for(const ie of S){const le=F.getTile(ie),oe=le.getBucket(k);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const be=y.evaluateSizeForZoom(oe.textSizeData,Z.zoom),de=Qn(le,1,T.transform.zoom),ye=xn(ie.posMatrix,ee,V,T.transform,de),Se="none"!==k.layout.get("icon-text-fit")&&oe.hasIconData();if(be){const Ae=Math.pow(2,Z.zoom-le.tileID.overscaledZ);ll(oe,V,ee,X,y.symbolSize,Z,ye,ie.posMatrix,Ae,be,Se)}}}(p,d,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),g),0!==c.paint.get("icon-opacity").constantOr(1)&&qr(d,s,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,E),0!==c.paint.get("text-opacity").constantOr(1)&&qr(d,s,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,E),s.map.showCollisionBoxes&&(al(d,s,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),al(d,s,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,s,c,p){if("translucent"!==d.renderPass)return;const g=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),S=!c.layout.get("circle-sort-key").isConstant();if(0===g.constantOr(1)&&(0===b.constantOr(1)||0===E.constantOr(1)))return;const T=d.context,k=T.gl,F=d.depthModeForSublayer(0,Vt.ReadOnly),B=On.disabled,H=d.colorModeForRenderPass(),X=[];for(let Z=0;Z<p.length;Z++){const V=p[Z],ee=s.getTile(V),ie=ee.getBucket(c);if(!ie)continue;const le=ie.programConfigurations.get(c.id),oe={programConfiguration:le,program:d.useProgram("circle",le),layoutVertexBuffer:ie.layoutVertexBuffer,indexBuffer:ie.indexBuffer,uniformValues:cr(d,V,ee,c)};if(S){const be=ie.segments.get();for(const de of be)X.push({segments:new y.SegmentVector([de]),sortKey:de.sortKey,state:oe})}else X.push({segments:ie.segments,sortKey:0,state:oe})}S&&X.sort((Z,V)=>Z.sortKey-V.sortKey);for(const Z of X){const{programConfiguration:V,program:ee,layoutVertexBuffer:ie,indexBuffer:le,uniformValues:oe}=Z.state;ee.draw(T,k.TRIANGLES,F,B,H,An.disabled,oe,c.id,ie,le,Z.segments,c.paint,d.transform.zoom,V)}},heatmap:function(d,s,c,p){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const g=d.context,b=g.gl,E=On.disabled,S=new cn([b.ONE,b.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(T,k,F){const B=T.gl;T.activeTexture.set(B.TEXTURE1),T.viewport.set([0,0,k.width/4,k.height/4]);let H=F.heatmapFbo;if(H)B.bindTexture(B.TEXTURE_2D,H.colorAttachment.get()),T.bindFramebuffer.set(H.framebuffer);else{const X=B.createTexture();B.bindTexture(B.TEXTURE_2D,X),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),H=F.heatmapFbo=T.createFramebuffer(k.width/4,k.height/4,!1),function(Z,V,ee,ie){const le=Z.gl;le.texImage2D(le.TEXTURE_2D,0,le.RGBA,V.width/4,V.height/4,0,le.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:le.UNSIGNED_BYTE,null),ie.colorAttachment.set(ee)}(T,k,X,H)}})(g,d,c),g.clear({color:y.Color.transparent});for(let T=0;T<p.length;T++){const k=p[T];if(s.hasRenderableParent(k))continue;const F=s.getTile(k),B=F.getBucket(c);if(!B)continue;const H=B.programConfigurations.get(c.id),X=d.useProgram("heatmap",H),{zoom:Z}=d.transform;X.draw(g,b.TRIANGLES,Vt.disabled,E,S,An.disabled,Uo(k.posMatrix,F,Z,c.paint.get("heatmap-intensity")),c.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,c.paint,d.transform.zoom,H)}g.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,b){const E=g.context,S=E.gl,T=b.heatmapFbo;if(!T)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,T.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let k=b.colorRampTexture;k||(k=b.colorRampTexture=new vn(E,b.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(E,S.TRIANGLES,Vt.disabled,On.disabled,g.colorModeForRenderPass(),An.disabled,((F,B,H,X)=>{const Z=y.create();y.ortho(Z,0,F.width,F.height,0,0,1);const V=F.context.gl;return{u_matrix:Z,u_world:[V.drawingBufferWidth,V.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(g,b),b.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,b.paint,g.transform.zoom)}(d,c))},line:function(d,s,c,p){if("translucent"!==d.renderPass)return;const g=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(0===g.constantOr(1)||0===b.constantOr(1))return;const E=d.depthModeForSublayer(0,Vt.ReadOnly),S=d.colorModeForRenderPass(),T=c.paint.get("line-dasharray"),k=c.paint.get("line-pattern"),F=k.constantOr(1),B=c.paint.get("line-gradient"),H=c.getCrossfadeParameters(),X=F?"linePattern":T?"lineSDF":B?"lineGradient":"line",Z=d.context,V=Z.gl;let ee=!0;for(const ie of p){const le=s.getTile(ie);if(F&&!le.patternsLoaded())continue;const oe=le.getBucket(c);if(!oe)continue;const be=oe.programConfigurations.get(c.id),de=d.context.program.get(),ye=d.useProgram(X,be),Se=ee||ye.program!==de,Ae=k.constantOr(null);if(Ae&&le.imageAtlas){const Re=le.imageAtlas,et=Re.patternPositions[Ae.to.toString()],st=Re.patternPositions[Ae.from.toString()];et&&st&&be.setConstantPatternPositions(et,st)}const fe=F?Dh(d,le,c,H):T?si(d,le,c,T,H):B?Hu(d,le,c,oe.lineClipsArray.length):ma(d,le,c);if(F)Z.activeTexture.set(V.TEXTURE0),le.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),be.updatePaintBuffers(H);else if(T&&(Se||d.lineAtlas.dirty))Z.activeTexture.set(V.TEXTURE0),d.lineAtlas.bind(Z);else if(B){const Re=oe.gradients[c.id];let et=Re.texture;if(c.gradientVersion!==Re.version){let st=256;if(c.stepInterpolant){const Yt=s.getSource().maxzoom,Ot=ie.canonical.z===Yt?Math.ceil(1<<d.transform.maxZoom-ie.canonical.z):1;st=y.clamp(y.nextPowerOfTwo(oe.maxLineLength/y.EXTENT*1024*Ot),256,Z.maxTextureSize)}Re.gradient=y.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:Re.gradient||void 0,clips:oe.lineClipsArray}),Re.texture?Re.texture.update(Re.gradient):Re.texture=new vn(Z,Re.gradient,V.RGBA),Re.version=c.gradientVersion,et=Re.texture}Z.activeTexture.set(V.TEXTURE0),et.bind(c.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}ye.draw(Z,V.TRIANGLES,E,d.stencilModeForClipping(ie),S,An.disabled,fe,c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,d.transform.zoom,be,oe.layoutVertexBuffer2),ee=!1}},fill:function(d,s,c,p){const g=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(0===b.constantOr(1))return;const E=d.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),T=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===g.constantOr(y.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(d.renderPass===T){const k=d.depthModeForSublayer(1,"opaque"===d.renderPass?Vt.ReadWrite:Vt.ReadOnly);Ii(d,s,c,p,k,E,!1)}if("translucent"===d.renderPass&&c.paint.get("fill-antialias")){const k=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);Ii(d,s,c,p,k,E,!0)}},"fill-extrusion":function(d,s,c,p){const g=c.paint.get("fill-extrusion-opacity");if(0!==g&&"translucent"===d.renderPass){const b=new Vt(d.context.gl.LEQUAL,Vt.ReadWrite,d.depthRangeFor3D);if(1!==g||c.paint.get("fill-extrusion-pattern").constantOr(1))pi(d,s,c,p,b,On.disabled,cn.disabled),pi(d,s,c,p,b,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const E=d.colorModeForRenderPass();pi(d,s,c,p,b,On.disabled,E)}}},hillshade:function(d,s,c,p){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const g=d.context,b=d.depthModeForSublayer(0,Vt.ReadOnly),E=d.colorModeForRenderPass(),[S,T]="translucent"===d.renderPass?d.stencilConfigForOverlap(p):[{},p];for(const k of T){const F=s.getTile(k);F.needsHillshadePrepare&&"offscreen"===d.renderPass?gi(d,F,c,b,On.disabled,E):"translucent"===d.renderPass&&mi(d,F,c,b,S[k.overscaledZ],E)}g.viewport.set([0,0,d.width,d.height])},raster:function(d,s,c,p){if("translucent"!==d.renderPass||0===c.paint.get("raster-opacity")||!p.length)return;const g=d.context,b=g.gl,E=s.getSource(),S=d.useProgram("raster"),T=d.colorModeForRenderPass(),[k,F]=E instanceof ls?[{},p]:d.stencilConfigForOverlap(p),B=F[F.length-1].overscaledZ,H=!d.options.moving;for(const X of F){const Z=d.depthModeForSublayer(X.overscaledZ-B,1===c.paint.get("raster-opacity")?Vt.ReadWrite:Vt.ReadOnly,b.LESS),V=s.getTile(X),ee=d.transform.calculatePosMatrix(X.toUnwrapped(),H);V.registerFadeDuration(c.paint.get("raster-fade-duration"));const ie=s.findLoadedParent(X,0),le=Ue(V,ie,s,c,d.transform);let oe,be;const de="nearest"===c.paint.get("raster-resampling")?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),V.texture.bind(de,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),ie?(ie.texture.bind(de,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),oe=Math.pow(2,ie.tileID.overscaledZ-V.tileID.overscaledZ),be=[V.tileID.canonical.x*oe%1,V.tileID.canonical.y*oe%1]):V.texture.bind(de,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);const ye=lf(ee,be||[0,0],oe||1,le,c);E instanceof ls?S.draw(g,b.TRIANGLES,Z,On.disabled,T,An.disabled,ye,c.id,E.boundsBuffer,d.quadTriangleIndexBuffer,E.boundsSegments):S.draw(g,b.TRIANGLES,Z,k[X.overscaledZ],T,An.disabled,ye,c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,s,c){const p=c.paint.get("background-color"),g=c.paint.get("background-opacity");if(0===g)return;const b=d.context,E=b.gl,S=d.transform,T=S.tileSize,k=c.paint.get("background-pattern");if(d.isPatternMissing(k))return;const F=!k&&1===p.a&&1===g&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==F)return;const B=On.disabled,H=d.depthModeForSublayer(0,"opaque"===F?Vt.ReadWrite:Vt.ReadOnly),X=d.colorModeForRenderPass(),Z=d.useProgram(k?"backgroundPattern":"background"),V=S.coveringTiles({tileSize:T});k&&(b.activeTexture.set(E.TEXTURE0),d.imageManager.bind(d.context));const ee=c.getCrossfadeParameters();for(const ie of V){const le=d.transform.calculatePosMatrix(ie.toUnwrapped()),oe=k?hr(le,g,d,k,{tileID:ie,tileSize:T},ee):Gu(le,g,p);Z.draw(b,E.TRIANGLES,H,B,X,An.disabled,oe,c.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}},debug:function(d,s,c){for(let p=0;p<c.length;p++)Tr(d,s,c[p])},custom:function(d,s,c){const p=d.context,g=c.implementation;if("offscreen"===d.renderPass){const b=g.prerender;b&&(d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),b.call(g,p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState())}else if("translucent"===d.renderPass){d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),p.setStencilMode(On.disabled);const b="3d"===g.renderingMode?new Vt(d.context.gl.LEQUAL,Vt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Vt.ReadOnly);p.setDepthMode(b),g.render(p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState(),p.bindFramebuffer.set(null)}}};class ba{constructor(s,c){this.context=new Ss(s),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=ht.maxUnderzooming+ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ye,this.gpuTimers={}}resize(s,c){if(this.width=s*devicePixelRatio,this.height=c*devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const s=this.context,c=new y.PosArray;c.emplaceBack(0,0),c.emplaceBack(y.EXTENT,0),c.emplaceBack(0,y.EXTENT),c.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(c,Ft.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);const p=new y.PosArray;p.emplaceBack(0,0),p.emplaceBack(y.EXTENT,0),p.emplaceBack(0,y.EXTENT),p.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=s.createVertexBuffer(p,Ft.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);const g=new y.RasterBoundsArray;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(g,wi.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);const b=new y.PosArray;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,Ft.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);const E=new y.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(E);const S=new y.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(S),this.emptyTexture=new vn(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const T=this.context.gl;this.stencilClearMode=new On({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const s=this.context,c=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=y.create();y.ortho(p,0,this.width,this.height,0,0,1),y.scale(p,p,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,c.TRIANGLES,Vt.disabled,this.stencilClearMode,cn.disabled,An.disabled,el(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,c){if(this.currentStencilSource===s.source||!s.isTileClipped()||!c||!c.length)return;this.currentStencilSource=s.source;const p=this.context,g=p.gl;this.nextStencilID+c.length>256&&this.clearStencil(),p.setColorMode(cn.disabled),p.setDepthMode(Vt.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of c){const S=this._tileClippingMaskIDs[E.key]=this.nextStencilID++;b.draw(p,g.TRIANGLES,Vt.disabled,new On({func:g.ALWAYS,mask:0},S,255,g.KEEP,g.KEEP,g.REPLACE),cn.disabled,An.disabled,el(E.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new On({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){const c=this.context.gl;return new On({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,p=s.sort((E,S)=>S.overscaledZ-E.overscaledZ),g=p[p.length-1].overscaledZ,b=p[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let S=0;S<b;S++)E[S+g]=new On({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[E,p]}return[{[g]:On.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new cn([s.CONSTANT_COLOR,s.ONE],new y.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?cn.unblended:cn.alphaBlended}depthModeForSublayer(s,c,p){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Vt(p||this.context.gl.LEQUAL,c,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,c){this.style=s,this.options=c,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(y.exported.now()),this.imageManager.beginFrame();const p=this.style._order,g=this.style.sourceCaches;for(const T in g){const k=g[T];k.used&&k.prepare(this.context)}const b={},E={},S={};for(const T in g){const k=g[T];b[T]=k.getVisibleCoordinates(),E[T]=b[T].slice().reverse(),S[T]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<p.length;T++)if(this.style._layers[p[T]].is3D()){this.opaquePassCutoff=T;break}this.renderPass="offscreen";for(const T of p){const k=this.style._layers[T];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const F=E[k.source];("custom"===k.type||F.length)&&this.renderLayer(this,g[k.source],k,F)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[p[this.currentLayer]],k=g[T.source],F=b[T.source];this._renderTileClippingMasks(T,F),this.renderLayer(this,k,T,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const T=this.style._layers[p[this.currentLayer]],k=g[T.source],F=("symbol"===T.type?S:E)[T.source];this._renderTileClippingMasks(T,b[T.source]),this.renderLayer(this,k,T,F)}if(this.options.showTileBoundaries){let T,k;Object.values(this.style._layers).forEach(F=>{F.source&&!F.isHidden(this.transform.zoom)&&(F.source!==(k&&k.id)&&(k=this.style.sourceCaches[F.source]),(!T||T.getSource().maxzoom<k.getSource().maxzoom)&&(T=k))}),T&&Ct.debug(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const k=T.transform.padding;Is(T,T.transform.height-(k.top||0),3,Tt),Is(T,k.bottom||0,3,wn),It(T,k.left||0,3,Gr),It(T,T.transform.width-(k.right||0),3,ve);const F=T.transform.centerPoint;var B,H,X,Z;oi(B=T,(H=F.x)-1,(X=T.transform.height-F.y)-10,2,20,Z=Pe),oi(B,H-10,X-1,20,2,Z)}(this),this.context.setDefault()}renderLayer(s,c,p,g){p.isHidden(this.transform.zoom)||("background"===p.type||"custom"===p.type||g.length)&&(this.id=p.id,this.gpuTimingStart(p),Ct[p.type](s,c,p,g,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let p=this.gpuTimers[s.id];p||(p=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),p.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const c={};for(const p in s){const g=s[p],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(g.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(g.query),c[p]=E}return c}translatePosMatrix(s,c,p,g,b){if(!p[0]&&!p[1])return s;const E=b?"map"===g?this.transform.angle:0:"viewport"===g?-this.transform.angle:0;if(E){const k=Math.sin(E),F=Math.cos(E);p=[p[0]*F-p[1]*k,p[0]*k+p[1]*F]}const S=_n(b?p[0]:Qn(c,p[0],this.transform.zoom),b?p[1]:Qn(c,p[1],this.transform.zoom),0),T=new Float32Array(16);return y.translate(T,s,S),T}saveTileTexture(s){const c=this._tileTextures[s.size[0]];c?c.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const c=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!c||!p}useProgram(s,c){this.cache=this.cache||{};const p=`${s}${c?c.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[p]||(this.cache[p]=new ju(this.context,s,dt[s],c,bn[s],this._showOverdrawInspector)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new vn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ts{constructor(s,c){this.points=s,this.planes=c}static fromInvProjectionMatrix(s,c,p){const g=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>y.transformMat4([],S,s)).map(S=>y.scale$1([],S,1/S[3]/c*g)),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const T=function(H,X){var Z=X[0],V=X[1],ee=X[2],ie=Z*Z+V*V+ee*ee;return ie>0&&(ie=1/Math.sqrt(ie)),H[0]=X[0]*ie,H[1]=X[1]*ie,H[2]=X[2]*ie,H}([],(H=[],X=ar([],b[S[0]],b[S[1]]),Z=ar([],b[S[2]],b[S[1]]),V=X[0],le=Z[0],H[0]=(ee=X[1])*(be=Z[2])-(ie=X[2])*(oe=Z[1]),H[1]=ie*le-V*be,H[2]=V*oe-ee*le,H)),k=-((F=T)[0]*(B=b[S[1]])[0]+F[1]*B[1]+F[2]*B[2]);var H,X,Z,V,ee,ie,le,oe,be,F,B;return T.concat(k)});return new Ts(b,E)}}class ds{constructor(s,c){var p,g,b;this.min=s,this.max=c,this.center=function(p,g,b){return p[0]=.5*g[0],p[1]=.5*g[1],p[2]=.5*g[2],p}([],((p=[])[0]=(g=this.min)[0]+(b=this.max)[0],p[1]=g[1]+b[1],p[2]=g[2]+b[2],p))}quadrant(s){const c=[s%2==0,s<2],p=pn(this.min),g=pn(this.max);for(let b=0;b<c.length;b++)p[b]=c[b]?this.min[b]:this.center[b],g[b]=c[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new ds(p,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const c=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let p=!0;for(let g=0;g<s.planes.length;g++){const b=s.planes[g];let E=0;for(let S=0;S<c.length;S++)y.dot(b,c[S])>=0&&E++;if(0===E)return 0;E!==c.length&&(p=!1)}if(p)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<s.points.length;S++){const T=s.points[S][g]-this.min[g];b=Math.min(b,T),E=Math.max(E,T)}if(E<0||b>this.max[g]-this.min[g])return 0}return 1}}class qi{constructor(s=0,c=0,p=0,g=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=p,this.right=g}interpolate(s,c,p){return null!=c.top&&null!=s.top&&(this.top=y.number(s.top,c.top,p)),null!=c.bottom&&null!=s.bottom&&(this.bottom=y.number(s.bottom,c.bottom,p)),null!=c.left&&null!=s.left&&(this.left=y.number(s.left,c.left,p)),null!=c.right&&null!=s.right&&(this.right=y.number(s.right,c.right,p)),this}getCenter(s,c){const p=y.clamp((this.left+s-this.right)/2,0,s),g=y.clamp((this.top+c-this.bottom)/2,0,c);return new y.Point(p,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new qi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class pr{constructor(s,c,p,g,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===b||!!b,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qi,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new pr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new y.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const c=-y.wrap(s,-180,180)*Math.PI/180;var p;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(p=new y.ARRAY_TYPE(4),y.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(p,g,b){var E=g[0],S=g[1],T=g[2],k=g[3],F=Math.sin(b),B=Math.cos(b);p[0]=E*B+T*F,p[1]=S*B+k*F,p[2]=E*-F+T*B,p[3]=S*-F+k*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=y.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,p){this._unmodified=!1,this._edgeInsets.interpolate(s,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new y.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),b=this.pointCoordinate(new y.Point(this.width,this.height)),E=this.pointCoordinate(new y.Point(0,this.height)),S=Math.floor(Math.min(p.x,g.x,b.x,E.x)),T=Math.floor(Math.max(p.x,g.x,b.x,E.x)),k=1;for(let F=S-k;F<=T+k;F++)0!==F&&c.push(new y.UnwrappedTileID(F,s))}return c}coveringTiles(s){let c=this.coveringZoomLevel(s);const p=c;if(void 0!==s.minzoom&&c<s.minzoom)return[];void 0!==s.maxzoom&&c>s.maxzoom&&(c=s.maxzoom);const g=y.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,c),E=[b*g.x,b*g.y,0],S=Ts.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let T=s.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(T=c);const k=Z=>({aabb:new ds([Z*b,0,0],[(Z+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),F=[],B=[],H=c,X=s.reparseOverscaled?p:c;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)F.push(k(-Z)),F.push(k(Z));for(F.push(k(0));F.length>0;){const Z=F.pop(),V=Z.x,ee=Z.y;let ie=Z.fullyVisible;if(!ie){const ye=Z.aabb.intersects(S);if(0===ye)continue;ie=2===ye}const le=Z.aabb.distanceX(E),oe=Z.aabb.distanceY(E),be=Math.max(Math.abs(le),Math.abs(oe)),de=3+(1<<H-Z.zoom)-2;if(Z.zoom===H||be>de&&Z.zoom>=T)B.push({tileID:new y.OverscaledTileID(Z.zoom===H?X:Z.zoom,Z.wrap,Z.zoom,V,ee),distanceSq:rr([E[0]-.5-V,E[1]-.5-ee])});else for(let ye=0;ye<4;ye++){const Se=(V<<1)+ye%2,Ae=(ee<<1)+(ye>>1);F.push({aabb:Z.aabb.quadrant(ye),zoom:Z.zoom+1,x:Se,y:Ae,wrap:Z.wrap,fullyVisible:ie})}}return B.sort((Z,V)=>Z.distanceSq-V.distanceSq).map(Z=>Z.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=y.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(s.lng)*this.worldSize,y.mercatorYfromLat(c)*this.worldSize)}unproject(s){return new y.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(s,c){const p=this.pointCoordinate(c),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(s),E=new y.MercatorCoordinate(b.x-(p.x-g.x),b.y-(p.y-g.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s){return this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}locationCoordinate(s){return y.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s.toLngLat()}pointCoordinate(s){const c=[s.x,s.y,0,1],p=[s.x,s.y,1,1];y.transformMat4(c,c,this.pixelMatrixInverse),y.transformMat4(p,p,this.pixelMatrixInverse);const g=c[3],b=p[3],E=c[1]/g,S=p[1]/b,T=c[2]/g,k=p[2]/b,F=T===k?0:(0-T)/(k-T);return new y.MercatorCoordinate(y.number(c[0]/g,p[0]/b,F)/this.worldSize,y.number(E,S,F)/this.worldSize)}coordinatePoint(s){const c=[s.x*this.worldSize,s.y*this.worldSize,0,1];return y.transformMat4(c,c,this.pixelMatrix),new y.Point(c[0]/c[3],c[1]/c[3])}getBounds(){return(new y.LngLatBounds).extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,c=!1){const p=s.key,g=c?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];const b=s.canonical,E=this.worldSize/this.zoomScale(b.z),S=b.x+Math.pow(2,b.z)*s.wrap,T=y.identity(new Float64Array(16));return y.translate(T,T,[S*E,b.y*E,0]),y.scale(T,T,[E/y.EXTENT,E/y.EXTENT,1]),y.multiply(T,c?this.alignedProjMatrix:this.projMatrix,T),g[p]=new Float32Array(T),g[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,c,p,g,b=-90,E=90,S=-180,T=180;const k=this.size,F=this._unmodified;if(this.latRange){const X=this.latRange;b=y.mercatorYfromLat(X[1])*this.worldSize,E=y.mercatorYfromLat(X[0])*this.worldSize,s=E-b<k.y?k.y/(E-b):0}if(this.lngRange){const X=this.lngRange;S=y.mercatorXfromLng(X[0])*this.worldSize,T=y.mercatorXfromLng(X[1])*this.worldSize,c=T-S<k.x?k.x/(T-S):0}const B=this.point,H=Math.max(c||0,s||0);if(H)return this.center=this.unproject(new y.Point(c?(T+S)/2:B.x,s?(E+b)/2:B.y)),this.zoom+=this.scaleZoom(H),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const X=B.y,Z=k.y/2;X-Z<b&&(g=b+Z),X+Z>E&&(g=E-Z)}if(this.lngRange){const X=B.x,Z=k.x/2;X-Z<S&&(p=S+Z),X+Z>T&&(p=T-Z)}void 0===p&&void 0===g||(this.center=this.unproject(new y.Point(void 0!==p?p:B.x,void 0!==g?g:B.y))),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const c=Math.PI/2+this._pitch,p=this._fov*(.5+s.y/this.height),g=Math.sin(p)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-c-p,.01,Math.PI-.01)),b=this.point,E=b.x,S=b.y,T=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),k=this.height/50;let F=new Float64Array(16);y.perspective(F,this._fov,this.width/this.height,k,T),F[8]=2*-s.x/this.width,F[9]=2*s.y/this.height,y.scale(F,F,[1,-1,1]),y.translate(F,F,[0,0,-this.cameraToCenterDistance]),y.rotateX(F,F,this._pitch),y.rotateZ(F,F,this.angle),y.translate(F,F,[-E,-S,0]),this.mercatorMatrix=y.scale([],F,_n(this.worldSize,this.worldSize,this.worldSize)),y.scale(F,F,_n(1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize)),this.projMatrix=F,this.invProjMatrix=y.invert([],this.projMatrix);const B=this.width%2/2,H=this.height%2/2,X=Math.cos(this.angle),Z=Math.sin(this.angle),V=E-Math.round(E)+X*B+Z*H,ee=S-Math.round(S)+X*H+Z*B,ie=new Float64Array(F);if(y.translate(ie,ie,[V>.5?V-1:V,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=ie,F=y.create(),y.scale(F,F,[this.width/2,-this.height/2,1]),y.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=y.create(),y.scale(F,F,[1,-1,1]),y.translate(F,F,[-1,-1,0]),y.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),F=y.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");this.pixelMatrixInverse=F,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new y.Point(0,0)),c=y.fromValues(s.x*this.worldSize,s.y*this.worldSize,0,1);return y.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,s))}getCameraQueryGeometry(s){const c=this.getCameraPoint();if(1===s.length)return[s[0],c];{let p=c.x,g=c.y,b=c.x,E=c.y;for(const S of s)p=Math.min(p,S.x),g=Math.min(g,S.y),b=Math.max(b,S.x),E=Math.max(E,S.y);return[new y.Point(p,g),new y.Point(b,g),new y.Point(b,E),new y.Point(p,E),new y.Point(p,g)]}}}class wa{constructor(s){this._hashName=s&&encodeURIComponent(s),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(c,p){let g=!1,b=null;const E=()=>{b=null,g&&(c(),b=setTimeout(E,300),g=!1)};return()=>(g=!0,b||E(),b)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const c=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),E=Math.round(c.lng*b)/b,S=Math.round(c.lat*b)/b,T=this._map.getBearing(),k=this._map.getPitch();let F="";if(F+=s?`/${E}/${S}/${p}`:`${p}/${S}/${E}`,(T||k)&&(F+="/"+Math.round(10*T)/10),k&&(F+=`/${Math.round(k)}`),this._hashName){const B=this._hashName;let H=!1;const X=window.location.hash.slice(1).split("&").map(Z=>{const V=Z.split("=")[0];return V===B?(H=!0,`${V}=${F}`):Z}).filter(Z=>Z);return H||X.push(`${B}=${F}`),`#${X.join("&")}`}return`#${F}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:c,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const Gi={linearity:.3,easing:y.bezier(0,0,.3,1)},Zi=y.extend({deceleration:2500,maxSpeed:1400},Gi),gn=y.extend({deceleration:20,maxSpeed:1400},Gi),ul=y.extend({deceleration:1e3,maxSpeed:360},Gi),Zl=y.extend({deceleration:1e3,maxSpeed:90},Gi);class Da{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=y.exported.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(c.pan.mag()){const b=Wi(c.pan.mag(),p,y.extend({},Zi,s||{}));g.offset=c.pan.mult(b.amount/c.pan.mag()),g.center=this._map.transform.center,mo(g,b)}if(c.zoom){const b=Wi(c.zoom,p,gn);g.zoom=this._map.transform.zoom+b.amount,mo(g,b)}if(c.bearing){const b=Wi(c.bearing,p,ul);g.bearing=this._map.transform.bearing+y.clamp(b.amount,-179,179),mo(g,b)}if(c.pitch){const b=Wi(c.pitch,p,Zl);g.pitch=this._map.transform.pitch+b.amount,mo(g,b)}if(g.zoom||g.bearing){const b=void 0===c.pinchAround?c.around:c.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.extend(g,{noMoveStart:!0})}}function mo(d,s){(!d.duration||d.duration<s.duration)&&(d.duration=s.duration,d.easing=s.easing)}function Wi(d,s,c){const{maxSpeed:p,linearity:g,deceleration:b}=c,E=y.clamp(d*g/(s/1e3),-p,p),S=Math.abs(E)/(b*g);return{easing:c.easing,duration:1e3*S,amount:E*(S/2)}}class xr extends y.Event{constructor(s,c,p,g={}){const b=ue.mousePos(c.getCanvasContainer(),p),E=c.unproject(b);super(s,y.extend({point:b,lngLat:E,originalEvent:p},g)),this._defaultPrevented=!1,this.target=c}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Xi extends y.Event{constructor(s,c,p){const g="touchend"===s?p.changedTouches:p.touches,b=ue.touchPos(c.getCanvasContainer(),g),E=b.map(T=>c.unproject(T)),S=b.reduce((T,k,F,B)=>T.add(k.div(B.length)),new y.Point(0,0));super(s,{points:b,point:S,lngLats:E,lngLat:c.unproject(S),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class br extends y.Event{constructor(s,c,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Qu{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new br(s.type,this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new xr(s.type,this._map,s))}mouseup(s){this._map.fire(new xr(s.type,this._map,s))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new xr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new xr(s.type,this._map,s))}mouseover(s){this._map.fire(new xr(s.type,this._map,s))}mouseout(s){this._map.fire(new xr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Xi(s.type,this._map,s))}touchmove(s){this._map.fire(new Xi(s.type,this._map,s))}touchend(s){this._map.fire(new Xi(s.type,this._map,s))}touchcancel(s){this._map.fire(new Xi(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ki{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(s){this._map.fire(new xr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new xr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ti{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&0===s.button&&(ue.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const p=c;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=p,this._box||(this._box=ue.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const b=Math.min(g.x,p.x),E=Math.max(g.x,p.x),S=Math.min(g.y,p.y),T=Math.max(g.y,p.y);ue.setTransform(this._box,`translate(${b}px,${S}px)`),this._box.style.width=E-b+"px",this._box.style.height=T-S+"px"}mouseupWindow(s,c){if(!this._active||0!==s.button)return;const p=this._startPos,g=c;if(this.reset(),ue.suppressClick(),p.x!==g.x||p.y!==g.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(p,g,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(ue.remove(this._box),this._box=null),ue.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new y.Event(s,{originalEvent:c}))}}function fs(d,s){const c={};for(let p=0;p<d.length;p++)c[d[p].identifier]=s[p];return c}class Ea{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const b=new y.Point(0,0);for(const E of g)b._add(E);return b.div(g.length)}(c),this.touches=fs(p,c)))}touchmove(s,c,p){if(this.aborted||!this.centroid)return;const g=fs(p,c);for(const b in this.touches){const E=this.touches[b],S=g[b];(!S||S.dist(E)>30)&&(this.aborted=!0)}}touchend(s,c,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class go{constructor(s){this.singleTap=new Ea(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,c,p){this.singleTap.touchstart(s,c,p)}touchmove(s,c,p){this.singleTap.touchmove(s,c,p)}touchend(s,c,p){const g=this.singleTap.touchend(s,c,p);if(g){const b=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(b&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Ai{constructor(){this._zoomIn=new go({numTouches:1,numTaps:2}),this._zoomOut=new go({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,p){this._zoomIn.touchstart(s,c,p),this._zoomOut.touchstart(s,c,p)}touchmove(s,c,p){this._zoomIn.touchmove(s,c,p),this._zoomOut.touchmove(s,c,p)}touchend(s,c,p){const g=this._zoomIn.touchend(s,c,p),b=this._zoomOut.touchend(s,c,p);return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(g)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ec={0:1,2:2};class Mi{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const p=ue.mouseButton(s);this._correctButton(s,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(s,c){const p=this._lastPoint;if(p)if(s.preventDefault(),function(g,b){const E=ec[b];return void 0===g.buttons||(g.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}mouseupWindow(s){this._lastPoint&&ue.mouseButton(s)===this._eventButton&&(this._moved&&ue.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mh extends Mi{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return 0===c&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Ws extends Mi{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const p=.8*(c.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){s.preventDefault()}}class tc extends Mi{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const p=-.5*(c.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){s.preventDefault()}}class Ca{constructor(s){this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)}touchstart(s,c,p){return this._calculateTransform(s,c,p)}touchmove(s,c,p){if(this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,c,p)}touchend(s,c,p){this._calculateTransform(s,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,p){p.length>0&&(this._active=!0);const g=fs(p,c),b=new y.Point(0,0),E=new y.Point(0,0);let S=0;for(const k in g){const F=g[k],B=this._touches[k];B&&(b._add(F),E._add(F.sub(B)),S++,g[k]=F)}if(this._touches=g,S<this._minTouches||!E.mag())return;const T=E.div(S);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(S),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,c,p){return{}}touchstart(s,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,p){if(!this._firstTwoTouches)return;s.preventDefault();const[g,b]=this._firstTwoTouches,E=Wl(p,c,g),S=Wl(p,c,b);if(!E||!S)return;const T=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],T,s)}touchend(s,c,p){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,E=Wl(p,c,g),S=Wl(p,c,b);E&&S||(this._active&&ue.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wl(d,s,c){for(let p=0;p<d.length;p++)if(d[p].identifier===c)return s[p]}function Ph(d,s){return Math.log(d/s)/Math.LN2}class cf extends qo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Ph(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ph(this._distance,p),pinchAround:c}}}function nc(d,s){return 180*d.angleWith(s)/Math.PI}class kh extends qo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nc(this._vector,p),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,p=nc(s,this._startVector);return Math.abs(p)<c}}function Fe(d){return Math.abs(d.y)>Math.abs(d.x)}class rc extends qo{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(s){this._lastPoints=s,Fe(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,p){const g=s[0].sub(this._lastPoints[0]),b=s[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(g,b,p.timeStamp),this._valid)return this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}}gestureBeginsVertically(s,c,p){if(void 0!==this._valid)return this._valid;const g=s.mag()>=2,b=c.mag()>=2;if(!g&&!b)return;if(!g||!b)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=s.y>0==c.y>0;return Fe(s)&&Fe(c)&&E}}const hf={panStep:100,bearingStep:15,pitchStep:10};class df{constructor(){const s=hf;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,p=0,g=0,b=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:S=>{const T=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:ic,zoom:c?Math.round(T)+c*(s.shiftKey?2:1):T,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+g*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ic(d){return d*(2-d)}const sc=4.000244140625;class Xl{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,y.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=y.exported.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==c&&c%sc==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ue.mousePos(this._el,s);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(0!==this._delta){const S="wheel"===this._type&&Math.abs(this._delta)>sc?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&0!==T&&(T=1/T);const k="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(k*T))),"wheel"===this._type&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c="number"==typeof this._targetZoom?this._targetZoom:s.zoom,p=this._startZoom,g=this._easing;let b,E=!1;if("wheel"===this._type&&p&&g){const S=Math.min((y.exported.now()-this._lastWheelEventTime)/200,1),T=g(S);b=y.number(p,c,T),S<1?this._frameId||(this._frameId=!0):E=!0}else b=c,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=y.ease;if(this._prevEase){const p=this._prevEase,g=(y.exported.now()-p.start)/p.duration,b=p.easing(g+.01)-p.easing(g),E=.27/Math.sqrt(b*b+1e-4)*.01,S=Math.sqrt(.0729-E*E);c=y.bezier(E,S,.25,1)}return this._prevEase={start:y.exported.now(),duration:s,easing:c},c}reset(){this._active=!1}}class Kl{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ff{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,c){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oc{constructor(){this._tap=new go({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,c,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,c,p))}touchmove(s,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=c[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,c,p)}touchend(s,c,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(s,c,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ac{constructor(s,c,p){this._el=s,this._mousePan=c,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class As{constructor(s,c,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yl{constructor(s,c,p,g){this._el=s,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Pn=d=>d.zoom||d.drag||d.pitch||d.rotate;class Ms extends y.Event{}function cl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Jl{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Da(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),y.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,E]of this._listeners)ue.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,c,p]of this._listeners)ue.removeEventListener(s,c,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Qu(c,s));const g=c.boxZoom=new Ti(c,s);this._add("boxZoom",g);const b=new Ai,E=new ff;c.doubleClickZoom=new Kl(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const S=new oc;this._add("tapDragZoom",S);const T=c.touchPitch=new rc;this._add("touchPitch",T);const k=new Ws(s),F=new tc(s);c.dragRotate=new As(s,k,F),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const B=new Mh(s),H=new Ca(s);c.dragPan=new ac(p,B,H),this._add("mousePan",B),this._add("touchPan",H,["touchZoom","touchRotate"]);const X=new kh,Z=new cf;c.touchZoomRotate=new Yl(p,Z,X,S),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]);const V=c.scrollZoom=new Xl(c,this);this._add("scrollZoom",V,["mousePan"]);const ee=c.keyboard=new df;this._add("keyboard",ee),this._add("blockableMapEvent",new Ki(c));for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ie]&&c[ie].enable(s[ie])}_add(s,c,p){this._handlers.push({handlerName:s,handler:c,allowed:p}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Pn(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,c,p){for(const g in s)if(g!==p&&(!c||c.indexOf(g)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const p of s)this._el.contains(p.target)&&c.push(p);return c}handleEvent(s,c){if("blur"===s.type)return void this.stop(!0);this._updatingCamera=!0;const p="renderFrame"===s.type?void 0:s,g={needsRenderFrame:!1},b={},E={},S=s.touches,T=S?this._getMapTouches(S):void 0,k=T?ue.touchPos(this._el,T):ue.mousePos(this._el,s);for(const{handlerName:H,handler:X,allowed:Z}of this._handlers){if(!X.isEnabled())continue;let V;this._blockedByActive(E,Z,H)?X.reset():X[c||s.type]&&(V=X[c||s.type](s,k,T),this.mergeHandlerResult(g,b,V,H,p),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||X.isActive())&&(E[H]=X)}const F={};for(const H in this._previousActiveHandlers)E[H]||(F[H]=p);this._previousActiveHandlers=E,(Object.keys(F).length||cl(g))&&(this._changes.push([g,b,F]),this._triggerRenderFrame()),(Object.keys(E).length||cl(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=g;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,c,p,g,b){if(!p)return;y.extend(s,p);const E={handlerName:g,originalEvent:p.originalEvent||b};void 0!==p.zoomDelta&&(c.zoom=E),void 0!==p.panDelta&&(c.drag=E),void 0!==p.pitchDelta&&(c.pitch=E),void 0!==p.bearingDelta&&(c.rotate=E)}_applyChanges(){const s={},c={},p={};for(const[g,b,E]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new y.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),void 0!==g.around&&(s.around=g.around),void 0!==g.pinchAround&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),y.extend(c,b),y.extend(p,E);this._updateMapTransform(s,c,p),this._changes=[]}_updateMapTransform(s,c,p){const g=this._map,b=g.transform;if(!cl(s))return this._fireEvents(c,p,!0);let{panDelta:E,zoomDelta:S,bearingDelta:T,pitchDelta:k,around:F,pinchAround:B}=s;void 0!==B&&(F=B),g._stop(!0),F=F||g.transform.centerPoint;const H=b.pointLocation(E?F.sub(E):F);T&&(b.bearing+=T),k&&(b.pitch+=k),S&&(b.zoom+=S),b.setLocationAtPoint(H,F),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,p,!0)}_fireEvents(s,c,p){const g=Pn(this._eventsInProgress),b=Pn(s),E={};for(const F in s){const{originalEvent:B}=s[F];this._eventsInProgress[F]||(E[`${F}start`]=B),this._eventsInProgress[F]=s[F]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const F in E)this._fireEvent(F,E[F]);b&&this._fireEvent("move",b.originalEvent);for(const F in s){const{originalEvent:B}=s[F];this._fireEvent(F,B)}const S={};let T;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:H}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],T=c[B]||H,S[`${F}end`]=T)}for(const F in S)this._fireEvent(F,S[F]);const k=Pn(this._eventsInProgress);if(p&&(g||b)&&!k){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=H=>0!==H&&-this._bearingSnap<H&&H<this._bearingSnap;F?(B(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:T})):(this._map.fire(new y.Event("moveend",{originalEvent:T})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new y.Event(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Ms("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class hl extends y.Evented{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}getCenter(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,p){return s=y.Point.convert(s).mult(-1),this.panTo(this.transform.center,y.extend({offset:s},c),p)}panTo(s,c,p){return this.easeTo(y.extend({center:s},c),p)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,p){return this.easeTo(y.extend({zoom:s},c),p)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,p){return this.easeTo(y.extend({bearing:s},c),p)}resetNorth(s,c){return this.rotateTo(0,y.extend({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=y.LngLatBounds.convert(s);const p=c&&c.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,c)}_cameraForBoxAndBearing(s,c,p,g){const b={top:0,bottom:0,right:0,left:0};if("number"==typeof(g=y.extend({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding){const de=g.padding;g.padding={top:de,bottom:de,right:de,left:de}}g.padding=y.extend(b,g.padding);const E=this.transform,S=E.padding,T=E.project(y.LngLat.convert(s)),k=E.project(y.LngLat.convert(c)),F=T.rotate(-p*Math.PI/180),B=k.rotate(-p*Math.PI/180),H=new y.Point(Math.max(F.x,B.x),Math.max(F.y,B.y)),X=new y.Point(Math.min(F.x,B.x),Math.min(F.y,B.y)),Z=H.sub(X),V=(E.width-(S.left+S.right+g.padding.left+g.padding.right))/Z.x,ee=(E.height-(S.top+S.bottom+g.padding.top+g.padding.bottom))/Z.y;if(ee<0||V<0)return void y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(E.scaleZoom(E.scale*Math.min(V,ee)),g.maxZoom),le=y.Point.convert(g.offset),oe=new y.Point((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(p*Math.PI/180),be=le.add(oe).mult(E.scale/E.zoomScale(ie));return{center:E.unproject(T.add(k).div(2).sub(be)),zoom:ie,bearing:p}}fitBounds(s,c,p){return this._fitInternal(this.cameraForBounds(s,c),c,p)}fitScreenCoordinates(s,c,p,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(s)),this.transform.pointLocation(y.Point.convert(c)),p,g),g,b)}_fitInternal(s,c,p){return s?(delete(c=y.extend(s,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(s,c){this.stop();const p=this.transform;let g=!1,b=!1,E=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(g=!0,p.zoom=+s.zoom),void 0!==s.center&&(p.center=y.LngLat.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(b=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(E=!0,p.pitch=+s.pitch),null==s.padding||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this.fire(new y.Event("movestart",c)).fire(new y.Event("move",c)),g&&this.fire(new y.Event("zoomstart",c)).fire(new y.Event("zoom",c)).fire(new y.Event("zoomend",c)),b&&this.fire(new y.Event("rotatestart",c)).fire(new y.Event("rotate",c)).fire(new y.Event("rotateend",c)),E&&this.fire(new y.Event("pitchstart",c)).fire(new y.Event("pitch",c)).fire(new y.Event("pitchend",c)),this.fire(new y.Event("moveend",c))}easeTo(s,c){this._stop(!1,s.easeId),(!1===(s=y.extend({offset:[0,0],duration:500,easing:y.ease},s)).animate||!s.essential&&y.exported.prefersReducedMotion)&&(s.duration=0);const p=this.transform,g=this.getZoom(),b=this.getBearing(),E=this.getPitch(),S=this.getPadding(),T="zoom"in s?+s.zoom:g,k="bearing"in s?this._normalizeBearing(s.bearing,b):b,F="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:p.padding,H=y.Point.convert(s.offset);let X=p.centerPoint.add(H);const Z=p.pointLocation(X),V=y.LngLat.convert(s.center||Z);this._normalizeCenter(V);const ee=p.project(Z),ie=p.project(V).sub(ee),le=p.zoomScale(T-g);let oe,be;s.around&&(oe=y.LngLat.convert(s.around),be=p.locationPoint(oe));const de={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||T!==g,this._rotating=this._rotating||b!==k,this._pitching=this._pitching||F!==E,this._padding=!p.isPaddingEqual(B),this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,de),this._ease(ye=>{if(this._zooming&&(p.zoom=y.number(g,T,ye)),this._rotating&&(p.bearing=y.number(b,k,ye)),this._pitching&&(p.pitch=y.number(E,F,ye)),this._padding&&(p.interpolatePadding(S,B,ye),X=p.centerPoint.add(H)),oe)p.setLocationAtPoint(oe,be);else{const Se=p.zoomScale(p.zoom-g),Ae=T>g?Math.min(2,le):Math.max(.5,le),fe=Math.pow(Ae,1-ye),Re=p.unproject(ee.add(ie.mult(ye*fe)).mult(Se));p.setLocationAtPoint(p.renderWorldCopies?Re.wrap():Re,X)}this._fireMoveEvents(c)},ye=>{this._afterEase(c,ye)},s),this}_prepareEase(s,c,p={}){this._moving=!0,c||p.moving||this.fire(new y.Event("movestart",s)),this._zooming&&!p.zooming&&this.fire(new y.Event("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new y.Event("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new y.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new y.Event("move",s)),this._zooming&&this.fire(new y.Event("zoom",s)),this._rotating&&this.fire(new y.Event("rotate",s)),this._pitching&&this.fire(new y.Event("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const p=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new y.Event("zoomend",s)),g&&this.fire(new y.Event("rotateend",s)),b&&this.fire(new y.Event("pitchend",s)),this.fire(new y.Event("moveend",s))}flyTo(s,c){if(!s.essential&&y.exported.prefersReducedMotion){const tt=y.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,c)}this.stop(),s=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},s);const p=this.transform,g=this.getZoom(),b=this.getBearing(),E=this.getPitch(),S=this.getPadding(),T="zoom"in s?y.clamp(+s.zoom,p.minZoom,p.maxZoom):g,k="bearing"in s?this._normalizeBearing(s.bearing,b):b,F="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:p.padding,H=p.zoomScale(T-g),X=y.Point.convert(s.offset);let Z=p.centerPoint.add(X);const V=p.pointLocation(Z),ee=y.LngLat.convert(s.center||V);this._normalizeCenter(ee);const ie=p.project(V),le=p.project(ee).sub(ie);let oe=s.curve;const be=Math.max(p.width,p.height),de=be/H,ye=le.mag();if("minZoom"in s){const tt=y.clamp(Math.min(s.minZoom,g,T),p.minZoom,p.maxZoom),Ht=be/p.zoomScale(tt-g);oe=Math.sqrt(Ht/ye*2)}const Se=oe*oe;function Ae(tt){const Ht=(de*de-be*be+(tt?-1:1)*Se*Se*ye*ye)/(2*(tt?de:be)*Se*ye);return Math.log(Math.sqrt(Ht*Ht+1)-Ht)}function fe(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Re(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const et=Ae(0);let st=function(tt){return Re(et)/Re(et+oe*tt)},Yt=function(tt){return be*((Re(et)*(fe(Ht=et+oe*tt)/Re(Ht))-fe(et))/Se)/ye;var Ht},Ot=(Ae(1)-et)/oe;if(Math.abs(ye)<1e-6||!isFinite(Ot)){if(Math.abs(be-de)<1e-6)return this.easeTo(s,c);const tt=de<be?-1:1;Ot=Math.abs(Math.log(de/be))/oe,Yt=function(){return 0},st=function(Ht){return Math.exp(tt*oe*Ht)}}return s.duration="duration"in s?+s.duration:1e3*Ot/("screenSpeed"in s?+s.screenSpeed/oe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=b!==k,this._pitching=F!==E,this._padding=!p.isPaddingEqual(B),this._prepareEase(c,!1),this._ease(tt=>{const Ht=tt*Ot,Rt=1/st(Ht);p.zoom=1===tt?T:g+p.scaleZoom(Rt),this._rotating&&(p.bearing=y.number(b,k,tt)),this._pitching&&(p.pitch=y.number(E,F,tt)),this._padding&&(p.interpolatePadding(S,B,tt),Z=p.centerPoint.add(X));const At=1===tt?ee:p.unproject(ie.add(le.mult(Yt(Ht))).mult(Rt));p.setLocationAtPoint(p.renderWorldCopies?At.wrap():At,Z),this._fireMoveEvents(c)},()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,c)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,c,p){!1===p.animate||0===p.duration?(s(1),c()):(this._easeStart=y.exported.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((y.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=y.wrap(s,-180,180);const p=Math.abs(s-c);return Math.abs(s-360-c)<p&&(s-=360),Math.abs(s+360-c)<p&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const p=s.lng-c.center.lng;s.lng+=p>180?-360:p<-180?360:0}}class Sa{constructor(s={}){this.options=s,y.bindAll(["_toggleAttribution","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._container=ue.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ue.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ue.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateCompact(),this._updateAttributions(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._container}onRemove(){ue.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,c){const p=this._map._getUIString(`AttributionControl.${c}`);s.title=p,s.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact-show")||this._container.classList.contains("mapboxgl-compact-show")?this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show"):this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show")}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>"string"!=typeof g?"":g)):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const c=this._map.style.sourceCaches;for(const g in c){const b=c[g];if(b.used){const E=b.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((g,b)=>g.length-b.length),s=s.filter((g,b)=>{for(let E=b+1;E<s.length;E++)if(s[E].indexOf(g)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){const s=this.options&&this.options.compact;this._map.getCanvasContainer().offsetWidth<=640||s?!1===s?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||(this._container.removeAttribute("open"),this._container.classList.add("maplibregl-compact","mapboxgl-compact")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}}class lc{constructor(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)}onAdd(s){this._map=s,this._container=ue.create("div","maplibregl-ctrl mapboxgl-ctrl");const c=ue.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(void 0),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ue.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return;const s=this._map.style.sourceCaches;for(const c in s)if(s[c].getSource().maplibreLogo)return!0;return!1}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("maplibregl-compact","mapboxgl-compact"):c.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class ai{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const g of p)if(g.id===s)return void(g.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Sn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Zr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},dl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ql{constructor(s,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Ws({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new tc({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ue.addEventListener(c,"mousedown",this.mousedown),ue.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),ue.addEventListener(c,"touchmove",this.touchmove),ue.addEventListener(c,"touchend",this.touchend),ue.addEventListener(c,"touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),ue.disableDrag()}move(s,c){const p=this.map,g=this.mouseRotate.mousemoveWindow(s,c);if(g&&g.bearingDelta&&p.setBearing(p.getBearing()+g.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(s,c);b&&b.pitchDelta&&p.setPitch(p.getPitch()+b.pitchDelta)}}off(){const s=this.element;ue.removeEventListener(s,"mousedown",this.mousedown),ue.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),ue.removeEventListener(s,"touchmove",this.touchmove),ue.removeEventListener(s,"touchend",this.touchend),ue.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){ue.enableDrag(),ue.removeEventListener(window,"mousemove",this.mousemove),ue.removeEventListener(window,"mouseup",this.mouseup)}mousedown(s){this.down(y.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ue.mousePos(this.element,s)),ue.addEventListener(window,"mousemove",this.mousemove),ue.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.move(s,ue.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=ue.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=ue.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ia(d,s,c){if(d=new y.LngLat(d.lng,d.lat),s){const p=new y.LngLat(d.lng-360,d.lat),g=new y.LngLat(d.lng+360,d.lat),b=c.locationPoint(d).distSqr(s);c.locationPoint(p).distSqr(s)<b?d=p:c.locationPoint(g).distSqr(s)<b&&(d=g)}for(;Math.abs(d.lng-c.center.lng)>180;){const p=c.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const fl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pl(d,s,c){const p=d.classList;for(const g in fl)p.remove(`maplibregl-${c}-anchor-${g}`,`mapboxgl-${c}-anchor-${g}`);p.add(`maplibregl-${c}-anchor-${s}`,`mapboxgl-${c}-anchor-${s}`)}class Yi extends y.Evented{constructor(s,c){if(super(),(s instanceof HTMLElement||c)&&(s=y.extend({element:s},c)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&"auto"!==s.pitchAlignment?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=y.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=ue.create("div"),this._element.setAttribute("aria-label","Map marker");const p=ue.createNS("http://www.w3.org/2000/svg","svg"),g=41,b=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${g}px`),p.setAttributeNS(null,"width",`${b}px`),p.setAttributeNS(null,"viewBox",`0 0 ${b} ${g}`);const E=ue.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const S=ue.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const T=ue.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of k){const oe=ue.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",le.rx),oe.setAttributeNS(null,"ry",le.ry),T.appendChild(oe)}const F=ue.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const B=ue.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(B);const H=ue.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const X=ue.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(X);const Z=ue.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const V=ue.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=ue.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const ie=ue.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),V.appendChild(ee),V.appendChild(ie),S.appendChild(T),S.appendChild(F),S.appendChild(H),S.appendChild(Z),S.appendChild(V),p.appendChild(S),p.setAttributeNS(null,"height",g*this._scale+"px"),p.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(p),this._offset=y.Point.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),pl(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ue.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=y.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const c=38.1,p=13.5,g=Math.sqrt(Math.pow(p,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[g,-1*(c-p+g)],"bottom-right":[-g,-1*(c-p+g)],left:[p,-1*(c-p)],right:[-p,-1*(c-p)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const c=s.code,p=s.charCode||s.keyCode;"Space"!==c&&"Enter"!==c&&32!==p&&13!==p||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ia(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),s&&"moveend"!==s.type||(this._pos=this._pos.round()),ue.setTransform(this._element,`${fl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`)}getOffset(){return this._offset}setOffset(s){return this._offset=y.Point.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new y.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&"auto"!==s?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const In={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qe,rt=0,yn=!1;const eu={maxWidth:100,unit:"metric"};function tu(d,s,c){const p=c&&c.maxWidth||100,g=d._container.clientHeight/2,b=d.unproject([0,g]),E=d.unproject([p,g]),S=b.distanceTo(E);if(c&&"imperial"===c.unit){const T=3.2808*S;T>5280?Zn(s,p,T/5280,d._getUIString("ScaleControl.Miles")):Zn(s,p,T,d._getUIString("ScaleControl.Feet"))}else c&&"nautical"===c.unit?Zn(s,p,S/1852,d._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Zn(s,p,S/1e3,d._getUIString("ScaleControl.Kilometers")):Zn(s,p,S,d._getUIString("ScaleControl.Meters"))}function Zn(d,s,c,p){const g=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let S=b/E;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(T){const k=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*k)/k}(S),E*S}(c);d.style.width=s*(g/c)+"px",d.innerHTML=`${g}&nbsp;${p}`}const Wr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ps=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ml(d){if(d){if("number"==typeof d){const s=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new y.Point(0,0),top:new y.Point(0,d),"top-left":new y.Point(s,s),"top-right":new y.Point(-s,s),bottom:new y.Point(0,-d),"bottom-left":new y.Point(s,-s),"bottom-right":new y.Point(-s,-s),left:new y.Point(d,0),right:new y.Point(-d,0)}}if(d instanceof y.Point||Array.isArray(d)){const s=y.Point.convert(d);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:y.Point.convert(d.center||[0,0]),top:y.Point.convert(d.top||[0,0]),"top-left":y.Point.convert(d["top-left"]||[0,0]),"top-right":y.Point.convert(d["top-right"]||[0,0]),bottom:y.Point.convert(d.bottom||[0,0]),"bottom-left":y.Point.convert(d["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(d["bottom-right"]||[0,0]),left:y.Point.convert(d.left||[0,0]),right:y.Point.convert(d.right||[0,0])}}return ml(new y.Point(0,0))}const ms={supported:hn,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:class extends hl{constructor(d){if(null!=(d=y.extend({},Zr,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pr(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new ai,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Sn,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new jt(d.transformRequest),"string"==typeof d.container){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),"undefined"!=typeof window&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Jl(this,d),this._hash=d.hash&&new wa("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,y.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Sa({customAttribution:d.customAttribution})),this.addControl(new lc,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update("style"===s.dataType),this.fire(new y.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new y.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(d,s){if(void 0===s&&(s=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const p=this._controlPositions[s];return-1!==s.indexOf("bottom")?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(d);return s>-1&&this._controls.splice(s,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}resize(d){const s=this._containerDimensions(),c=s[0],p=s[1];this._resizeCanvas(c,p),this.transform.resize(c,p),this.painter.resize(c,p);const g=!this._moving;return g&&(this.stop(),this.fire(new y.Event("movestart",d)).fire(new y.Event("move",d))),this.fire(new y.Event("resize",d)),g&&this.fire(new y.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(y.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(y.LngLat.convert(d))}unproject(d){return this.transform.pointLocation(y.Point.convert(d))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(d,s,c){if("mouseenter"===d||"mouseover"===d){let p=!1;return{layer:s,listener:c,delegates:{mousemove:b=>{const E=this.getLayer(s)?this.queryRenderedFeatures(b.point,{layers:[s]}):[];E.length?p||(p=!0,c.call(this,new xr(d,this,b.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if("mouseleave"===d||"mouseout"===d){let p=!1;return{layer:s,listener:c,delegates:{mousemove:E=>{(this.getLayer(s)?this.queryRenderedFeatures(E.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,c.call(this,new xr(d,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,c.call(this,new xr(d,this,E.originalEvent)))}}}}{const p=g=>{const b=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];b.length&&(g.features=b,c.call(this,g),delete g.features)};return{layer:s,listener:c,delegates:{[d]:p}}}}on(d,s,c){if(void 0===c)return super.on(d,s);const p=this._createDelegatedListener(d,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(d,s,c){if(void 0===c)return super.once(d,s);const p=this._createDelegatedListener(d,s,c);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(d,s,c){return void 0===c?super.off(d,s):(this._delegatedListeners&&this._delegatedListeners[d]&&(p=>{const g=this._delegatedListeners[d];for(let b=0;b<g.length;b++){const E=g[b];if(E.layer===s&&E.listener===c){for(const S in E.delegates)this.off(S,E.delegates[S]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(d,s){if(!this.style)return[];let c;if(void 0!==s||void 0===d||d instanceof y.Point||Array.isArray(d)||(s=d,d=void 0),s=s||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||"number"==typeof d[0])c=[y.Point.convert(d)];else{const p=y.Point.convert(d[0]),g=y.Point.convert(d[1]);c=[p,new y.Point(g.x,p.y),g,new y.Point(p.x,g.y),p]}return this.style.queryRenderedFeatures(c,s,this.transform)}querySourceFeatures(d,s){return this.style.querySourceFeatures(d,s)}setStyle(d,s){return!1!==(s=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(d,s))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const s=this._locale[d];if(null==s)throw new Error(`Missing UI string '${d}'`);return s}_updateStyle(d,s){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new lt(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new lt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,s){if("string"==typeof d){const c=this._requestManager.transformRequest(d,y.ResourceType.Style);y.getJSON(c,(p,g)=>{p?this.fire(new y.ErrorEvent(p)):g&&this._updateDiff(g,s)})}else"object"==typeof d&&this._updateDiff(d,s)}_updateDiff(d,s){try{this.style.setState(d)&&this._update(!0)}catch(c){y.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")}addSource(d,s){return this._lazyInitEmptyStyle(),this.style.addSource(d,s),this._update(!0)}isSourceLoaded(d){const s=this.style&&this.style.sourceCaches[d];if(void 0!==s)return s.loaded();this.fire(new y.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const s in d){const c=d[s]._tiles;for(const p in c){const g=c[p];if("loaded"!==g.state&&"errored"!==g.state)return!1}}return!0}addSourceType(d,s,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,s,c)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,s,{pixelRatio:c=1,sdf:p=!1,stretchX:g,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||y.isImageBitmap(s)){const{width:S,height:T,data:k}=y.exported.getImageData(s);this.style.addImage(d,{data:new y.RGBAImage({width:S,height:T},k),pixelRatio:c,stretchX:g,stretchY:b,content:E,sdf:p,version:0})}else{if(void 0===s.width||void 0===s.height)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:T,data:k}=s,F=s;this.style.addImage(d,{data:new y.RGBAImage({width:S,height:T},new Uint8Array(k)),pixelRatio:c,stretchX:g,stretchY:b,content:E,sdf:p,version:0,userImage:F}),F.onAdd&&F.onAdd(this,d)}}}updateImage(d,s){const c=this.style.getImage(d);if(!c)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||y.isImageBitmap(s)?y.exported.getImageData(s):s,{width:g,height:b,data:E}=p;if(void 0===g||void 0===b)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==c.data.width||b!==c.data.height)return this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(s instanceof HTMLImageElement||y.isImageBitmap(s));c.data.replace(E,S),this.style.updateImage(d,c)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,s){y.getImage(this._requestManager.transformRequest(d,y.ResourceType.Image),s)}listImages(){return this.style.listImages()}addLayer(d,s){return this._lazyInitEmptyStyle(),this.style.addLayer(d,s),this._update(!0)}moveLayer(d,s){return this.style.moveLayer(d,s),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,s,c){return this.style.setLayerZoomRange(d,s,c),this._update(!0)}setFilter(d,s,c={}){return this.style.setFilter(d,s,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,s,c,p={}){return this.style.setPaintProperty(d,s,c,p),this._update(!0)}getPaintProperty(d,s){return this.style.getPaintProperty(d,s)}setLayoutProperty(d,s,c,p={}){return this.style.setLayoutProperty(d,s,c,p),this._update(!0)}getLayoutProperty(d,s){return this.style.getLayoutProperty(d,s)}setLight(d,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,s){return this.style.setFeatureState(d,s),this._update()}removeFeatureState(d,s){return this.style.removeFeatureState(d,s),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,s=0;return this._container&&(d=this._container.clientWidth||400,s=this._container.clientHeight||300),[d,s]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map","mapboxgl-map");const s=this._canvasContainer=ue.create("div","maplibregl-canvas-container mapboxgl-canvas-container",d);this._interactive&&s.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=ue.create("canvas","maplibregl-canvas mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1]);const p=this._controlContainer=ue.create("div","maplibregl-control-container mapboxgl-control-container",d),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{g[b]=ue.create("div",`maplibregl-ctrl-${b} mapboxgl-ctrl-${b}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,s){const c=devicePixelRatio||1;this._canvas.width=c*d,this._canvas.height=c*s,this._canvas.style.width=`${d}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const d=y.extend({},hn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);s?(this.painter=new ba(s,this.transform),y.exported$1.testSupport(s)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){let s,c=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,s),c=y.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let g=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,S=y.exported.now();this.style.zoomHistory.update(E,S);const T=new y.EvaluationParameters(E,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=T.crossFadingFactor();1===k&&k===this._crossFadingFactor||(g=!0,this._crossFadingFactor=k),this.style.update(T)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=y.exported.now()-c;p.endQueryEXT(p.TIME_ELAPSED_EXT,s),setTimeout(()=>{const S=p.getQueryObjectEXT(s,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s),this.fire(new y.Event("gpu-timing-frame",{cpuTime:E,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(E);this.fire(new y.Event("gpu-timing-layer",{layerTimes:S}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty;return b||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ue.remove(this._canvasContainer),ue.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=y.exported.frame(d=>{this._frame=null,this._render(d)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,s){y.setCacheLimits(d,s)}},NavigationControl:class{constructor(d){this.options=y.extend({},dl,d),this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map.getZoom(),s=d===this._map.getMaxZoom(),c=d===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=d}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ql(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ue.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,s){const c=ue.create("button",d,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(d,s){const c=this._map._getUIString(`NavigationControl.${s}`);d.title=c,d.setAttribute("aria-label",c)}},GeolocateControl:class extends y.Evented{constructor(d){super(),this.options=y.extend({},In,d),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(d){var s;return this._map=d,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,void 0!==qe?s(qe):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(c=>{qe="denied"!==c.state,s(qe)}):(qe=!!window.navigator.geolocation,s(qe)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ue.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,rt=0,yn=!1}_isOutOfMapMaxBounds(d){const s=this._map.getMaxBounds(),c=d.coords;return s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",d)),this._finish()}}_updateCamera(d){const s=new y.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,p=this._map.getBearing(),g=y.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),g,{geolocateSource:!0})}_updateMarker(d){if(d){const s=new y.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.clientHeight/2,s=this._map.unproject([0,d]),c=this._map.unproject([1,d]),p=s.distanceTo(c),g=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&yn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=ue.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===d){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ue.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Yi(this._dotElement),this._circleElement=ue.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new y.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rt--,yn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),rt++,rt>1?(d={maximumAge:6e5,timeout:0},yn=!0):(d=this.options.positionOptions,yn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Sa,ScaleControl:class{constructor(d){this.options=y.extend({},eu,d),y.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){tu(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ue.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,tu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ue.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ue.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);ue.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends y.Evented{constructor(d){super(),this.options=y.extend(Object.create(Wr),d),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ue.remove(this._content),this._container&&(ue.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=y.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const s=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=d;p=c.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ue.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ue.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_update(d){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=ue.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=ue.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(b=>this._container.classList.add(b)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ia(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d))return;const s=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let c=this.options.anchor;const p=ml(this.options.offset);if(!c){const b=this._container.offsetWidth,E=this._container.offsetHeight;let S;S=s.y+p.bottom.y<E?["top"]:s.y>this._map.transform.height-E?["bottom"]:[],s.x<b/2?S.push("left"):s.x>this._map.transform.width-b/2&&S.push("right"),c=0===S.length?"bottom":S.join("-")}const g=s.add(p[c]).round();ue.setTransform(this._container,`${fl[c]} translate(${g.x}px,${g.y}px)`),pl(this._container,c,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ps);d&&d.focus()}_onClose(){this.remove()}},Marker:Yi,Style:lt,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){co().acquire(Ds)},clearPrewarmedResources:function(){const d=ji;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(Ds),ji=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return ut.workerCount},set workerCount(d){ut.workerCount=d},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){y.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){y.clearTileCache(d)},workerUrl:"",addProtocol(d,s){y.config.REGISTERED_PROTOCOLS[d]=s},removeProtocol(d){delete y.config.REGISTERED_PROTOCOLS[d]}};return ms}),sn}()}},Ro=>{Ro(Ro.s=705)}]);